<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

    
    
    <title>โมเดลเชิงเส้นระดับลดหลั่น</title>

        <script src="HLM_files/header-attrs-2.7/header-attrs.js"></script>
        <script src="HLM_files/jquery-1.11.3/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="HLM_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="HLM_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="HLM_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
        <script src="HLM_files/navigation-1.1/tabsets.js"></script>
        <link href="HLM_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="HLM_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="HLM_files/downcute-0.1/downcute.css" rel="stylesheet" />
        <link href="HLM_files/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
        <script src="HLM_files/downcute-0.1/downcute.js"></script>
        <script src="HLM_files/prism-1.22/prism.js"></script>
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
               <!-- downcute start -->   
   <div id="docute" class="Root">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            <ul>
            <li><a href="#เตรียมความพร้อมก่อนเรียน">เตรียมความพร้อมก่อนเรียน</a>
            <ul>
            <li><a href="#ติดตั้ง-package-ที่จำเป็น">ติดตั้ง package ที่จำเป็น</a></li>
            </ul></li>
            <li><a href="#hierarchical-linear-model-hlm"><strong>Hierarchical Linear Model (HLM)</strong></a>
            <ul>
            <li><a href="#one-way-anova-with-random-effect"><strong>One-Way ANOVA with random effect</strong></a></li>
            <li><a href="#means-as-outcomes-regression-model"><strong>Means as Outcomes Regression Model</strong></a></li>
            <li><a href="#one-way-ancova-with-random-effect"><strong>One-Way ANCOVA with random effect</strong></a></li>
            <li><a href="#random-coefficient-regression-model"><strong>Random-coefficient Regression model</strong></a></li>
            <li><a href="#intercepts-and-slopes-as-outcomes-model"><strong>Intercepts and slopes as outcomes model</strong></a></li>
            <li><a href="#non-randomly-varying-slopes"><strong>Non-randomly varying slopes</strong></a></li>
            </ul></li>
            </ul>
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle"><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
        
      <h1 class="title">โมเดลเชิงเส้นระดับลดหลั่น</h1>
      
      <p class="authors">
              

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<p style="line-height:1.3; font-size:16px; color: #353b48; text-align:right;">
สิวะโชติ ศรีสุทธิยากร </br> กนิษฐ์ ศรีเคลือบ </br> </br> ภาควิชาวิจัยและจิตวิทยาการศึกษา คณะครุศาสตร์ </br> จุฬาลงกรณ์มหาวิทยาลัย </br> </font> 6 May 2021 </font>
</p>
<div id="เตรียมความพร้อมก่อนเรียน" class="section level1">
<h1>เตรียมความพร้อมก่อนเรียน</h1>
<p style="text-indent:2.5em;">
เนื้อหาในวันนี้จะเรียนผ่านการทำกิจกรรม โดยใช้ชุดข้อมูลตัวอย่างคือชุดข้อมูล High School &amp; Beyond สำรวจโดยศูนย์สถิติการศึกษาแห่งชาติ (National Center for Educational Statistics: NCES) ของสหรัฐอเมริกาในปี ค.ศ. 1982 ประกอบด้วยข้อมูลของนักเรียนจำนวน 7,185 คน จากโรงเรียนจำนวน 160 โรงเรียน ประกอบด้วยชุดข้อมูลระดับนักเรียน <a href="https://drive.google.com/file/d/1AvFYXVcLxh3QqtKDBlpSUciUShuItBlV/view?usp=sharing">hsb1.sav</a> และชุดข้อมูลระดับโรงเรียน <a href="https://drive.google.com/file/d/1RwMRt7eRqTs2eZ7LMfJoPRubutttDWys/view?usp=sharing">hsb2.sav</a>
</p>
<p style="text-indent:2.5em;">
ชุดข้อมูลในไฟล์ hsb2.sav ประกอบด้วยตัวแปรในระดับโรงเรียนได้แก่ (1) ขนาดโรงเรียน (size) ที่วัดจากจำนวนนักเรียนในโรงเรียน (2) ประเภทของโรงเรียน (sector) ที่มี 2 ประเภทได้แก่ 1 = โรงเรียนเครือคาทอริก และ 0 = โรงเรียนรัฐบาล (3) สัดส่วนนักเรียนที่เรียนอยู่ในสายวิชาการ (pracad) (4) บรรยากาศทางระเบียบวินัย (disciplinary climate) (5) สัดส่วนของชนกลุ่มน้อย (himinty) โดย 1 = โรงเรียนที่มีชนกลุ่มน้อยมากกว่า 40% และ 0 = โรงเรียนที่มีชนกลุ่มน้อยน้อยกว่าหรือเท่ากับ 40% ของนักเรียนทั้งหมด และ (6) ค่าเฉลี่ยเศรษฐานะของนักเรียนในโรงเรียน (meanses)
</p>
<div id="ติดตั้ง-package-ที่จำเป็น" class="section level2">
<h2>ติดตั้ง package ที่จำเป็น</h2>
<p>การวิเคราะห์ HLM ด้วยโปรแกรม R จำเป็นต้อง download packages เพิ่มเติมดังนี้</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">&quot;lme4&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">&quot;lmerTest&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(lme4)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(lmerTest)</span></code></pre></div>
</div>
</div>
<div id="hierarchical-linear-model-hlm" class="section level1">
<h1><strong>Hierarchical Linear Model (HLM)</strong></h1>
<p style="text-indent:2.5em;">
สืบเนื่องจากเนื้อหาในสัปดาห์ที่ผ่านมา นิสิตได้ทราบมโนทัศน์ และประเภทของข้อมูลพหุระดับที่มีหลากหลายประเภท ในสัปดาห์นี้จะลงรายละเอียดเกี่ยวกับโมเดลทางสถิติต่าง ๆ สำหรับการวิเคราะห์ข้อมูลพหุระดับแบบระดับลดหลั่น (hierarchical data) ด้วย โมเดลที่เรียกว่า <strong>โมเดลเชิงเส้นแบบลดหลั่น (hierarchical linear model: HLM)</strong> สารสนเทศที่ได้จากโมเดลดังกล่าวจะช่่วยให้นักวิจัยสามารถวิเคราะห์และอธิบายความผันแปรที่เกิดขึ้นในตัวแปรตามที่เกิดขึ้นจากตัวแปรที่อยู่ในระดับสูงกว่าได้
</p>
<ul>
<li><a href="https://drive.google.com/file/d/1GpP-Pvc8QR17gIA4xAGGMug0d-q-DflN/view?usp=sharing">โมเดลพื้นฐานภายใต้กรอบ HLM</a></li>
</ul>
<p>โมเดล HLM ประกอบด้วยโมเดลย่อยหลายโมเดล ซึ่งครอบคลุมการวิเคราะห์ส่วนประกอบความแปรปรวนของตัวแปรตาม และการวิเคราะห์ความสัมพันธ์พหุระดับระหว่างตัวแปรตามกับตัวแปรอิสระ รายละเอียดของแต่ละโมเดลจะอธิบายผ่านการทำกิจกรรม 6 กิจกรรม ในหัวข้อต่อไป</p>
<div id="one-way-anova-with-random-effect" class="section level2">
<h2><strong>One-Way ANOVA with random effect</strong></h2>
<p>โมเดลการวิเคราะห์ความแปรปรวนทางเดียวแบบอิทธิพลสุ่มใช้สำหรับวิเคราะห์เพื่อเปรียบเทียบค่าเฉลี่ยระหว่างกลุ่มหรือระดับของปัจจัยที่ได้มาจากการสุ่ม จากชุดข้อมูล hsb1.sav ขอให้นิสิตดำเนินการดังต่อไปนี้</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># 1. importing data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">library</span>(foreign)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> dat1<span class="ot">&lt;-</span><span class="fu">read.spss</span>(<span class="st">&quot;/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/2756714/dataset/week3/hsb1.sav&quot;</span>, <span class="at">to.data.frame=</span>T)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(dat1)</span></code></pre></div>
<pre><code>  schoolid minority female    ses mathach
1     1224        0      1 -1.528   5.876
2     1224        0      1 -0.588  19.708
3     1224        0      0 -0.528  20.349
4     1224        0      0 -0.668   8.781
5     1224        0      0 -0.158  17.898
6     1224        0      0  0.022   4.583</code></pre>
<ol style="list-style-type: decimal">
<li><p>พิจารณาการแจกแจงของ <code>mathach</code></p></li>
<li><p>พิจารณาการแจกแจงของ <code>mathach</code> จำแนกตามโรงเรียน</p></li>
</ol>
<p>การแจกแจงของ <code>mathach</code> ในภาพรวมกับเมื่อจำแนกตามโรงเรียนมีความเหมือนหรือแตกต่างกันอย่างไร?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggplot2)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(gridExtra)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> dat1<span class="sc">$</span>schoolid<span class="ot">&lt;-</span><span class="fu">factor</span>(dat1<span class="sc">$</span>schoolid)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(dat1)<span class="sc">+</span><span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x=</span>mathach),<span class="at">alpha=</span><span class="fl">0.2</span>)<span class="sc">+</span><span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">40</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(dat1)<span class="sc">+</span><span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x=</span>mathach, <span class="at">fill=</span>schoolid),<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span><span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">40</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">grid.arrange</span>(p1,p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>ลองพิจารณาด้วยค่าสถิติ</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> dat1<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(mathach), <span class="at">sd=</span><span class="fu">sd</span>(mathach))</span></code></pre></div>
<pre><code>      mean       sd
1 12.74785 6.878246</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> dat1<span class="sc">%&gt;%</span><span class="fu">group_by</span>(schoolid)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(mathach), <span class="at">sd=</span><span class="fu">sd</span>(mathach))</span></code></pre></div>
<pre><code># A tibble: 160 x 3
   schoolid  mean    sd
 * &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;
 1 1224      9.72  7.59
 2 1288     13.5   7.02
 3 1296      7.64  5.35
 4 1308     16.3   6.11
 5 1317     13.2   5.46
 6 1358     11.2   5.88
 7 1374      9.73  8.36
 8 1433     19.7   3.88
 9 1436     18.1   4.55
10 1461     16.8   6.95
# … with 150 more rows</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> aggr<span class="ot">&lt;-</span>dat1<span class="sc">%&gt;%</span><span class="fu">group_by</span>(schoolid)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(mathach), <span class="at">sd=</span><span class="fu">sd</span>(mathach))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(aggr)</span></code></pre></div>
<pre><code>    schoolid        mean             sd       
 1224   :  1   Min.   : 4.24   Min.   :3.541  
 1288   :  1   1st Qu.:10.47   1st Qu.:5.592  
 1296   :  1   Median :12.90   Median :6.320  
 1308   :  1   Mean   :12.62   Mean   :6.241  
 1317   :  1   3rd Qu.:14.65   3rd Qu.:6.863  
 1358   :  1   Max.   :19.72   Max.   :8.481  
 (Other):154                                  </code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p1<span class="ot">&lt;-</span>aggr<span class="sc">%&gt;%</span><span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>mean))<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;School mathach&quot;</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p2<span class="ot">&lt;-</span>aggr<span class="sc">%&gt;%</span><span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean))<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;School mathach&quot;</span>)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">grid.arrange</span>(p1,p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-6-1.png" width="1152" /></p>
<div id="คำถามวิจัย" class="section level3">
<h3><strong>คำถามวิจัย</strong></h3>
<p>คะแนน mathach ของนักเรียนในแต่ละโรงเรียนมีความแตกต่างกันหรือไม่?</p>
</div>
<div id="โมเดลการวิเคราะห์" class="section level3">
<h3><strong>โมเดลการวิเคราะห์</strong></h3>
<p><img src="Screen%20Shot%202562-09-28%20at%2010.20.46.png" style="width:60.0%" /></p>
<p>ในกรณีนี้โมเดลการวิเคราะห์มี 2 ระดับ ได้แก่โมเดลระดับนักเรียน และโมเดลระดับโรงเรียนดังนี้</p>
<p><strong>โมเดลระดับนักเรียน (student-level model)</strong></p>
<p><span class="math inline">\(mathach_{ij}=\beta_{0j}+r_{ij}\)</span></p>
<p><strong>โมเดลระดับโรงเรียน (school-level model)</strong></p>
<p><span class="math inline">\(\beta_{0j}=\gamma_{00}+u_{0j}\)</span></p>
<p>จากสมการทั้งสองสามารถนำมารวมกันเพื่อเขียนเป็น<strong>โมเดลรวม (combined model)</strong> ได้ดังนี้</p>
<p><span class="math inline">\(mathach_{ij}=\gamma_{00}+u_{0j}+r_{ij}\)</span></p>
<p>เมื่อ <span class="math inline">\(i = 1, 2, 3, ..., n_j\)</span> และ <span class="math inline">\(j = 1, 2, 3, ..., J\)</span></p>
<p>จากสมการในโมเดลรวมข้างต้นจะเห็นว่ามีการระบุอิทธิพลที่มีต่อ <code>mathach</code> ของนักเรียน 2 ตัวได้แก่ อิทธิพลคงที่ (fixed effect) คือ <span class="math inline">\(\gamma_{00}\)</span> ที่เป็นค่าเฉลี่ยผลสัมฤทธิ์รวม (grand mean) และอิทธิพลสุ่ม (random effect) คือ <span class="math inline">\(u_{0j}\)</span> กับ <span class="math inline">\(r_{ij}\)</span> ที่เป็นความแตกต่างระหว่างโรงเรียน และระหว่างนักเรียนภายในโรงเรียนตามลำดับ โดยที่ <span class="math inline">\(u_{0j} \sim N(0, \tau_{00})\)</span> และ <span class="math inline">\(r_{ij} \sim N(0,\sigma^2)\)</span></p>
<p><strong>Note:</strong> พารามิเตอร์ในโมเดลข้างต้นมีกี่ตัว อะไรบ้าง แต่ละตัวมีความหมายอย่างไร?</p>
<p>การประมาณค่าพารามิเตอร์ในโมเดลข้างต้นด้วยโปรแกรม R สามารถทำได้โดยใช้ใช้ฟังก์ชัน <code>lmer()</code> ซึ่งจะระบุโมเดลโดยอิงจากโมเดลรวม (combined model) จากค่าพารามิเตอร์ของหน่วยข้อมูลในระดับที่ 2 เท่านั้น ในกรณีข้างต้นจึงระบุเพียงพารามิเตอร์ fixed-effect (<span class="math inline">\(\gamma_{00}\)</span>) และพารามิเตอร์ random-effect (<span class="math inline">\(u_{0j}\)</span>) ดังนี้ <code>lmer(math~1+(1|schoolid))</code></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#1. estimate the model parameters</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> null.model<span class="ot">&lt;-</span><span class="fu">lmer</span>(mathach<span class="sc">~</span><span class="dv">1</span><span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>schoolid),<span class="at">data=</span>dat1)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co">#2. extract the output</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">summary</span>(null.model)</span></code></pre></div>
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [&#39;lmerModLmerTest&#39;]
Formula: mathach ~ 1 + (1 | schoolid)
   Data: dat1

REML criterion at convergence: 47116.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.0631 -0.7539  0.0267  0.7606  2.7426 

Random effects:
 Groups   Name        Variance Std.Dev.
 schoolid (Intercept)  8.614   2.935   
 Residual             39.148   6.257   
Number of obs: 7185, groups:  schoolid, 160

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  12.6370     0.2444 156.6473   51.71   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>การวิเคราะห์ null model จะให้สารสนเทศที่สำคัญคือปริมาณความแปรปรวนในตัวแปรตามที่เกิดขึ้นอันเนื่องมาจากตัวแปร (ที่ไม่ได้สังเกตค่าในโมเดลนี้) ในแต่ละระดับ (ระดับนักเรียน/ระดับโรงเรียน) ผลการวิเคราะห์ข้างต้นจะเห็นว่า ความแปรปรวนระดับนักเรียนมีค่าเท่ากับ <span class="math inline">\(\sigma^2 = 39.148\)</span> และความแปรปรวนระดับโรงเรียนมีค่าเท่ากับ <span class="math inline">\(\tau = 8.614\)</span> ผลการวิเคราะห์นี้ทำให้สามารถประมาณค่าสถิติที่สำคัญตัวหนึ่งคือ สัมประสิทธิ์สหสัมพันธ์ภายในกลุ่ม (intraclass correlation: ICC) ดังนี้</p>
<centet><span class="math inline">\(ICC = \frac{8.614}{8.614+39.148} = .1804\)</span>
</center>
<p>ปัจจุบันการคำนวณ ICC ในข้างต้นสามารถทำได้โดยใช้ package-sjstats ดังนี้</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">&quot;sjstats&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(sjstats)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> performance<span class="sc">::</span><span class="fu">icc</span>(null.model)</span></code></pre></div>
<pre><code># Intraclass Correlation Coefficient

     Adjusted ICC: 0.180
  Conditional ICC: 0.180</code></pre>
<p>นอกจากนี้ผู้วิเคราะห์ยังสามารถเรียกผลทดสอบนัยสำคัญของอิทธิพลสุ่มในโมเดลได้ด้วยฟังก์ชัน package-ranova() ดังนี้</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">ranova</span>(null.model)</span></code></pre></div>
<pre><code>ANOVA-like table for random-effects: Single term deletions

Model:
mathach ~ (1 | schoolid)
               npar logLik   AIC    LRT Df Pr(&gt;Chisq)    
&lt;none&gt;            3 -23558 47123                         
(1 | schoolid)    2 -24052 48107 986.12  1  &lt; 2.2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="ประมาณค่าเฉลี่ยของกลุ่ม-beta_0j" class="section level3">
<h3><strong>ประมาณค่าเฉลี่ยของกลุ่ม (<span class="math inline">\(\beta_{0j}\)</span>)</strong></h3>
<p>จากโมเดลในระดับที่ 1</p>
<p><span class="math inline">\(mathach_{ij}=\beta_{0j}+r_{ij}\)</span></p>
<p>จะเห็นว่าพารามิเตอร์ <span class="math inline">\(\beta_{0j}\)</span> คือพารามิเตอร์จุดตัดแกนซึ่งในกรณีนี้มีความหมายเป็นค่าเฉลี่ยผลสัมฤทธิ์ทางการเรียนวิชาคณิตศาสตร์ของแต่ละโรงเรียน (group mean) เมื่อ <span class="math inline">\(j=1,2,...,J\)</span></p>
<p>การประมาณค่าเฉลี่ยของกลุ่มดังกล่าวใน R สามารถเขียนคำสั่งได้ดังนี้</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> intercept<span class="ot">&lt;-</span><span class="fu">coef</span>(null.model)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> intercept<span class="ot">&lt;-</span>intercept[<span class="dv">1</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(intercept<span class="sc">$</span>schoolid)</span></code></pre></div>
<pre><code>  (Intercept)    
 Min.   : 5.234  
 1st Qu.:10.731  
 Median :12.871  
 Mean   :12.637  
 3rd Qu.:14.463  
 Max.   :19.115  </code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(intercept<span class="sc">$</span>schoolid)<span class="ot">&lt;-</span><span class="st">&quot;group.mean&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> intercept<span class="sc">$</span>schoolid<span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>       <span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>group.mean))<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>          <span class="fu">xlab</span>(<span class="fu">expression</span>(beta[<span class="dv">0</span>[j]]<span class="sc">==</span>gamma[<span class="dv">00</span>]<span class="sc">+</span>u[<span class="dv">0</span>[j]]))<span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>         <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-11-1.png" width="768" /></p>
<p>จากผลการวิเคราะห์ข้างต้นจะเห็นว่าผลสัมฤทธิ์ทางการเรียนเฉลี่ยในระดับโรงเรียนมีค่าอยู่ในช่วง 5.234 ถึง 19.115</p>
</div>
<div id="การวินิจฉัยความเหมาะสมของโมเดลการวิเคราะห์" class="section level3">
<h3><strong>การวินิจฉัยความเหมาะสมของโมเดลการวิเคราะห์</strong></h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#calculate level-1 residuals</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> res1<span class="ot">&lt;-</span><span class="fu">residuals</span>(null.model)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co">#calculae level-2 residuals</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> res2<span class="ot">&lt;-</span>dat1<span class="sc">$</span>mathach<span class="fl">-12.6370</span><span class="sc">-</span>res1</span></code></pre></div>
<p><strong>(1) normality</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">hist</span>(res1)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">hist</span>(res2)</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-13-1.png" width="1152" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(ggpubr)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p1<span class="ot">&lt;-</span><span class="fu">ggqqplot</span>(res1)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> p2<span class="ot">&lt;-</span><span class="fu">ggqqplot</span>(res2)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">grid.arrange</span>(p1,p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-13-2.png" width="1152" /></p>
<p><strong>(2) homogeneity of variances</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="ot">&lt;-</span>dat1</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">$</span>e2<span class="ot">&lt;-</span>res1<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">$</span>res1<span class="ot">&lt;-</span>res1</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">$</span>schoolid<span class="ot">&lt;-</span><span class="fu">factor</span>(temp<span class="sc">$</span>schoolid)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">%&gt;%</span><span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y=</span>res1,<span class="at">fill=</span>schoolid),<span class="at">show.legend=</span>F)<span class="sc">+</span><span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-14-1.png" width="1152" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">%&gt;%</span><span class="fu">group_by</span>(schoolid)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">var=</span><span class="fu">var</span>(res1))<span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>       <span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>var))<span class="sc">+</span><span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-14-2.png" width="1152" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> temp<span class="sc">%&gt;%</span><span class="fu">group_by</span>(schoolid)<span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="at">var=</span><span class="fu">var</span>(res1))<span class="sc">%&gt;%</span><span class="fu">summary</span>()</span></code></pre></div>
<pre><code>    schoolid        var       
 1224   :  1   Min.   :12.54  
 1288   :  1   1st Qu.:31.27  
 1296   :  1   Median :39.94  
 1308   :  1   Mean   :39.75  
 1317   :  1   3rd Qu.:47.10  
 1358   :  1   Max.   :71.93  
 (Other):154                  </code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#log-determinant criterion</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">log</span>(<span class="fl">71.93</span>)<span class="sc">/</span><span class="fu">log</span>(<span class="fl">12.54</span>)</span></code></pre></div>
<pre><code>[1] 1.690717</code></pre>
<hr />
</div>
</div>
<div id="means-as-outcomes-regression-model" class="section level2">
<h2><strong>Means as Outcomes Regression Model</strong></h2>
<p>จากผลการวิเคราะห์ใน nullmodel จะเห็นว่าสามารถแยกส่วนประกอบความแปรปรวนในผลสัมฤทธิ์ทางการเรียนวิชาคณิตศาสตร์ได้เป็นสองส่วนได้แก่ ความแปรปรวนระดับนักเรียน และความแปรปรวนในระดับโรงเรียน ดังนี้</p>
<p><span class="math inline">\(Var(mathach_{ij})=\tau_{00}+\sigma^2=8.614 + 39.148\)</span></p>
<p>โดยพบว่าความแปรปรวนในระดับโรงเรียน (<span class="math inline">\(\tau_{00}\)</span>) มีนัยสำคัญทั้งเชิงสถิติและเชิงปฏิบัติ แสดงว่าผลสัมฤทธิ์ทางการเรียนวิชาคณิตศาสตร์ของนักเรียนในระดับโรงเรียน (group means) มีความแตกต่างกันไปตามโรงเรียนที่แตกต่างกันด้วย (<span class="math inline">\(\beta_j \neq \beta{j&#39;}\)</span> เมื่อ <span class="math inline">\(j \neq j&#39;\)</span>)</p>
<p>เมื่อพบว่าค่าเฉลี่ยของกลุ่มมีความแตกต่างกันไปตามหน่วยข้อมูลซึ่งก็คือโรงเรียน ในงานวิจัยบางงานจึงมีความสนใจที่จะอธิบายความผันแปรของค่าเฉลี่ยดังกล่าว โดยอาจหาตัวแปรอิสระในระดับโรงเรียนมาอธิบาย โมเดลการวิเคราะห์ในกรณีนี้จึงจะมีการเพิ่มตัวแปรอิสระในโมเดลระดับโรงเรียนเพื่ออธิบายความผันแปรในพารามิเตอร์ intercept เรียกโมเดลการวิเคราะห์นี้ว่า mean as outcome regression model หรือ โมเดลสัมประสิทธิ์จุดตัดแกนสุ่ม (random intercept model)</p>
<div id="คำถามวิจัย-1" class="section level3">
<h3><strong>คำถามวิจัย</strong></h3>
<p>เศรษฐานะของนักเรียนในระดับโรงเรียนส่งผลต่อคะแนนเฉลี่ยผลสัมฤทธิ์ทางการเรียนคณิตศาสตร์ของนักเรียนในระดับโรงเรียนหรือไม่?</p>
</div>
<div id="โมเดลการวิเคราะห์-1" class="section level3">
<h3><strong>โมเดลการวิเคราะห์</strong></h3>
<p><img src="Screen%20Shot%202562-09-28%20at%2010.35.59.png" style="width:60.0%" /></p>
<p>พารามิเตอร์ในโมเดลข้างต้นมีกี่ตัว อะไรบ้าง?</p>
<p>เนื่องจากโมเดลการวิเคราะห์นี้จำเป็นต้องใช้ข้อมูลของตัวแปรอิสระในระดับโรงเรียน คือ <code>meanses</code> มาเป็นตัวแปรอธิบายความผันแปรที่เกิดขึ้นในค่าเฉลี่ยผลสัมฤทธิ์ในระดับโรงเรียน การวิเคราะห์จึงจำเป็นต้องมีการเตรียมชุดข้อมูลให้พร้อมก่อนการวิเคราะห์ด้วยการรวมชุดข้อมูล hsb1.sav และ hsb2.sav เข้าด้วยกัน ในโปรแกรม R อาจใช้ฟังก์ชัน <code>merge()</code> ดังนี้</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># hsb1.sav</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> dat1<span class="ot">&lt;-</span><span class="fu">read.spss</span>(<span class="st">&quot;/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/2756714/dataset/week3/hsb1.sav&quot;</span>, <span class="at">to.data.frame=</span>T)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(dat1)</span></code></pre></div>
<pre><code>  schoolid minority female    ses mathach
1     1224        0      1 -1.528   5.876
2     1224        0      1 -0.588  19.708
3     1224        0      0 -0.528  20.349
4     1224        0      0 -0.668   8.781
5     1224        0      0 -0.158  17.898
6     1224        0      0  0.022   4.583</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># hsb2.sav</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> dat2<span class="ot">&lt;-</span><span class="fu">read.spss</span>(<span class="st">&quot;/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/2756714/dataset/week3/hsb2.sav&quot;</span>, <span class="at">to.data.frame=</span>T)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(dat2)</span></code></pre></div>
<pre><code>  schoolid size sector pracad disclim himnty meanses
1     1224  842      0   0.35   1.597      0  -0.428
2     1288 1855      0   0.27   0.174      0   0.128
3     1296 1719      0   0.32  -0.137      1  -0.420
4     1308  716      1   0.96  -0.622      0   0.534
5     1317  455      1   0.95  -1.694      1   0.351
6     1358 1430      0   0.25   1.535      0  -0.014</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># merge dataset</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> dat<span class="ot">&lt;-</span><span class="fu">merge</span>(dat2,dat1,<span class="at">by=</span><span class="st">&quot;schoolid&quot;</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">str</span>(dat)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   7185 obs. of  11 variables:
 $ schoolid: num  1224 1224 1224 1224 1224 ...
 $ size    : num  842 842 842 842 842 842 842 842 842 842 ...
 $ sector  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ pracad  : num  0.35 0.35 0.35 0.35 0.35 0.35 0.35 0.35 0.35 0.35 ...
 $ disclim : num  1.6 1.6 1.6 1.6 1.6 ...
 $ himnty  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ meanses : num  -0.428 -0.428 -0.428 -0.428 -0.428 -0.428 -0.428 -0.428 -0.428 -0.428 ...
 $ minority: num  0 0 0 0 0 0 0 0 0 0 ...
 $ female  : num  1 1 0 0 0 0 1 0 1 0 ...
 $ ses     : num  -1.528 -0.588 -0.528 -0.668 -0.158 ...
 $ mathach : num  5.88 19.71 20.35 8.78 17.9 ...</code></pre>
<p>เมื่อยุบรวมชุดข้อมูลแล้ว สามารถประมาณค่าพารามิเตอร์ในโมเดลโดยกำหนดโมเดลในฟังก์ชัน <code>lmer()</code> ด้วยหลักภาษาเหมือนเดิมดังนี้</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> mean.model<span class="ot">&lt;-</span><span class="fu">lmer</span>(mathach<span class="sc">~</span>meanses<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>schoolid),<span class="at">data=</span>dat)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(mean.model)</span></code></pre></div>
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: mathach ~ meanses + (1 | schoolid)
   Data: dat

REML criterion at convergence: 46961.3

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.13480 -0.75256  0.02409  0.76773  2.78501 

Random effects:
 Groups   Name        Variance Std.Dev.
 schoolid (Intercept)  2.639   1.624   
 Residual             39.157   6.258   
Number of obs: 7185, groups:  schoolid, 160

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  12.6494     0.1493 153.7425   84.74   &lt;2e-16 ***
meanses       5.8635     0.3615 153.4067   16.22   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
        (Intr)
meanses -0.004</code></pre>
<p>ผลการวิเคราะห์ข้างต้นหมายความว่าอย่างไร??</p>
<p><a href="https://www.menti.com/9erio6kmvk" class="uri">https://www.menti.com/9erio6kmvk</a> &lt;— คลิ้กเลย</p>
<hr />
</div>
</div>
<div id="one-way-ancova-with-random-effect" class="section level2">
<h2><strong>One-Way ANCOVA with random effect</strong></h2>
<p>ผลการวิเคราะห์ null model เราทราบแล้วว่าความแปรปรวนระหว่างกลุ่ม (ระหว่างโรงเรียน) มีนัยสำคัญทางสถิติ ซึ่งให้ข้อสรุปว่า ผลสัมฤทธิ์ทางการเรียนของนักเรียนในแต่ละโรงเรียนมีค่าเฉลี่ยที่แตกต่างกัน อย่างไรก็ตามอาจมีข้อสงสัยว่าความแตกต่างที่เกิดขึ้นนั้นไม่ได้เป็นเพราะการบริหารจัดการของโรงเรียนแต่เพียงอย่างเดียว แต่อาจะเป็นเพราะพื้นฐานทางบ้านของผู้เรียนในแต่ละโรงเรียนไม่เท่าเทียมกันด้วย เพื่อพิสูจน์ข้อสงสัยนี้ผู้วิจัยจึงนำตัวแปรเศรษฐานะ (ses) ของผู้เรียนมาเป็นตัวแปรควบคุมในโมเดล และทำการวิเคราะห์โดยใช้เทคนิคการวิเคราะห์ความแปรปรวนร่วม ดังนี้</p>
<div id="คำถามวิจัย-2" class="section level3">
<h3><strong>คำถามวิจัย</strong></h3>
<p>เมื่อมีการควบคุมปัจจัยด้านเศรษฐานะให้คงที่ ผลสัมฤทธิ์ของนักเรียนในระดับโรงเรียนมีความแตกต่างกันหรือไม่ อย่างไร?</p>
</div>
<div id="โมเดลการวิเคราะห์-2" class="section level3">
<h3><strong>โมเดลการวิเคราะห์</strong></h3>
<p><img src="Screen%20Shot%202562-09-28%20at%2011.29.31.png" style="width:60.0%" /></p>
<p>เพื่อให้ค่าจุดตัดแกนมีความหมายและสามารถแปลความได้อย่างสมบูรณ์ การวิเคราะห์ความแปรปรวนร่วมจึงมักมีการ centering ตัวแปรควบคุมก่อนการวิเคราะห์ ดังนี้</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#centering ses by groupmean</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ses.cen<span class="ot">&lt;-</span>dat<span class="sc">$</span>ses<span class="sc">-</span>dat<span class="sc">$</span>meanses</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> dat<span class="sc">$</span>ses.cen<span class="ot">&lt;-</span>ses.cen</span></code></pre></div>
<p>การประมาณค่าพารามิเตอร์ในโมเดลการวิเคราะห์สามารถทำได้ดังนี้</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> ancova.model<span class="ot">&lt;-</span><span class="fu">lmer</span>(mathach<span class="sc">~</span>ses.cen<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>schoolid),<span class="at">data=</span>dat,<span class="at">REML=</span>F)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(ancova.model)</span></code></pre></div>
<pre><code>Linear mixed model fit by maximum likelihood . t-tests use Satterthwaite&#39;s
  method [lmerModLmerTest]
Formula: mathach ~ ses.cen + (1 | schoolid)
   Data: dat

     AIC      BIC   logLik deviance df.resid 
 46728.4  46755.9 -23360.2  46720.4     7181 

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.09692 -0.73196  0.01945  0.75739  2.91423 

Random effects:
 Groups   Name        Variance Std.Dev.
 schoolid (Intercept)  8.612   2.935   
 Residual             37.005   6.083   
Number of obs: 7185, groups:  schoolid, 160

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)   12.6494     0.2437  157.7181   51.90   &lt;2e-16 ***
ses.cen        2.1912     0.1086 7023.0025   20.17   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
        (Intr)
ses.cen 0.003 </code></pre>
<p>โมเดล random effect ANCOVA มีลักษณะเกือบเหมือนกับโมเดล ANCOVA แบบปกติ ต่างกันเพียงอิทธิพลของตัวแปรอิสระแบบจัดประเภทที่มีต่อตัวแปรตามเป็นอิทธิพลแบบสุ่ม ดังนั้นข้อตกลงเบื้องต้นของโมเดล random effect ANCOVA จึงเหมือนกับโมเดล ANCOVA แบบปกติทุกประการ ข้อตกลงเบื้องต้นที่สำคัญคือ homogeneity of regression slope ที่กำหนดให้สัมประสิทธิ์ความชันของตัวแปร covariate มีค่าเท่ากันในแต่ละกลุ่มหรือระดับของปัจจัย</p>
<p>นิสิตคิดว่า assumption ดังกล่าวเป็นจริงในข้อมูลชุดนี้หรือไม่? จะตรวจสอบได้อย่างไร? และหากไม่เป็นจริงจะแก้ปัญหาอย่างไร?</p>
<hr />
</div>
</div>
<div id="random-coefficient-regression-model" class="section level2">
<h2><strong>Random-coefficient Regression model</strong></h2>
<p>โมเดลนี้มีลักษณะเฉพาะคือมีการกำหนดให้สัมประสิทธิ์ความถดถอยทั้งหมดของโมเดลเป็นอิทธิพลแบบสุ่ม ซึ่งทำให้จุดตัดแกนและอิทธิพลของตัวแปรอิสระที่มีต่อตัวแปรตามมีความแตกต่างกันอย่างสุ่มระหว่างกลุ่ม</p>
<div id="คำถามวิจัย-3" class="section level3">
<h3><strong>คำถามวิจัย</strong></h3>
<ul>
<li><p>อิทธิพลของ ses ที่มีต่อ mathach มีความแตกต่างกันระหว่างโรงเรียนหรือไม่</p></li>
<li><p>เมื่อควบคุมอิทธิพลสุ่มของ ses ให้คงที่ แล้ว mathach ในระดับโรงเรียนมีความแตกต่างกันหรือไม่</p></li>
<li><p>คุณภาพและความเหลื่อมล้ำทางการศึกษาของแต่ละโรงเรียนเป็นอย่างไร</p></li>
</ul>
</div>
<div id="โมเดลการวิเคราะห์-3" class="section level3">
<h3><strong>โมเดลการวิเคราะห์</strong></h3>
<p><img src="Screen%20Shot%202562-09-28%20at%2012.34.06.png" style="width:60.0%" /></p>
<p>การกำหนดโมเดลการวิเคราะห์ในฟังก์ชัน <code>lmer()</code> สามารถทำได้ในทำนองเดียวกัน ดังนี้</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> random.coef<span class="ot">&lt;-</span><span class="fu">lmer</span>(mathach<span class="sc">~</span>ses.cen<span class="sc">+</span>(<span class="dv">1</span><span class="sc">+</span>ses.cen<span class="sc">|</span>schoolid), <span class="at">data=</span>dat)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(random.coef)</span></code></pre></div>
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: mathach ~ ses.cen + (1 + ses.cen | schoolid)
   Data: dat

REML criterion at convergence: 46714.2

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.09680 -0.73194  0.01858  0.75388  2.89928 

Random effects:
 Groups   Name        Variance Std.Dev. Corr
 schoolid (Intercept)  8.682   2.9465       
          ses.cen      0.694   0.8331   0.02
 Residual             36.700   6.0581       
Number of obs: 7185, groups:  schoolid, 160

Fixed effects:
            Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)  12.6493     0.2445 156.7391   51.73   &lt;2e-16 ***
ses.cen       2.1932     0.1283 155.2180   17.10   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
        (Intr)
ses.cen 0.012 </code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="ot">&lt;-</span><span class="fu">coef</span>(random.coef)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="ot">&lt;-</span>coef<span class="sc">$</span>schoolid</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">names</span>(coef)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;quality&quot;</span>,<span class="st">&quot;ineq&quot;</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="sc">$</span>schoolid<span class="ot">&lt;-</span><span class="fu">rownames</span>(coef)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> sector<span class="ot">&lt;-</span>dat<span class="sc">%&gt;%</span><span class="fu">select</span>(schoolid, sector)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="ot">&lt;-</span><span class="fu">merge</span>(coef,sector, <span class="at">by=</span><span class="st">&quot;schoolid&quot;</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="sc">$</span>sector<span class="ot">&lt;-</span><span class="fu">factor</span>(coef<span class="sc">$</span>sector, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Public&quot;</span>,<span class="st">&quot;Catholic&quot;</span>))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> coef<span class="sc">%&gt;%</span><span class="fu">ggplot</span>()<span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>ineq, <span class="at">y=</span>quality,<span class="at">col=</span>sector))</span></code></pre></div>
<p><img src="HLM_files/figure-html/unnamed-chunk-21-1.png" width="960" /></p>
<hr />
</div>
</div>
<div id="intercepts-and-slopes-as-outcomes-model" class="section level2">
<h2><strong>Intercepts and slopes as outcomes model</strong></h2>
<p><img src="Screen%20Shot%202562-09-28%20at%2012.37.18.png" style="width:60.0%" /></p>
<hr />
</div>
<div id="non-randomly-varying-slopes" class="section level2">
<h2><strong>Non-randomly varying slopes</strong></h2>
<p><img src="Screen%20Shot%202562-09-28%20at%2012.05.01.png" style="width:60.0%" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nonrandom.model<span class="ot">&lt;-</span><span class="fu">lmer</span>(mathach<span class="sc">~</span>ses<span class="sc">+</span>sector<span class="sc">+</span>ses<span class="sc">*</span>sector<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>schoolid),<span class="at">data=</span>dat)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">summary</span>(nonrandom.model)</span></code></pre></div>
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
lmerModLmerTest]
Formula: mathach ~ ses + sector + ses * sector + (1 | schoolid)
   Data: dat

REML criterion at convergence: 46574.2

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-3.07709 -0.72532  0.01753  0.76025  3.02224 

Random effects:
 Groups   Name        Variance Std.Dev.
 schoolid (Intercept)  3.694   1.922   
 Residual             36.840   6.070   
Number of obs: 7185, groups:  schoolid, 160

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)   11.7980     0.2285  155.1103  51.629  &lt; 2e-16 ***
ses            2.9512     0.1406 6843.1069  20.989  &lt; 2e-16 ***
sector         2.1382     0.3413  148.0143   6.264 3.87e-09 ***
ses:sector    -1.3128     0.2120 6719.6983  -6.193 6.26e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Correlation of Fixed Effects:
           (Intr) ses    sector
ses         0.084              
sector     -0.669 -0.057       
ses:sector -0.056 -0.663 -0.017</code></pre>
<center>
<img src="/Users/siwachoat/Library/Mobile%20Documents/com~apple~CloudDocs/%E0%B9%80%E0%B8%AD%E0%B8%81%E0%B8%AA%E0%B8%B2%E0%B8%A3%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%81%E0%B8%AD%E0%B8%9A%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%AA%E0%B8%AD%E0%B8%99/2758501%20STAT%20info%20ED/%E0%B8%A0%E0%B8%B2%E0%B8%84%E0%B8%95%E0%B9%89%E0%B8%99%202562/page/edustat%20(1).png" style="width:20.0%" />
</center>
</div>
</div>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
