<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="ผศ.ดร.สิวะโชติ ศรีสุทธิยากร">

<title>หลักการเรียนรู้ของเครื่องและการประยุกต์</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="หนังสือ_ML_pdf_files/libs/clipboard/clipboard.min.js"></script>
<script src="หนังสือ_ML_pdf_files/libs/quarto-html/quarto.js"></script>
<script src="หนังสือ_ML_pdf_files/libs/quarto-html/popper.min.js"></script>
<script src="หนังสือ_ML_pdf_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="หนังสือ_ML_pdf_files/libs/quarto-html/anchor.min.js"></script>
<link href="หนังสือ_ML_pdf_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="หนังสือ_ML_pdf_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="หนังสือ_ML_pdf_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="หนังสือ_ML_pdf_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="หนังสือ_ML_pdf_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="หนังสือ_ML_pdf_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="หนังสือ_ML_pdf_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#บทท-1-ความรพนฐานเกยวกบการเรยนรของเครอง" id="toc-บทท-1-ความรพนฐานเกยวกบการเรยนรของเครอง" class="nav-link active" data-scroll-target="#บทท-1-ความรพนฐานเกยวกบการเรยนรของเครอง">บทที่ 1 ความรู้พื้นฐานเกี่ยวกับการเรียนรู้ของเครื่อง</a>
  <ul class="collapse">
  <li><a href="#whats-algorithms" id="toc-whats-algorithms" class="nav-link" data-scroll-target="#whats-algorithms">1.1 What’s algorithms?</a></li>
  <li><a href="#กจกรรม-rule-based-algorithm" id="toc-กจกรรม-rule-based-algorithm" class="nav-link" data-scroll-target="#กจกรรม-rule-based-algorithm">1.2 กิจกรรม Rule-based algorithm</a></li>
  <li><a href="#ai-vs-ml-vs-dl" id="toc-ai-vs-ml-vs-dl" class="nav-link" data-scroll-target="#ai-vs-ml-vs-dl">1.3 AI vs ML vs DL</a></li>
  <li><a href="#data-analysis-vs-data-analytics" id="toc-data-analysis-vs-data-analytics" class="nav-link" data-scroll-target="#data-analysis-vs-data-analytics">1.4 Data Analysis vs Data Analytics</a></li>
  <li><a href="#types-of-machine-learning" id="toc-types-of-machine-learning" class="nav-link" data-scroll-target="#types-of-machine-learning">1.5 Types of Machine Learning?</a>
  <ul class="collapse">
  <li><a href="#supervised-learning" id="toc-supervised-learning" class="nav-link" data-scroll-target="#supervised-learning">Supervised Learning</a></li>
  <li><a href="#unsupervised-learning" id="toc-unsupervised-learning" class="nav-link" data-scroll-target="#unsupervised-learning">Unsupervised Learning</a></li>
  <li><a href="#reinforcement-learning" id="toc-reinforcement-learning" class="nav-link" data-scroll-target="#reinforcement-learning">Reinforcement Learning</a></li>
  </ul></li>
  <li><a href="#ตวอยางการประยกตใช-ml-ทางการศกษา-การบาน" id="toc-ตวอยางการประยกตใช-ml-ทางการศกษา-การบาน" class="nav-link" data-scroll-target="#ตวอยางการประยกตใช-ml-ทางการศกษา-การบาน">1.6 ตัวอย่างการประยุกต์ใช้ ML ทางการศึกษา (การบ้าน)</a></li>
  </ul></li>
  <li><a href="#บทท-2-ความรพนฐานในการพฒนา-supervised-learning" id="toc-บทท-2-ความรพนฐานในการพฒนา-supervised-learning" class="nav-link" data-scroll-target="#บทท-2-ความรพนฐานในการพฒนา-supervised-learning">บทที่ 2 ความรู้พื้นฐานในการพัฒนา Supervised Learning</a>
  <ul class="collapse">
  <li><a href="#ตดตง-r-และ-rstudio" id="toc-ตดตง-r-และ-rstudio" class="nav-link" data-scroll-target="#ตดตง-r-และ-rstudio">2.1 ติดตั้ง R และ RStudio</a></li>
  <li><a href="#ตดตง-anaconda" id="toc-ตดตง-anaconda" class="nav-link" data-scroll-target="#ตดตง-anaconda">2.2 ติดตั้ง Anaconda</a></li>
  <li><a href="#กจกรรม-my-first-regression" id="toc-กจกรรม-my-first-regression" class="nav-link" data-scroll-target="#กจกรรม-my-first-regression">2.3 กิจกรรม My First Regression</a>
  <ul class="collapse">
  <li><a href="#fitting-linear-regression-using-lm" id="toc-fitting-linear-regression-using-lm" class="nav-link" data-scroll-target="#fitting-linear-regression-using-lm">Fitting Linear Regression using <code>lm()</code></a></li>
  <li><a href="#evaluation-metrics" id="toc-evaluation-metrics" class="nav-link" data-scroll-target="#evaluation-metrics">Evaluation Metrics</a></li>
  </ul></li>
  <li><a href="#กจกรรม-my-first-classification" id="toc-กจกรรม-my-first-classification" class="nav-link" data-scroll-target="#กจกรรม-my-first-classification">2.4 กิจกรรม My First Classification</a>
  <ul class="collapse">
  <li><a href="#fitting-logistic-regression-model-using-glm" id="toc-fitting-logistic-regression-model-using-glm" class="nav-link" data-scroll-target="#fitting-logistic-regression-model-using-glm">Fitting Logistic Regression Model using <code>glm()</code></a></li>
  <li><a href="#evaluation-metrics-1" id="toc-evaluation-metrics-1" class="nav-link" data-scroll-target="#evaluation-metrics-1">Evaluation Metrics</a></li>
  <li><a href="#คำถามทายบท" id="toc-คำถามทายบท" class="nav-link" data-scroll-target="#คำถามทายบท">คำถามท้ายบท</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#บทท-3-กระบวนการพฒนา-machine-learning-models" id="toc-บทท-3-กระบวนการพฒนา-machine-learning-models" class="nav-link" data-scroll-target="#บทท-3-กระบวนการพฒนา-machine-learning-models">บทที่ 3 กระบวนการพัฒนา Machine Learning Models</a>
  <ul class="collapse">
  <li><a href="#bias-and-variance-in-ml-models" id="toc-bias-and-variance-in-ml-models" class="nav-link" data-scroll-target="#bias-and-variance-in-ml-models">3.1 Bias and Variance in ML models</a></li>
  <li><a href="#underfitting-overfitting-และ-good-fit-models" id="toc-underfitting-overfitting-และ-good-fit-models" class="nav-link" data-scroll-target="#underfitting-overfitting-และ-good-fit-models">3.2 Underfitting, Overfitting และ Good fit models</a></li>
  <li><a href="#training-validation-and-test-dataset" id="toc-training-validation-and-test-dataset" class="nav-link" data-scroll-target="#training-validation-and-test-dataset">3.3 Training, validation, and Test Dataset</a></li>
  <li><a href="#data-partitioning" id="toc-data-partitioning" class="nav-link" data-scroll-target="#data-partitioning">3.4 Data Partitioning</a>
  <ul class="collapse">
  <li><a href="#ชดขอมล-mpg" id="toc-ชดขอมล-mpg" class="nav-link" data-scroll-target="#ชดขอมล-mpg">ชุดข้อมูล <code>mpg</code></a></li>
  <li><a href="#การแบงขอมลดวยการสมอยางงาย" id="toc-การแบงขอมลดวยการสมอยางงาย" class="nav-link" data-scroll-target="#การแบงขอมลดวยการสมอยางงาย">การแบ่งข้อมูลด้วยการสุ่มอย่างง่าย</a></li>
  <li><a href="#การแบงขอมลดวยการสมแบบชนภม" id="toc-การแบงขอมลดวยการสมแบบชนภม" class="nav-link" data-scroll-target="#การแบงขอมลดวยการสมแบบชนภม">การแบ่งข้อมูลด้วยการสุ่มแบบชั้นภูมิ</a></li>
  </ul></li>
  <li><a href="#การสมซำ-resampling" id="toc-การสมซำ-resampling" class="nav-link" data-scroll-target="#การสมซำ-resampling">3.5 การสุ่มซ้ำ (resampling)</a>
  <ul class="collapse">
  <li><a href="#k-fold-cross-validation-และวธการอน-ๆ-ทเกยวของ" id="toc-k-fold-cross-validation-และวธการอน-ๆ-ทเกยวของ" class="nav-link" data-scroll-target="#k-fold-cross-validation-และวธการอน-ๆ-ทเกยวของ">K-fold Cross-Validation และวิธีการอื่น ๆ ที่เกี่ยวข้อง</a></li>
  <li><a href="#monte-carlo-cross-validation" id="toc-monte-carlo-cross-validation" class="nav-link" data-scroll-target="#monte-carlo-cross-validation">Monte Carlo Cross-Validation</a></li>
  <li><a href="#bootstraping" id="toc-bootstraping" class="nav-link" data-scroll-target="#bootstraping">Bootstraping</a></li>
  </ul></li>
  <li><a href="#tidymodels-framework" id="toc-tidymodels-framework" class="nav-link" data-scroll-target="#tidymodels-framework">3.6 Tidymodels Framework</a>
  <ul class="collapse">
  <li><a href="#fitting-linear-regression-using-parsnip" id="toc-fitting-linear-regression-using-parsnip" class="nav-link" data-scroll-target="#fitting-linear-regression-using-parsnip">Fitting Linear Regression using parsnip</a></li>
  <li><a href="#fitting-classification-models-logistic-regression-using-parsnip" id="toc-fitting-classification-models-logistic-regression-using-parsnip" class="nav-link" data-scroll-target="#fitting-classification-models-logistic-regression-using-parsnip">Fitting Classification models (logistic regression) using parsnip</a></li>
  </ul></li>
  <li><a href="#scikit-learn-library" id="toc-scikit-learn-library" class="nav-link" data-scroll-target="#scikit-learn-library">3.6 Scikit-Learn library</a></li>
  <li><a href="#กจกรรมพฒนา-regression-model-ดวย-tidymodel-framework" id="toc-กจกรรมพฒนา-regression-model-ดวย-tidymodel-framework" class="nav-link" data-scroll-target="#กจกรรมพฒนา-regression-model-ดวย-tidymodel-framework">3.7 กิจกรรมพัฒนา regression model ด้วย tidymodel framework</a></li>
  <li><a href="#สรป" id="toc-สรป" class="nav-link" data-scroll-target="#สรป">สรุป</a></li>
  </ul></li>
  <li><a href="#บทท-4-การเตรยมขอมล-data-preprocessing" id="toc-บทท-4-การเตรยมขอมล-data-preprocessing" class="nav-link" data-scroll-target="#บทท-4-การเตรยมขอมล-data-preprocessing">บทที่ 4 การเตรียมข้อมูล (data preprocessing)</a>
  <ul class="collapse">
  <li><a href="#ภาพรวมและความสำคญของ-data-preprocessing" id="toc-ภาพรวมและความสำคญของ-data-preprocessing" class="nav-link" data-scroll-target="#ภาพรวมและความสำคญของ-data-preprocessing">4.1 ภาพรวมและความสำคัญของ Data Preprocessing</a></li>
  <li><a href="#ประเภทของ-data-preprocessing" id="toc-ประเภทของ-data-preprocessing" class="nav-link" data-scroll-target="#ประเภทของ-data-preprocessing">4.2 ประเภทของ Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#การทำความสะอาดขอมล-data-cleaning" id="toc-การทำความสะอาดขอมล-data-cleaning" class="nav-link" data-scroll-target="#การทำความสะอาดขอมล-data-cleaning">การทำความสะอาดข้อมูล (data cleaning)</a></li>
  <li><a href="#การแปลงขอมล-data-transformation" id="toc-การแปลงขอมล-data-transformation" class="nav-link" data-scroll-target="#การแปลงขอมล-data-transformation">การแปลงข้อมูล (data transformation)</a></li>
  <li><a href="#การคดเลอกตวแปร-feature-selection" id="toc-การคดเลอกตวแปร-feature-selection" class="nav-link" data-scroll-target="#การคดเลอกตวแปร-feature-selection">การคัดเลือกตัวแปร (feature selection)</a></li>
  </ul></li>
  <li><a href="#พนฐาน-recipe-สำหรบทำ-data-preprocessing" id="toc-พนฐาน-recipe-สำหรบทำ-data-preprocessing" class="nav-link" data-scroll-target="#พนฐาน-recipe-สำหรบทำ-data-preprocessing">4.3 พื้นฐาน <code>recipe</code> สำหรับทำ Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#การดาวนโหลดและตดตง-package" id="toc-การดาวนโหลดและตดตง-package" class="nav-link" data-scroll-target="#การดาวนโหลดและตดตง-package">การดาวน์โหลดและติดตั้ง package</a></li>
  <li><a href="#ขนตอนการทำ-data-preprocessing-ดวย-recipe" id="toc-ขนตอนการทำ-data-preprocessing-ดวย-recipe" class="nav-link" data-scroll-target="#ขนตอนการทำ-data-preprocessing-ดวย-recipe">ขั้นตอนการทำ data preprocessing ด้วย recipe</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#บทท-5-decision-tree-part-i" id="toc-บทท-5-decision-tree-part-i" class="nav-link" data-scroll-target="#บทท-5-decision-tree-part-i">บทที่ 5 Decision Tree (Part I)</a>
  <ul class="collapse">
  <li><a href="#มโนทศนสำคญของ-decision-tree" id="toc-มโนทศนสำคญของ-decision-tree" class="nav-link" data-scroll-target="#มโนทศนสำคญของ-decision-tree">5.1 มโนทัศน์สำคัญของ decision tree</a>
  <ul class="collapse">
  <li><a href="#สวนประกอบของ-decision-tree" id="toc-สวนประกอบของ-decision-tree" class="nav-link" data-scroll-target="#สวนประกอบของ-decision-tree">ส่วนประกอบของ decision tree</a></li>
  <li><a href="#partitioning-regression-tree" id="toc-partitioning-regression-tree" class="nav-link" data-scroll-target="#partitioning-regression-tree">Partitioning: Regression Tree</a></li>
  <li><a href="#partitioning-classification-tree" id="toc-partitioning-classification-tree" class="nav-link" data-scroll-target="#partitioning-classification-tree">Partitioning: Classification Tree</a></li>
  </ul></li>
  <li><a href="#data-preprocessing-สำหรบ-decision-tree" id="toc-data-preprocessing-สำหรบ-decision-tree" class="nav-link" data-scroll-target="#data-preprocessing-สำหรบ-decision-tree">5.2 Data Preprocessing สำหรับ decision tree</a></li>
  <li><a href="#hyperparameters-สำหรบ-decision-tree" id="toc-hyperparameters-สำหรบ-decision-tree" class="nav-link" data-scroll-target="#hyperparameters-สำหรบ-decision-tree">5.3 Hyperparameters สำหรับ decision tree</a></li>
  <li><a href="#hyperparameter-tuning-using-tidymodels-workflow" id="toc-hyperparameter-tuning-using-tidymodels-workflow" class="nav-link" data-scroll-target="#hyperparameter-tuning-using-tidymodels-workflow">5.4 Hyperparameter tuning using tidymodels Workflow</a>
  <ul class="collapse">
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">Hyperparameter Tuning</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#บทท-7-regularized-regression" id="toc-บทท-7-regularized-regression" class="nav-link" data-scroll-target="#บทท-7-regularized-regression">บทที่ 7 : Regularized Regression</a>
  <ul class="collapse">
  <li><a href="#มโนทศนสำคญของ-regularized-regression" id="toc-มโนทศนสำคญของ-regularized-regression" class="nav-link" data-scroll-target="#มโนทศนสำคญของ-regularized-regression">7.1 มโนทัศน์สำคัญของ regularized regression</a></li>
  <li><a href="#ประเภทของ-regularization" id="toc-ประเภทของ-regularization" class="nav-link" data-scroll-target="#ประเภทของ-regularization">7.2 ประเภทของ Regularization</a>
  <ul class="collapse">
  <li><a href="#ridge-regression" id="toc-ridge-regression" class="nav-link" data-scroll-target="#ridge-regression">Ridge Regression</a></li>
  <li><a href="#lasso-regression" id="toc-lasso-regression" class="nav-link" data-scroll-target="#lasso-regression">Lasso Regression</a></li>
  <li><a href="#elastic-net-regression" id="toc-elastic-net-regression" class="nav-link" data-scroll-target="#elastic-net-regression">Elastic-Net Regression</a></li>
  </ul></li>
  <li><a href="#implement-regularized-regression-using-tidymodels" id="toc-implement-regularized-regression-using-tidymodels" class="nav-link" data-scroll-target="#implement-regularized-regression-using-tidymodels">7.3 Implement regularized regression using tidymodels</a>
  <ul class="collapse">
  <li><a href="#โมเดลทำนายเงนเดอนคร" id="toc-โมเดลทำนายเงนเดอนคร" class="nav-link" data-scroll-target="#โมเดลทำนายเงนเดอนคร">โมเดลทำนายเงินเดือนครู</a></li>
  <li><a href="#ตวอยางการสราง-workflow-เพอทำ-hyperparameter-tuning-ridge-regression" id="toc-ตวอยางการสราง-workflow-เพอทำ-hyperparameter-tuning-ridge-regression" class="nav-link" data-scroll-target="#ตวอยางการสราง-workflow-เพอทำ-hyperparameter-tuning-ridge-regression">ตัวอย่างการสร้าง workflow เพื่อทำ hyperparameter tuning : Ridge Regression</a></li>
  </ul></li>
  <li><a href="#tuning-and-comparing-models" id="toc-tuning-and-comparing-models" class="nav-link" data-scroll-target="#tuning-and-comparing-models">7.4 Tuning and Comparing Models</a>
  <ul class="collapse">
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a></li>
  <li><a href="#สราง-workflowset-และวเคราะห-hyperparemeters" id="toc-สราง-workflowset-และวเคราะห-hyperparemeters" class="nav-link" data-scroll-target="#สราง-workflowset-และวเคราะห-hyperparemeters">สร้าง workflowset และวิเคราะห์ hyperparemeters</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#บทท-8-polynomial-and-multivariate-adaptive-regression-splines" id="toc-บทท-8-polynomial-and-multivariate-adaptive-regression-splines" class="nav-link" data-scroll-target="#บทท-8-polynomial-and-multivariate-adaptive-regression-splines">บทที่ 8 : Polynomial and Multivariate Adaptive Regression Splines</a></li>
  <li><a href="#บทท-9-random-forest-algorithm" id="toc-บทท-9-random-forest-algorithm" class="nav-link" data-scroll-target="#บทท-9-random-forest-algorithm">บทที่ 9 : Random Forest Algorithm</a>
  <ul class="collapse">
  <li><a href="#basic-concepts" id="toc-basic-concepts" class="nav-link" data-scroll-target="#basic-concepts">9.1 Basic Concepts</a></li>
  <li><a href="#out-of-bag-oob" id="toc-out-of-bag-oob" class="nav-link" data-scroll-target="#out-of-bag-oob">9.2 Out-of-Bag (OOB)</a></li>
  <li><a href="#hyperparameters-ของ-random-forest" id="toc-hyperparameters-ของ-random-forest" class="nav-link" data-scroll-target="#hyperparameters-ของ-random-forest">9.3 Hyperparameters ของ Random Forest</a></li>
  <li><a href="#ตวอยางการวเคราะห-random-forest" id="toc-ตวอยางการวเคราะห-random-forest" class="nav-link" data-scroll-target="#ตวอยางการวเคราะห-random-forest">9.4 ตัวอย่างการวิเคราะห์ random forest</a></li>
  <li><a href="#fine-tune-hyperparameters" id="toc-fine-tune-hyperparameters" class="nav-link" data-scroll-target="#fine-tune-hyperparameters">9.5 fine-tune hyperparameters</a>
  <ul class="collapse">
  <li><a href="#ขนแรก-นำเขาขอมล-และจดการ-label-ของขอมล" id="toc-ขนแรก-นำเขาขอมล-และจดการ-label-ของขอมล" class="nav-link" data-scroll-target="#ขนแรก-นำเขาขอมล-และจดการ-label-ของขอมล">ขั้นแรก นำเข้าข้อมูล และจัดการ label ของข้อมูล</a></li>
  <li><a href="#ขนทสอง-แบงชดขอมล" id="toc-ขนทสอง-แบงชดขอมล" class="nav-link" data-scroll-target="#ขนทสอง-แบงชดขอมล">ขั้นที่สอง แบ่งชุดข้อมูล</a></li>
  <li><a href="#ขนทสาม-สราง-recipe-object-สำหรบจดการขอมล" id="toc-ขนทสาม-สราง-recipe-object-สำหรบจดการขอมล" class="nav-link" data-scroll-target="#ขนทสาม-สราง-recipe-object-สำหรบจดการขอมล">ขั้นที่สาม สร้าง recipe object สำหรับจัดการข้อมูล</a></li>
  <li><a href="#ขนท-4-กำหนดโมเดล-model-specification" id="toc-ขนท-4-กำหนดโมเดล-model-specification" class="nav-link" data-scroll-target="#ขนท-4-กำหนดโมเดล-model-specification">ขั้นที่ 4 กำหนดโมเดล (model specification)</a></li>
  <li><a href="#ขนท-5-สราง-workflow" id="toc-ขนท-5-สราง-workflow" class="nav-link" data-scroll-target="#ขนท-5-สราง-workflow">ขั้นที่ 5 สร้าง workflow</a></li>
  <li><a href="#ขนท-6-เตรยมทำ-cross-validation-และกำหนด-hyperparameter-grid" id="toc-ขนท-6-เตรยมทำ-cross-validation-และกำหนด-hyperparameter-grid" class="nav-link" data-scroll-target="#ขนท-6-เตรยมทำ-cross-validation-และกำหนด-hyperparameter-grid">ขั้นที่ 6 เตรียมทำ cross-validation และกำหนด hyperparameter grid</a></li>
  <li><a href="#ขนท-7-ทำ-cv-เพอนำขอมลมา-tune-hyperparameters" id="toc-ขนท-7-ทำ-cv-เพอนำขอมลมา-tune-hyperparameters" class="nav-link" data-scroll-target="#ขนท-7-ทำ-cv-เพอนำขอมลมา-tune-hyperparameters">ขั้นที่ 7 ทำ CV เพื่อนำข้อมูลมา tune hyperparameters</a></li>
  <li><a href="#วเคราะห-tuning-results" id="toc-วเคราะห-tuning-results" class="nav-link" data-scroll-target="#วเคราะห-tuning-results">วิเคราะห์ tuning results</a></li>
  <li><a href="#ขนท-8-finalized" id="toc-ขนท-8-finalized" class="nav-link" data-scroll-target="#ขนท-8-finalized">ขั้นที่ 8 Finalized</a></li>
  </ul></li>
  <li><a href="#grid-search-methods" id="toc-grid-search-methods" class="nav-link" data-scroll-target="#grid-search-methods">9.5 Grid Search methods</a></li>
  <li><a href="#regular-grid" id="toc-regular-grid" class="nav-link" data-scroll-target="#regular-grid">Regular grid</a></li>
  <li><a href="#irregular-grid" id="toc-irregular-grid" class="nav-link" data-scroll-target="#irregular-grid">Irregular grid</a></li>
  </ul></li>
  <li><a href="#บทท-10-workflow-set" id="toc-บทท-10-workflow-set" class="nav-link" data-scroll-target="#บทท-10-workflow-set">บทที่ 10: workflow set</a></li>
  <li><a href="#บทท-11-k-nn-algorithm" id="toc-บทท-11-k-nn-algorithm" class="nav-link" data-scroll-target="#บทท-11-k-nn-algorithm">บทที่ 11: K-NN algorithm</a>
  <ul class="collapse">
  <li><a href="#distance-matrices" id="toc-distance-matrices" class="nav-link" data-scroll-target="#distance-matrices"><img src="images/image-587457222.png" class="img-fluid"> 11.1 Distance matrices</a>
  <ul class="collapse">
  <li><a href="#euclidean-distance" id="toc-euclidean-distance" class="nav-link" data-scroll-target="#euclidean-distance">Euclidean Distance</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">หลักการเรียนรู้ของเครื่องและการประยุกต์</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>ผศ.ดร.สิวะโชติ ศรีสุทธิยากร </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div style="page-break-after: always;"></div>
<section id="บทท-1-ความรพนฐานเกยวกบการเรยนรของเครอง" class="level1">
<h1>บทที่ 1 ความรู้พื้นฐานเกี่ยวกับการเรียนรู้ของเครื่อง</h1>
<p>ปัจจุบันคอมพิวเตอร์ได้เข้ามามีบทบาทอย่างมากกับมนุษย์ โดยเข้ามามีส่วนช่วยเหลือ สนับสนุน หรือแม้กระทั่งทำงานแทนมนุษย์ให้หลาย ๆ งาน ส่วนประกอบสำคัญส่วนหนึ่งของคอมพิวเตอร์ที่จะขาดไปไม่ได้ในการดำเนินงาน/กิจกรรมต่าง ๆ คือโปรแกรมคอมพิวเตอร์</p>
<p>ที่ผ่านมากโปรแกรมคอมพิวเตอร์ถูกพัฒนาขึ้นเป็นจำนวนมาก รวมถึงศาสตร์ในด้านการพัฒนาโปรแกรมคอมพิวเตอร์ก็ถูกพัฒนาไปอย่างมากเช่นกัน เราอาจจำแนกส่วนประกอบของโปรแกรมคอมพิวเตอร์ได้เป็น 2 ส่วนได้แก่ ส่วนต่อประสานกับผู้ใช้ (user interface: UI) และส่วนประมวลผลหรือควบคุมการทำงานของโปรแกรมซึ่งในเชิงเทคนิคเรียกว่า <strong>อัลกอริทึม (algorithm)</strong> ของโปรแกรม ทั้งนี้ในโปรแกรมหนึ่ง ๆ อาจมีอัลกอริทึมมากกว่าหนึ่งตัวก็ได้</p>
<p>บทเรียนนี้จะกล่าวถึงภาพรวมของมโนทัศน์และคำศัพท์ที่เกี่ยวข้องกับศาสตร์การเรียนรู้ของเครื่องเพื่อเป็นพื้นฐานสำหรับการศึกษาในบทเรียนอื่น ๆ ต่อไป รายละเอียดมีดังนี้</p>
<section id="whats-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="whats-algorithms">1.1 What’s algorithms?</h2>
<p>อัลกอริทึมคือกระบวนการในการดำเนินงานที่มีขั้นตอนอย่างชัดเจน โดยมีวัตถุประสงค์เพื่อทำงาน/แก้ปัญหาที่กำหนดให้สำเร็จ การใช้อัลกอริทึมในการทำงานนั้นไม่ได้จำกัดเฉพาะงานทางด้านคอมพิวเตอร์ หรือสถิติและวิทยาการข้อมุลเท่านั้น แต่ในชีวิตประจำวันเราก็มีการใช้อัลกอริทึมเพื่อดำเนินงานต่าง ๆ อยู่เป็นประจำ เช่น</p>
<ul>
<li><p>การเดินทางจากบ้านไปยังร้านขายของสะดวกซื้อ งานดังกล่าวสามารถเขียนแยกแยะออกมาเป็นขั้นตอนการเดินทางโดยอาจเริ่มตั้งแต่การออกประตูบ้าน เลี้ยวขวา เดินตรงไป เมื่อพบสามแยกให้เลี้ยวขวาอีกครั้งจะพบร้านสะดวกซื้อ</p></li>
<li><p>การทอดไข่เจียวที่อาจเริ่มจากการตั้งไฟ ใส่น้ำมัน ตอกไข่ ตีไข่ ใส่เครื่องปรุง ทอดไข่ และนำไข่เจียวที่ได้เสริฟ</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1843582165.png" class="img-fluid figure-img" style="width:65.0%"></p>
<p></p><figcaption class="figure-caption">rule-based vs ML-based (https://www.epam.com/insights/blogs/making-ai-more-human-black-box-models-lead-to-better-decision-making)</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
<p>ปัจจุบันโลกได้ก้าวเข้าสู่ยุคที่ให้เครื่องจักรทำงานบางอย่างแทนมนุษย์ได้ ซึ่งเบื้องหลังการดำเนินการของเครื่องจักรต่าง ๆ จำเป็นต้องมีอัลกอริทึมที่ใช้สำหรับควบคุมการทำงาน การพัฒนาอัลกอริทึมดังกล่าวอาจทำได้สองวิธีการ <strong>วิธีการแรกเรียกว่า rule-based algorithm</strong> ที่ผู้พัฒนาเป็นผู้กำหนดขั้นตอนวิธีการทำงานและประมวลผลทั้งหมด เพื่อให้เป็นภาพของ rule-based algorithm ผู้อ่านลองพิจารณาตัวอย่างในรูปด้านล่าง</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-744969239.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">7-segment display problem (ที่มา: wikipedia)</figcaption><p></p>
</figure>
</div>
<p>รูปข้างต้นเป็นปัญหาชื่อว่า 7-segment display วัตถุประสงค์คือต้องการพัฒนาโปรแกรมที่จะใช้จำแนกตัวเลขบนป้ายไฟแบบ Digital โดยบนป้ายไฟมีไฟ LED จำนวน 7 หลอด ได้แก่ A, B, C, D, E, F และ G การเปิด/ปิดไฟอย่างเหมาะสมตามตารางในรูป จะทำให้ได้ตัวเลข 0-9 บนป้ายไฟ</p>
<p>จากปัญหาข้างต้นการพัฒนาโปรแกรมสำหรับจำแนกตัวเลขบนป้าย (classifier) ด้วยวิธีการแบบ rule-based ผู้วิเคราะห์จะต้องมี sensor เพื่อตรวจจับการเปิด/ปิดไฟแต่ละตำแหน่งบนป้าย จากนั้นจึงพัฒนาโปรแกรมเพื่ออ่านค่าของตัวเลข โดยอัลกอริทึมแบบ rule-based อาจมีลักษณะเป็นการเขียนคำสั่งด้วยการใช้ IF…ELSE ดังนี้</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1919829854.png" class="img-fluid figure-img" style="width:65.0%"></p>
<p></p><figcaption class="figure-caption">Rule-based Classifier</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
<p>การพัฒนา rule-based algorithms ไม่ได้จำเป็นต้องใช้แค่ if…else แต่เพียงอย่างเดียว แต่สามารถใช้กระบวนการทางคณิตศาสตร์เข้ามาช่วยในการสร้างได้ ลองพิจารณาตัวอย่างในกิจกรรมต่อไปนี้</p>
<hr>
</section>
<section id="กจกรรม-rule-based-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="กจกรรม-rule-based-algorithm">1.2 กิจกรรม Rule-based algorithm</h2>
<p>ข้อมูลในตาราง 1 ประกอบด้วยคะแนนสอบ (score) กับคะแนนพฤติกรรมการเรียนของนักเรียน (behav) ลองดำเนินการดังนี้</p>
<ol type="1">
<li>ลองวิเคราะห์ความสัมพันธ์เบื้องต้นระหว่าง <code>score</code> กับ <code>behav</code> ความสัมพันธ์ระหว่างตัวแปรทั้งสองมีลักษณะเป็นอย่างไร</li>
<li>หากใช้วิธีการทางคณิตศาสตร์เพื่อสร้างสมการที่จะใช้เป็นตัวแทนความสัมพันธ์ที่พบในข้อ 1. จะได้สมการเป็นอย่างไร</li>
<li>สมการที่สร้างได้จากข้อ 2. มีประสิทธิภาพในการทำนาย <code>score</code> ดีหรือไม่ อย่างไร</li>
</ol>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">

<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>ข้อมูลคะแนนสอบและพฤติกรรมการเรียนของนักเรียน</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> behav </th>
   <th style="text-align:right;"> score </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 4 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<hr>
<div style="page-break-after: always;"></div>
<p>ตัวอย่างในข้างต้นแสดงให้เห็นว่า ในกรณีที่ข้อมูลนำเข้าไม่มีความคลาดเคลื่อนหรือมีความคลาดเคลื่อนอยู่ในระดับต่ำมาก ๆ การพัฒนาโปรแกรมด้วยวิธีการแบบ rule-based ก็สามารถทำได้อย่างมีประสิทธิภาพ อย่างไรก็ตามในปัญหาทั่วไปในโลกจริงเป็นการยากที่จะมีข้อมูลนำเข้าที่มีคุณสมบัติดังกล่าว ผู้อ่านลองพิจารณาปัญหา Handwriting Digit Recognition (Geron, 2019) ซึ่งเป็นปัญหาการจำแนกตัวเลขเช่นเดียวกับปัญหา 7-segment display ข้างต้น แต่มีความแตกต่างกันคือ input feature สำหรับปัญหานี้จะเป็นลายมือของคนจริง ๆ ไม่ใช่ข้อมูลแบบ binary ของไฟ LED</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1795009334.png" class="img-fluid figure-img" style="width:40.0%" alt="Handwritting Digit Recognition"></p>
<p></p><figcaption class="figure-caption">Handwritting Digit Recognition</figcaption><p></p>
</figure>
</div>
<p>จากรูปข้างต้นจะเห็นว่าการเขียนกฎเกณฑ์แบบ rule-based เพื่อจำแนกตัวเลขในรูปข้างต้นทำได้ยากมากและเป็นไปแทบไม่ได้เลยที่จะพัฒนาอัลกอริทึมแบบ rule-based สำหรับจำแนกตัวเลขจากลายมือดังกล่าวได้อย่างมีประสิทธิภาพ ดังนั้นการที่จะพัฒนาโปรแกรมให้ทำงานแทนมนุษย์ได้จริง ๆ นั้น วิธีการแบบบ rule-based เป็นวิธีการที่ยังมีข้อจำกัดอยู่มาก ทั้งนี้เพราะเป็นวิธีการขาดความยืดหยุ่นและไม่สามารถใช้ได้ดีหากข้อมูลนำเข้ามีความแตกต่างไปจากกฎเกณฑ์ที่วางเอาไว้แม้จะเพียงเล็กน้อย จึงมีแนวโน้มที่จะเกิดความคลาดเคลื่อนสูงมากเมื่อนำโปรแกรมแบบ rule-based ไปใช้ในสถานการณ์ทั่วไป</p>
<p><strong>วิธีการที่สองเรียกว่า machine learning-based</strong> ที่เป็นวิธีการสมัยใหม่และปัจจุบันถูกใช้เป็นวิธีการหลักวิธีหนึ่งในการพัฒนาโปรแกรม การเรียนรู้ของเครื่อง เป็นศาสตร์ย่อยแขนงหนึ่งภายใต้ศาสตร์ทางด้านสถิติและวิทยาการข้อมูล ซึ่งเกี่ยวข้องกับการพัฒนาและใช้อัลกอริทึม ที่มีความสามารถในการเรียนรู้สารสนเทศจากข้อมูลได้ แล้วนำสารสนเทศดังกล่าวมาใช้งาน อัลกอริทึมในกลุ่มนี้ถูกใช้มากสำหรับการสร้างโมเดลเพื่อทำนาย จำแนก หรือตัดสินใจ โดยโมเดลที่สร้างขึ้นจะมีความแตกต่างไปจากโมเดลที่ได้จากอัลกอริทึมแบบ rule-based ตรงที่มีการใช้วิธีการทางสถิติและความน่าจะเป็นเข้ามาช่วยจัดการกับความคลาดเคลื่อนที่อาจเกิดขึ้นในข้อมูลนำเข้า โมเดลที่พัฒนาขึ้นจึงมีความยืดหยุ่นและมีประสิทธิภาพมากกว่าโมเดลที่พัฒนาด้วยอัลกอรทึมแบบ rule-based ประสิทธิภาพดังกล่าวไม่ได้หมายถึงประสิทธิภาพในการทำนายแต่เพียงอย่างเดียว แต่ยังหมายถึงประสิทธิภาพในการพัฒนาโมเดลด้วย</p>
<p>ตัวอย่างต่อไปนี้แสดงการใช้ ML-based เพื่อจำแนกตัวเลขจากลายมือในปัญหา Handwriting Digit Recognition ข้างต้น</p>
<ul>
<li><p><a href="https://www.kaggle.com/code/pranjalrathore/digit-recognizer-minst" class="uri">https://www.kaggle.com/code/pranjalrathore/digit-recognizer-minst</a></p></li>
<li><p><a href="https://www.kaggle.com/code/alphaghostusmc/mnist-cnnv2" class="uri">https://www.kaggle.com/code/alphaghostusmc/mnist-cnnv2</a></p></li>
<li><p><a href="https://www.kaggle.com/code/kobakhit/digital-recognizer-in-r" class="uri">https://www.kaggle.com/code/kobakhit/digital-recognizer-in-r</a></p></li>
<li><p><a href="https://www.kaggle.com/code/ivoruaro/mnist-xgboost-r" class="uri">https://www.kaggle.com/code/ivoruaro/mnist-xgboost-r</a></p></li>
</ul>
</section>
<section id="ai-vs-ml-vs-dl" class="level2">
<h2 class="anchored" data-anchor-id="ai-vs-ml-vs-dl">1.3 AI vs ML vs DL</h2>
<p>ปัจจุบันมีการใช้คำว่า AI, ML และ DL แทนกันไปมาจนบางครั้งเหมือนว่าจะเป็นคำเดียวกัน ในความเป็นจริงทั้งสามคำดังกล่าวม่ได้เป็นสิ่งเดียวกันเลยทีเดียว แต่มีทั้งส่วนที่เหมือนและแตกต่างกัน รายละเอียดมีดังนี้</p>
<ul>
<li><p><strong>AI ย่อมาจาก Artificial Intelligent</strong> เป็นเทคนิคหรือวิธีการที่นักวิทยาการข้อมูลใช้เพื่อพัฒนาโปรแกรมคอมพิวเตอร์ รวมถึงหุ่นยนต์หรือจักรกลที่สามารถเลียนแบบการทำงานต่าง ๆ ของมนุษย์ได้ AI จะมีความสามารถในการทำงานใกล้เคียงหรือดีกว่ามนุษย์ ทั้งความสามารถในการจดจำ จำแนก และตัดสินใจดำเนินงานเองโดยอาศัยข้อมูลที่เป็นไปได้ทั้งข้อมูลตัวเลข ข้อความ รูปภาพ และเสียง ตัวอย่างของ AI เช่น รถยนต์หรือยานพาหนะไร้คนขับ, AlphaGo - DeepMind, Chatgpt เป็นต้น</p></li>
<li><p><strong>Machine Learning (ML)</strong> เป็นกลุ่มของเทคนิคหรือศาสตร์ย่อยแขนงนึงภายใต้ AI ที่เกี่ยวข้องกับการใช้ประยุกต์ใช้ทฤษฎีทางสถิติและคณิตศาสตร์เพื่อเรียนรู้หรือสกัดสารสนเทศจากข้อมูล สารสนเทศดังกล่าวสามารถนำมาใช้ได้หลายลักษณะ ทั้งการบรรยาย อธิบาย ทำนาย และตัดสินใจ ML ถือเป็นส่วนประกอบที่สำคัญที่สนับสนุนการทำงานของ AI</p></li>
<li><p><strong>Deep Learning (DL)</strong> เป็นแขนงย่อย (subdivision) ของ ML ที่เกี่ยวข้องกับการใช้เทคนิคที่เรียกว่าเครือข่ายประสาทเทียม (artificial neural network: ANN) ที่มีความลึกของเครือข่ายหลายชั้นเพื่อเรียนรู้หรือสกัดสารสนเทศจากข้อมูลและใช้ในวัตถุประสงค์หลักคือเพื่อทำนาย/จำแนกค่าสังเกตของตัวแปรตาม นอกจากนี้ลักษณะเฉพาะตัวที่โดดเด่นของ DL คือเครือข่ายประสาทเทียมที่ใช้ในการเรียนรู้นั้นถูกพัฒนาขึ้นเลียนแบบการทำงานของเซลล์เครือข่ายสมองของมนุษย์ การเรียนรู้ของเครื่องที่ใช้ DL จึงสามารถเรียนรู้ข้อมูลที่มีความซับซ้อนเช่น ข้อความ ภาพ และเสียงได้มีประสิทธิภาพมากกว่าการใช้เทคนิค ML แบบปกติ</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-744630750.png" class="img-fluid figure-img" style="width:70.0%" alt="https://k21academy.com/datascience/deep-learning/dl-vs-ml/"></p>
<p></p><figcaption class="figure-caption">AI, ML และ DL (https://k21academy.com/datascience/deep-learning/dl-vs-ml/)</figcaption><p></p>
</figure>
</div>
<p>จากความหมายในข้างต้นจะเห็นว่า DL ถือเป็น machine learning ตัวหนึ่งที่ใช้ในวัตถุประสงค์เพื่อทำนายหรือจำแนกค่าสังเกตของตัวแปรตาม เมื่อเปรียบเทียบความแตกต่างระหว่าง machine learning algorithm ในกลุ่มที่ใช้สำหรับทำนาย กับ DL มีความแตกต่างหนึ่งที่เห็นได้อย่างชัดเจนคือในส่วนของกระบวนการเรียนรู้ของโมเดล ดังรูปด้านล่าง</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1871870544.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">ML (https://www.advancinganalytics.co.uk/blog/2021/12/15/understanding-the-difference-between-ai-ml-and-dl-using-an-incredibly-simple-example)</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/image-1842751579.png" class="img-fluid figure-img" style="width:50.0%" alt="https://www.advancinganalytics.co.uk/blog/2021/12/15/understanding-the-difference-between-ai-ml-and-dl-using-an-incredibly-simple-example"></p>
<p></p><figcaption class="figure-caption">DL (https://www.advancinganalytics.co.uk/blog/2021/12/15/understanding-the-difference-between-ai-ml-and-dl-using-an-incredibly-simple-example)</figcaption><p></p>
</figure>
</div>
</section>
<section id="data-analysis-vs-data-analytics" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis-vs-data-analytics">1.4 Data Analysis vs Data Analytics</h2>
<p>คำศัพท์ที่ควรทราบเมื่อศึกษาหัวข้อเกี่ยวกับวิทยาการข้อมูลหรือการเรียนรู้ของเครื่องคือคำว่า data analysis และ data analytics เราอาจเห็นหลายที่ใช้คำศัพท์สองคำทดแทนกันไปมาเช่นเดียวกับ AI, ML หรือ DL ข้างต้น แต่ในความเป็นจริงทั้งสองคำนี้มีมโนทัศน์ที่แตกต่างกัน แต่มีความสัมพันธ์ซึ่งกันและกัน</p>
<p><strong>Data Analysis</strong> เป็นกระบวนการทางสถิติและวิทยาการข้อมูลที่เกี่ยวข้องกับการเก็บรวบรวมข้อมูล การจัดระเบียบและจัดกระทำข้อมูล และการวิเคราะห์ข้อมูล โดยการวิเคราะห์ข้อมูลนี้มีวัตถุประสงค์หลักเพื่อข้อสรุปสำหรับการบรรยายหรืออธิบายตัวแปรหรือความสัมพันธ์ระหว่างตัวแปรภายในประชากรที่ศึกษา มักใช้ตอบคำถามในลักษณะ</p>
<ul>
<li><p>ที่ผ่านมาเกิดอะไรขึ้น?</p></li>
<li><p>สิ่งที่เกิดขึ้นนั้นเป็นอย่างไร?</p></li>
<li><p>เพราะอะไรถึงเป็นแบบนั้น?</p></li>
</ul>
<p>จะเห็นว่าลักษณะของ data analysis เน้นการอธิบายปรากฏการณ์หรือความเป็นไปในอดีตเป็นหลัก ตัวอย่างการใช้ Data Analysis เช่นการวิเคราะห์สถิติบรรยาย การเปรียบเทียบค่าเฉลี่ย การวิเคราะห์ความสัมพันธ์ระหว่างตัวแปรด้วย correlation หรือ regression หรือการวิเคราะห์ความสัมพันธ์เชิงสาเหตุด้วย structural equation model เป็นต้น</p>
<p><strong>Data Analytics</strong> เป็นกระบวนการที่ผู้วิเคราะห์นำข้อมูลที่มีมาใช้วิเคราะห์ปรากฏการณ์หรือการำเนินงานที่เกี่ยวข้อง เพื่อสร้างเป็นแบบจำลองหรือโมเดล แล้วนำโมเดลที่สร้างขึ้นนี้ไปใช้งานในเชิงการทำนาย การตัดสินใจ หรือให้ข้อเสนอแนะจากข้อมูลสำหรับเหตุการณ์ที่จะเกิดขึ้นในอนาคต กระบวนการทำงานของ data analytic ส่วนใหญ่คล้ายกับ data analysis กล่าวคือมีส่วนของกระบวนการที่จะต้องจัดการเก็บรวบรวมข้อมูล และจัดเตรียมข้อมูลเหมือนกัน แต่ความแตกต่างคือส่วนของการวิเคราะห์ที่ไม่ได้เน้นการอธิบายความเป็นไปในอดีต แต่เน้นการนำโมเดลที่สร้างขึ้นไปทำนาย ช่วยคิดหรือตัดสินใจแทนมนุษย์ การวิเคราะห์ข้อมูลทางด้าน data analytics ส่วนใหญ่จะมีการใช้อัลกอริทึมการเรียนรู้ของเครื่องเข้ามาใช้</p>
</section>
<section id="types-of-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="types-of-machine-learning">1.5 Types of Machine Learning?</h2>
<p>การเรียนรู้ของเครื่อง (ML) เป็นศาสตร์ย่อยแขนงหนึ่งภายใต้ศาสตร์ทางด้านสถิติและวิทยาการข้อมูล ซึ่งเกี่ยวข้องกับการใช้<strong>อัลกอริทึม (algorithms)</strong> ในการเรียนรู้/ค้นหาความรู้จากข้อมูล แล้วนำความรู้ที่ได้มาใช้งานตั้งแต่<strong>การบรรยายสภาพของข้อมูล (descriptive) การวินิจฉัย (diagnostic) เพื่อหาสาเหตุหรือปัจจัยที่ก่อให้เกิดผลลัพธ์ที่สนใจ การทำนาย (predictive) เพื่อสร้างโมเดลที่เรียนรู้ความสัมพันธ์ในข้อมูลเพื่อทำนายผลลัพธ์ของตัวแปรที่สนใจ ผลลัพธ์ที่ได้จากการทำนายนี้สามารถนำมาโมเดลเพื่อช่วยวางแผน/ตัดสินใจ (prescriptive)</strong> ดำเนินการเพื่อนำไปสู่ผลลัพธ์ที่คาดหวัง</p>
<p>เทคนิคการเรียนรู้ของเครื่องอาจจำแนกได้เป็น 3 ประเภท ตามวัตถุประสงค์หรือความสามารถของอัลกอริทึมการเรียนรู้ ได้แก่</p>
<ul>
<li><p>การเรียนรู้ที่มีการชี้นำ (supervised learning)</p></li>
<li><p>การเรียนรู้แบบไม่มีการชี้นำ (unsupervised learning)</p></li>
<li><p>การเรียนรู้แบบที่มีการเสริมแรง (reinforcement learning)</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ML.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">ประเภทของ ML</figcaption><p></p>
</figure>
</div>
<section id="supervised-learning" class="level3">
<h3 class="anchored" data-anchor-id="supervised-learning">Supervised Learning</h3>
<p>ผู้วิเคราะห์จะใช้ supervised learning เมื่อมีวัตถุประสงค์ที่ต้องการสร้างโมเดลทำนาย/จำแนกค่าสังเกตของตัวแปรตามด้วยข้อมูลค่าสังเกตของตัวแปรอิสระ โดย supervised learning เป็นกลุ่มของอัลกอริทึมที่จะเรียนรู้รูปแบบความสัมพันธ์ระหว่างตัวแปรอิสระกับตัวแปรตาม และใช้รูปแบบความสัมพันธ์ที่เรียนรู้จากข้อมูลในอดีตนี้ในการทำนายข้อมูลที่ไม่ทราบค่าที่จะเกิดขึ้นในอนาคต เช่น</p>
<ul>
<li><p>การทำนายสถานะการเป็นหนี้ของลูกค้า (ลูกหนี้ชั้นดี ลูกหนี้ปกติ ลูกหนี้เสีย) โดยอิงกับข้อมูลส่วนตัว ข้อมูลที่เกี่ยวข้องกับเครดิตทางการเงิน และข้อมูลพฤติกรรมการดำเนินชีวิต</p></li>
<li><p>ผู้พัฒนาคอสเรียนออนไลน์ใช้ supervised learning เพื่อทำนายผลการเรียนของนักเรียน หรือแนวโน้มการ drop out ของนักเรียนในคอสเรียน โดยอิงจากพฤติกรรมการเรียนที่แสดงในระบบการเรียนรู้ออนไลน์</p></li>
<li><p>การพัฒนาระบบวินิจฉัยความยึดมั่นผูกพันของนักเรียนด้วยการรู้จำใบหน้าโดยใช้การเรียนรู้เชิงลึก</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-325848635.png" class="img-fluid figure-img" style="width:80.0%" alt="ลักษณะของ ML ประเภท supervised learning (https://3.bp.blogspot.com/-occLtedKtRw/W8RVv5QyIlI/AAAAAAAAEBg/fdvwBPGxdfQ1izWa_l95-SW4kgYSMgAsgCLcBGAs/s1600)"></p>
<p></p><figcaption class="figure-caption">ลักษณะของ ML ประเภท supervised learning (https://3.bp.blogspot.com/-occLtedKtRw/W8RVv5QyIlI/AAAAAAAAEBg/fdvwBPGxdfQ1izWa_l95-SW4kgYSMgAsgCLcBGAs/s1600)</figcaption><p></p>
</figure>
</div>
<p>การที่จะใช้ supervised learning ได้นั้นผู้วิเคราะห์ยังจำเป็นต้องมีชุดข้อมูลต้นแบบที่ภายในชุดข้อมูลประกอบด้วยข้อมูลของตัวแปรตามหรือผลลัพธ์ที่ต้องการทำนาย และตัวแปรอิสระหรือข้อมูลที่จะใช้เป็นตัวทำนายผลลัพธ์ที่ต้องการดังกล่าว ในเชิงเทคนิคจะเรียกชุดข้อมูลต้นแบบดังกล่าวว่า <strong>ชุดข้อมูลฝึกหัด (training dataset)</strong> นอกจากนี้ supervised learning ยังจำแนกเป็นประเภทย่อยได้อีก 2 ประเภทตามลักษณะของตัวแปรตาม ได้แก่ regression และ classification</p>
<ul>
<li><p><strong>Regression</strong> เป็นโมเดลสำหรับทำนายตัวแปรตามเชิงปริมาณ</p></li>
<li><p><strong>Classification</strong> เป็นโมเดลสำหรับทำนายตัวแปรตามแบบจัดประเภท</p></li>
</ul>
</section>
<section id="unsupervised-learning" class="level3">
<h3 class="anchored" data-anchor-id="unsupervised-learning">Unsupervised Learning</h3>
<p>ภาษาไทยอาจใช้คำว่าการเรียนรู้แบบไม่มีการชี้นำ การเรียนรู้ประเภทนี้มีความแตกต่างจาก supervised learning กล่าวคือชุดข้อมูลฝึกหัดไม่จำเป็นต้องมีค่าสังเกตของตัวแปรตาม และวัตถุประสงค์ของการใช้ unsupervised learning คือการสร้างหรือสกัดสารสนเทศออกมาจากข้อมูล ซึ่งอาจจำแนกได้เป็น การจัดกลุ่ม (clustering) และการหาความสัมพันธ์ (association)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1170930730.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ลักษณะของการ clustering</figcaption><p></p>
</figure>
</div>
</section>
<section id="reinforcement-learning" class="level3">
<h3 class="anchored" data-anchor-id="reinforcement-learning">Reinforcement Learning</h3>
<p>เป็นอัลกอริทึมการเรียนรู้ (เรียกว่า agent) ที่เรียนรู้ด้วยการใช้ feedback ที่มีการให้รางวัล (reward) เมื่ออัลกอริทึมสามารถทำงานได้สำเร็จ และมีการทำโทษ (punishments) เมื่อล้มเหลว ผู้พัฒนาอัลกอริทึมประเภทนี้จะให้ agent ทำการเรียนรู้งานที่การให้ feedback ดังกล่าวแบบทวนซ้ำจนกระทั้งอัลกอริทึมสามารถทำงานที่กำหนดได้อย่างมีประสิทธิภาพตามที่ต้องการ</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=ldXxDNjS5jw" class="uri">https://www.youtube.com/watch?v=ldXxDNjS5jw</a></li>
<li><a href="https://www.youtube.com/watch?v=n2gE7n11h1Y" class="uri">https://www.youtube.com/watch?v=n2gE7n11h1Y</a></li>
<li><a href="https://www.youtube.com/watch?v=2tamH76Tjvw" class="uri">https://www.youtube.com/watch?v=2tamH76Tjvw</a></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="ตวอยางการประยกตใช-ml-ทางการศกษา-การบาน" class="level2">
<h2 class="anchored" data-anchor-id="ตวอยางการประยกตใช-ml-ทางการศกษา-การบาน">1.6 ตัวอย่างการประยุกต์ใช้ ML ทางการศึกษา (การบ้าน)</h2>
<p>ขอให้นิสิตสืบค้นงานวิจัยทางการศึกษาที่มีการใช้ machine learning จากนั้นสรุปสาระสำคัญจากงานวิจัยดังกล่าวส่งเป็นการบ้านชิ้นที่ 1 <strong>กำหนดส่ง 25 มกราคม 2566</strong> โดยรายงานสรุปที่จะส่งขอให้มีความยาวไม่เกิน 2 หน้า A4 โดยมีรายละเอียดครอบคลุมหัวข้อดังนี้</p>
<ul>
<li><p>ชื่องานวิจัย</p></li>
<li><p>ความเป็นมา หรือ motivation ของงานวิจัย</p></li>
<li><p>วัตถุประสงค์ของการวิจัย</p></li>
<li><p>กลุ่มเป้าหมาย</p></li>
<li><p>ตัวแปรและข้อมูลที่ใช้ในการวิจัย</p></li>
<li><p>อัลกริทึมการเรียนรู้ของเครื่องที่ใช้ในการวิจัย</p></li>
<li><p>ผลการวิจัยที่สำคัญ</p></li>
<li><p>จุดเด่นและข้อสังเกตของการวิจัย</p></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="บทท-2-ความรพนฐานในการพฒนา-supervised-learning" class="level1">
<h1>บทที่ 2 ความรู้พื้นฐานในการพัฒนา Supervised Learning</h1>
<p>Supervised learning เป็นการเรียนรู้ของเครื่องที่มีการนำมาประยุกต์ใช้งานอย่างแพร่หลาย บทเรียนนี้จะกล่าวถึงมโนทัศน์ที่สำคัญของกระบวนการพัฒนา supervised learning model ทั้งในกลุ่มของ regression และ classification models</p>
<section id="ตดตง-r-และ-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="ตดตง-r-และ-rstudio">2.1 ติดตั้ง R และ RStudio</h2>
<p><img src="images/image-759196559.png" class="img-fluid" style="width:25.0%"></p>
<p>เครื่องมือที่สามารถใช้จัดการข้อมูลและพัฒนาโมเดลการเรียนรู้ของเครื่องในปัจจุบันมีหลายตัว R เป็นโปรแกรมภาษาหนึ่งที่มีความสามารถสูงในการพัฒนาโมเดลการเรียนรู้ของเครื่องดังกล่าว ก่อนจะไปสู่บทเรียนในหัวข้อถัดไป ขอให้ผู้อ่านดาวน์โหลดและติดตั้ง R และ RStudio IDE ก่อน โดย<a href="https://cran.r-project.org/mirrors.html">ดาวน์โหลด R ที่นี่</a> และ<a href="https://posit.co/download/rstudio-desktop/">ดาวน์โหลด Rstudio ที่นี่</a></p>
<p>ปัจจุบัน RStudio เป็น IDE ที่ค่อนข้างครบเครื่องสำหรับผู้ใช้ R และสามารถใช้เขียนภาษาอื่น ๆ ได้หลายตัวทั้ง Python, HTML, Markdown, Stan เป็นต้น ดังนั้นในกรณีที่ต้องการใช้ Python อาจใช้บน RStudio เลยก็ได้ อย่างไรก็ตามการใช้งาน Python บน RStudio เป็นการใช้งานผ่านตัวแปลงคือ package reticulate จึงอาจทำให้การประมวลผลช้ากว่าการทำงานบน Editor ของ Python โดยเฉพาะ</p>
</section>
<section id="ตดตง-anaconda" class="level2">
<h2 class="anchored" data-anchor-id="ตดตง-anaconda">2.2 ติดตั้ง Anaconda</h2>
<p><img src="images/image-1208095281.png" class="img-fluid" style="width:30.0%"></p>
<p>Anaconda เป็นชุดโปรแกรมที่รวบรวม package การทำงานสำหรับนักสถิติและวิทยาการข้อมูล โดยมีทั้งเครื่องมือสำหรับภาษา R และ Python โดย Anaconda จะรวบรวม package ที่เกี่ยวข้องสำหรับการทำงานทางด้านวิทยาการข้อมุลเอาไว้มากกว่า 1,000 ตัว และสามารถติดตั้งได้ทั้งบน Windows, Linux และ Mac OS ซึ่งช่วยอำนวยความสะดวกให้กับผู้ใช้ โดยไม่ต้องดาวน์โหลดและติดตั้ง package พื้นฐานทีละตัวด้วยตนเอ เช่น pandas, numpy, matplotlib และ seaborn ข้อควรระวังคือ Anaconda นั้นรวบรวม package เอาไว้เป็นจำนวนมากการติดตั้งจึงค่อนข้างเปลืองพื้นที่ HDD ของเครื่องคอมพิวเตอร์ สำหรับผู้ที่มีพื้นที่จำกัดอาจเลี่ยงไปติดตั้ง Miniconda หรือใช้ Python บน Google Colab ขั้นตอนการติดตั้ง Anaconda ให้ดำเนินการดังนี้</p>
<ol type="1">
<li>ดาวน์โหลดและติดตั้ง Anaconda ได้ที่ <a href="https://www.anaconda.com/" class="uri">https://www.anaconda.com/</a></li>
<li>ดำเนินการติดตั้งตามตัวช่วยเหลือการติดตั้ง</li>
<li>ถ้ามีการถามว่าต้องการติดตั้ง VS Code หรือไม่ สามารถเลือกติดตั้งหรือไม่ก็ได้ แต่แนะนำว่าติดตั้งไว้ดีกว่าเพราะมีประโยชน์ในการเขียน Python</li>
<li>เมื่อติดตั้งเสร็จให้กดเปิด Anaconda Navigator ขึ้นมา หน้าต่างนี้จะเหมือนเป็น Hub ที่รวบรวมโปรแกรมต่าง ๆ สำหรับการทำงาน เช่น Jupyter Notebook, JupyterLab ซึ่งเป็น gen ใหม่ของ Jupyter Notebook, VS Code ซึ่งเราสามารถใช้ Editor พวกนี้ในการเขียน Python ได้</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-582954745.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Anaconda Navigator</figcaption><p></p>
</figure>
</div>
</section>
<section id="กจกรรม-my-first-regression" class="level2">
<h2 class="anchored" data-anchor-id="กจกรรม-my-first-regression">2.3 กิจกรรม My First Regression</h2>
<p>จากตัวอย่างข้อมูลของกิจกรรมในหัวข้อ 1.2 (<a href="#กจกรรม-rule-based-algorithm">1.2 กิจกรรม Rule-based algorithm</a>) ในหัวข้อนี้เราจะสร้างโมเดลทำนายตัวใหม่โดยจะใช้อัลกอริทึมการเรียนรู้ของเครื่องเป็นเครื่องมือในการพัฒนา จากกิจกรรม 1.2 เราทราบแล้วว่าความสัมพันธ์ระหว่างตัวแปรในชุดข้อมูลเป็นความสัมพันธ์เชิงเส้นตรง ดังนั้นกิจกรรมนี้เราจะใช้อัลกอริทึม linear regression ในการพัฒนาโมเดลทำนาย</p>
<p>อัลกอริทึม linear regression เป็นอัลกอริทึมทางสถิติที่ใช้สำหรับทำนายแนวโน้มค่าสังเกตของตัวแปรตามที่ไม่ทราบค่าโดยอิงกับค่าสังเกตของตัวแปรอิสระที่ทราบค่า การเรียนรู้ของ linear regression จะพยายามสร้างสมการเส้นตรงที่ดีที่สุด (best linear equation) ที่สามารถใช้เป็นตัวแทนความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระที่พบในชุดข้อมูล ในเชิงเทคนิคการหาสมการเส้นตรงด้วยอัลกอริทึมนี้เป็นการเฟ้นค่าหาของพารามิเตอร์ภายในสมการเส้นตรง ได้แก่ พารามิเตอร์จุดตัดแกน y และพารามิเตอร์ความชัน ที่ทำให้สมการเส้นตรงมีความคลาดเคลื่อนในการทำนายต่ำที่สุด โดยที่ความคลาดเคลื่อนในการทำนายดังกล่าวคำนวณจากค่าผลรวมของความคลาดเคลื่อนกำลังสอง (sum squared error: SSE) สามารถคำนวณได้ดังนี้</p>
<p><span class="math display">\[
SSE = \sum_{i=1}^n(y_i-\hat{y}_i)^2
\]</span></p>
<p>เมื่อ <span class="math inline">\(\hat{y}_i\)</span> เป็นผลรวมเชิงเส้น (linear combination) ของตัวแปรอิสระที่ใช้ทำนายตัวแปรตาม</p>
<section id="fitting-linear-regression-using-lm" class="level3">
<h3 class="anchored" data-anchor-id="fitting-linear-regression-using-lm">Fitting Linear Regression using <code>lm()</code></h3>
<p>จากข้อมูลในกิจกรรม 1 สามารถใช้อัลกอริทึม linear regression เพื่อหาโมเดลทำนายที่เหมาะสมด้วยโปรแกรม R ได้ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">behav =</span> x, <span class="at">score =</span> y)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate linear regression model</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>fit_linear<span class="ot">&lt;-</span><span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_linear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = dat)

Residuals:
       1        2        3        4        5        6 
-0.09524  0.27619 -0.35238  0.01905  0.39048 -0.23810 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  1.09524    0.23425   4.675  0.00948 **
x            0.62857    0.07737   8.124  0.00125 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3237 on 4 degrees of freedom
Multiple R-squared:  0.9429,    Adjusted R-squared:  0.9286 
F-statistic:    66 on 1 and 4 DF,  p-value: 0.001249</code></pre>
</div>
</div>
</section>
<section id="evaluation-metrics" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-metrics">Evaluation Metrics</h3>
<p>วัตถุประสงค์หลักของการพัฒนาโมเดลทำนายข้างต้นคือเพื่อทำนายคะแนนสอบด้วยพฤติกรรมการเรียนของนักเรียน การจะนำโมเดลดังกล่าวไปใช้จึงจำเป็นจะต้องตรวจสอบประสิทธิภาพการทำนายของโมเดลดังกล่าวก่อน</p>
<p>เนื่องจากโมเดลนี้เป็น supervised learning model ประเภท regression การตรวจสอบประสิทธิภาพการทำนายจึงควรเป็นการเปรียบเทียบความสอดคล้องกันระหว่างค่าทำนายกับค่าจริงของ <code>score</code> ในเชิงเทคนิคมีเกณฑ์พิจารณาที่เรียกว่า evaluation metric สำหรับ regression model อยู่หลายตัว โดยในบทเรียนนี้จะกล่าวถึง 2 ตัวได้แก่ RMSE และ R squared รายละเอียดมีดังนี้</p>
<section id="root-mean-squared-error-rmse" class="level4">
<h4 class="anchored" data-anchor-id="root-mean-squared-error-rmse">Root Mean Squared Error (RMSE)</h4>
<p>ในทางทฤษฎีค่า RMSE มีความหมายเป็นค่าคลาดเคลื่อนในการทำนายโดยเฉลี่ยของโมเดล สามารถคำนวณได้จากสูตร</p>
<p><span class="math display">\[
RMSE = \sqrt\frac{\sum_{i=1}^n(y_i-\hat{y}_i)^2}{n}
\]</span></p>
</section>
<section id="coeffcient-of-determination-r-squared" class="level4">
<h4 class="anchored" data-anchor-id="coeffcient-of-determination-r-squared">Coeffcient of Determination (R squared)</h4>
<p>ส่วน R squared มีความหมายเป็นสัดส่วนของความผันแปรที่ร่วมกันระหว่างค่าจริงของตัวแปรตามกับค่าทำนายของตัวแปรตามที่ได้จากโมเดลทำนาย การคำนวณค่า R squared สามารถทำได้ง่าย ๆ ด้วยการหาค่ากำลังสองของสัมประสิทธิ์สหสัมพันธ์ระหว่างค่าจริงกับค่าทำนายของตัวแปรตามดังกล่าว</p>
<p><span class="math display">\[
R^2=Corr(y,\hat{y})^2
\]</span></p>
<p>จะเห็นว่า evaluation metric ทั้งสองล้วนเป็นการเปรียบเทียบความแตกต่างหรือความสอดคล้องระหว่างค่าจริงของตัวแปรตามกับค่าทำนายที่ได้จากโมเดลทำนาย การคำนวณค่าของ metric ดังกล่าวสามารถเขียนคำสั่งใน R ได้ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate prediction values</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pred<span class="ot">&lt;-</span><span class="fu">predict</span>(fit_linear, <span class="at">newdata =</span> dat)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>pred <span class="co"># predicted value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6 
1.095238 1.723810 2.352381 2.980952 3.609524 4.238095 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate rmse value</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>pred)<span class="sc">^</span><span class="dv">2</span>)) <span class="co">#rmse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.264275</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate r squared value</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(pred, y)<span class="sc">^</span><span class="dv">2</span> <span class="co">#rsq</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9428571</code></pre>
</div>
</div>
</section>
<section id="r-squared-plot" class="level4">
<h4 class="anchored" data-anchor-id="r-squared-plot">R squared plot</h4>
<p>R squared plot เป็นแผนภาพการกระจายที่ plot ระหว่างค่าทำนาย (แกน Y) กับค่าจริง (แกน X) และเปรียบเทียบแนวโน้มของคู่อันดับกับกล่าวกับเส้นตรงอ้างอิง <span class="math inline">\(y=x\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create R squared plot</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, pred,  <span class="at">pch=</span><span class="dv">16</span>, <span class="at">xlab =</span> <span class="st">"actual score"</span>, <span class="at">ylab=</span><span class="st">"predicted score"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>, <span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"steelblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">R Square plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>ผลการพัฒนา linear regression ข้างต้นได้ข้อสรุปว่าโมเดลทำนายที่พัฒนาขึ้นมีประสิทธิภาพสูงมากในการทำนายคะแนนของนักเรียน (ผู้อ่านเห็นด้วยกับข้อความนี้หรือไม่? เพราะเหตุใด?)</strong></p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="กจกรรม-my-first-classification" class="level2">
<h2 class="anchored" data-anchor-id="กจกรรม-my-first-classification">2.4 กิจกรรม My First Classification</h2>
<p>กิจกรรมนี้จะแสดงตัวอย่างการสร้างโมเดลจำแนก (classfication model) ชุดข้อมูลที่ใช้่เป็นตัวอย่างในกิจกรรมนี้จะใช้ชุดข้อมูล <code>mmreg.sav</code> <a href="https://github.com/ssiwacho/2758688_ML/blob/main/week%201/mmreg.sav">โดยสามารถดาวน์โหลดได้ที่นี่</a></p>
<p>กิจกรรมนี้จะสร้างโมเดลจำแนกผลการเรียนวิชาคณิตศาสตร์ (สอบผ่าน vs สอบตก) โดยใช้ตัวแปรอิสระได้แก่ เพศ (<code>female</code>) และแรงจูงใจในการเรียน​ (<code>motivation</code>) ทั้งนี้ก่อนการดำเนินการขอให้ผู้อ่านแปลงค่าของตัวแปร <code>math</code> ให้เป็นแบบ binary response ก่อน โดยใช้คำสั่งดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importing mmreg.sav into dat</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="st">"mmreg.sav"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># manipulating response variable "math"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat<span class="sc">%&gt;%</span><span class="fu">mutate</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">math_binary =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(math<span class="sc">&gt;</span><span class="dv">50</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"fail"</span>,<span class="st">"pass"</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>math_binary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
fail pass 
 266  334 </code></pre>
</div>
</div>
<section id="fitting-logistic-regression-model-using-glm" class="level3">
<h3 class="anchored" data-anchor-id="fitting-logistic-regression-model-using-glm">Fitting Logistic Regression Model using <code>glm()</code></h3>
<p>สำหรับอัลกอริทึมการเรียนรู้ที่จะใช้ในกิจกรรมนี้จะเลือกใช้ logistic regression ซึ่งเป็นอัลกริทึมพื้นฐานที่เรียนในรายวิชาสถิติพื้นฐานแล้ว การ fit logistic regression บน R สามารถทำได้หลายวิธีการ โดยมีขั้นตอนการดำเนินงานที่คล้ายกับการ fit linear regression โดยจะใช้ฟังก์ชัน <code>glm()</code> แทน <code>lm()</code> คำสั่งต่อไปนี้แสดงการ fit binary logistic regression ด้วยโปรแกรม R จากชุดข้อมูลดังกล่าว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(math_binary <span class="sc">~</span> female <span class="sc">+</span> motivation,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> dat,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_logistic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = math_binary ~ female + motivation, family = "binomial", 
    data = dat)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.4960  -1.2290   0.8893   1.0177   1.4228  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.2931     0.1951  -1.502    0.133    
female       -0.2674     0.1691  -1.582    0.114    
motivation    1.0166     0.2468   4.119  3.8e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 824.05  on 599  degrees of freedom
Residual deviance: 805.30  on 597  degrees of freedom
AIC: 811.3

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>สมการถดถอยแบบ logistic ในข้างต้นสามารถเขียนได้ดังนี้</p>
<p><span class="math display">\[
P(math=1|female,\ motivation)=\frac{exp(-0.2931+-0.2674female+1.0166mov)}{1+exp(-0.2931+-0.2674female+1.0166mov)}
\]</span></p>
<p>แสดงว่าค่าทำนายของสมการข้างต้นเป็นค่าความน่าจะเป็นที่จะสอบผ่านเมื่อกำหนดค่าของตัวแปรอิสระ การจะใช้โมเดลดังกล่าวเพื่อจำแนกว่านักเรียนแต่ละคนมีแนวโน้มจะสอบผ่านหรือตกจะต้องแปลงค่าความน่าจะเป็นดังกล่าวให้เป็นประเภทหรือค่าสังเกตของตัวแปรตามแบบจัดประเภท การแปลงค่าความน่าจะเป็นนี้สามารถทำได้โดยกำหนดคะแนนจุดตัดของค่าความน่าจะเป็นสำหรับแบ่งประเภทของหน่วยข้อมูลระหว่างสอบผ่านและสอบตก (เชิงเทคนิคเรียกว่าค่า threshold)</p>
<p>สมมุติว่ากำหนดค่า threshold = 0.5 สามารถคำนวณค่าทำนายผลการสอบรายวิชาคณิตศาสตร์ได้ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predicted probabilities</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_logistic,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type=</span><span class="st">"response"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata =</span> dat)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pred_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.3634  0.5106  0.5958  0.5567  0.6121  0.6734 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predicted response values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>pred_val <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(pred_prob<span class="sc">&gt;</span><span class="fl">0.5</span>,<span class="st">"pass"</span>,<span class="st">"fail"</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># assign predicted response values into dat dataframe</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>pred_prob <span class="ot">&lt;-</span> pred_prob</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>pred_val <span class="ot">&lt;-</span> pred_val</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>pred_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
fail pass 
 120  480 </code></pre>
</div>
</div>
</section>
<section id="evaluation-metrics-1" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-metrics-1">Evaluation Metrics</h3>
<p>Evaluation metric สำหรับ classification model มีหลายตัว ในหัวข้อนี้จะกล่าวถึงบางตัวก่อน</p>
<section id="confusion-matrix" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h4>
<p>confusion matrix ที่เป็นเมทริกซ์เปรียบเทียบระหว่างค่าทำนายกับค่าจริงดังตัวอย่างในรูปด้านล่าง</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-753775251.png" class="img-fluid figure-img" style="width:35.0%"></p>
<p></p><figcaption class="figure-caption">confusion matrix</figcaption><p></p>
</figure>
</div>
<p>การคำนวณ confusion matrix ใน R สามารถดำเนินการได้หลายวิธีการ วิธีการหนึ่งคือการใช้ฟังก์ชัน <code>table()</code> เพื่อแจกแจงความถี่ระหว่างค่าทำนายกับค่าจริง ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>pred_val, dat<span class="sc">$</span>math_binary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
       fail pass
  fail   65   55
  pass  201  279</code></pre>
</div>
</div>
<p>confusion matrix เป็นเครื่องมือสำหรับที่ใช้ประเมินประสิทธิภาพการทำนายของโมเดลประเภท classification models รูปด้านล่างแสดงการเปรียบเทียบ confusion matrix ระหว่าง logistic regression model กับ random forest model ผู้อ่านคิดว่าโมเดลใดมีแนวโน้มจะมีประสิทธิภาพในการทำนายสูงกว่ากัน</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-235695373.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">เปรียบเทียบ confusion matrix ระหว่าง logistic regression กับ random forest</figcaption><p></p>
</figure>
</div>
</section>
<section id="accuracy-hit-rate" class="level4">
<h4 class="anchored" data-anchor-id="accuracy-hit-rate">Accuracy (Hit Rate)</h4>
<p>บาง package อาจเรียว่า balance accuracy ดัชนีตัวนี้เป็นค่าบ่งชี้ความแม่นยำในการทำนายโดยตรงของโมเดลโดยมีค่าเท่ากับสัดส่วนของเคสที่ทำนายถูกทั้งหมดเทียบกับเคสทั้งหมดที่ทำนาย ดังนี้</p>
<p><span class="math display">\[
Accuracy=\frac{TP+TN}{Total}
\]</span></p>
</section>
<section id="sensitivity-and-specificity" class="level4">
<h4 class="anchored" data-anchor-id="sensitivity-and-specificity">Sensitivity and Specificity</h4>
<p>sensitivity เป็นประสิทธิภาพของโมเดลในด้านความไวหรืออำนาจในการตรวจจับเคสที่ <span class="math inline">\(y=1\)</span> ส่วน specificity เป็นประสิทธิภาพของโมเดลในการทำนายเคสที่ <span class="math inline">\(y=0\)</span> ดัชนี้ทั้งสองตัวสามารถคำนวณได้ดังนี้</p>
<p><span class="math display">\[
Sensitivity = \frac{TP}{TP+FN}
\]</span></p>
<p><span class="math display">\[
Specificity = \frac{TN}{FP+TN}
\]</span></p>
</section>
<section id="prevalence" class="level4">
<h4 class="anchored" data-anchor-id="prevalence">Prevalence</h4>
<p>เป็นค่าความชุกของเคสที่ <span class="math inline">\(y=1\)</span> ในกรณีที่ค่า prevalence มีค่าต่ำ บ่งชี้ว่าโมเดลทำนายอาจเกิดปัญหา Imbalance class กล่าวคือโมเดลมีชุดข้อมูลฝึกหัดสำหรับเคส <span class="math inline">\(y=1\)</span> ที่อาจน้อยเกินไป</p>
<p><span class="math display">\[
Prevalence = \frac{TP+TN}{Total}
\]</span></p>
</section>
<section id="precision" class="level4">
<h4 class="anchored" data-anchor-id="precision">Precision</h4>
<p>เป็นความน่าเชื่อถือของผลการทำนายเคส y=1 สามารถคำนวณได้จาก</p>
<p><span class="math display">\[
Precision = \frac{TP}{TP+FP}
\]</span></p>
<p>การคำนวณดัชนีข้างต้นด้วยมือค่อนข้างวุ่นวายใน R มี package หลายตัวที่ช่วยคำนวณดัชนีข้างต้นได้ ในที่นี้จะให้ฟังก์ชัน <code>confusionMatrix()</code> ของ package caret ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.package("caret")</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> dat<span class="sc">$</span>pred_val,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">reference =</span> dat<span class="sc">$</span>math_binary,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"pass"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction fail pass
      fail   65   55
      pass  201  279
                                          
               Accuracy : 0.5733          
                 95% CI : (0.5326, 0.6133)
    No Information Rate : 0.5567          
    P-Value [Acc &gt; NIR] : 0.2177          
                                          
                  Kappa : 0.0844          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.8353          
            Specificity : 0.2444          
         Pos Pred Value : 0.5812          
         Neg Pred Value : 0.5417          
             Prevalence : 0.5567          
         Detection Rate : 0.4650          
   Detection Prevalence : 0.8000          
      Balanced Accuracy : 0.5398          
                                          
       'Positive' Class : pass            
                                          </code></pre>
</div>
</div>
</section>
</section>
<section id="คำถามทายบท" class="level3">
<h3 class="anchored" data-anchor-id="คำถามทายบท">คำถามท้ายบท</h3>
<ul>
<li><p><strong>ผลการพัฒนา binary logistic regression ในข้างต้นผู้อ่านคิดว่าโมเดลที่พัฒนาขึ้นมีประสิทธิภาพในการทำนายเป็นอย่างไร?</strong></p></li>
<li><p><strong>จากกระบวนการที่ใช้พัฒนาทั้ง linear regression model และ logistic regression model ผู้อ่านคิดว่าเป็นกระบวนการที่เหมาะสมสำหรับการพัฒนาโมเดลทำนายแล้วหรือไม่ หรือมีข้อสังเกตอะไร</strong></p></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="บทท-3-กระบวนการพฒนา-machine-learning-models" class="level1">
<h1>บทที่ 3 กระบวนการพัฒนา Machine Learning Models</h1>
<p>กระบวนการพัฒนา machine learning models อาจจำแนกได้เป็นสองส่วน ส่วนแรกคือส่วนของการพัฒนาโมเดล และส่วนที่สองคือส่วนของการนำโมเดลไปใช้งาน</p>
<p>ส่วนการพัฒนาโมเดลมีกระบวนการพัฒนาแสดงไว้ในรูป 15 จากรูปจะเห็นว่าเริ่มตั้งแต่การเก็บรวบรวมข้อมูล การจัดการข้อมูล จากนั้นจะมีการแบ่งชุดข้อมูลออกเป็นส่วน traning dataset และ test dataset ข้อมูลส่วนที่เป็น traning dataset จะถูกนำมาพัฒนาการเรียนรู้/ความสามารถในการทำนายของโมเดล ผ่านอัลกอริทึมต่าง ๆ จากนั้นจะเลือกอัลกอริทึมที่มีประสิทธิภาพสูงที่สุด (ประเมินจาก test dataset) ไปใช้งาน ทั้งนี้การจะนำโมเดลทำนายไปใช้งานได้นั้นจะต้องมีบันทึกโมเดลที่พัฒนาขึ้นเพื่อนำไปเรียกใช้ต่อไป</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1728379488.png" class="img-fluid figure-img" alt="Modeling Process"></p>
<p></p><figcaption class="figure-caption">Modeling Process</figcaption><p></p>
</figure>
</div>
<p>ลักษณะเฉพาะในกระบวนการพัฒนาโมเดลทำนายคือ การดำเนินงานในหลายขั้นตอน เช่น การจัดการข้อมูล การ fit และปรับแต่งโมเดล หรือการคัดเลือกโมเดลทำนายที่ดีที่สุด ไม่ได้มีแนวทางหรือกฎเกณฑ์ที่ชัดเจนตายตัวว่าต้องดำเนินการอย่างไร นอกจากนี้กระบวนการดังกล่าวยังมีลักษณะเป็นแบบทวนซ้ำไปมา รูป 16 แสดงตัวอย่างการดำเนินงานของผู้วิเคราะห์เพื่อพัฒนาโมเดลทำนายโมเดลหนึ่ง</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1908104112.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">ตัวอย่างขั้นตอนการพัฒนาโมเดลทำนาย (ที่มา : Max Kuhn and Kjell Johnson (2019))</figcaption><p></p>
</figure>
</div>
<p>จากรูปข้างต้นจะเห็นว่ากระบวนการเริ่มต้นด้วยกากการวิเคราะห์เพื่อสำรวจข้อมูล (exploratory data analysis: EDA) ก่อน (จุด a) โดยที่ EDA เป็นเทคนิคที่ผู้วิเคราะห์ใช้เพื่อทำความเข้าใจคุณลักษณะสำคัญของตัวแปรต่าง ๆ ภายในชุดข้อมูล ซึ่งประกอบด้วย (1) การวิเคราะห์สถานะและการแจกแจงของตัวแปร (2) การวิเคราะห์ความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระ รวมทั้งความสัมพันธ์ระหว่างตัวแปรอิสระ (3) การวิเคราะห์รูปแบบการสูญหายของข้อมูล และ (4) ความผิดปกติที่อาจเกิดขึ้นในข้อมูล กระบวนการในส่วนของการสำรวจนี้เป็นกระบวนการทวนซ้ำและอาจมีการสลับไปมาระหว่างการใช้ทัศนภาพข้อมูลเชิงสำรวจ และการใช้เทคนิคการวิเคราะห์เชิงปริมาณ (จุด b) เข้ามาช่วย สารสนเทศที่ได้จากกระบวนส่วนนี้จะสามารถใช้เป็นแนวทางเพื่อจัดข้อมูลของตัวแปรอิสระให้เหมาะสมและมีประสิทธิภาพสูงที่สำหรับการพัฒนาโมเดลทำนายต่อไป เรียกขั้นตอนนี้ว่า feature engineering (จุด c) เมื่อสิ้นสุดขั้นตอนนี้ผลผลิตที่ควรได้คือชุดข้อมูลต้นแบบที่ประกอบด้วยตัวแปรตาม และตัวแปรอิสระที่ผ่านการคัดเลือกหรือทำ feature engineering มาแล้ว และอยู่ในรูปแบบที่พร้อมจะนำไปวิเคราะห์</p>
<p>เมื่อได้ชุดข้อมูลต้นแบบมาเรียบร้อยแล้ว ผู้วิเคราะห์จะนำชุดข้อมูลดังกล่าวไปเป็นต้นแบบให้อัลกอริทึมการเรียนรู้ของเครื่องหลาย ๆ ตัวได้เรียนรู้ เพื่อพัฒนาเป็นโมเดลทำนาย (จุด d) จากรูปจะเห็นว่าอัลกอริทึมที่ถูกเลือกมาใช้จำนวน 4 อัลกอริทึม ทั้งนี้อัลกอริทึมส่วนใหญ่มักมีส่วนประกอบที่เรียกว่า hyperparameters ที่ต้องกำหนดค่าด้วยการปรับแต่ง (tuning) จากรูปจะเห็นว่าการเรียนรู้ในแต่ละอัลกอริทึมจะมีขั้นตอนของการเรียนรู้ และการปรับแต่ง hyperparameters ที่ต้องดำเนินการแบบทวนซ้ำสลับไปมาจนกระทั่งได้โมเดลที่มีประสิทธิภาพสูงสุด ทั้งนี้เมื่อได้โมเดลดังกล่าวแล้ว ผู้วิเคราะห์จะนำโมเดลที่พัฒนาได้ไปประเมินประสิทธิภาพการทำนายของโมเดล การดำเนินงานในส่วนนี้จะมีการใช้ทั้งการวิเคราะห์เชิงปริมาณผ่านค่าสถิติต่าง ๆ เช่น evaluation metrics ต่าง ๆ ที่ใช้ประเมินประสิทธิภาพการทำนาย รวมทั้งยังอาจมีการใช้ EDA อีก เพื่อวิเคราะห์ประสิทธิภาพ หรือข้อจำกัดของแต่ละโมเดลในการทำนายผลลัพธ์ที่ต้องการ (จุด e และ f)</p>
<p>สารสนเทศที่ได้จากการวิเคราะห์ประสิทธิภาพของโมเดลจะเป็นตัวกำหนดการดำเนินงานต่อไปของผู้วิเคราะห์ โดยอาจจำแนกเป็นสองกรณี กรณีแรกคือหากโมเดลมีประสิทธิภาพในการทำนายสูงอยู่ระดับที่สามารถนำไปใช้งานได้แล้วผู้วิเคราะห์จะหยุดการดำเนินงานไว้ที่ขั้นตอนนี้แล้วนำโมเดลดังกล่าวไปใช้งานต่อไป กรณีที่สองหากโมเดลทำนายที่พัฒนาขึ้นยังมีประสิทธิภาพไม่ถึงเกณฑ์ที่กำหนด ผู้วิเคราะห์สามารถใช้สารสนเทศจาก EDA ในจุด f ประกอบการคัดเลือกโมเดลเบื้องต้น และปรับแต่งโมเดลรวมทั้งอาจดำเนินการทำ feature engineering อีกครั้งหนึ่งเพื่อเพิ่มประสิทธิภาพการทำนายให้กับโมเดล (จุด h) เมื่อได้โมเดลสุดท้ายแล้วผู้วิเคราะห์สามารถเปรียบเทียบประสิทธิภาพระหว่างโมเดลคู่แข่งขันโดยใข้ชุดข้อมูลทดสอบ (test dataset) แล้วเลือกโมเดลที่ดีที่สุดไปใช้งาน</p>
<p>ส่วนของการนำโมเดลไปใช้งาน ต้องทำความเข้าใจว่า ML model ที่พัฒนาขึ้นนั้นเป็นเหมือนสมองซึ่งต้องเข้าไปอยู่ในโปรแกรมหรือ application สักตัวหนึ่ง โดยโปรแกรมดังกล่าวจะมีหน้าที่หลัก ๆ เช่นมี interface สำหรับรับข้อมูลจากผู้ใช้ เพื่อนำไปประมวลผลด้วยโมเดลทำนายที่เราสร้างขึ้น และรายงานผลการทำนาย/จำแนก ที่ได้จากโมเดลให้แก่ผู้ใช้ ทั้งนี้โปรแกรมดังกล่าวยังอาจมีส่วนอื่น ๆ ที่ยอมให้ผู้ใช้เลือกหรือปรับแต่งการทำงานของโปรแกรมได้ ทั้งนี้ขึ้นอยู่กับวัตถุประสงค์การใช้งาน ตัวอย่างด้านล่างแสดงโปรแกรมทำนายผลการเรียนของนิสิต <a href="https://siwachoat.shinyapps.io/reportandpredict/?_ga=2.42051557.1707159165.1666195773-1113918738.1613372414&amp;utm_source=KruRooTeller">KruRooTeller</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1909139629.png" class="img-fluid figure-img" style="width:90.0%" alt="ระบบ KruRooTeller"></p>
<p></p><figcaption class="figure-caption">ระบบ KruRooTeller</figcaption><p></p>
</figure>
</div>
<p>เนื้อหาส่วนที่เหลือของบทเรียนนี้จะกล่าวถึงกระบวนการในส่วนของการพัฒนา supervised learning models โดยจะกล่าวถึงมโนทัศน์ที่จำเป็นก่อน จากนั้นจึงกล่าวถึงกระบวนการพัฒนาโมเดลดังกล่าว รายละเอียดมีดังนี้</p>
<div style="page-break-after: always;"></div>
<section id="bias-and-variance-in-ml-models" class="level2">
<h2 class="anchored" data-anchor-id="bias-and-variance-in-ml-models">3.1 Bias and Variance in ML models</h2>
<p>พิจารณารูป 18 แสดงการ fit โมเดลทำนาย 3 แบบกับชุดข้อมูลฝึกหัดชุดหนึ่ง จะเห็นว่าแต่ละโมเดลมีความสามารถในการเรียนรู้ความสัมพันธ์ที่เกิดขึ้นในชุดข้อมูลแตกต่างกัน ความแตกต่างระหว่างค่าจริงของตัวแปรตามในชุดข้อมูลฝึกหัดกับค่าทำนายที่ได้จากโมเดล เรียกว่า <strong>ความลำเอียง (bias)</strong> <strong>จากรูป 16 ผู้อ่านคิดว่าโมเดลใดที่มีประสิทธิภาพในการทำนายสูงที่สุดเพราะเหตุใด ?</strong></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">regression model on training dataset</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>พิจารณารูป 19 ผู้วิเคราะห์ได้นำโมเดลทำนายทั้ง 3 แบบ ที่พัฒนาจากชุดข้อมูลฝึกหัดมาใช้ทำนายข้อมูลใหม่ที่โมเดลทั้ง 3 ไม่เคยได้เรียนรู้มาก่อน ความแตกต่างระหว่างค่าจริงของตัวแปรตามในชุดข้อมูลใหม่ (หรือชุดข้อมูลที่ไม่ได้ใช้ในขั้นการพัฒนาโมเดล) กับค่าทำนายของโมเดล เรียกว่า <strong>ความแปรปรวน (variance)</strong> ความแปรปรวนของโมเดลทั้ง 3 เป็นอย่างไร?</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">regression model on new dataset</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>จากตัวอย่างข้างต้นจะเห็นว่า ถึงแม้จะสามารถพัฒนาโมเดลทำนายให้สามารถเรียนรู้ความสัมพันธ์ภายในชุดข้อมูลฝึกหัดได้เป็นอย่างดี (มีความลำเอียงต่ำที่สุดแล้ว) แต่ก็ไม่ใช่เงื่อนไขเพียงพอที่จะสรุปได้ว่าโมเดลทำนายดังกล่าวจะมีประสิทธิภาพในการทำนายได้ดีในกรณีทั่วไป การตรวจสอบอีกชั้นหนึ่งคือตรวจสอบความแปรปรวนของโมเดลทำนาย โดยนำโมเดลดังกล่าวไปทำนายชุดข้อมูลที่ไม่เคยได้เรียนรู้มาก่อน โมเดลที่มีทั้งความลำเอียงและความแปรปรวนต่ำจึงเป็นโมเดลที่มีประสิทธิภาพที่จะนำไปใช้ในกรณีทั่วไป</p>
<p>ในเชิงอุดมคติ ผู้วิเคราะห์ต้องการให้ทั้งความลำเอียง และความแปรปรวนมีค่าต่ำที่สุดเท่าที่จะสามารถต่ำได้ แต่ในความเป็นจริงความคลาดเคลื่อนทั้งสองไม่ควบคุมให้ต่ำที่สุดพร้อมกันได้ <strong>(เพราะอะไร?)</strong> รูป 20 ด้านล่างแสดงความสัมพันธ์ระหว่างความลำเอียง และความแปรปรวน ซึ่งจะเห็นว่ามีการแปรผกผันซึ่งกันและกัน โมเดลที่มีความลำเอียงสูงมีแนวโน้มที่จะมีความแปรปรวนต่ำ และในทางกลับกันโมเดลที่มีความลำเอียงต่ำจะมีแนวโน้มที่มีความแปรปรวนสูง <strong>ดังนั้นวัตถุประสงค์ของการพัฒนาโมเดลจึงเป็นการหาจุดที่ดีที่สุดที่ทำให้ความคลาดเคลื่อนทั้งสองอยู่ในจุดที่ต่ำที่สุดเท่าที่จะเป็นไปได้</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-712567945.png" class="img-fluid figure-img" style="width:60.0%" alt="bias and variance trace-off"></p>
<p></p><figcaption class="figure-caption">bias and variance trace-off</figcaption><p></p>
</figure>
</div>
</section>
<section id="underfitting-overfitting-และ-good-fit-models" class="level2">
<h2 class="anchored" data-anchor-id="underfitting-overfitting-และ-good-fit-models">3.2 Underfitting, Overfitting และ Good fit models</h2>
<p>หากจำแนกโมเดลทำนายที่ถูกพัฒนาขึ้นตามประสิทธิภาพการทำนายของโมเดล อาจจำแนกได้เป็น 3 ประเภท ได้แก่</p>
<ol type="1">
<li>underfitting models คือโมเดลที่มีความลำเอียงสูง ความลำเอียงเป็นความคลาดเคลื่อนที่เป็นระบบ อันเนื่องมาจากโมเดลทำนายที่พัฒนาขึ้นยังไม่สามารถเรียนรู้แนวโน้มหรือรูปแบบความสัมพันธ์หลักระหว่างตัวแปรภายในชุดข้อมูลฝึกหัดได้ดีเพียงพอ จากรูป 21 ซ้ายมือ จะเห็นว่าแนวโน้มความสัมพันธ์ตามธรรมชาติระหว่างตัวแปรตามกับตัวแปรอิสระคือความสัมพันธ์เชิงเส้นโค้ง แต่โมเดลทำนายที่พัฒนาขึ้นอยู่ในรูปแบบเส้นตรง ความแตกต่างระหว่างรูปแบบความสัมพันธ์ดังกล่าวก่อให้เกิดความลำเอียงขึ้น และเรียกโมเดลที่มีความลำเอียงในระดับที่มากเกินไปนี้ว่า underfitting model</li>
<li>overfitting models คือโมเดลที่มีความแปรปรวนสูง ความแปรปรวนเกิดขึ้นจากการที่โมเดลทำนายที่พัฒนาขึ้นสามารถเรียนรู้ความสัมพันธ์ในชุดข้อมูลฝึกหัดได้ดีมากเกินไป จนขาดความยืดหยุ่นในการนำโมเดลดังกล่าวไปใช้ในกรณีทั่วไป ดังตัวอย่างในรูป 21 ขวามือ จากรูปจะเห็นว่าโมเดลสามารถเรียนรู้ความสัมพันธ์ได้เกือบสมบูรณ์ แต่หากนำโมเดลนี้ไปใช้ทำนายข้อมูลใหม่ที่อยู่นอกเหนือจากชุดข้อมูลที่โมเดลนี้ได้เรียนรู้มีแนวโน้มสูงที่จะเกิดความคลาดเคลื่อนในการทำนาย</li>
<li>good fit models คือโมเดลที่สามารถสมดุลความลำเอียงและความแปรปรวนให้มีค่าต่ำที่สุดเท่าที่จะเป็นไปได้</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1638148101.png" class="img-fluid figure-img" alt="underfitting, good fit, and overfitting model"></p>
<p></p><figcaption class="figure-caption">underfitting, good fit, and overfitting model</figcaption><p></p>
</figure>
</div>
</section>
<section id="training-validation-and-test-dataset" class="level2">
<h2 class="anchored" data-anchor-id="training-validation-and-test-dataset">3.3 Training, validation, and Test Dataset</h2>
<p>จาก concept ข้างต้นจะเห็นว่าในกระบวนการพัฒนาโมเดลผู้วิเคราะห์จะให้ความสำคัญกับประสิทธิภาพในการทำนายของโมเดลเฉพาะด้านความลำเอียงไม่ได้ ยังต้องคำนึงถึงด้านความแปรปรวนด้วย การพัฒนาโมเดลการเรียนรู้ของเครื่องจึงจะมีแค่ชุดข้อมูลฝึกหัดไม่ได้ ยังต้องมีชุดข้อมูลอีกชุดหนึ่งเพื่อเอาไว้ตรวจสอบความแปรปรวนของโมเดลด้วย ในเชิงเทคนิคเรียกชุดข้อมูลนี้ว่า <strong>ชุดข้อมูลทดสอบ (test dataset)</strong></p>
<p>ภายในอัลกอริทึม supervised learning จะมีส่วนประกอบหลัก ๆ ได้แก่ อัลกอริทึม พารามิเตอร์ และ ไฮเปอร์พารามิเตอร์</p>
<ul>
<li><p><strong>อัลกอริทึม</strong> เป็นส่วนของวิธีการเรียนรู้ของสำหรับแต่ละการเรียนรู้ของเครื่องที่ใช้ในการเรียนรู้หรือสกัดสารสนเทศจากข้อมูลในชุดข้อมูลฝึกหัด</p></li>
<li><p><strong>พารามิเตอร์</strong> <strong>(parameters)</strong> ส่วนที่ทำให้การเรียนรู้ของเครื่อง fit กับข้อมูล กล่าวง่าย ๆ คือค่าของพารามิเตอร์ที่เปลี่ยนแปลงไป จะทำให้รูปแบบการเรียนรู้มีการเปลี่ยนไป ค่าพารามิเตอร์นี้สามารถประมาณได้จากข้อมูลด้วยวิธีการทางสถิติ/คณิตศาสตร์ ตัวอย่างของพารามิเตอร์เช่น ใน linear regression model มีพารามิเตอร์คือ สัมประสิทธิ์จุดตัดแกน และสัมประสิทธิ์ความชัน เป็นต้น อย่างไรก็ตามบางอัลกอริทึมไม่ได้มีพารามิเตอร์ของโมเดล เช่น K-NN เป็นต้น</p></li>
<li><p><strong>ไฮเปอร์พารามิเตอร์ (Hyperparameters)</strong> เป็นพารามิเตอร์ประเภทหนึ่งในอัลกอริทึมการเรียนรู้ของเครื่อง พารามิเตอร์ประเภทนี้ไม่สามารถประมาณค่าจากข้อมูลโดยตรงด้วยวิธีการทางสถิติ แต่จะใช้การกำหนด/ปรับแต่งค่าโดยตัวผู้วิเคราะห์เอง <strong>ในเชิงเทคนิคเรียกการปรับแต่งค่าดังกล่าวว่า hyperparameter tuning</strong> การปรับแต่งค่าของ hyperparameter ดังกล่าวจะใช้วิธีการทดลองกำหนดค่า hyperparameter จำนวนหนึ่งให้กับอัลกอริทึม จากนั้นเลือกใช้ค่า hyperparameter ที่ทำให้ค่าประสิทธิภาพของโมเดลทำนายสูงที่สุด ทั้งนี้การพิจารณาประสิทธิภาพดังกล่าวจะพิจารณาบนชุดข้อมูลอีกชุดหนึ่งที่เรียกว่า <strong>validation dataset</strong></p></li>
</ul>
<p>จากที่กล่าวข้างต้นจะเห็นว่าในกระบวนการพัฒนาโมเดลการเรียนรู้ของเครื่อง ต้องการชุดข้อมูลทั้งหมดจำนวน 3 ชุด ได้แก่ training, validation และ test dataset โดยที่ training และ validation dataset เป็นชุดข้อมูลที่ใช้ในระยะพัฒนาการเรียนรู้ของโมเดลให้มีประสิทธิภาพสูงสุด ส่วน test dataset เป็นชุดข้อมูลที่ใช้ตรวจสอบประสิทธิภาพด้านความเป็นนัยทั่วไปแต่จะไม่ได้มีส่วนเกี่ยวข้องกับระยะการพัฒนาการเรียนรู้ของโมเดล</p>
<div style="page-break-after: always;"></div>
</section>
<section id="data-partitioning" class="level2">
<h2 class="anchored" data-anchor-id="data-partitioning">3.4 Data Partitioning</h2>
<p>ในทางปฏิบัติผู้วิเคราะห์มักมีข้อมูลต้นฉบับเพียงชุดเดียวเท่านั้นแต่ละใช้การแบ่งส่วนข้อมูลโดยใช้วิธีการสุ่มตัวอย่าง (random sampling) เพื่อสร้าง training, validation และ test dataset รูปด้านล่างแสดงลักษณะการแบ่งส่วนข้อมูล</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-2117384298.png" class="img-fluid figure-img" style="width:40.0%" alt="training, validation และ testing dataset"></p>
<p></p><figcaption class="figure-caption">training, validation และ testing dataset</figcaption><p></p>
</figure>
</div>
<p>โดยปกติการแบ่งส่วนข้อมูลดังกล่าวไม่ได้มีกฎเกณฑ์ตายตัวว่าควรแบ่งส่วนใดอย่างละเท่าไหร่ โดยปกติผู้วิเคราะห์มักกำหนดสัดส่วนระหว่าง training + validation dataset กับ test dataset เป็น 80 : 20, 75 : 25, 70 : 30, 60: 40 หรือ 50: 50 ขึ้นอยู่กับว่าชุดข้อมูลต้นฉบับที่มีนั้นมีขนาดใหญ่มากเพียงใด นอกจากนี้การแบ่งส่วนข้อมูลด้วยวิธีการสุ่มตัวอย่างอาจจำแนกเป็น 2 วิธีการ วิธีการแรกคือการสุ่มตัวอย่างแบบง่าย (simple random sampling: SRS) และวิธีการที่สองคือการสุ่มตัวอย่างแบบชั้นภูมิ (stratified random sampling)</p>
<section id="ชดขอมล-mpg" class="level3">
<h3 class="anchored" data-anchor-id="ชดขอมล-mpg">ชุดข้อมูล <code>mpg</code></h3>
<p>ชุดข้อมูลที่ใช้เป็นตัวอย่างในหัวข้อนี้จะใช้ dataset <code>mpg</code> ที่เป็นชุดข้อมูลตัวอย่างซึ่งถูกติดตั้งมาพร้อมกับการติดตั้งโปรแกรม R อยู่แล้ว ผู้วิเคราะห์สามารถเรียกดูข้อมูลภายในชุดข้อมูลดังกล่าวได้โดยใช้คำสั่งพื้นฐานต่าง ๆ เช่น <code>head()</code>, <code>str()</code>, <code>glimpse()</code> หรือ <code>summary()</code> เป็นต้น</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa…
2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa…
3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa…
4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa…
5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa…
6 audi         a4      2.8  1999     6 manual(m5) f        18    26 p     compa…</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 234
Columns: 11
$ manufacturer &lt;chr&gt; "audi", "audi", "audi", "audi", "audi", "audi", "audi", "…
$ model        &lt;chr&gt; "a4", "a4", "a4", "a4", "a4", "a4", "a4", "a4 quattro", "…
$ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2.0, 2.…
$ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1999, 200…
$ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 8, 8, …
$ trans        &lt;chr&gt; "auto(l5)", "manual(m5)", "manual(m6)", "auto(av)", "auto…
$ drv          &lt;chr&gt; "f", "f", "f", "f", "f", "f", "f", "4", "4", "4", "4", "4…
$ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17, 17, 1…
$ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25, 25, 2…
$ fl           &lt;chr&gt; "p", "p", "p", "p", "p", "p", "p", "p", "p", "p", "p", "p…
$ class        &lt;chr&gt; "compact", "compact", "compact", "compact", "compact", "c…</code></pre>
</div>
</div>
</section>
<section id="การแบงขอมลดวยการสมอยางงาย" class="level3">
<h3 class="anchored" data-anchor-id="การแบงขอมลดวยการสมอยางงาย">การแบ่งข้อมูลด้วยการสุ่มอย่างง่าย</h3>
<p>การแบ่งด้วย simple random sampling เป็นการแบ่งโดยสุ่มข้อมูลตามจำนวนที่กำหนดออกมาเป็นชุดข้อมูล training dataset หรือ test dataset โดยการสุ่มดังกล่าวมีข้อสมมุติว่าหน่วยข้อมูลทุกหน่อยในชุดข้อมูลต้นฉบับมีโอกาสที่จะถูกสุ่มขึ้นมาเท่ากันทั้งหมด การแบ่งข้อมูลด้วยวิธีการนี้ใน R สามารถทำได้หลายวิธี แต่ในบทความนี้จะใช้วิธีที่อยู่ภายใต้ framework ของ tidymodels การแบ่งข้อมูลด้วยวิธีการดังกล่าวมีสองขั้นตอน <strong>ขั้นแรก</strong> คือการสร้างกรอบของการแบ่งข้อมูลออกเป็น training และ test data สามารถทำได้ด้วยฟังก์ชัน <code>initial_split()</code> ของ package rsample อาร์กิวเมนท์สำคัญที่จะต้องระบุในฟังก์ชันได้แก่ <code>data</code> และ <code>prop</code><strong>ขั้นที่สอง</strong> คือการแบ่งข้อมูลตามกรอบในขั้นตอนแรก โดยจะใช้ฟังก์ชัน <code>training()</code> เพื่อแบ่งชุด training dataset ออกมา และใช้ฟังก์ชัน <code>testing()</code> เพื่อแบ่งชุดข้อมูล test dataset ออกมา</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import rsample</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate sampling frame</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>mpg_split1 <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> mpg, <span class="at">prop =</span> <span class="fl">0.75</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>mpg_split1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;175/59/234&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create training and test dataset</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>train_srs <span class="ot">&lt;-</span> mpg_split1 <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>test_srs <span class="ot">&lt;-</span> mpg_split1 <span class="sc">%&gt;%</span> <span class="fu">testing</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="การแบงขอมลดวยการสมแบบชนภม" class="level3">
<h3 class="anchored" data-anchor-id="การแบงขอมลดวยการสมแบบชนภม">การแบ่งข้อมูลด้วยการสุ่มแบบชั้นภูมิ</h3>
<p>การแบ่งชุดข้อมูลด้วยการสุ่มแบบชั้นภูมิสามารถทำได้ด้วยฟังก์ชัน <code>initial_split()</code> เช่นเดียวกัน แต่จะต้องมีการระบุอาร์กิวเมนท์ของฟังก์ชันเพิ่มเติมได้แก่ <code>strata</code> เพื่อระบุตัวแปรตามหรือตัวแปรเกณฑ์ที่จะใช้แบ่งชั้นภูมิก่อนการสุ่มตัวอย่าง และ <code>breaks</code> ใช้กำหนดจำนวนอันตรภาคชั้นของตัวแปรตามหรือตัวแปรเกณฑ์ที่จะใช้แบ่งชั้นภูมิหากตัวแปรดังกล่าวเป็นตัวแปรเชิงปริมาณ ค่าเริ่มต้นของอาร์กิวเมนท์นี้กำหนดให้ <code>breaks = 4</code>ตัวอย่างต่อไปนี้แสดงการแบ่งชุดข้อมูล training และ test ด้วยการสุ่มแบบชั้นภูมิ</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mpg_split2 <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> mpg, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prop =</span> <span class="fl">0.75</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strata =</span> <span class="st">"hwy"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">breaks =</span> <span class="dv">10</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>train_str <span class="ot">&lt;-</span> mpg_split2 <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>test_str <span class="ot">&lt;-</span> mpg_split2 <span class="sc">%&gt;%</span> <span class="fu">testing</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>รูปด้านล่างแสดงการเปรียบเทียบการแจกแจงของตัวแปรตามระหว่างชุดข้อมูลต้นฉบับ (full dataset), training และ test dataset ที่แบ่งด้วยวิธีการสุ่มตัวอย่างแบบง่าย และแบบชั้นภูมิ</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">เปรียบเทียบระหว่าง SRS กับ STR</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>การสุ่มแบบชั้นภูมิเหมาะสำหรับการพัฒนา classification models เมื่อสัดส่วนของค่าที่เป็นไปได้ของตัวแปรตามมีความแตกต่างกันมาก ๆ หรือมีบางค่าสังเกตของตัวแปรตามที่มีสัดส่วนการเกิดที่น้อยเมื่อเปรียบเทียบกับค่าสังเกตอื่น ๆ (imbalanced outcome) นอกจากนี้ยังเหมาะกับการพัฒนา regression models เมื่อตัวแปรตามมีลักษณะการแจกแจงแบบเบ้ขวา</p>
</section>
</section>
<section id="การสมซำ-resampling" class="level2">
<h2 class="anchored" data-anchor-id="การสมซำ-resampling">3.5 การสุ่มซ้ำ (resampling)</h2>
<p>อัลกอริทึมการเรียนรู้ของเครื่องหลายตัวมี hyperparameters ที่หากมีการกำหนดค่าที่เหมาะสมจะช่วยพัฒนาการเรียนรู้ได้ดีขึ้นและช่วยให้โมเดลทำนายมีประสิทธิภาพการทำนายที่สูงขึ้นได้ อย่างไรก็ตาม hyperparameters ดังกล่าวไม่สามารถประมาณได้โดยตรงจากข้อมูล แต่ต้องอาศัยการกำหนดค่าเองโดยผู้วิเคราะห์ ดังนั้นในระหว่างการพัฒนาโมเดลจึงมีความจำเป็นที่ผู้วิเคราะห์จะต้องทราบประสิทธิภาพการทำนายของโมเดลเมื่อมีการกำหนดค่า hyperparameters ต่าง ๆ เพื่อใช้เป็นสารสนเทศประกอบการกำหนดค่า hyperparameters ดังกล่าว</p>
<p>ด้วยเหตุผลเดียวกับการประเมินประสิทธิภาพของโมเดลด้วยชุดข้อมูลทดสอบ การประเมินประสิทธิภาพในระยะของการพัฒนาโมเดลดังกล่าวไม่ช่วยใช้ข้อมูลจากชุดข้อมูลฝึกหัด เพราะจะทำให้ค่าประสิทธิภาพดังกล่าวมีค่าสูงเกินความเป็นจริงและอาจทำให้การกำหนดค่า hyperparameters มีความคลาดเคลื่อน เพื่อแก้ปัญหาดังกล่าวจึงมีการใช้เทคนิคการสุ่มซ้ำ (resampling) ในการสุ่มชุดข้อมูลย่อยจากชุดข้อมูลฝึกหัด โดยแบ่งชุดข้อมูลฝึกหัดออกเป็นสองชุดข้อมูลย่อย อาจเรียกว่าชุดข้อมูลสำหรับวิเคราะห์ (analysis) ต่อไปจะเรียกว่า traning dataset และชุดข้อมูลสำหรับสำหรับประเมินประสิทธิภาพ (assessment) ซึ่งต่อไปจะเรียกว่า validation dataset ดังรูป 24</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-468626522.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">resampling strategy</figcaption><p></p>
</figure>
</div>
<p>เนื่องจากเทคนิคการสุ่มซ้ำเป็นการสุ่มแบบที่มีการใส่คืน (sampling with replacement) จึงทำให้ในระยะของการพัฒนาโมเดลผู้วิเคราะห์สามารถทวนซ้ำการสุ่มซ้ำดังกล่าวเพื่อสร้าง training และ validation dataset ได้จำนวนหลายชุด การดำเนินการดังกล่าวช่วยให้การประเมินประสิทธิภาพของโมเดลทำนายภายใต้เงื่อนไขของการกำหนด hyperparameters ต่าง ๆ สามารถทำได้อย่างแม่นยำ</p>
<p>ปัจจุบันมีเทคนิคการสุ่มซ้ำสำหรับการพัฒนาโมเดลทำนายดังกล่าวหลายตัว ได้แก่ K-fold Cross-Validation, Monte Carlo Cross-Validation, Bootstrapping และ Rolling Origin Forecasting รายละเอียดมีดังนี้</p>
<section id="k-fold-cross-validation-และวธการอน-ๆ-ทเกยวของ" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation-และวธการอน-ๆ-ทเกยวของ">K-fold Cross-Validation และวิธีการอื่น ๆ ที่เกี่ยวข้อง</h3>
<p>เป็นเทคนิคการสุ่มซ้ำที่นิยมใช้กันอย่างแพร่หลาย เทคนิคนี้จะแบ่งชุดข้อมูล traning dataset โดยใช้การสุ่มแบบใส่คืนออกเป็นข้อมูลชุดย่อยจำนวน K ชุด จากนั้นจะดำเนินการวิเคราะห์และประเมินประสิทธิภาพของโมเดลจำนวน K ครั้ง โดยที่แต่ละครั้งที่จะมีการหมุนเวียนใช้ชุดข้อมูลจำนวน K-1 ชุดเพื่อวิเคราะห์ และใช้ชุดข้อมูลที่เหลืออีก 1 ชุดเพื่อประเมินประสิทธิภาพ</p>
<p>รูป 25 แสดงตัวอย่างของ 5-fold cross-validation จากรูปจะเห็นว่ามีการสุ่มเพื่อแบ่งชุดข้อมูลฝึกหัดออกเป็น 5 ชุดย่อย จากนั้นทวนซ้ำการดำเนินการวิเคราะห์และประเมินประสิทธิภาพของโมเดลจำนวน 5 ครั้ง โดยที่ในแต่ละครั้งจะใช้ชุดข้อมูลย่อยจำนวน 4 ชุด เป็น training dataset เพื่อสร้างโมเดลทำนาย และใช้อีก 1 ชุดที่เหลือเป็น validation dataset เพื่อตรวจสอบประสิทธิภาพของโมเดลทำนาย จากรูปจะเห็นว่าในแต่ละครั้งจะมีการหมุนเวียนชุดข้อมูลที่จะใช้เป็น training และ validation ไปเรื่อย ๆ จนครบ การดำเนินการดังกล่าวจะทำให้ผู้วิเคราะห์มีค่าสถิติที่ใช้ประเมินประสิทธิภาพของโมเดลจำนวน 5 ค่า ผู้วิเคราะห์จะใช้ผลการวิเคราะห์จากค่าสถิติดังกล่าว เช่น ค่าเฉลี่ยของ RMSE หรือ R square ในการประเมินประสิทธิภาพของโมเดลภายใต้เงื่อนไขต่าง ๆ เช่น ภายใต้การกำหนดค่า hyperparameters ต่าง ๆ เป็นต้น</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1150746472.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">5-fold CV (ที่มา : https://towardsdatascience.com/cross-validation-k-fold-vs-monte-carlo-e54df2fc179b)</figcaption><p></p>
</figure>
</div>
<p>เนื่องจาก K-fold CV สุ่มเพื่อแบ่งชุดข้อมูลในครั้งแรกเพียงครั้งเดียว และใช้การหมุนเวียนชุดข้อมูลย่อยที่ได้จากการสุ่มดังกล่าวเพื่อวิเคราะห์และประเมินประสิทธิภาพของโมเดล จึงทำให้หน่วยข้อมูลแต่ละหน่วยมีโอกาสที่จะปรากฎอยู่ใน validation dataset ได้เพียงครั้งเดียวดังตัวอย่างในรูป 26 ข้อจำกัดนี้ทำให้ค่าประมาณประสิทธิภาพของโมเดลทำนายที่มีแนวโน้มจะมีความแปรปรวนมากที่สุดเมื่อเปรียบเทียบกับ resampling วิธีการอื่น ๆ การที่จะลดทอนความแปรปรวนดังกล่าวให้น้อยลงสามารถทำได้ด้วยการเพิ่มจำนวน K ให้มากขึ้น โดยจากการศึกษาพบว่าการกำหนดให้ K มีค่าตั้งแต่ 10 ขึ้นไป จะช่วยลดทอนความแปรปรวนของการประเมินประสิทธิภาพได้ อย่างไรก็ตาม K-fold CV ก็ยังมีแนวโน้มที่จะมีความแปรปรวนดังกล่าวมากกว่าการใช้การสุ่มซ้ำแบบอื่นอยู่ดี</p>
<p>อีกข้อจำกัดหนึ่งของการทำ K-fold CV คือการกำหนดค่า K จำนวนมากจะทำให้การประมวลผลต้องดำเนินการหลายรอบและต้องใช้เวลาและทรัพยากรในการประมวลผลที่มากขึ้น ในกรณีที่ข้อมูลและโมเดลมีความซับซ้อนการประมวลผลในขั้นตอนนี้อาจใช้เวลานานหลายชั่วโมงหรือเป็นวันซึ่งอาจไม่คุ้มค่าที่จะดำเนินการในลักษณะดังกล่าว โดยในกรณีที่กำหนดให้ K = n เมื่อ n คือจำนวนหน่วยข้อมูลทั้งหมดจะเรียกการสุ่มนี้ว่า leave-one-out CV (LOOCV) ที่เป็นกรณีสุดโต่งที่สุดของการทำ K fold CV ปัจจุบัน LOOCV ไม่ค่อยถูกใช้งานแล้วเนื่องจากใช้เวลาและทรัพยากรอย่างมาก</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-998799574.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">10-fold CV จากชุดข้อมูลที่มีหน่วยข้อมูลจำนวน 32 หน่วย (ที่มา : Boehmke, and Greenwell (2020))</figcaption><p></p>
</figure>
</div>
<p>เพื่อแก้ปัญหาของ K-fold CV ข้างต้นถึงมีการพัฒนาเทคนิคอีกตัวหนึ่งเรียกว่า repeated K-fold cross-validation เทคนิคดังกล่าวเป็นการทำ K-fold CV ซ้ำ ๆ หลาย ๆ รอบ วิธีการนี้ทำให้หน่วยข้อมูลแต่ละหน่วยสามารถปรากฎอยู่ใน validation dataset ได้มากกว่าหนึ่งครั้ง ซึ่งช่วยให้ความแปรปรวนในการประมาณค่าประสิทธิภาพของโมเดลทำนายลดลงได้</p>
</section>
<section id="monte-carlo-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-cross-validation">Monte Carlo Cross-Validation</h3>
<p>ในขณะที่ K-fold CV เป็นวิธีการที่ยอมให้หน่วยข้อมูลแต่ละหน่วยปรากฎใน validation dataset ได้เพียงครั้งเดียว แต่ในทางกลับกัน Monte Carlo CV (MCCV) จะสร้างชุดข้อมูลย่อย K ชุดที่ยอมให้มีหน่วยข้อมูลที่ร่วมกันได้ซึ่งทำให้หน่วยข้อมูลแต่ละหน่วยสามารถปรากฎอยู่ใน validation dataset มากกว่าหนึ่งครั้งและช่วยลดทอนความแปรปรวนในการประมาณค่าประสิทธิภาพของโมเดลลงได้ โดย MCCV มีขั้นตอนการดำเนินการดังนี้</p>
<div style="page-break-after: always;"></div>
<ol type="1">
<li>แบ่งชุดข้อมูลที่จะนำมาพัฒนาโมเดลออกเป็นสองส่วน ได้แก่ ส่วน training dataset และ validation dataset (อาจใช้สัดส่วน 70:30, 80:20, … ตามที่ผู้วิเคราะห์เห็นว่าเหมาะสม)</li>
<li>นำข้อมูลใน training dataset ไปดำเนินการวิเคราะห์ และใช้ validation dataset เพื่อประเมินประสิทธิภาพของโมเดล จากนั้นเก็บค่าประสิทธิภาพดังกล่าวไว้</li>
<li>ทวนซ้ำขั้นตอนที่ 1. ใหม่ การทวนซ้ำอาจทำเป็นจำนวน 100, 500 หรือ 1,000 รอบ ซึ่งเมื่อครบตามจำนวนรอบที่กำหนดแล้วผู้วิเคราะห์จะนำค่าประมาณประสิทธิภาพจากแต่ละรอบมาหาค่าเฉลี่ย</li>
</ol>
<p>รูป 27 แสดงตัวอย่างของการทำ MCCV จำนวน 100 รอบ</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-103001330.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Monte Carlo CV จำนวน 100 รอบ (ที่มา : https://towardsdatascience.com/cross-validation-k-fold-vs-monte-carlo-e54df2fc179b)</figcaption><p></p>
</figure>
</div>
<p>รูป 28 แสดงการเปรียบเทียบผลที่ได้จากการแบ่งชุดข้อมูลระหว่าง 10-fold CV กับ 10 resample MCCV (โดยกำหนดให้สัดส่วนการสุ่มเป็น 90:10) ของชุดข้อมูลต้นฉบับที่มีจำนวน 20 หน่วย จากรูปจะเห็นว่าหน่วยข้อมูลมีโอกาสปรากฎใน validation dataset ได้เพียงครั้งเดียวเมื่อใช้ 10-fold CV แต่สามารถปรากฎได้มากกว่าหนึ่งครั้งเมื่อใช้ 10 resample MCCV</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1721863239.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ผลที่ได้จากการแบ่งชุดข้อมูลระหว่าง 10-fold CV กับ 10 resample MCCV (โดยกำหนดให้สัดส่วนการสุ่มเป็น 90:10) ของชุดข้อมูลต้นฉบับที่มีจำนวน 20 หน่วย (ที่มา : Max Kuhn and Kjell Johnson (2019))</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="bootstraping" class="level3">
<h3 class="anchored" data-anchor-id="bootstraping">Bootstraping</h3>
<p>กำหนดให้ชุดข้อมูลต้นฉบับมีขนาด n หน่วย <strong>bootstrap sample</strong> คือตัวอย่างสุ่มขนาด n หน่วย (เท่ากับชุดข้อมูลต้นฉบับ) ที่ได้จากการสุ่มตัวอย่างอย่างง่ายแบบใส่คืน (simple random sampling with replacement) จากชุดข้อมูลต้นฉบับ จากลักษณะของการสุ่มตัวอย่างแบบ bootstrap ข้างต้นจะได้ว่า ความน่าจะเป็นที่หน่วยข้อมูลแต่ละหน่วยจะถูกเลือกในการสุ่มข้อมูลตัวที่ <span class="math inline">\(i\)</span> โดยที่ <span class="math inline">\(i = 1,2,3,...,n\)</span> จะมีค่าเท่ากับ <span class="math inline">\(P(select_i) = \frac{1}{n}\)</span> ซึ่งทำให้ความน่าจะเป็นที่หน่วยข้อมูลจะไม่ถูกเลือกในการสุ่มครั้งที่ <span class="math inline">\(i\)</span> เท่ากับ <span class="math inline">\(P(not \ select)=1-\frac{1}{n}\)</span> ดังนั้นความน่าจะเป็นที่หน่วยข้อมูลแต่ละหน่วยจะอยู่ในตัวอย่างแบบ bootstrap จะมีค่าเท่ากับ <span class="math inline">\((1-\frac{1}{n})^n\)</span> เมื่อ <span class="math inline">\(n \rightarrow \infty\)</span> จะได้ว่าความน่าจะเป็นที่หน่วยข้อมูลแต่ละหน่วยจะปรากฎอยู่ในตัวอย่างแบบ bootstrap มีค่าเท่ากับ 63.2% (การพิสูจน์ใช้คุณสมบัติของ Taylor series) รูป 29 ด้านล่างแสดงลักษณะของตัวอย่างแบบ bootstrap</p>
<p><img src="images/image-1881794685.png" class="img-fluid"></p>
<p>ในกระบวนการพัฒนาโมเดลทำนาย จะใช้ตัวอย่าง bootstrap เป็นชุดข้อมูลสำหรับวิเคราะห์ และใช้ชุดข้อมูลที่เหลือที่ไม่ได้ถูกสุ่มไว้ในตัวอย่าง bootstrap เป็นชุดข้อมูลสำหรับประเมินประสิทธิภาพของโมเดลทำนายระหว่างการพัฒนาโมเดล (เทียบเท่ากับ validation dataset) โดยจะเรียกตัวอย่างที่ไม่ได้ถูกสุ่มไว้ในตัวอย่าง bootstrap ในแต่ละรอบว่า <strong>out-of-bag sample (OOB)</strong></p>
<p>จากคุณลักษณะของตัวอย่าง bootstrap ที่หน่วยข้อมูลแต่ละหน่วยมีโอกาสปรากฏอยู่ในชุดข้อมูล bootstrap ได้มากกว่า 1 ชุด จึงทำให้การประมาณค่าประสิทธิภาพของโมเดลที่ได้จากการสุ่มซ้ำแบบ bootstrap มีแนวโน้มที่จะมีความแปรปรวนต่ำกว่าการสุ่มซ้ำแบบ k-fold CV อย่างไรก็ตามในกรณีที่ข้อมูลต้นฉบับมีขนาดเล็กการสุ่มซ้ำแบบ boostrap มีแนวโน้มที่จะให้ค่าประมาณประสิทธิภาพของโมเดลที่ลำเอียง จึงควรใช้เทคนิคการสุ่มซ้ำแบบ bootstrap เมื่อข้อมูลมีขนาดใหญ่เพียงพอ (n &gt; 1000) (Boehmke, B., &amp; Greenwell, B., 2020)</p>
</section>
</section>
<section id="tidymodels-framework" class="level2">
<h2 class="anchored" data-anchor-id="tidymodels-framework">3.6 Tidymodels Framework</h2>
<p>ปัจจุบันมีเครื่องมือที่ช่วยให้ผู้วิเคราะห์สามารถพัฒนา machine model ได้หลายตัว บทเรียนนี้จะกล่าวถึงการใช้โปรแกรม R เพื่อพัฒนา ML model ดังกล่าว ทั้งนี้ต้องทำความเข้าใจก่อนว่า การทำงานบน R แม้จะเป็นปัญหาเดียวกัน ชุดข้อมูลเดียวกัน แต่ผู้วิเคราะห์ต่างคนกันก็มีทางที่จะดำเนินการด้วยวิธีการที่แตกต่างกันได้ (ใน Python หรือโปรแกรมอื่น ๆ ก็เช่นเดียวกัน) วิธีการหนึ่งใน R ที่สามารถ modeling ได้ง่ายและมีประสิทธิภาพคือการใช้ <strong>tidymodels framework</strong> ดังรูป 23</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-258190158.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">tidymodel framework</figcaption><p></p>
</figure>
</div>
<ul>
<li><p><strong>package-rsample</strong> ใช้ในงาน resampling ข้อมูล เช่นการสร้าง training/validation/test dataset การสร้าง cross-validation dataset หรือการสร้าง bootstrape dataset ซึ่งได้กล่าวการใช้งานเบื้องต้นไปแล้ว</p></li>
<li><p><strong>package-recipes</strong> ใช้แปลง/แก้ปัญหาที่เกิดขึ้นในข้อมูลของตัวแปรที่ใช้ในการพัฒนาโมเดล ขั้นตอนนี้เรียกว่า feature engineering</p></li>
<li><p><strong>package-parsnip</strong> ใช้ fit machine learning กับข้อมูล</p></li>
<li><p><strong>package-Tune</strong> และ <strong>package-dials</strong> มีฟังก์ชันที่อำนวยความสะดวกในการ fine tune hyperparameter ของโมเดลเพื่อเพิ่มประสิทธิภาพการทำนายของโมเดลให้สูงที่สุด</p></li>
<li><p><strong>package-yardstick</strong> มีฟังก์ชันของ metric ที่ใช้ประเมินประสิทธิภาพของโมเดลทำนาย</p></li>
</ul>
<p>tidymodels ถูกพัฒนาขึ้นโดยได้รับการออกแบบให้สามารถทำซ้ำกระบวนการพัฒนาโมเดลได้ง่าย โดยใช้ไวยกรณ์ของภาษาในลักษณะเดียวกัน และถูกออกแบบโดยเน้นใช้กับ supervised learning เป็นหลัก ผู้ใช้งานไม่จำเป็นต้องติดตั้งทุก package ในข้างต้นด้วยตนเอง แต่ติดตั้งเพียง package-tidymodels ก็สามารถใช้งานทุก package ภายใต้ framework ดังกล่าวได้แล้ว โดยการพิมพ์คำสั่งต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidymodels"</span>) <span class="co"># ดาวน์โหลดและติดตั้ง tidymodels</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># เรียกใช้ tidymodels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.3     ✔ tibble       3.1.8
✔ dials        1.1.0     ✔ tidyr        1.3.0
✔ infer        1.0.4     ✔ tune         1.0.1
✔ modeldata    1.0.1     ✔ workflows    1.1.2
✔ parsnip      1.0.3     ✔ workflowsets 1.0.0
✔ purrr        1.0.1     ✔ yardstick    1.1.0
✔ recipes      1.0.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ gridExtra::combine()     masks dplyr::combine()
✖ purrr::discard()         masks scales::discard()
✖ dplyr::filter()          masks stats::filter()
✖ kableExtra::group_rows() masks dplyr::group_rows()
✖ dplyr::lag()             masks stats::lag()
✖ purrr::lift()            masks caret::lift()
✖ yardstick::precision()   masks caret::precision()
✖ yardstick::recall()      masks caret::recall()
✖ yardstick::sensitivity() masks caret::sensitivity()
✖ yardstick::specificity() masks caret::specificity()
✖ recipes::step()          masks stats::step()
• Use suppressPackageStartupMessages() to eliminate package startup messages</code></pre>
</div>
</div>
<section id="fitting-linear-regression-using-parsnip" class="level3">
<h3 class="anchored" data-anchor-id="fitting-linear-regression-using-parsnip">Fitting Linear Regression using parsnip</h3>
<p><img src="images/image-538379331.png" class="img-fluid" style="width:30.0%"></p>
<p>การ fit machine learning model กับข้อมูลด้วย R ในยุคเริ่มแรกค่อนข้างมีความยากลำบากพอสมควร เพราะ R ไม่ได้มี package ที่เป็น framework รวมสำหรับการ fit ML model ดังกล่าว การที่จะ fit ML model ในงานหนึ่ง ๆ ผู้วิเคราะห์อาจจะต้องยุ่งเกี่ยวกับ package จำนวนมาก เช่น</p>
<ul>
<li><p>package rpart สำหรับ fit decision tree</p></li>
<li><p>package glmnet สำหรับ fit regularized regression model</p></li>
<li><p>package knn สำหรับ fit K-NN model</p></li>
</ul>
<p>โดย package ที่แตกต่างกันมักมีแนวคิดและไวยกรณ์การเขียนคำสั่งที่แตกต่างกัน ทำให้เป็นอุปสรรคต่อการทำงานโดยเฉพาะการทำซ้ำในอนาคต จากปัญหานี้ tidymodels จึงมีการพัฒนา package parsnip ขึ้นเพื่อเป็น interface สำหรับใช้ package ใน R ที่เกี่ยวข้องกับการ fit supervised learning ทั้งนี้ parsnip ได้ถูกออกแบบมาให้การสั่งงานทั้งหมดอยู่ภายใต้ไวยกรณ์แบบเดียวกัน ปัจจุบันการ fit ML models ใน R จึงดำเนินการได้ง่ายขึ้นอย่างมาก</p>
<p>ขั้นตอนการ fit ML models ด้วย parsnip มี 2 ขั้นตอน ได้แก่ การระบุโมเดล และการประมวลผล รายละเอียดมีดังนี้</p>
<section id="การระบโมเดล-model-specification" class="level4">
<h4 class="anchored" data-anchor-id="การระบโมเดล-model-specification">(1) การระบุโมเดล (model specification)</h4>
<p>การระบุโมเดลใน parsnip มีส่วนประกอบ 3 ส่วนที่จำเป็นได้แก่</p>
<ul>
<li><p><strong>model type</strong> หรืออัลกอริทึมการเรียนรู้ของเครื่องที่ผู้วิเคราะห์จะใช้ในการทำงาน</p></li>
<li><p><strong>engine</strong> หรือ package ของ R ที่จะใช้สำหรับประมวลผล model type ที่เลือก</p></li>
<li><p><strong>mode</strong> สำหรับกำหนดว่าปัญหาที่ทำงานด้วยอยู่นี้เป็น regression หรือ classification</p></li>
</ul>
<p>รายละเอียดว่าผู้วิเคราะห์สามารถกำหนด model type, engine และ mode แบบใดได้บ้างและต้องกำหนดอย่างไร สามารถศึกษาได้จาก <a href="https://www.tidymodels.org/find/parsnip/" class="uri">https://www.tidymodels.org/find/parsnip/</a> รูป 24 ด้านล่างแสดงค้นหาสำหรับอัลกอริทึม linear regression จากผลการค้นหาในรูปด้านล่างจะเห็นว่าการ fit linear regression ด้วย parsnip สามารถทำได้ด้วย model type คือ <code>linear_reg()</code> เมื่อพิจารณาในคอลัมน์ engine จะเห็นว่าการ fit linear regression มี engine จำนวนมากที่สามารถใช้เพื่อประมาณค่าพารามิเตอร์ของโมเดลได้ engine ดังกล่าวจริง ๆ แล้วคือ package ต่าง ๆ ของ R ที่ใช้ประมวลผล mode type ที่เลือกไว้ได้ ผู้อ่านจะเห็นว่า model type แบบ <code>linear_reg</code> มี engine ที่สามารถใช้ประมวลผลได้จำนวนมาก ซึ่งมีความเหมือนและความแตกต่างกัน เนื้อหาส่วนนี้มีความละเอียดพอสมควรจึงจะกล่าวถึงในบท regression model ต่อไป</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-33185451.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">parsnip manual</figcaption><p></p>
</figure>
</div>
<p>ในคู่มือข้างต้นยังมีเครื่องมือให้ค้นหาการกำหนดอาร์กิวเมนท์ของฟังก์ชัน model type ในข้างต้น จากรูป 25 จะเห็นรายละเอียดในการกำหนดอาร์กิวเมนท์ของฟังก์ชัน <code>linear_reg()</code> เมื่อกำหนด engine ในลักษณะต่าง ๆ</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1313501193.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">argument ในฟังก์ชัน model type</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
<p>ความหมายของการกำหนดอาร์กิวเมนท์แต่ละค่าสามารถศึกษาได้จากคู่มือของฟังก์ชัน <code>linear_reg()</code> ซึ่งสามารถกด hyperlink จากคู่มือได้เลย (คู่มือ <a href="https://parsnip.tidymodels.org/reference/linear_reg.html"><code>linear_reg()</code></a>)</p>
<p>เอกสารเพิ่มเติมเกี่ยวกับ package parsnip</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/parsnip/parsnip.pdf" class="uri">https://cran.r-project.org/web/packages/parsnip/parsnip.pdf</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/parsnip/vignettes/parsnip.html" class="uri">https://cran.r-project.org/web/packages/parsnip/vignettes/parsnip.html</a></p></li>
</ul>
<p>สมมุติว่าผู้วิเคราะห์ต้องการพัฒนาโมเดลการเรียนรู้ของเครื่องด้วยอัลกอริทึม linear regression โดยมีตัวแปรตามคือ <code>hwy</code> และตัวแปรอิสระเพียง 1 ตัวได้แก่ <code>cty</code> ตัวอย่างคำสั่งต่อไปนี้แสดงการกำหนดโมเดลการเรียนรู้ด้วย parsnip ดังกล่าว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span>        <span class="co"># model type</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span>  <span class="co"># model engine</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="co"># model mode</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="การประมวลผล" class="level4">
<h4 class="anchored" data-anchor-id="การประมวลผล">(2) การประมวลผล</h4>
<p>เมื่อกำหนดโมเดลการเรียนรู้แล้วขั้นตอนถัดไปคือการนำ model specification ดังกล่าว ไปดำเนินการประมวลผล โดยส่งผ่านไปยังฟังก์ชัน <code>fit()</code> ซึ่งมีอาร์กิวเมนท์สำคัญ 2 ตัวได้แก่ model formula และ training dataset ที่จะใช้สำหรับฝึกหัดโมเดล</p>
<p>การเขียน model formula จะเขียนอยู่ในรูปของ <code>y ~ x1+x2+x3+…</code> โดยที่ <code>y</code> คือตัวแปรตาม ส่วน <code>x1, x2, x3 ,…</code> คือตัวแปรอิสระภายในชุดข้อมูลฝึกหัด และสัญลักษณ์ <code>~</code> หมายความว่า “regress on” ในกรณีที่ต้องการใช้ตัวแปรที่เหลือในชุดข้อมูลทั้งหมดเป็นตัวแปรทำนาย สามารถเขียน model formula สั้น ๆ ได้ดังนี้ `y ~ .` ตัวอย่างต่อไปนี้แสดงการส่งผ่าน model specification <code>lm_model</code> ในข้างต้นไปประมวลผล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> lm_model <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">fit</span>(hwy <span class="sc">~</span> cty,  <span class="co"># model formula</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_str) <span class="co"># training dataset</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>fit_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:
stats::lm(formula = hwy ~ cty, data = data)

Coefficients:
(Intercept)          cty  
     0.2176       1.3759  </code></pre>
</div>
</div>
</section>
<section id="การเรยกดคาประมาณพารามเตอรของ-ml-model" class="level4">
<h4 class="anchored" data-anchor-id="การเรยกดคาประมาณพารามเตอรของ-ml-model">(3) การเรียกดูค่าประมาณพารามิเตอร์ของ ML model</h4>
<p>อย่างไรก็ตาม tidymodels มีฟังก์ชัน <code>tidy()</code> ซึ่งช่วยสร้างตารางสรุปผลลัพธ์จากการประมาณค่าพารามิเตอร์หรือการเรียนรู้ของโมเดลทำนายที่ใช้ให้อยู่ในรูปแบบเดียวกัน ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    0.218    0.573      0.380 7.05e- 1
2 cty            1.38     0.0330    41.7   8.28e-92</code></pre>
</div>
</div>
<p>ภายใต้ framework ของ tidymodels จะใช้ฟังก์ชันใน package parsnip เพื่อ fitting model ทำนายดังกล่าว package ดังกล่าว จุดเด่นของ parsnip คือถูกออกแบบมาเพื่อเป็น interface สำหรับ fit supervised learning model ที่มีรูปแบบการใช้คำสั่งเป็นไวยกรณ์แบบเดียว</p>
</section>
<section id="prediction" class="level4">
<h4 class="anchored" data-anchor-id="prediction">(4) Prediction</h4>
<p>ผู้วิเคราะห์สามารถนำโมเดลที่ผ่านการ train เรียบร้อยแล้วไปใช้หาค่าทำนาย โดยส่งผ่านโมเดลที่ train แล้ว (ในที่นี้คือ <code>fit_lm</code>) ไปยังฟังก์ชัน <code>predict()</code> ที่มีอาร์กิวเมนท์สำคัญคือ <code>new_data</code> ตัวอย่างด้านล่างแสดงนำ <code>fit_lm</code> ไปทำนายตัวแปร <code>hwy</code> ในชุดข้อมูลทดสอบ ผลลัพธ์ที่ได้จากการทำนายจะเป็นตารางแบบ tibble ที่แต่ละ row คือค่าทำนายของหน่วยข้อมูลใน row เดียวกันกับใน <code>test_str</code> ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>hwy_pred <span class="ot">&lt;-</span> fit_lm <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">predict</span>(<span class="at">new_data =</span> test_str)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>hwy_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 1
   .pred
   &lt;dbl&gt;
 1  29.1
 2  25.0
 3  20.9
 4  23.6
 5  23.6
 6  19.5
 7  19.5
 8  18.1
 9  22.2
10  20.9
# … with 50 more rows</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>เมื่อได้ค่าทำนายในชุดข้อมูลทดสอบมาแล้ว ขั้นตอนถัดไปคือการประเมินประสิทธิภาพของโมเดลทำนาย โดยทั่วไปผู้วิเคราะห์มักจะรวมค่าทำนายที่ได้ (ในที่นี้คือ <code>hwy_pred</code>) ไปไว้อยู่ภายในชุดข้อมูลทดสอบ การดำเนินการนี้สามารถทำได้หลายวิธีการขึ้นอยู่กับว่าถนัดจะดำเนินการแบบนี้ ในตัวอย่างนี้จะใช้ฟังก์ชัน <code>bind_cols()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test_str <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(hwy, cty) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bind_cols</span>(hwy_pred)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>test_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60 × 3
     hwy   cty .pred
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1    29    21  29.1
 2    26    18  25.0
 3    25    15  20.9
 4    25    17  23.6
 5    25    17  23.6
 6    20    14  19.5
 7    20    14  19.5
 8    17    13  18.1
 9    26    16  22.2
10    23    15  20.9
# … with 50 more rows</code></pre>
</div>
</div>
</section>
<section id="evaluating-models-using-yardstick" class="level4">
<h4 class="anchored" data-anchor-id="evaluating-models-using-yardstick">(5) Evaluating models using yardstick</h4>
<p>การคำนวณค่าประสิทธิภาพของโมเดลทำนายแบบ regression ภายใต้ tidymodels framework สามารถทำได้ง่าย ๆ โดยใช้ฟังก์ชันจาก package yardstick ได้แก่ <code>rmse()</code> และ <code>rsq()</code> ตัวอย่างต่อไปนี้แสดงการเขียนคำสั่งเพื่อคำนวณ metric ทั้งสอง</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">truth =</span> hwy, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard        1.78</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsq</span>(<span class="at">truth =</span> hwy, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard       0.929</code></pre>
</div>
</div>
<p>ผลลัพธ์ข้างต้นเมื่อพิจารณาค่า RMSE พบว่าโมเดลทำนายที่พัฒนาขึ้นมีความคลาดเคลื่อนในการทำนายค่าของตัวแปร <code>hwy</code> โดยเฉลี่ย 1.64 หน่วย และเมื่อพิจารณาจากค่า R square พบว่ามีค่าเท่ากับ .913 แสดงว่าค่าจริงของ <code>hwy</code> กับค่าทำนายมีความผันแปรร่วมกันคิดเป็นร้อยละ 91.3 ซึ่งอยู่ในระดับที่สูงมาก ผลการวิเคราะห์นี้จึงบ่งชี้ว่าโมเดลทำนายที่พัฒนาขึ้นสามารถใช้ทำนายคะแนน <code>hwy</code> ได้ดี</p>
<p>นอกจาก metric ที่เป็นค่าสถิติแล้วยังมี metric ที่เป็น visualization ด้วย เช่นในกรณีของ regression model สามารถใช้ R squared plots เพื่อประเมินความสอดคล้องกันระหว่างค่าจริงของตัวแปรตามกับค่าทำนายได้ การสร้าง R squared plot ใน R สามารถทำได้หลายวิธี ทั้งการใช้ฟังก์ชัน <code>plot()</code> ของ package graphic เหมือนกับตัวอย่างในบทที่ 2 นอกจากนี้ยังสามารถใช้ package ggplot2 เพื่อสร้างแผนภาพดังกล่าวได้เหมือนกัน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create R squared plot using graphic package</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> test_results<span class="sc">$</span>hwy, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> test_results<span class="sc">$</span>.pred,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"predicted value"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"actual value"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">1</span>,<span class="at">b=</span><span class="dv">1</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"steelblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="336"></p>
</div>
</div>
<p>ในกรณีที่ต้องการใช้ ggplot2 สามารถเขียนคำสั่งได้ดังนี้</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create R squared plot using ggplot2 package</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>()<span class="sc">+</span>  <span class="co"># create 2D plane</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> hwy, <span class="co"># create scatter plot</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> .pred))<span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">1</span>, <span class="at">slope=</span><span class="dv">1</span>, <span class="at">linetype=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_obs_pred</span>()<span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">R squared plot via ggplot2</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผลการวิเคราะห์จาก R square plot ข้างต้นแสดงให้เห็นว่าโมเดลสามารถทำนายค่าของตัวแปร <code>hwy</code> ได้ค่อนข้างดี อย่างไรก็ตามหากพิจารณาเปรียบเทียบความสัมพันธ์ระหว่างค่าจริงกับค่าทำนายจะพบว่าโมเดลนี้มีแนวโน้มให้ค่าทำนายที่ต่ำกว่าความเป็นจริง (underestimate)</p>
<p><strong>คำถาม เราได้เรียน</strong> linear regression มาพอสมควรแล้ว โดยหากจำได้จะทราบว่า linear regression เป็นโมเดลทางสถิติที่มีข้อตกลงเบื้องต้นที่ค่อนข้างเข้มงวด ได้แก่ independence, homoscedasticity, normality, no multicollinearity, no outlier, … คำถามคือในการพัฒนา ML model ดังกล่าวจำเป็นมั้ยที่จะต้องตรวจสอบข้อตกลงเบื้องต้นดังกล่าว เพราะอะไร?</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="fitting-classification-models-logistic-regression-using-parsnip" class="level3">
<h3 class="anchored" data-anchor-id="fitting-classification-models-logistic-regression-using-parsnip">Fitting Classification models (logistic regression) using parsnip</h3>
<p>หัวข้อนี้จะใช้ tidymodels framework เพื่อ fit logistic regression model สำหรับทำนายชุดข้อมูล ชุดข้อมูลที่ใช้ชื่อ <code>classification.csv</code> <a href="https://github.com/ssiwacho/2758688_ML/blob/79a225047656cb9a22a4e1b78835b8bdd91a1d26/week%201/classification.csv">สามารถดาวน์โหลดได้ที่นี่</a> ชุดข้อมูลนี้มีตัวแปรตามที่สนใจคือ <code>Class</code> ซึ่งเป็นสถานะการ dropout ออกจากระบบ LMS ของนักเรียน ส่วนที่เหลือเป็นตัวแปรที่คาดว่าจะนำมาเป็นตัวแปรอิสระ</p>
<section id="การนำเขาและสำรวจขอมล" class="level4">
<h4 class="anchored" data-anchor-id="การนำเขาและสำรวจขอมล">(1) การนำเข้าและสำรวจข้อมูล</h4>
<p>ในกรณีนี้นำเข้าข้อมูล <code>classfication.csv</code> ด้วยฟังก์ชัน <code>read.csv()</code> จากนั้นสำรวจข้อมูลเบื้องต้นด้วยฟังก์ชัน <code>glimpse()</code> ได้ผลเป็นดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/classification.csv"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># explore dataset</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 208
Columns: 62
$ X     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 1…
$ V1    &lt;dbl&gt; 0.0200, 0.0453, 0.0262, 0.0100, 0.0762, 0.0286, 0.0317, 0.0519, …
$ V2    &lt;dbl&gt; 0.0371, 0.0523, 0.0582, 0.0171, 0.0666, 0.0453, 0.0956, 0.0548, …
$ V3    &lt;dbl&gt; 0.0428, 0.0843, 0.1099, 0.0623, 0.0481, 0.0277, 0.1321, 0.0842, …
$ V4    &lt;dbl&gt; 0.0207, 0.0689, 0.1083, 0.0205, 0.0394, 0.0174, 0.1408, 0.0319, …
$ V5    &lt;dbl&gt; 0.0954, 0.1183, 0.0974, 0.0205, 0.0590, 0.0384, 0.1674, 0.1158, …
$ V6    &lt;dbl&gt; 0.0986, 0.2583, 0.2280, 0.0368, 0.0649, 0.0990, 0.1710, 0.0922, …
$ V7    &lt;dbl&gt; 0.1539, 0.2156, 0.2431, 0.1098, 0.1209, 0.1201, 0.0731, 0.1027, …
$ V8    &lt;dbl&gt; 0.1601, 0.3481, 0.3771, 0.1276, 0.2467, 0.1833, 0.1401, 0.0613, …
$ V9    &lt;dbl&gt; 0.3109, 0.3337, 0.5598, 0.0598, 0.3564, 0.2105, 0.2083, 0.1465, …
$ V10   &lt;dbl&gt; 0.2111, 0.2872, 0.6194, 0.1264, 0.4459, 0.3039, 0.3513, 0.2838, …
$ V11   &lt;dbl&gt; 0.1609, 0.4918, 0.6333, 0.0881, 0.4152, 0.2988, 0.1786, 0.2802, …
$ V12   &lt;dbl&gt; 0.1582, 0.6552, 0.7060, 0.1992, 0.3952, 0.4250, 0.0658, 0.3086, …
$ V13   &lt;dbl&gt; 0.2238, 0.6919, 0.5544, 0.0184, 0.4256, 0.6343, 0.0513, 0.2657, …
$ V14   &lt;dbl&gt; 0.0645, 0.7797, 0.5320, 0.2261, 0.4135, 0.8198, 0.3752, 0.3801, …
$ V15   &lt;dbl&gt; 0.0660, 0.7464, 0.6479, 0.1729, 0.4528, 1.0000, 0.5419, 0.5626, …
$ V16   &lt;dbl&gt; 0.2273, 0.9444, 0.6931, 0.2131, 0.5326, 0.9988, 0.5440, 0.4376, …
$ V17   &lt;dbl&gt; 0.3100, 1.0000, 0.6759, 0.0693, 0.7306, 0.9508, 0.5150, 0.2617, …
$ V18   &lt;dbl&gt; 0.2999, 0.8874, 0.7551, 0.2281, 0.6193, 0.9025, 0.4262, 0.1199, …
$ V19   &lt;dbl&gt; 0.5078, 0.8024, 0.8929, 0.4060, 0.2032, 0.7234, 0.2024, 0.6676, …
$ V20   &lt;dbl&gt; 0.4797, 0.7818, 0.8619, 0.3973, 0.4636, 0.5122, 0.4233, 0.9402, …
$ V21   &lt;dbl&gt; 0.5783, 0.5212, 0.7974, 0.2741, 0.4148, 0.2074, 0.7723, 0.7832, …
$ V22   &lt;dbl&gt; 0.5071, 0.4052, 0.6737, 0.3690, 0.4292, 0.3985, 0.9735, 0.5352, …
$ V23   &lt;dbl&gt; 0.4328, 0.3957, 0.4293, 0.5556, 0.5730, 0.5890, 0.9390, 0.6809, …
$ V24   &lt;dbl&gt; 0.5550, 0.3914, 0.3648, 0.4846, 0.5399, 0.2872, 0.5559, 0.9174, …
$ V25   &lt;dbl&gt; 0.6711, 0.3250, 0.5331, 0.3140, 0.3161, 0.2043, 0.5268, 0.7613, …
$ V26   &lt;dbl&gt; 0.6415, 0.3200, 0.2413, 0.5334, 0.2285, 0.5782, 0.6826, 0.8220, …
$ V27   &lt;dbl&gt; 0.7104, 0.3271, 0.5070, 0.5256, 0.6995, 0.5389, 0.5713, 0.8872, …
$ V28   &lt;dbl&gt; 0.8080, 0.2767, 0.8533, 0.2520, 1.0000, 0.3750, 0.5429, 0.6091, …
$ V29   &lt;dbl&gt; 0.6791, 0.4423, 0.6036, 0.2090, 0.7262, 0.3411, 0.2177, 0.2967, …
$ V30   &lt;dbl&gt; 0.3857, 0.2028, 0.8514, 0.3559, 0.4724, 0.5067, 0.2149, 0.1103, …
$ V31   &lt;dbl&gt; 0.1307, 0.3788, 0.8512, 0.6260, 0.5103, 0.5580, 0.5811, 0.1318, …
$ V32   &lt;dbl&gt; 0.2604, 0.2947, 0.5045, 0.7340, 0.5459, 0.4778, 0.6323, 0.0624, …
$ V33   &lt;dbl&gt; 0.5121, 0.1984, 0.1862, 0.6120, 0.2881, 0.3299, 0.2965, 0.0990, …
$ V34   &lt;dbl&gt; 0.7547, 0.2341, 0.2709, 0.3497, 0.0981, 0.2198, 0.1873, 0.4006, …
$ V35   &lt;dbl&gt; 0.8537, 0.1306, 0.4232, 0.3953, 0.1951, 0.1407, 0.2969, 0.3666, …
$ V36   &lt;dbl&gt; 0.8507, 0.4182, 0.3043, 0.3012, 0.4181, 0.2856, 0.5163, 0.1050, …
$ V37   &lt;dbl&gt; 0.6692, 0.3835, 0.6116, 0.5408, 0.4604, 0.3807, 0.6153, 0.1915, …
$ V38   &lt;dbl&gt; 0.6097, 0.1057, 0.6756, 0.8814, 0.3217, 0.4158, 0.4283, 0.3930, …
$ V39   &lt;dbl&gt; 0.4943, 0.1840, 0.5375, 0.9857, 0.2828, 0.4054, 0.5479, 0.4288, …
$ V40   &lt;dbl&gt; 0.2744, 0.1970, 0.4719, 0.9167, 0.2430, 0.3296, 0.6133, 0.2546, …
$ V41   &lt;dbl&gt; 0.0510, 0.1674, 0.4647, 0.6121, 0.1979, 0.2707, 0.5017, 0.1151, …
$ V42   &lt;dbl&gt; 0.2834, 0.0583, 0.2587, 0.5006, 0.2444, 0.2650, 0.2377, 0.2196, …
$ V43   &lt;dbl&gt; 0.2825, 0.1401, 0.2129, 0.3210, 0.1847, 0.0723, 0.1957, 0.1879, …
$ V44   &lt;dbl&gt; 0.4256, 0.1628, 0.2222, 0.3202, 0.0841, 0.1238, 0.1749, 0.1437, …
$ V45   &lt;dbl&gt; 0.2641, 0.0621, 0.2111, 0.4295, 0.0692, 0.1192, 0.1304, 0.2146, …
$ V46   &lt;dbl&gt; 0.1386, 0.0203, 0.0176, 0.3654, 0.0528, 0.1089, 0.0597, 0.2360, …
$ V47   &lt;dbl&gt; 0.1051, 0.0530, 0.1348, 0.2655, 0.0357, 0.0623, 0.1124, 0.1125, …
$ V48   &lt;dbl&gt; 0.1343, 0.0742, 0.0744, 0.1576, 0.0085, 0.0494, 0.1047, 0.0254, …
$ V49   &lt;dbl&gt; 0.0383, 0.0409, 0.0130, 0.0681, 0.0230, 0.0264, 0.0507, 0.0285, …
$ V50   &lt;dbl&gt; 0.0324, 0.0061, 0.0106, 0.0294, 0.0046, 0.0081, 0.0159, 0.0178, …
$ V51   &lt;dbl&gt; 0.0232, 0.0125, 0.0033, 0.0241, 0.0156, 0.0104, 0.0195, 0.0052, …
$ V52   &lt;dbl&gt; 0.0027, 0.0084, 0.0232, 0.0121, 0.0031, 0.0045, 0.0201, 0.0081, …
$ V53   &lt;dbl&gt; 0.0065, 0.0089, 0.0166, 0.0036, 0.0054, 0.0014, 0.0248, 0.0120, …
$ V54   &lt;dbl&gt; 0.0159, 0.0048, 0.0095, 0.0150, 0.0105, 0.0038, 0.0131, 0.0045, …
$ V55   &lt;dbl&gt; 0.0072, 0.0094, 0.0180, 0.0085, 0.0110, 0.0013, 0.0070, 0.0121, …
$ V56   &lt;dbl&gt; 0.0167, 0.0191, 0.0244, 0.0073, 0.0015, 0.0089, 0.0138, 0.0097, …
$ V57   &lt;dbl&gt; 0.0180, 0.0140, 0.0316, 0.0050, 0.0072, 0.0057, 0.0092, 0.0085, …
$ V58   &lt;dbl&gt; 0.0084, 0.0049, 0.0164, 0.0044, 0.0048, 0.0027, 0.0143, 0.0047, …
$ V59   &lt;dbl&gt; 0.0090, 0.0052, 0.0095, 0.0040, 0.0107, 0.0051, 0.0036, 0.0048, …
$ V60   &lt;dbl&gt; 0.0032, 0.0044, 0.0078, 0.0117, 0.0094, 0.0062, 0.0103, 0.0053, …
$ Class &lt;chr&gt; "drop", "drop", "drop", "drop", "drop", "drop", "drop", "drop", …</code></pre>
</div>
</div>
<p>จากผลการสำรวจข้างต้น จงตอบคำถามต่อไปนี้ ชุดข้อมูล <code>classification.csv</code> …</p>
<ul>
<li><p>มีหน่วยข้อมูลจำนวนกี่หน่วย?</p></li>
<li><p>มีตัวแปรจำนวนกี่ตัวแปร</p></li>
<li><p>การแจกแจงของตัวแปรตามเป็นอย่างไร?</p></li>
<li><p>type ของตัวแปรที่จัดเก็บใน <code>dat</code> ข้างต้นมีแบบไหนบ้าง เหมาะสมแล้วหรือไม่ที่จะนำไปวิเคราะห์ logistic regression ต่อไป</p></li>
</ul>
</section>
<section id="การแบงชดขอมล" class="level4">
<h4 class="anchored" data-anchor-id="การแบงชดขอมล">(2) การแบ่งชุดข้อมูล</h4>
<p>ในทำนองเดียวกับการพัฒนา regression models ผู้วิเคราะห์ต้องแบ่งชุดข้อมูล <code>dat</code> ออกเป็นสองส่วนได้แก่ ส่วน training dataset เพื่อพัฒนาโมเดล และ test dataset เพื่อตรวจสอบประสิทธิภาพของโมเดล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"drop"</span>, <span class="st">"stay"</span>))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>class_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data=</span> dat,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prop=</span><span class="fl">0.8</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">strata =</span> Class)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> class_split <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span>  class_split <span class="sc">%&gt;%</span> <span class="fu">testing</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="การประมวลผลและสำรวจโมเดล" class="level4">
<h4 class="anchored" data-anchor-id="การประมวลผลและสำรวจโมเดล">(3) การประมวลผลและสำรวจโมเดล</h4>
<p>เมื่อแบ่งชุดข้อมูลแล้วขั้นตอนต่อมาคือการพัฒนาโมเดลทำนาย ในที่นี้จะใช้ logistic regression ก่อน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>logistic_reg <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">engine =</span><span class="st">"glm"</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mode =</span> <span class="st">"classification"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>fit_logistic <span class="ot">&lt;-</span> logistic_reg <span class="sc">%&gt;%</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">fit</span>(Class <span class="sc">~</span> . , <span class="at">data=</span>train[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>เราสามารถวิเคราะห์สัมประสิทธิถดถอยของตัวแปรอิสระในโมเดลได้ โดยใช้ data visualization มาช่วย เช่น</p>
<div class="cell" data-fit.height="4">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fit_logistic<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data.frame</span>(<span class="at">coef=</span> .)<span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(<span class="dv">1</span>),<span class="at">y=</span>coef))<span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="288"></p>
<p></p><figcaption class="figure-caption">boxplot ของสัมประสิทธิ์การถดถอยใน logistic regression</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>เราจะเห็นว่าโมเดลทำนายที่พัฒนาขึ้นข้างต้น มีตัวแปรอิสระที่น่าจะใช้ทำนายตัวแปรตาม <code>Class</code> ได้ เยอะมาก ปัจจัยนี้อาจเป็นสาเหตุหนึ่งที่ทำให้การประมาณค่าพารามิเตอร์ของโมเดลเกิดปัญหาไม่ลู่เข้า การแก้ปัญหาดังกล่าวอาจทำการคัดเลือกตัวแปรอิสระที่ไม่จำเป็นออกไปจากโมเดล ซึ่งจะเห็นว่าเป็นงานที่ค่อนข้างเหนื่อยเพราะมีตัวแปรอิสระเยอะพอสมควรในชุดข้อมูลนี้ อีกวิธีการหนึ่งคือใช้เทคนิค regularization ซึ่งสามารถทำได้โดยเปลี่ยน <code>engine = "glmnet"</code> เนื้อหาส่วนนี้จะกล่าวถึงอีกครั้งในบทต่อไป</p>
<div style="page-break-after: always;"></div>
</section>
<section id="การคำนวณคาทำนายจากโมเดล" class="level4">
<h4 class="anchored" data-anchor-id="การคำนวณคาทำนายจากโมเดล">(4) การคำนวณค่าทำนายจากโมเดล</h4>
<p>ในกรณีนี้สมมุติว่าโมเดลทำนาย logistic regression ไม่ได้มีปัญหาอะไรและจะนำไปสู่ขั้นตอนการตรวจสอบคุณภาพในชุดข้อมูลทดสอบ ในทำนองเดียวกับ regression models การตรวจสอบประสิทธิภาพในการทำนายของโมเดล ผู้วิเคราะห์ต้องมี (1) ค่าสังเกตจริงของตัวแปรตามในชุดข้อมูลทดสอบ และ (2) ค่าทำนายที่ได้จากโมเดลทำนายในชุดข้อมูลทดสอบ</p>
<p>การคำนวณค่าทำนายจากโมเดลสามารถทำได้ด้วยฟังก์ชัน <code>predict()</code> เช่นเดียวกับ regression models อย่างไรก็ตามใน classfication models สามารถคำนวณค่าทำนายได้ 2 ประเภทหลัก ได้แก่ ค่าความน่าจะเป็น (probability) ของการเกิดเหตุการณ์/ผลลัพธ์ที่สนใจในตัวแปรตามของหน่วยข้อมูล และค่าทำนายประเภท/ผลลัพธ์ในตัวแปรตามของหน่วยข้อมูล โดยในกรณีที่ต้องการค่าทำนายเป็นค่าความน่าจะเป็นให้กำหนดอาร์กิวเมนท์ <code>type = "prob"</code> ส่วนในกรณีที่ต้องการค่าทำนายเป็นประเภทในตัวแปรตามให้กำหนดอาร์กิวเมนท์ <code>type = "class"</code></p>
<section id="กรณกำหนด-type-prob" class="level5">
<h5 class="anchored" data-anchor-id="กรณกำหนด-type-prob">กรณีกำหนด <code>type = "prob"</code></h5>
<p>การกำหนดลักษณะนี้จะได้ค่าความน่าจะเป็นซึ่งสามารถนำไปคำนวณเป็นค่าทำนายประเภทของหน่วยข้อมูลได้โดยการกำหนดคะแนนจุดตัดหรือค่า threshold ซึ่งโดยปกติมักกำหนดให้ค่า threshold = 0.5 ตัวอย่างคำสั่งต่อไปนี้แสดงการคำนวณค่าความน่าจะเป็นดังกล่าว รวมทั้งการแปลงค่าความน่าจะเป็นที่ได้โดยการกำหนด threshold เป็น 0.2, 0.5 และ 0.8 ตามลำดับ ทั้งนี้หากโมเดลที่มีประสิทธิภาพไม่คงที่เมื่อเปลี่ยนค่า threshold จะบ่งชี้ว่าโมเดลดังกล่าวมีประสิทธิภาพการทำนายที่ไม่ดีนัก กล่าวคือ เป็นโมเดลที่ไม่ชัดเจนในการทำนาย ในทางกลับกันโมเดลที่มีค่าทำนายประเภทของหน่วยข้อมูลที่คงเส้นคงวา เมื่อกำหนดค่า threshold แตกต่างกัน บ่งชี้ว่าโมเดลดังกล่าวเป็นโมเดลที่มีประสิทธิภาพในการทำนายสูง</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted value</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_logistic, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">new_data =</span> test[,<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>pred_class_thres0<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(pred_prob[,<span class="dv">1</span>] <span class="sc">&gt;=</span><span class="fl">0.2</span>,<span class="st">"drop"</span>, <span class="st">"stay"</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>pred_class_thres0<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(pred_prob[,<span class="dv">1</span>] <span class="sc">&gt;=</span><span class="fl">0.5</span>,<span class="st">"drop"</span>, <span class="st">"stay"</span>))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>pred_class_thres0<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(pred_prob[,<span class="dv">1</span>] <span class="sc">&gt;=</span><span class="fl">0.8</span>,<span class="st">"drop"</span>, <span class="st">"stay"</span>))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pred_class_thres0<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pred_class_thres0.2
drop stay 
  18   25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pred_class_thres0<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pred_class_thres0.5
drop stay 
  18   25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pred_class_thres0<span class="fl">.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pred_class_thres0.8
drop stay 
  18   25 </code></pre>
</div>
</div>
<p>ผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าค่าทำนายประเภทของหน่วยข้อมูลไม่มีการเปลี่ยนแปลงเมื่อกำหนด threshold เท่ากับ 0.2, 0.5 และ 0.8 ซึ่งบ่งชี้ว่าโมเดลทำนายมีแนวโน้มที่จะให้ค่าทำนายที่คงเส้นคงวา อย่างไรก็ตามการวิเคราะห์เพียง 3 จุดของ threshold เป็นการวิเคราะห์ที่ค่อนข้างหยาบ ส่วนท้ายของหัวข้อนี้จะกล่าวถึงการใช้ ROC curve เพื่อวิเคราะห์ประสิทธิภาพของโมเดลบนแต่ละค่าของ threshold ดังกล่าว</p>
</section>
<section id="กรณกำหนด-type-class" class="level5">
<h5 class="anchored" data-anchor-id="กรณกำหนด-type-class">กรณีกำหนด <code>type = "class"</code></h5>
<p>เมื่อกำหนดให้ <code>type = "class"</code> ฟังก์ชัน <code>predict()</code> จะทำนายประเภทของหน่วยข้อมูลโดยใช้ค่า threshold = 0.5 ดังนั้นหากผู้วิเคราะห์ต้องการใช้ threshold ค่านี้อยู่แล้ว การกำหนดอาร์กิวเมนท์ลักษณะนี้จะช่วยลดขั้นตอนการทำงานลงได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pred_class2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_logistic, </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">new_data =</span> test[,<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred_class2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  .pred_class
  &lt;fct&gt;      
1 stay       
2 drop       
3 stay       
4 drop       
5 drop       
6 stay       </code></pre>
</div>
</div>
<p>จะเห็นว่าผลการทำนายประเภทที่ได้จากฟังก์ชัน <code>predict()</code> อยู่ในรูปชุดข้อมูลแบบ tibble โดยคอลัมน์ที่เก็บค่าทำนายจะใช้ชื่อ <code>.pred_class</code> และมีสถานะเป็นตัวแปรแบบ factor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pred_class2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.pred_class
drop stay 
  18   25 </code></pre>
</div>
</div>
</section>
</section>
<section id="การประเมนประสทธภาพการทำนายของโมเดล" class="level4">
<h4 class="anchored" data-anchor-id="การประเมนประสทธภาพการทำนายของโมเดล">(5) การประเมินประสิทธิภาพการทำนายของโมเดล</h4>
<p>package yardstick มีฟังก์ชัน <code>conf_mat()</code> ที่ทำหน้าที่เหมือนกับฟังก์ชัน <code>confusionMatrix()</code> โดยอาร์กิวเมนท์สำคัญของฟังก์ชันนี้ได้แก่ <code>data</code> ที่เป็น data.frame หรือ tibble ที่ต้องมีคอลัมน์ของค่าจริงของตัวแปรตาม และค่าทำนายของตัวแปรตามให้เรียบร้อย <code>truth</code> คืออาร์กิวเมนท์สำหรับระบุว่าคอลัมน์ไหนคือค่าจริงของตัวแปรตาม และ <code>estimate</code> คือคอลัมน์ที่ใช้ระบุว่าคอลัมน์ไหนคือค่าทำนายของตัวแปรตาม ทั้งนี้ตัวแปรตามและค่าทำนายจะต้องเก็บอยู่ในรูปแบบ factor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine .pred_class column to test dataset</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Class) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(pred_class2, pred_prob)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results, <span class="at">truth =</span> Class, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction drop stay
      drop   15    3
      stay    5   20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="at">data =</span> test_results, <span class="at">truth =</span> Class, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.814</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sens</span>(<span class="at">data =</span> test_results, <span class="at">truth =</span> Class, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 sens    binary          0.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specificity</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span>(<span class="at">data =</span> test_results, <span class="at">truth =</span> Class, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 spec    binary         0.870</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define metric set function</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>custom_metric<span class="ot">&lt;-</span><span class="fu">metric_set</span>(accuracy, sens, spec)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">custom_metric</span>(<span class="at">data =</span> test_results, <span class="at">truth =</span> Class, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.814
2 sens     binary         0.75 
3 spec     binary         0.870</code></pre>
</div>
</div>
<p>นอกจากนี้ยังสามารถใช้ฟังก์ชัน <code>summary()</code> กับผลลัพธ์ที่ได้จาก <code>conf_mat()</code> เพื่อเรียกดูค่าสถิติของ confusion matrix คล้ายกับฟังก์ชัน <code>confusionMatrix()</code> ของ package caret ที่ได้กล่าวถึงในหัวข้อ 2.4</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results, </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> Class, </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.814
 2 kap                  binary         0.624
 3 sens                 binary         0.75 
 4 spec                 binary         0.870
 5 ppv                  binary         0.833
 6 npv                  binary         0.8  
 7 mcc                  binary         0.626
 8 j_index              binary         0.620
 9 bal_accuracy         binary         0.810
10 detection_prevalence binary         0.419
11 precision            binary         0.833
12 recall               binary         0.75 
13 f_meas               binary         0.789</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>รายละเอียดของ metric ต่าง ๆ สามารถศึกษาเพิ่มเติมได้จากเอกสารที่เกี่ยวกับ package yardstick</p>
<ul>
<li><p>https://cran.r-project.org/web/packages/yardstick/yardstick.pdf</p></li>
<li><p>https://yardstick.tidymodels.org/</p></li>
<li><p>https://cran.r-project.org/web/packages/yardstick/vignettes/metric-types.html</p></li>
</ul>
</section>
<section id="การนำเสนอประสทธภาพการทำนายของโมเดลดวยทศนภาพขอมล" class="level4">
<h4 class="anchored" data-anchor-id="การนำเสนอประสทธภาพการทำนายของโมเดลดวยทศนภาพขอมล">(6) การนำเสนอประสิทธิภาพการทำนายของโมเดลด้วยทัศนภาพข้อมูล</h4>
<p>การวิเคราะห์ประสิทธิภาพการทำนายของ classification models สามารถทำได้ด้วยทัศนภาพข้อมูลหลายตัว ซึ่งบางตัวช่วยให้สารสนเทศเชิงลึกประกอบการปรับแต่งโมเดลทำนายแก่ผู้วิเคราะห์ได้เป็นอย่างดี เนื้อหาประกอบด้วย การใช้ heatmap แผนภาพ mosaic และ ROC Curve รายละเอียดมีดังนี้</p>
<section id="แผนทความรอน-heatmap-ของ-confusion-matrix" class="level5">
<h5 class="anchored" data-anchor-id="แผนทความรอน-heatmap-ของ-confusion-matrix">แผนที่ความร้อน (heatmap) ของ confusion matrix</h5>
<p>ทัศนภาพนี้เหมาะสำหรับ classification model ที่มีการจำแนกประเภทจำนวนหลาย ๆ ประเภท การสร้างแผนที่ความร้อนดังกล่าวสามารถสร้างได้โดยการส่งค่า confusion matrix ที่สร้างจากฟังก์ชัน <code>conf_mat()</code> ไปยังฟังก์ชัน <code>autoplot()</code> และในฟังก์ชัน <code>autoplot()</code> ให้กำหนดอาร์กิวเมนท์ <code>type = "heatmap"</code> ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results, </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> Class, </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="288"></p>
<p></p><figcaption class="figure-caption">plotting the confusion matrix using Heatmap</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>จากรูป 27 จะเห็นว่าแผนที่ความร้อนที่สร้างขึ้นจะใช้ความเข้มของสีแสดงความถี่ในแต่ละประเภทของการทำนาย โดยในรูปตัวอย่างพบว่าโมเดลทำนายมีแนวโน้มที่จะทำนายได้อย่างถูกต้องเป็นส่วนใหญ่</p>
<div style="page-break-after: always;"></div>
</section>
<section id="แผนภาพโมเสก-mosaic-plot" class="level5">
<h5 class="anchored" data-anchor-id="แผนภาพโมเสก-mosaic-plot">แผนภาพโมเสก (mosaic plot)</h5>
<p>ทัศนภาพนี้จะแสดงผลลัพธ์ในมิติของ sensitivity หรือ specificity การสร้างแผนภาพโมเสกจาก confusion matrix สามารถใช้ฟังก์ชัน <code>autoplot()</code> เช่นเดียวกับการสร้างแผนที่ความร้อน แต่ให้กำหนดอาร์กิวเมนท์ <code>type = mosaic</code> ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results, </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> Class, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"mosaic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="288"></p>
<p></p><figcaption class="figure-caption">plotting the confusion matrix using Masaic plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>จากรูป 28 เมื่อพิจารณาในคอลัมน์แรกจะพบว่าเป็นคอลัมน์ที่แสดง sensitivity ของโมเดล (เนื่องจากโมเดลทำนายมุ่งที่จะทำนายกลุ่ม dropout ดังนั้นกลุ่มนี้จึงเป็นพวก positive ของโมเดล) ส่วนคอลัมน์ที่สองแสดง specificity ของโมเดล ซึ่งมีค่าอยู่ในระดับสูงทั้งสอง metrics</p>
</section>
<section id="roc-curve" class="level5">
<h5 class="anchored" data-anchor-id="roc-curve">ROC curve</h5>
<p>ดังที่ได้กล่าวไว้ก่อนแล้วข้างต้นว่าคุณสมบัติที่ดีของโมเดลทำนายอย่างหนึ่งคือการที่สามารถให้ค่าทำนายประเภทของหน่วยข้อมูลที่คงเส้นคงวาบนแต่ละระดับของค่า threshold การตรวจสอบประสิทธิภาพด้านนี้อย่างละเอียดควรดำเนินการวิเคราะห์ประสิทธิภาพในการทำนายของโมเดลเมื่อกำหนดค่า threshold ตั้งแต่ 0.00 ถึง 1.00 การดำเนินการดังกล่าวด้วย R ในสมัยก่อนผู้วิเคราะห์จำเป็นจะต้องเขียนฟังก์ชันเพื่อทวนซ้ำการทำนายในแต่ละค่า threshold แต่ในปัจจุบันหากใช้ package yardstick ผู้วิเคราะห์สามารถใช้ฟังก์ชัน <code>roc_curve()</code> เพื่อช่วยทำการวิเคราะห์นี้ได้ อาร์กิวเมนท์ของฟังก์ชันนี้ประกอบด้วย ค่าจริงของตัวแปรตามในชุดข้อมูลทดสอบ และค่าประมาณความน่าจะเป็นของการเกิดผลลัพธ์ที่สนใจ (positive type) ในตัวแปรตาม</p>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> Class, .pred_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.
ℹ The deprecated feature was likely used in the yardstick package.
  Please report the issue at &lt;]8;;https://github.com/tidymodels/yardstick/issueshttps://github.com/tidymodels/yardstick/issues]8;;&gt;.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
    .threshold specificity sensitivity
         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1 -Inf              0            1   
 2    2.22e-16       0            1   
 3    8.95e- 9       0.783        0.75
 4    6.23e- 6       0.826        0.75
 5    9.00e- 1       0.870        0.75
 6    9.81e- 1       0.913        0.75
 7    1.00e+ 0       0.913        0.7 
 8    1.00e+ 0       0.913        0.65
 9    1   e+ 0       0.913        0.6 
10  Inf              1            0   </code></pre>
</div>
</div>
<p>ข้อดีของฟังก์ชัน <code>roc_curve()</code> คือฟังก์ชันจะกำหนด grid หรือช่วงของค่า threshold ที่เหมาะสมกับข้อมูลซึ่งช่วย output ที่ไม่จำเป็นลงได้ จากตารางข้างต้นจะเห็นว่าถ้าไม่นับกรณีที่กำหนด threshold อย่างสุดโต่งคือ 0 หรือ 1 ประสิทธิภาพของโมเดลทำนายที่พัฒนาขึ้นนี้มีค่า sensitivity และ specificity มากกว่า 0.75 เกือบทุกกรณี</p>
<p>อย่างไรก็ตามในกรณีทั่วไปผลลัพธ์จากตารางข้างต้นอาจมีจำนวนมากจนเป็นการยากที่จะดำเนินการวิเคราะห์ ผู้วิเคราะห์จึงมักนิยมแปลงผลการวิเคราะห์ในตารางดังกล่าวให้เป็นแผนภาพ ROC curve ที่เป็นการพล็อตคู่อันดับของ FPR = 1 - specificity กับ sensitivity ที่คำนวณได้จากแต่ละค่าของ threshold โดยให้ค่า sensitivity อยู่บนแกน Y และค่า FPR อยู่บนแกน X รูปต่อไปนี้แสดงตัวอย่างของ ROC curve</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1255912826.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ตัวอย่าง ROC Curve</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
<p>โมเดลทำนายที่ดีควรมี ROC curve ที่ลู่เข้าไปใกล้คู่อันดับ (0.00,1.00) เนื่องจากคู่อันดับดังกล่าวเป็นจุดที่โมเดลมี FPR = 0.00 และมี sensitivity = 1.00 หรือเป็นจุดที่ดีที่สุดที่เป็นไปได้ (optimal point) ส่วนโมเดลที่มีประสิทธิภาพต่ำจะเป็นโมเดลที่มี Roc curve ลู่เข้าหาหรือมีลักษณะใกล้เคียงกับเส้นอ้างอิง <span class="math inline">\(y=x\)</span> ซึ่งแสดงว่าโมเดลทำนายมีประสิทธิภาพในการทำนายที่ใกล้เคียงกับการเดาสุ่มแบบโยนเหรียญหัวก้อย</p>
<p>จากรูป 30 จะเห็นว่าโมเดลตัวอย่างทางด้านซ้ายมีแนวโน้มที่จะมีประสิทธิภาพในการทำนายสูงกว่าโมเดลตัวอย่างทางด้านขวา ทั้งนี้เป็นเพราะ ROC curve ของโมเดลทางซ้ายมีแนวโน้มลู่เข้าไปหาคู่อันดับ (0.00,1.00) มากกว่าโมเดลทางขวามือ สำหรับการสร้าง ROC curve ด้วย R สามารถทำได้โดยส่งผ่านผลลัพธ์ที่ได้จากฟังก์ชัน <code>roc_curve()</code> ในข้างต้นไปในฟังก์ชัน <code>autoplot()</code> ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> Class, .pred_drop) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="384"></p>
<p></p><figcaption class="figure-caption">ROC Curve</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผลการวิเคราะห์ ROC curve จากรูป 31 สามารถสรุปได้อย่างไร?</p>
</section>
<section id="area-under-curve-auc" class="level5">
<h5 class="anchored" data-anchor-id="area-under-curve-auc">Area Under Curve (AUC)</h5>
<p>พื้นที่ใต้โค้ง ROC (area under curve: AUC) ถูกใช้เป็น metric อีกตัวหนึ่งสำหรับประเมินประสิทธิภาพในการทำนายของโมเดล ที่คำนวณจากพื้นที่ใต้โค้งของกราฟ ROC โดยโมเดลทำนายที่มีค่า AUC สูงเข้าใกล้ 1.00 จะเป็นโมเดลที่มีแนวโน้มจะมีประสิทธิภาพในการทำนายสูง ส่วนโมเดลที่มีค่า AUC เข้าใกล้ 0.5 มีแนวโน้มที่จะมีประสิทธิภาพในการทำนายต่ำใกล้เคียงกับการเดาสุ่ม จากความหมายดังกล่าวจะเห็นว่าค่า AUC สามารถใช้เป็น metric แทนการอ่านผลจากกราฟ ROC โดยตรงได้</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1194220562.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Area Under Curve (AUC)</figcaption><p></p>
</figure>
</div>
<div style="page-break-after: always;"></div>
<p>การคำนวณค่า AUC ด้วย R สามารถทำได้โดยใช้ฟังก์ชัน <code>roc_auc()</code> ที่มีอาร์กิวเมนท์เหมือนกับฟังก์ชัน <code>roc_curve()</code> จากตัวอย่าง logistic regression จะได้ว่าผลการวิเคราะห์ AUC เป็นดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(<span class="at">truth =</span> Class, .pred_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.809</code></pre>
</div>
</div>
<p>ตารางต่อไปนี้แสดงเกณฑ์การพิจารณาค่า AUC ข้างต้น โดยจำแนกเกรดของโมเดลออกเป็น 5 ระดับตามค่าของ AUC ได้แก่ ดีมาก (A) ดี (B) ไปจนถึงยอมรับไม่ได้ (F)</p>
<table class="table">
<caption>AUC criterion</caption>
<thead>
<tr class="header">
<th>AUC</th>
<th>แปลผล</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[0.9 , 1.0]</td>
<td>ดีมาก (A)</td>
</tr>
<tr class="even">
<td>[0.8 , 0.9)</td>
<td>ดี (B)</td>
</tr>
<tr class="odd">
<td>[0.7 , 0.8)</td>
<td>พอใช้ (C)</td>
</tr>
<tr class="even">
<td>[0.6 , 0.7)</td>
<td>แย่ (D)</td>
</tr>
<tr class="odd">
<td>[0.5 , 0.6)</td>
<td>ยอมรับไม่ได้ (F)</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>
<section id="scikit-learn-library" class="level2">
<h2 class="anchored" data-anchor-id="scikit-learn-library">3.6 Scikit-Learn library</h2>
<p>scikit-learn เป็น library สำหรับวิเคราะห์ machine learning model ในโปรแกรมภาษา Python ซึ่งมีจุดเด่นคือเป็น library สำหรับพัฒนา machine learning model ที่มีประสิทธิภาพและสามารถใช้งานได้ง่าย นอกจากนี้ยังสามารถทำงานร่วมกับ library Numpy, SciPy, Pandas และ matplotlib</p>
<p>coming soon …</p>
</section>
<section id="กจกรรมพฒนา-regression-model-ดวย-tidymodel-framework" class="level2">
<h2 class="anchored" data-anchor-id="กจกรรมพฒนา-regression-model-ดวย-tidymodel-framework">3.7 กิจกรรมพัฒนา regression model ด้วย tidymodel framework</h2>
<ol type="1">
<li>นำเข้าข้อมูลจากไฟล์ <a href="https://github.com/ssiwacho/2758688_ML/blob/main/week%201/TeacherSalaryData.csv"><code>TeacherSalaryData.csv</code></a></li>
<li>สำรวจข้อมูลจากชุดข้อมูลดังกล่าว แล้วตอบคำถาม
<ul>
<li><p>ชุดข้อมูลนี้มีตัวแปรทั้งหมดกี่ตัว</p></li>
<li><p>มีหน่วยข้อมูลทั้งหมดกี่หน่วย</p></li>
<li><p>หาค่าสถิติพื้นฐานของตัวแปรเชิงปริมาณในชุดข้อมูล</p></li>
<li><p>อาจารย์มหาวิทยาลัยส่วนใหญ่มีตำแหน่งวิชาการอะไร</p></li>
</ul></li>
<li>แบ่งส่วนข้อมูลที่นำเข้าออกเป็นสองส่วน ได้แก่ training และ test dataset โดยกำหนดให้สัดส่วนระหว่างชุดข้อมูลทั้งหมดเป็น 80 : 20</li>
<li>กำหนดให้ตัวแปรตามคือ <code>salary</code> (เงินเดือนของอาจารย์มหาวิทยาลัย) ลองพัฒนา supervised learning model 2 โมเดล โดยตัวแรกให้ใช้ linear regression model ที่ใช้ lm เป็น engine และตัวที่สองให้ใช้ decision tree ที่ใช้ rpart เป็น engine ทั้งนี้ให้ใช้ตัวแปรอิสระทุกตัวในชุดข้อมูลเป็นตัวแปรทำนาย</li>
<li>เปรียบเทียบประสิทธิภาพในการทำนายของโมเดลทั้งสอง ผลที่ได้เป็นอย่างไร</li>
</ol>
<div class="cell">

</div>
</section>
<section id="สรป" class="level2">
<h2 class="anchored" data-anchor-id="สรป">สรุป</h2>
<p>บทเรียนนี้ผู้อ่านได้เห็นภาพของกระบวนการพัฒนา regression models ซึ่งเป็น supervised learning ประเภทหนึ่งโดยเป็นการดำเนินงานภายใต้ tidymodels framework เกือบทั้งหมด โดยยังขาดในส่วนของการจัดการข้อมูลหรือที่เรียกว่า feature engineering และส่วนการปรับแต่งค่า hyperparameters ของโมเดลทำนาย ซึ่งจะกล่าวรายละเอียดทั้งหมดในบทเรียนถัดไป</p>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="บทท-4-การเตรยมขอมล-data-preprocessing" class="level1">
<h1>บทที่ 4 การเตรียมข้อมูล (data preprocessing)</h1>
<blockquote class="blockquote">
<p>Garbage in, garbage out …</p>
</blockquote>
<p>จากบทที่ 3 ผู้อ่านจะเห็นว่าข้อมูลเป็นปัจจัยนำเข้าที่สำคัญมากในการพัฒนาโมเดลการเรียนรู้ของเครื่อง การนำข้อมูลที่เป็นขยะเข้าสู่โมเดลผลลัพธ์ที่ได้ย่อมเป็นขยะ ข้อมูลที่เป็นขยะถึงแม้จะได้รับการจัดการที่ดีมากแค่ไหนก็ตาม เมื่อนำเข้าสู่โมเดล ผลลัพธ์ที่ได้ก็ยังเป็นขยะเหมือนเดิม นอกจากนี้ถึงแม้ผู้วิเคราะห์จะมีข้อมูลที่ดีแต่หากมีการจัดการที่ไม่ดี เมื่อนำเข้าสู่โมเดลก็อาจจะได้ผลลัพธ์ที่ไม่ดีเท่าที่ควรหรืออาจจะเป็นขยะเหมือนเดิมก็ได้ ดังนั้นการมีข้อมูลที่ดีและมีการจัดการอย่างเหมาะสมจึงเป็นสิ่งที่สำคัญที่ผู้พัฒนาโมเดลการเรียนรู้ของเครื่องควรให้ความสำคัญ</p>
<section id="ภาพรวมและความสำคญของ-data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="ภาพรวมและความสำคญของ-data-preprocessing">4.1 ภาพรวมและความสำคัญของ Data Preprocessing</h2>
<p><strong>การเตรียมข้อมูล (Data preprocessing)</strong> เป็นคำศัพท์เชิงเทคนิคที่ใช้เรียกกระบวนการต่าง ๆ ที่ผู้วิเคราะห์ดำเนินการกับข้อมูลก่อนที่จะนำข้อมูลไปวิเคราะห์ในอัลกอริทึมการเรียนรู้ โดยมีวัตถุประสงค์เพื่อให้การเรียนรู้ของอัลกอริทึมต่าง ๆ สามารถทำได้สำเร็จและมีประสิทธิภาพ การเตรียมข้อมูลมีหลายวิธีการ โดยแต่ละวิธีการเหมาะกับสถานการณ์และเงื่อนไขที่แตกต่างกัน อย่างไรก็ตามเราอาจจำแนกการเตรียมข้อมูลออกได้เป็น 2 ประเภท ได้แก่ การเตรียมข้อมูลงตามข้อตกลงเบื้องต้นของอัลกอริทึมการเรียนรู้ และการเตรียมเพื่อใช้ประโยชน์จากข้อมูลให้มีประสิทธิภาพสูงที่สุด</p>
<p><strong>(1) การเตรียมข้อมูลตามข้อตกลงเบื้องต้นของอัลกอริทึมการเรียนรู้</strong> เป็นการจัดระเบียบหรือจัดกระทำข้อมูล (tidying and manipulating data) เพื่อให้ข้อมูลดิบมีความพร้อมหรืออยู่ในรูปแบบที่สอดคล้องกับความต้องการของอัลกอริทึมการเรียนรู้ที่เลือกใช้ การละเลยการจัดการข้อมูลดังกล่าวอาจส่งผลให้การเรียนรู้ของอัลกอริทึมมีความผิดพลาด หรือไม่สามารถเรียนรู้ชุดข้อมูลดังกล่าวได้ ตัวอย่างต่อไปนี้แสดงการเตรียมข้อมูลเพื่อให้สอดคล้องกับข้อตกลงเบื้องต้นของอัลกอริทึมการเรียนรู้</p>
<ul>
<li><p>การจัดรูปแบบตารางข้อมูล (reshaping data) เพื่อให้ได้ตารางข้อมูลที่อยู่ในรูปแบ tidydata</p></li>
<li><p>การเปลี่ยนสถานะของตัวแปรตัวอักษร (character variable) ใน R ให้เป็นตัวแปรแบบ factor</p></li>
<li><p>การทดแทนค่าสูญหาย (missing value imputation) เพื่อทดแทนค่าสูญหายก่อนจะนำไปวิเคราะห์</p></li>
<li><p>ในโมเดล multiple linear regression มีข้อตกลงเบื้องต้นที่สำคัญหลายข้อ เช่น ต้องไม่มีปัญหา heteroscedasticity และ multicollinearity ซึ่งหากเกิดปัญหาดังกล่าวขึ้นอย่างน้อยหนึ่งอย่าง ผู้วิเคราะห์จำเป็นต้องดำเนินการแก้ไขปัญหาดังกล่าวให้เรียบร้อยก่อนที่จะทำการวิเคราะห์ข้อมูล เช่น (1) อาจใช้การแปลงค่าตัวแปรด้วย logarithm หรือใช้การแปลงแบบ Box-Cox transformation เพื่อแก้ปัญหา heteroscedasticity และ (2) อาจใช้การตัดตัวแปรอิสระที่มีความสัมพันธ์กันเองสูง ๆ ออกจากโมเดล หรือใช้การสกัดองค์ประกอบหลัก (PCA) เพื่อแก้ปัญหา multicollinearity เป็นต้น</p></li>
<li><p>สำหรับอัลกอริทึม K-NN และ regularized regression ผู้วิเคราะห์จำเป็นต้องแปลงคะแนนของตัวแปรอิสระทั้งหมดให้เป็นหน่วยคะแนนมาตรฐานก่อน เพื่อให้อัลกอริทึมดังกล่าวสามารถเรียนรู้รูปแบบความสัมพันธ์ระหว่างตัวแปรในชุดข้อมูลได้โดยไม่มีปัจจัยเกี่ยวกับหน่วยข้อมูลมาเป็นตัวแทรกซ้อนและก่อให้เกิดความผิดพลาดในการเรียนรู้</p></li>
</ul>
<div style="page-break-after: always;"></div>
<p>ผู้อ่านจะเห็นว่าการทำ data preprocessing ประเภทนี้จำเป็นต้องทำตามข้อตกลงเบื้องต้นของโมเดล ทั้งนี้เพื่อให้โมเดลหรืออัลกอริทึมการเรียนรู้สามารถทำงานได้อย่างถูกต้อง หากผู้วิเคราะห์ละเลยการดำเนินการในส่วนนี้อาจส่งผลให้ผลการเรียนรู้ของอัลกอริทึมมีความผิดพลาด และประสบความล้มเหลวในการพัฒนาโมเดลทำนายที่ต้องการ โดยทั่วไปการจัดกระทำข้อมูลอาจจำแนกเป็น การแปลงค่าของตัวแปรจัดประเภทให้เป็นตัวแปรดัมมี (dummy) การตัดตัวแปรที่มีความแปรปรวนน้อยหรือความแปรปรวนเท่ากับ 0 ออกจากชุดข้อมูล (zv) การทดแทนค่าสูญหาย (impute) การแก้ปัญหา multicollinearity (decorrelate) การแปลงคะแนนตัวแปรให้อยู่ในสเกลมาตรฐาน (normalized) และการแปลงค่าของตัวแปรให้มีการแจกแจงที่สมมาตรหรือใกล้เคียง (transform)</p>
<p>ตารางต่อไปนี้แสดงตัวอย่าง checklist ของการจัดกระทำข้อมูลที่ควรดำเนินการในแต่ละอัลกอริทึมการเรียนรู้</p>
<table class="table">
<caption>Checklist การจัดกระทำข้อมูลของอัลกอริทึมการเรียนรู้ต่าง ๆ</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>อัลกอริทึม</th>
<th>dummy</th>
<th>zv</th>
<th>impute</th>
<th>decorrelate</th>
<th>normalized</th>
<th>transform</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>linear regression</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>maybe</td>
</tr>
<tr class="even">
<td>binary logistic</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>maybe</td>
</tr>
<tr class="odd">
<td>multinomial logistic</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>maybe</td>
</tr>
<tr class="even">
<td>K-NN</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>maybe</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>naive bayes</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="even">
<td>decision tree (CART)</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>maybe</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="odd">
<td>decision tree (C5)</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="even">
<td>pls regression</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>MARS</td>
<td>yes</td>
<td>no</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>maybe</td>
</tr>
<tr class="even">
<td>SVM</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td>random forest</td>
<td>no</td>
<td>maybe</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="even">
<td>bagging tree</td>
<td>no</td>
<td>no</td>
<td>no</td>
<td>maybe</td>
<td>no</td>
<td>no</td>
</tr>
<tr class="odd">
<td>bagging MARS</td>
<td>yes</td>
<td>no</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>maybe</td>
</tr>
<tr class="even">
<td>boosting tree</td>
<td>no</td>
<td>maybe</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>no</td>
</tr>
</tbody>
</table>
<p><strong>(2) การเตรียมเพื่อใช้ประโยชน์จากข้อมูลให้มีประสิทธิภาพสูงที่สุด</strong> อาจกล่าวว่าเป็นขั้นตอนที่ทำภายหลังจากการเตรียมข้อมูลให้เป็นไปตามข้อตกลงเบื้องต้นของอัลกอริทึมแล้ว การเตรียมข้อมูลส่วนนี้ไม่ได้เป็นเงื่อนไขจำเป็นของการพัฒนาโมเดลทำนาย แต่อาจเป็นเงื่อนไขที่เพียงพอจะทำให้การพัฒนาโมเดลทำนายประสบความสำเร็จ กล่าวคือได้โมเดลทำนายที่มีประสิทธิภาพในการทำนายสูง การดำเนินการส่วนโดยปกติเป็นการจัดกระทำข้อมูลของตัวแปรอิสระ (independent variables) หรือที่นักวิทยาการข้อมูลมักใช้คำว่า features ให้มีความเหมาะสมกับบบริบทของปัญหาซึ่งจะช่วยให้การเรียนรู้ของโมเดลทำได้อย่างมีประสิทธิภาพมากขึ้น อาจเรียกการเตรียมข้อมูลประเภทนี้ว่า feature engineering</p>
<p>การทำ feature engineering มีลักษณะเด่นที่สำคัญคือเป็นการดำเนินการที่ไม่ได้ขึ้นกับอัลกอริทึมการเรียนรู้แต่ขึ้นกับบริบทของปัญหาหรือข้อมูลที่ผู้วิเคราะห์มี ดังนั้นการที่ผู้วิเคราะห์จะตัดสินใจเลือกว่าจะใช้การจัดการข้อมูลแบบใดกับตัวแปรอิสระภายในชุดข้อมูลอาจต้องพิจารณาในหลายมิติร่วมกัน เช่น สภาพของข้อมูล ตัวเลือกทั้งหมดที่เป็นไปได้ในการจัดกระทำข้อมูลของตัวแปร ลักษณะ/รูปแบบของความสัมพันธ์ในธรรมชาติระหว่างตัวแปรตามกับตัวแปรอิสระ ในหลาย ๆ ครั้งอาจจะต้องใช้หลักเหตุผลรวมทั้งศึกษาค้นคว้าเอกสารงานวิจัยหรือทฤษฎีที่เกี่ยวข้องกับตัวแปรที่กำลังดำเนินงานอยู่ นอกจากนี้การสัมภาษณ์หรือเก็บรวบรวมข้อมูลจากผู้เกี่ยวข้อง เจ้าของข้อมูล หรือผู้มีส่วนได้ส่วนเสีย (stakeholder) อาจให้สารสนเทศที่เป็นประโยชน์ต่อการดำเนินงานในส่วนนี้ จะเห็นว่าการเตรียมข้อมูลลักษณะนี้ต้องใช้ทักษะมากกว่าการเตรียมข้อมูลประเภทแรกค่อนข้างมาก และมีลักษณะที่เป็น data-driven ซึ่งการดำเนินงานจะมีลักษณะทวนซ้ำเพื่อสังเกตผลลัพธ์และปรับแต่งการจัดกระทำตัวแปรเพื่อให้ประสิทธิภาพในการทำนายมีค่าสูงที่สุดเท่าที่จะเป็นไปได้ ทั้งนี้เพื่อให้เข้าใจลักษณะและประสิทธิภาพของการทำ feature engineering มากขึ้น ขอให้ผู้อ่านลองพิจารณาตัวอย่างต่อไปนี้</p>
<div class="cell">

</div>
<p>ชุดข้อมูล <code>logistic.csv</code> ดาวน์โหลดได้จาก <a href="https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week2/logistic.csv" class="uri">https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week2/logistic.csv</a> ประกอบด้วยข้อมูลของตัวแปรตาม <code>y</code> คือสถานะการเลื่อนตำแหน่งของพนักงาน (promated และ not promoted) ส่วนตัวแปรอิสระมี 2 ตัวได้แก่ อายุของพนักงาน (<code>age</code>) และประสิทธิภาพในการทำงาน (<code>performance</code>) วัตถุประสงค์ของผู้วิเคราะห์คือพัฒนาโมเดลทำนายการได้เลื่อนตำแหน่งของพนักงานด้วยตัวแปรอิสระทั้งสองตัวดังกล่าว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week2/logistic.csv"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,000
Columns: 4
$ X           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
$ age         &lt;dbl&gt; 35.73, 42.92, 57.10, 46.28, 59.89, 47.25, 58.40, 52.44, 55…
$ performance &lt;dbl&gt; 8.57928964, 7.99899950, 7.10855428, 3.04652326, 6.25812906…
$ y           &lt;chr&gt; "not promoted", "not promoted", "promoted", "promoted", "p…</code></pre>
</div>
</div>
<p>ผลการสำรวจข้อมูลเบื้องต้นพบว่าชุดข้อมูล <code>dat</code> ที่นำเข้ามามีตัวแปรที่ไม่เกี่ยวข้องคือ <code>X</code> ซึ่งควรเอาออกจากชุดข้อมูล และตัวแปรตาม <code>y</code> อยู่ในรูปแบบของตัวแปรตัวอักษรซึ่งควรเปลี่ยนให้เป็นตัวแปรแบบ factor ก่อน การดำเนินการแก้ไขปัญหาดังกล่าวเป็นการจัดกระทำข้อมูลให้สอดคล้องกับการวิเคราะห์ด้วยอัลกอริทึม logistic regression ในโปรแกรม R จัดอยู่ในกลุ่มการเตรียมข้อมูลประเภทแรกดังที่ได้กล่าวไปแล้ว คำสั่งต่อไปนี้เป็นการเตรียมข้อมูลดังกล่าว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">factor</span>(y, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"promoted"</span>,<span class="st">"not promoted"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>เมื่อจัดการกับข้อมูลดังกล่าวแล้ว ผู้วิเคราะห์ทำการแบ่งชุดข้อมูลออกเป็นสองชุด ได้แก่ ชุดข้อมูลฝึกหัด และชุดข้อมูลทดสอบ จากนั้นดำเนินการสำรวจความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระด้วยทัศนภาพข้อมูล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>dat_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dat, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> y)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>dat_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;1399/601/2000&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> dat_split <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> dat_split <span class="sc">%&gt;%</span> <span class="fu">testing</span>()</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data exploring</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>performance))<span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>y))<span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">ผลการสำรวจข้อมูลเบื้องต้น</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผลการสำรวจความสัมพันธ์ระหว่างตัวแปรด้วยทัศนภาพข้อมูลข้างต้น จะเห็นว่าสามารถจำแนกพนักงานด้วยสายตาออกได้เป็น 3 กลุ่มอย่างค่อนข้างชัดเจน กลุ่มแรกคือกลุ่มที่มีประสิทธิภาพในการทำงานต่ำกว่า 0 คะแนน ซึ่งเกือบทั้งหมดไม่ได้รับการเลื่อนตำแหน่ง กลุ่มที่สองคือกลุ่มพนักงานที่ประสิทธิภาพการทำงานสูงกว่า 0 คะแนน แต่ไม่ได้รับการเลื่อนตำแหน่ง ในจำนวนนี้พบว่าส่วนใหญ่เป็นพนักงานที่มีอายุยังน้อย และกลุ่มที่สามคือกลุ่มพนักงานที่ประสิทธิภาพการทำงานสูงกว่า 0 และได้รับการเลื่อนตำแหน่ง ซึ่งในจำนวนนี้พบว่าส่วนใหญ่เป็นพนักงานที่มีอายุมาก</p>
<p>ขั้นตอนถัดมาผู้วิเคราะห์นำชุดข้อมูลฝึกหัดที่สร้างขึ้นไปให้อัลกอริทึมเรียนรู้จากนั้นทำการตรวจสอบประสิทธิภาพการทำนายของโมเดลในชุดข้อมูลทดสอบด้วย package parsnip ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>fit_logistic1 <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_mode</span>(<span class="st">"classification"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">fit</span>(y <span class="sc">~</span> ., <span class="at">data=</span>train)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predicted values</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_logistic1, </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">new_data =</span> test,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_logistic1, </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">new_data =</span> test,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(y)<span class="sc">%&gt;%</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bind_cols</span>(pred, pred_prob)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate model</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results,</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> y,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class)<span class="sc">%&gt;%</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.812
 2 kap                  binary         0.341
 3 sens                 binary         0.324
 4 spec                 binary         0.955
 5 ppv                  binary         0.677
 6 npv                  binary         0.828
 7 mcc                  binary         0.375
 8 j_index              binary         0.278
 9 bal_accuracy         binary         0.639
10 detection_prevalence binary         0.108
11 precision            binary         0.677
12 recall               binary         0.324
13 f_meas               binary         0.438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># roc curve</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> y,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">estimate =</span> .pred_promoted)<span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">ROC Curve ของ logistic regression</figcaption><p></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">roc_auc</span>(<span class="at">truth =</span> y,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">estimate =</span> .pred_promoted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.752</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decision boundary</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>,<span class="dv">60</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">age =</span> x1,<span class="at">performance =</span> x2)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>bg.dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_logistic1, grid, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pred_prob =</span> <span class="fu">predict</span>(fit_logistic1, grid, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bg.dat, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>performance, <span class="at">col=</span>.pred_class), </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">3</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span> performance, <span class="at">col=</span>y), <span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col=</span><span class="st">"test dataset"</span>, <span class="at">fill=</span><span class="st">"Decision Boundary"</span>)<span class="sc">+</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family=</span><span class="st">"ChulaCharasNew"</span>))<span class="sc">+</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="528"></p>
<p></p><figcaption class="figure-caption">Decision Boundary ของ logistic regression</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผลการพัฒนาโมเดลทำนายด้วยอัลกอริทึม logistic regression ในข้างต้นจะเห็นว่ายังไม่ประสบความสำเร็จ โดยจากรูปจะเห็นว่าพื้นที่การตัดสินใจของโมเดลทำนายอยู่บริเวณมุมขวาบนของ feature space ซึ่งยังมีความคลาดเคลื่อนอยู่มาก เมื่อพิจารณาผลการวิเคราะห์จาก confusion matrix ประกอบพบว่าโมเดลมีความไว (sensitivity) ในการทำนายการเลื่อนตำแหน่งเท่ากับ .324 ซึ่งอยู่ในระดับต่ำ แต่มีความจำเพาะ (specificity) เท่ากับ .955 ซึ่งอยู่ในระดับสูงมาก อย่างไรก็ตามค่าความจำเพาะที่สูงดังกล่าวเป็นผลมาจากการที่โมเดลมี sensitivity ต่ำมากนั่นเอง นอกจากนี้เมื่อพิจารณา AUC ของ ROC curve พบว่ามีค่าเท่ากับ .752 แสดงว่าในภาพรวมโมเดลมีประสิทธิภาพการทำนายอยู่ในระดับพอใช้</p>
<p>จากปัญหาที่พบเราสามารถแก้ปัญหาได้หลายวิธีการ วิธีการแรก ๆ ที่ควรดำเนินการคือการทำ feature engineering จากผลการสำรวจความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระในรูป 33 จะเห็นว่าการเลื่อนตำแหน่งของพนักงานไม่ได้ขึ้นกับอายุและประสิทธิภาพในการทำนายแบบเป็นเส้นตรง กล่าวคือพนักงานอายุเยอะไม่จำเป็นต้องได้เลื่อนตำแหน่งเสมอไป และพนักงานที่มีประสิทธิภาพการทำงานที่ดีก็ไม่จำเป็นที่จะต้องได้เลื่อนตำแหน่งเสมอไปเช่นกัน แต่พนักงานที่มีแนวโน้มจะได้เลื่อนตำแหน่งคือพนักงานที่มีประสิทธิภาพการทำงานดีและมีอายุ จากข้อสังเกตนี้แสดงให้เห็นว่ามีอิทธิพลปฏิสัมพันธ์ระหว่างอายุกับประสิทธิภาพการทำนายต่อการเลื่อนตำแหน่ง</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>fit_logistic2 <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_mode</span>(<span class="st">"classification"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">fit</span>(y <span class="sc">~</span> . <span class="sc">+</span> age<span class="sc">*</span>performance, <span class="at">data=</span>train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.822
2 sens     binary         0.375
3 spec     binary         0.953</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">ROC Curve ของ logistic regression ที่มีอิทธิพลปฏิสัมพันธ์</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.801</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decision boundary</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>,<span class="dv">60</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">age =</span> x1,<span class="at">performance =</span> x2)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>bg.dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_logistic2, grid, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pred_prob =</span> <span class="fu">predict</span>(fit_logistic2, grid, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bg.dat, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>performance, <span class="at">col=</span>.pred_class), </span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">3</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span> performance, <span class="at">col=</span>y), <span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col=</span><span class="st">"test dataset"</span>, <span class="at">fill=</span><span class="st">"Decision Boundary"</span>)<span class="sc">+</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family=</span><span class="st">"ChulaCharasNew"</span>))<span class="sc">+</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="528"></p>
<p></p><figcaption class="figure-caption">Decision Boundary ของ logistic regression ที่มีอิทธิพลปฏิสัมพันธ์</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผลการทำนายของโมเดลที่มีเทอมปฏิสัมพันธ์ระหว่างอายุกับประสิทธิภาพการทำงานพบว่าดีขึ้นเล็กน้อย แต่ยังไม่ประสบความสำเร็จ คราวนี้เราลองพิจารณาทางเลือกในการแปลงค่าของตัวแปรในลักษณะอื่นบ้าง จากผลการสำรวจที่พบว่าการเลื่อนตำแหน่งขึ้นกับปัจจัยอายุและประสิทธิภาพการทำงานผู้วิเคราะห์สร้างตัวแปรใหม่ในชุดข้อมูลเป็นอัตราส่วนอายุต่อประสิทธิภาพการทำงาน (<code>ratio_age_performance</code>) จากนั้นดำเนินการ fit โมเดลเหมือนกับสองโมเดลแรกที่ผ่านมา</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat<span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">ratio_age_performance =</span> age<span class="sc">/</span>performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;1399/601/2000&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              Truth
Prediction     promoted not promoted
  promoted          129            6
  not promoted        7          459</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.978
2 sens     binary         0.949
3 spec     binary         0.987</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="336"></p>
<p></p><figcaption class="figure-caption">ROC Curve ของ logistic regression ที่มีการทำ feature engineering</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decision boundary</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>,<span class="dv">60</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">age =</span> x1,<span class="at">performance =</span> x2)<span class="sc">%&gt;%</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ratio_age_performance =</span> age<span class="sc">/</span>performance)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>bg.dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_logistic3, grid, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pred_prob =</span> <span class="fu">predict</span>(fit_logistic3, grid, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bg.dat, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>performance, <span class="at">col=</span>.pred_class), </span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">3</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span> performance, <span class="at">col=</span>y), <span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col=</span><span class="st">"test dataset"</span>, <span class="at">fill=</span><span class="st">"Decision Boundary"</span>)<span class="sc">+</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family=</span><span class="st">"ChulaCharasNew"</span>))<span class="sc">+</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="528"></p>
<p></p><figcaption class="figure-caption">Decision Boundary ของ logistic regression ที่มีการทำ Feature Engineering</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>คราวนี้ลองเปลี่ยนโมเดลทำนายข้างต้นเป็น decision tree แบบ CART ที่มีจุดเด่นคือเป็นโมเดลจำแนกแบบ nonlinear classification กล่าวคือโมเดล decision tree ควรมีประสิทธิภาพในการจำแนกพนักงานที่จะได้เลื่อนและไม่ได้เลื่อนตำแหน่งได้สูงกว่า logistic regression ที่ยังไม่ได้ทำ feature engineering</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>fit_tree <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">set_mode</span>(<span class="st">"classification"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">fit</span>(y <span class="sc">~</span> . , <span class="at">data=</span>train)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predicted values</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_tree, </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">new_data =</span> test,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_tree, </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">new_data =</span> test,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(y)<span class="sc">%&gt;%</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">bind_cols</span>(pred, pred_prob)</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate model</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(<span class="at">data =</span> test_results,</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> y,</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Truth
Prediction     promoted not promoted
  promoted          124            6
  not promoted       12          459</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>eval_metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, sens, spec)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">eval_metric</span>(<span class="at">data =</span> test_results,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">truth =</span> y,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.970
2 sens     binary         0.912
3 spec     binary         0.987</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decision boundary</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">18</span>,<span class="dv">60</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">age =</span> x1,<span class="at">performance =</span> x2)<span class="sc">%&gt;%</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ratio_age_performance =</span> age<span class="sc">/</span>performance)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>bg.dat<span class="ot">&lt;-</span><span class="fu">data.frame</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_tree, grid, <span class="at">type=</span><span class="st">"class"</span>),</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pred_prob =</span> <span class="fu">predict</span>(fit_tree, grid, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> bg.dat, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>performance, <span class="at">col=</span>.pred_class), </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">3</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> test, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span> performance, <span class="at">col=</span>y), <span class="at">shape=</span><span class="dv">16</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">col=</span><span class="st">"test dataset"</span>, <span class="at">fill=</span><span class="st">"Decision Boundary"</span>)<span class="sc">+</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="528"></p>
<p></p><figcaption class="figure-caption">Decision Boundary ของ Decision Tree (CART algorithm)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ผู้อ่านจะเห็นว่าการทำ feature engineering โดยสร้างเทอมอัตราส่วนระหว่างอายุกับประสิทธิภาพการทำงานของพนักงานในการทำนายการเลื่อนตำแหน่งของพนักงานใน logistic regression ช่วยให้พื้นที่การตัดสินใจของโมเดลทำนายแบบ logistic regression พัฒนาขึ้นมาก จากเดิมที่เป็น linear classification เป็น nonlinear classification และมีประสิทธิภาพการทำนายบนชุดข้อมูลทดสอบที่สูงมากใกล้เคียงกับการใช้ decision tree ที่เป็น nonlinear classification (อย่างไรก็ตาม decision tree มี hyperparameter ที่สามารถปรับแต่งได้อีก ซึ่งอาจเพิ่มประสิทธิภาพในการทำนายได้มากขึ้นกว่านี้) ตัวอย่างนี้เป็นตัวอย่างหนึ่งที่แสดงให้เห็นว่าการทำ feature engineering ที่เหมาะสมนั้นช่วยเพิ่มประสิทธิภาพการทำนายให้กับโมเดลได้อย่างไร</p>
</section>
<section id="ประเภทของ-data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="ประเภทของ-data-preprocessing">4.2 ประเภทของ Data Preprocessing</h2>
<p>ดังที่ได้กล่าวในข้างต้นว่า data preprocessing เป็นกระบวนการจัดการข้อมูลที่มีลักษณะทวนซ้ำ และไม่ได้มีขั้นตอนการดำเนินการที่แน่นอน ขั้นตอนการดำเนินการจัดการข้อมูลในแต่ละงานขึ้นอยู่กับสภาพของข้อมูล และวัตถุประสงค์ของการวิเคราะห์ในแต่ละงาน โดยทั่วไปการจัดการข้อมูลอาจจำแนกเป็น 3 ประเภทได้แก่</p>
<ul>
<li><p><strong>การทำความสะอาดข้อมูล (data cleaning)</strong></p></li>
<li><p><strong>การแปลงข้อมูล (data transformation)</strong></p></li>
<li><p><strong>การคัดเลือกตัวแปร (feature selection)</strong></p></li>
</ul>
<p>รายละเอียดมีดังนี้</p>
<section id="การทำความสะอาดขอมล-data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="การทำความสะอาดขอมล-data-cleaning">การทำความสะอาดข้อมูล (data cleaning)</h3>
<p>การทำความสะอาดข้อมูลเป็นกระบวนการเพื่อสำรวจ วินิจฉัย และแก้ไขความผิดปกติที่เกิดขึ้นในข้อมูล ความผิดปกติดังกล่าวสามารถเกิดขึ้นได้จากหลายสาเหตุ เช่น การจัดเก็บหรือบันทึกข้อมูลที่ผิดพลาด หรือการวัดข้อมูลมีความคลาดเคลื่อนจากการวัด ความผิดปกติดังกล่าวมีโอกาสเกิดขึ้นได้เป็นประจำ จึงเป็นหน้าที่ของนักวิทยาการข้อมูลที่จะต้องสำรวจ และวินิจฉัยความผิดปกติดังกล่าวในชุดข้อมูล จากนั้นจึงดำเนินการแก้ไขอย่างเหมาะสม วัตถุประสงค์ของการทำความสะอาดข้อมูลคือการได้มาซึ่งชุดข้อมูลใหม่ที่มีความพร้อมในการนำไปวิเคราะห์ได้โดยไม่มีความผิดพลาด การทำความสะอาดข้อมูลจัดอยู่ในกลุ่มการเตรียมข้อมูลให้สอดคล้องกับความต้องการหรือข้อตกลงเบื้องต้นของอัลกอริทึมการเรียนรู้ ซึ่งเกี่ยวข้องกับการดำเนินการหรือเทคนิควิธีการหลายอย่าง ได้แก่</p>
<ul>
<li><p><strong>การจัดระเบียบและจัดกระทำข้อมูล (tidying and manipulating data)</strong> ซึ่งเกี่ยวข้องกับการจัดรูปแบบของตารางข้อมูลให้อยู่ในรูปแบบที่เหมาะสมสำหรับการวิเคราะห์ เช่นการเปลี่ยนรูปแบบตารางระหว่างตารางข้อมูลรูปแบบยาว (long format) กับรูปแบบกว้าง (wide format) การเปลี่ยนสถานะของตัวแปรในชุดข้อมูลให้เหมาะสม การแยกและยุบรวมคอลัมนท์ การจัดการกับข้อมูลซ้ำซ้อน การรวมชุดข้อมูล การคัดกรองข้อมูล เป็นต้น package ของ R ที่เกี่ยวข้องกับการดำเนินการส่วนนี้ ได้แก่ tidyr และ dplyr (รายละเอียดสามารถศึกษาได้จาก สิวะโชติ ศรีสุทธิยากร (2564)) &lt;--- ไม่พูดถึงแล้วในรายวิชานี้</p></li>
<li><p><strong>การสำรวจและจัดการกับค่าผิดปกติ</strong> เกี่ยวข้องกับการสำรวจข้อมูล วินิจฉัยความผิดปกติของข้อมูล และการแก้ไขปัญหาความผิดปกติของข้อมูล ข้อมูลที่ผิดปกติอาจจำแนกได้เป็นสามประเภทตามสาเหตุของการเกิด เช่น outlier, anomaly และ noisy data</p></li>
<li><p><strong>การวิเคราะห์และทดแทนค่าสูญหาย</strong> เป็นปกติที่ชุดข้อมูลจะมีข้อมูลที่สูญหายไม่ครบถ้วน หากค่าสูญหายดังกล่าวเกิดขึ้นเป็นจำนวนมากเกินไป และมีรูปแบบการเกิดที่เป็นระบบ อาจส่งผลให้การเรียนรู้ของเครื่องมีความลำเอียงหรือมีความน่าเชื่อถือที่ลดลงได้ การวิเคราะห์รูปแบบของค่าสูญหาย และการเลือกวิธีการทดแทนค่าสูญหายที่เหมาะสมจะช่วยลดทอนผลกระทบที่เกิดจากค่าสูญหายดังกล่าว</p></li>
</ul>
</section>
<section id="การแปลงขอมล-data-transformation" class="level3">
<h3 class="anchored" data-anchor-id="การแปลงขอมล-data-transformation">การแปลงข้อมูล (data transformation)</h3>
<p>การแปลงข้อมูลเป็นกระบวนการเปลี่ยนลักษณะหรือรูปแบบของข้อมูลจากรูปแบบหนึ่งไปเป็นอีกรูปแบบหนึ่ง เพื่อให้เหมาะกับความต้องการหรือข้อตกลงเบื้องต้นของการวิเคราะห์ที่เลือกใช้ ได้แก่ การแปลงข้อมูลจัดประเภทให้เป็นตัวแปรตัวเลข เช่น dummy encoding หรือ one-hot encoding การแปลงข้อมูลที่ไม่สมมาตรให้สมมาตร หรือการแปลงข้อมูลจากหน่วยใด ๆ ให้อยู่ในหน่วยมาตรฐานเพื่อให้สามารถเปรียบเทียบกันได้ หรือลดผลกระทบจากหน่วยข้อมูลที่มีต่อการเรียนรู้ของเครื่องในบางอัลกอริทึม นอกจากนี้การแปลงข้อมูลยังเป็นเทคนิคที่อาจช่วยให้การวิเคราะห์มีประสิทธิภาพสูงขึ้นดังตัวอย่างที่แสดงไว้ในส่วนนำของบทเรียนนี้</p>
</section>
<section id="การคดเลอกตวแปร-feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="การคดเลอกตวแปร-feature-selection">การคัดเลือกตัวแปร (feature selection)</h3>
<p>เป็นกระบวนการคัดเลือกตัวแปรอิสระภายในชุดข้อมูลที่มีประสิทธิภาพสำหรับการวิเคราะห์หรือพัฒนาโมเดลทำนาย กระบวนการนี้มีความสำคัญมากโดยเฉพาะในสถานการณ์ที่ผู้วิเคราะห์มีชุดข้อมูลขนาดใหญ่และมีตัวแปรจำนวนมาก การคัดเลือกตัวแปรจะช่วยลดขนาดของชุดข้อมูลและช่วยให้ผู้วิเคราะห์ทำงานได้ง่ายขึ้น โดยทั่วไปอาจจำแนกวิธีการคัดเลือกตัวแปรได้เป็น 3 ประเภทได้แก่ filter methods, wrapper methods และ embedded methods</p>
<p><strong>Filter methods</strong> เป็นวิธีการพื้นฐานสำหรับการคัดเลือกตัวแปรอิสระ วิธีการในกลุ่มนี้จะเป็นการใช้ค่าสถิติพื้นฐาน ได้แก่ สัมประสิทธิ์สหสัมพันธ์ และใช้ความรู้จากการทบทวนวรรณกรรม ประสบการณ์ของผู้วิเคราะห์ ความคิดเห็นของผู้เกี่ยวข้องหรือผู้ทรงคุณวุฒิ เข้ามาร่วมกันเพื่อคัดเลือกชุดของตัวแปรอิสระที่เหมาะสม</p>
<p><strong>Wrapper methods</strong> เป็นวิธีการที่คัดเลือกตัวแปรอิสระในโมเดลด้วยอัลกอริทึมสำหรับคัดเลือกตัวแปรได้แก่ forward selection, backward selection, stepwise selection หรือ recursive feature elimination เป็นต้น</p>
<p><strong>Embedded methods</strong> เป็นวิธีการคัดเลือกตัวแปรอิสระที่รวมไปกับกระบวนการเรียนรู้ของอัลกอริทึมบางตัว เช่น lasso regression และ decision tree</p>
</section>
</section>
<section id="พนฐาน-recipe-สำหรบทำ-data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="พนฐาน-recipe-สำหรบทำ-data-preprocessing">4.3 พื้นฐาน <code>recipe</code> สำหรับทำ Data Preprocessing</h2>
<p><img src="images/image-1527588902.png" class="img-fluid" style="width:30.0%"></p>
<p>การทำ data preprocessing เป็นกระบวนการที่มีการใช้ทั้งการจัดกระทำข้อมูล สถิติและอัลกอริทึมการเรียนรู้ จริง ๆ แล้วการดำเนินการดังกล่าวสามารถทำได้โดยใช้คำสั่งพื้นฐานปกติใน R อย่างไรก็ตามในกระบวนการพัฒนาโมเดลที่มีการดำเนินการแบบทวนซ้ำแต่ละขั้นตอนไปมาซึ่งการเขียนคำสั่งแบบปกติอาจไม่สะดวกนัก โดยเฉพาะในกรณีที่ผู้วิเคราะห์มีการใช้เทคนิคการจัดการข้อมูลหลาย ๆ เทคนิคต่อเนื่องกัน เช่น การแปลงค่า — &gt;การทดแทนค่าสูญหาย —&gt; การสร้างองค์ประกอบด้วย PCA บทเรียนนี้จะกล่าวถึงการใช้ package recipe เพื่อใช้เป็นวิธีการทางเลือกสำหรับผู้วิเคราะห์ในการทำ data preprocessing ภายใต้ package นี้ผู้วิเคราะห์สามารถดำเนินการทำ data preprocessing ที่มีหลายขั้นตอนหลายเทคนิคได้อย่างต่อเนื่องโดยใช้ piping operator คล้ายกับการทำงานใน package dplyr นอกจากนี้ยังนำกระบวนการที่กำหนดไปทำซ้ำกับชุดข้อมูลอื่นได้โดยง่าย เนื้อหาในหัวข้อนี้จะกล่าวถึงพื้นฐานการใช้ package recipe ดังกล่าวรายละเอียดมีดังนี้</p>
<section id="การดาวนโหลดและตดตง-package" class="level3">
<h3 class="anchored" data-anchor-id="การดาวนโหลดและตดตง-package">การดาวน์โหลดและติดตั้ง package</h3>
<p>กรณีที่ติดตั้ง package tidymodels จะดาวน์โหลดและติดตั้ง package recipe โดยอัตโนมัติ ส่วนในกรณีที่ต้องการติดตั้งแยกสามารถพิมพ์คำสั่งดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CRAN version</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"recipe"</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipe)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># development version from GitHub</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"tidymodels/recipes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ขนตอนการทำ-data-preprocessing-ดวย-recipe" class="level3">
<h3 class="anchored" data-anchor-id="ขนตอนการทำ-data-preprocessing-ดวย-recipe">ขั้นตอนการทำ data preprocessing ด้วย recipe</h3>
<p>การทำ data preprocessing ด้วย package recipe ประกอบด้วยขั้นตอนการดำเนินงานหลัก 4 ขั้นได้แก่</p>
<ol type="1">
<li><p>ขั้นตอนการกำหนดสถานะของตัวแปร ว่าภายในชุดข้อมูลที่ดำเนินการอยู่ ตัวแปรใดเป็นตัวแปรตามตัวแปรใดเป็นตัวแปรอิสระ รวมถึงพิจารณาประเภทของข้อมูลในแต่ละตัวแปรด้วย ซึ่งปกติสามารถจำแนกได้ 2 ประเภทได้แก่ ข้อมูลตัวเลข และข้อมูลแบบจัดประเภท การดำเนินการในขั้นนี้จะใช้ฟังก์ชัน <code>recipe()</code></p></li>
<li><p>ขั้นตอนการกำหนดวิธีการจัดการข้อมูลที่ต้องการ โดยผู้วิเคราะห์สามารถกำหนดวิธีการจัดการข้อมูลที่ต้องการผ่านฟังก์ชัน <code>step_*()</code> ที่ครอบคลุมทั้งการแปลงค่าข้อมูล เช่น การแปลงให้เป็นคะแนนมาตรฐาน การแปลงด้วยฟังก์ชัน log การสร้างตัวแปรใหม่จากข้อมูลของตัวแปรเดิม หรือ การทดแทนค่าสูญหาย (missing data imputation) เป็นต้น ผู้อ่านสามารถศึกษารายละเอียดของฟังก์ชัน <code>step_*()</code> ทั้งหมดภายใต้ package recipe ได้จาก <a href="https://recipes.tidymodels.org/reference/index.html" class="uri">https://recipes.tidymodels.org/reference/index.html</a></p></li>
<li><p>การจัดการข้อมูลหลายตัวมีการใช้วิธีการทางสถิติหรืออัลกอริทึมการเรียนรู้ที่จะต้องใช้ผลการวิเคราะห์จากชุดข้อมูลฝึกหัดมาเป็นค่าพารามิเตอร์หรือค่าสถิติสำหรับจัดการข้อมูลที่กำหนด (แต่การจัดการข้อมูลบางตัวก็ไม่ต้องใช้) ดังนั้นเมื่อผู้วิเคราะห์กำหนดสถานะของตัวแปรและการจัดการข้อมูลเรียบร้อยแล้ว ขั้นตอนที่ 3 คือการนำตัวแปรจาก <code>recipe()</code> ข้างต้นมาผ่านการประมวลผลหรือวิเคราะห์โดยใช้ชุดข้อมูลฝึกหัดเป็นข้อมูลนำเข้า เช่น หากผู้วิเคราะห์กำหนดให้มีการแปลงคะแนนตัวแปรให้เป็นสเกลมาตรฐาน ขั้นตอนนี้จะเป็นการคำนวนค่าเฉลี่ย และส่วนเบี่ยงเบนมาตรฐานของตัวแปรในชุดข้อมูลฝึกหัดที่กำหนดเพื่อใช้ในการ centering และ scaling ตัวแปรในชุดข้อมูลที่ต้องการจะทำ data preprocessing ในอนาคต การดำเนินการใช้ขั้นตอนนี้จะใช้ฟังก์ชัน <code>prep()</code></p></li>
<li><p>ขั้นตอนสุดท้ายคือการจัดการข้อมูลตามที่วางแผนไว้บนชุดข้อมูลที่กำหนด ซึ่งเป็นไปได้ทั้ง training dataset, test dataset หรือชุดข้อมูลอื่น ๆ ที่จะนำเข้าสู่โมเดลทำนายในอนาคต (เพราะ ML model ที่พัฒนาต้องจะต้องการข้อมูลที่มีการจัดการเหมือนกับชุดข้อมูลฝึกหัด) การดำเนินการในขั้นตอนนี้จะใช้ฟังก์ชัน <code>bake()</code></p></li>
</ol>
<p>ตัวอย่างต่อไปนี้แสดงทำ data preprocessing ด้วย package recipe ตามขั้นตอนข้างต้น จากชุดข้อมูล <a href="https://github.com/ssiwacho/2758688_ML/blob/main/week%201/TeacherSalaryData.csv"><code>TeacherSalaryData.csv</code></a> สมมุติว่าผู้วิจัยต้องการแปลงค่าของตัวแปร <code>salary</code> ด้วยฟังก์ชัน log สามารถดำเนินการได้ดังนี้</p>
<p><strong>ขั้นที่ 0 : นำเข้าและแบ่งชุดข้อมูล</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv"</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[,<span class="sc">-</span><span class="dv">1</span>] <span class="co">#remove X</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat<span class="sc">%&gt;%</span><span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co"># data splitting</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> dat, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>salary_train <span class="ot">&lt;-</span> split <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>salary_test <span class="ot">&lt;-</span> split <span class="sc">%&gt;%</span> <span class="fu">testing</span>()</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        rank     discipline yrs.since.phd    yrs.service        sex     
 AssocProf: 55   A:141      Min.   : 1.00   Min.   : 0.00   Female: 35  
 AsstProf : 51   B:176      1st Qu.:12.00   1st Qu.: 7.00   Male  :282  
 Prof     :211              Median :22.00   Median :17.00               
                            Mean   :22.57   Mean   :17.88               
                            3rd Qu.:32.00   3rd Qu.:26.00               
                            Max.   :56.00   Max.   :60.00               
     salary      
 Min.   : 57800  
 1st Qu.: 91000  
 Median :108200  
 Mean   :114839  
 3rd Qu.:135027  
 Max.   :231545  </code></pre>
</div>
</div>
<p><strong>ขั้น 1 : กำหนดสถานะของตัวแปร และพิจารณาความถูกต้องของประเภทข้อมูลในแต่ละตัวแปร</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>salary_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(salary <span class="sc">~</span>., <span class="at">data =</span> salary_train)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>salary_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>salary_rec <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  variable      type    role      source  
  &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
1 rank          nominal predictor original
2 discipline    nominal predictor original
3 yrs.since.phd numeric predictor original
4 yrs.service   numeric predictor original
5 sex           nominal predictor original
6 salary        numeric outcome   original</code></pre>
</div>
</div>
<p>ผลการวิเคราะห์ข้างต้นจะเห็นว่าภายในชุดข้อมูลประกอบด้วย 6 ตัวแปร มีตัวแปรตามคือ salary ซึ่งเป็นตัวแปรเชิงปริมาณ ตัวแปรที่เหลือเป็นตัวแปรอิสระที่ประกอบด้วยตัวแปรเชิงปริมาณจำนวน 2 ตัว และตัวแปรจัดประเภทจำนวน 3 ตัว</p>
<p><strong>ขั้น 2 : กำหนดการจัดการข้อมูลให้กับตัวแปร <code>recipe</code> จากขั้นที่ 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>salary_rec <span class="ot">&lt;-</span> salary_rec <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_log</span>(salary, <span class="at">base =</span> <span class="dv">10</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>salary_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          5

Operations:

Log transformation on salary</code></pre>
</div>
</div>
<p>ผลลัพธ์ในข้างต้นแสดงให้เห็นว่ามีการกำหนดให้แปลงค่าของตัวแปร <code>salary</code> ด้วยฟังก์ชัน log</p>
<p><strong>ขั้น 3 : การประมวลผล preprocessing model</strong></p>
<p>ขั้นตอนนี้เป็นการนำกรอบการจัดการข้อมูลที่กำหนดให้ขั้นที่ 1 และ 2 มาประมวลผลบนชุดข้อมูลฝึกหัด ด้วยฟังก์ชัน <code>prep()</code> โดยฟังก์ชันดังกล่าวจะคำนวณค่าสถิติที่จำเป็นหรือให้อัลกอริทึมการเรียนรู้ทำการประมวลผลลัพธ์ที่จำเป็นสำหรับการจัดการข้อมูลตามที่กำหนดไว้ ฟังก์ชัน <code>prep()</code> มีอาร์กิวเมนท์ที่สำคัญคือ <code>training</code> ที่ใช้ระบุชุดข้อมูลฝึกหัดสำหรับการจัดการข้อมูล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>salary_rec_prep <span class="ot">&lt;-</span> salary_rec <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training =</span> salary_train)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>salary_rec_prep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          5

Training data contained 317 data points and no missing data.

Operations:

Log transformation on salary [trained]</code></pre>
</div>
</div>
<p>จะเห็นว่าเมื่อผ่านตัวแปรของ <code>recipe</code> เข้าสู่ฟังก์ชัน <code>prep</code> แล้วจะมีการขึ้นสถานะว่า <code>[trained]</code> ซึ่งหมายถึง package recipe ได้ประมวลผลที่จำเป็นสำหรับการจัดการข้อมูลตามที่กำหนดแล้ว และเก็บผลดังกล่าวเอาไว้ในตัวแปร <code>salary_rec_pre</code></p>
<p><strong>ขั้น 4 : การจัดการข้อมูล</strong></p>
<p>อย่างที่กล่าวไว้แล้วว่าขั้นที่ 1 - 3 ถือเป็นขั้นตอนการวางแผนและเตรียมการจัดการข้อมูล ส่วนขั้นที่ 4 เป็นการจัดการข้อมูลบนชุดข้อมูลที่กำหนด ด้วยฟังก์ชัน <code>bake()</code> โดยจะใช้กรอบการจัดการข้อมูลที่กำหนดในขั้นตอนที่ 1 และ 2 และจะใช้ค่าสถิติที่จำเป็นสำหรับการจัดการข้อมูลที่ได้จากขั้นตอนที่ 3 ฟังก์ชัน <code>bake()</code> มีอาร์กิวเมนท์สำคัญหนึ่งตัวคือ <code>new_data</code> ที่ใช้ระบุชุดข้อมูลที่จะต้องการดำเนินการ ในกรณีที่ต้องการจัดการข้อมูลฝึกหัดที่ใช้เป็นชุดข้อมูลฝึกหัดในขั้นตอนที่ 3 ให้กำหนด <code>new_data = NULL</code> ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>salary_train_baked <span class="ot">&lt;-</span> salary_rec_prep <span class="sc">%&gt;%</span> <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salary_train_baked)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        rank     discipline yrs.since.phd    yrs.service        sex     
 AssocProf: 55   A:141      Min.   : 1.00   Min.   : 0.00   Female: 35  
 AsstProf : 51   B:176      1st Qu.:12.00   1st Qu.: 7.00   Male  :282  
 Prof     :211              Median :22.00   Median :17.00               
                            Mean   :22.57   Mean   :17.88               
                            3rd Qu.:32.00   3rd Qu.:26.00               
                            Max.   :56.00   Max.   :60.00               
     salary     
 Min.   :4.762  
 1st Qu.:4.959  
 Median :5.034  
 Mean   :5.044  
 3rd Qu.:5.130  
 Max.   :5.365  </code></pre>
</div>
</div>
<p>ในกรณีที่ต้องการนำการจัดการข้อมูลที่ train ไว้ในขั้นที่ 3 ไปใช้กับชุดข้อมูลอื่นเช่น <code>salary_test</code> สามารถเขียนคำสั่งได้ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>salary_test_baked <span class="ot">&lt;-</span> salary_rec_prep <span class="sc">%&gt;%</span> <span class="fu">bake</span>(<span class="at">new_data =</span> salary_test)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>salary_test_baked</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 6
   rank     discipline yrs.since.phd yrs.service sex   salary
   &lt;fct&gt;    &lt;fct&gt;              &lt;int&gt;       &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt;
 1 AsstProf B                      4           3 Male    4.90
 2 Prof     A                     36          31 Male    5.01
 3 AsstProf B                      5           3 Male    4.92
 4 AsstProf B                     11           0 Male    4.89
 5 Prof     B                     13           9 Male    5.07
 6 AsstProf B                      4           2 Male    4.90
 7 Prof     B                     40          27 Male    5.01
 8 Prof     B                     12          11 Male    5.04
 9 Prof     B                     16           9 Male    5.03
10 AsstProf B                      8           3 Male    4.88
# … with 70 more rows</code></pre>
</div>
</div>
<p>จะเห็นว่าชุดข้อมูลทั้งสองมีการจัดการข้อมูลของตัวแปร salary ตามที่กำหนดไว้เรียบร้อยแล้ว เนื้อหาในส่วนต่อไปจะกล่าวถึงเทคนิคการทำ data preprocessing สำหรับสถานการณ์ต่าง ๆ โดยจะใช้ package recipe ในการดำเนินการ</p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="บทท-5-decision-tree-part-i" class="level1">
<h1>บทที่ 5 Decision Tree (Part I)</h1>
<p>บทเรียนนี้จะกล่าวถึงอัลกอริทึม decision tree ที่เป็นอัลกอริทึมพื้นฐานตัวหนึ่งที่สามารถใช้ได้พัฒนาโมเดลทำนายทั้งที่เป็น regression และ classification model โดย decision tree จัดเป็นอัลกอริทึมที่อยู่ในกลุ่ม nonparametric ซึ่งแตกต่างจาก linear regression กล่าวคือการเรียนรู้ของ decision tree มีลักษณะเป็นการสร้างกฎเกณฑ์ในการแบ่งข้อมูลออกเป็นส่วนย่อยที่ไม่ทับซ้อนกันภายใต้ feature space จากคุณลักษณะดังกล่าวทำให้ decision tree เป็นอัลกอริทึมที่มีความยืดหยุ่นมากกว่า linear regression และสามารถใช้เรียนรู้ความสัมพันธ์ที่ไม่ใช่เชิงเส้นได้ดีกว่า regression</p>
<p>นอกจากนี้ decision tree ยังเป็นอัลกอริทึมที่มี hyperparameters หลายตัว อย่างที่ได้กล่าวไปในบทเรียนก่อนหน้าว่า hyperparameter คือพารามิเตอร์ในโมเดลที่ไม่สามารถประมาณค่าที่เหมาะสมได้จากข้อมูล แต่ละต้องใช้การกำหนดค่าโดยผู้วิเคราะห์ ปัญหาที่ตามมาคือการกำหนดค่า hyperparameter ที่เหมาะสมควรดำเนินการอย่างไร กระบวนการที่ผู้วิเคราะห์ใช้เพื่อกำหนดค่า hyperparameter ดังกล่าวเรียกว่า การปรับแต่ง hyperparameter (hyperparameter tuning) ซึ่งจะเป็นเนื้อหาอีกส่วนหนึ่งที่จะกล่าวถึงในบทเรียนนี้</p>
<section id="มโนทศนสำคญของ-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="มโนทศนสำคญของ-decision-tree">5.1 มโนทัศน์สำคัญของ decision tree</h2>
<p>decision tree เป็นอัลกอริทึมการเรียนรู้ตัวพื้นฐานในกลุ่มของ supervised learning ปัจจุบันมีอัลกอริทึม decision tree ถูกพัฒนาขึ้นหลายตัว บทเรียนนี้จะกล่าวถึง decision tree ที่เรียนรู้ด้วยอัลกอริทึม recursive binary splitting ซึ่งสามารถใช้ได้กับทั้ง classification และ regression models</p>
<section id="สวนประกอบของ-decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="สวนประกอบของ-decision-tree">ส่วนประกอบของ decision tree</h3>
<p>รูปด้านล่างแสดงตัวอย่างของ decision tree โดยจะเป็นว่าโมเดลมีส่วนประกอบ 3 ส่วนหลักได้แก่ root node, internal nodes และ leaf nodes (หรือ terminal nodes)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-549379503.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">ตัวอย่าง decision tree</figcaption><p></p>
</figure>
</div>
<p>การเรียนรู้ของ decision tree แบบ CART เป็นการสร้างพื้นที่ปิดล้อมรูปสี่เหลี่ยมที่ไม่ทับซ้อนกันเพื่อแบ่งส่วนของข้อมูลภายใน feature space ออกเป็นส่วนย่อย ๆ โดยการแบ่งแต่ละครั้งจะทำให้เกิดส่วนย่อยใหม่ขึ้น 2 ส่วน และดำเนินการแบ่งพื้นที่ดังกล่าวทวนซ้ำไปเรื่อย ๆ จนกว่าจะถึงจุดที่หยุดกระบวนการ เรียกกระบวนการแบ่งส่วนของพื้นที่ดังกล่าวว่า <strong>binary recursive partitioning</strong></p>
</section>
<section id="partitioning-regression-tree" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-regression-tree">Partitioning: Regression Tree</h3>
<p>สมมุติให้ R1 และ R2 เป็นพื้นที่ย่อยที่เกิดขึ้นจากการแบ่งส่วนครั้งหนึ่งภายใต้ feature space การพิจารณาว่าแบ่งส่วนย่อยดังกล่าวควรแบ่งโดยใช้ตัวแปรอิสระใด และแบ่งที่ค่าใดของตัวแปรอิสระนั้น จะพิจารณาจากความคลาดเคลื่อนระหว่างค่าจริงกับค่าทำนายภายในแต่ละพื้นที่ R โดย<strong>สำหรับปัญหาแบบ regression</strong> อาจพิจารณาความคลาดเคลื่อนดังกล่าวให้<strong>ค่าผลรวมกำลังสองโดยรวม (total SSE)</strong> ของ terminal node ที่เป็นผลรวมระหว่าง SSE ของแต่ละพื้นที่มีค่าต่ำที่สุด เขียนเป็นสูตรได้ดังนี้</p>
<p><span class="math display">\[
Total \ SSE = \sum_{i \in R_1}(y_i-c_1)^2+\sum_{i \in R_2}(y_i-c_2)^2
\]</span></p>
<p>เพื่อให้ผู้อ่านเห็นภาพการแบ่งพื้นที่ใน feature space สำหรับปัญหา regression ด้วยเกณฑ์ข้างต้น ขอให้พิจารณาตัวอย่างต่อไปนี้ สมมุติว่าผู้วิเคราะห์มีข้อมูลของตัวแปรตาม y กับตัวแปรอิสระ x อย่างละตัว โดยตัวแปรดังกล่าวมีความสัมพันธ์กันแบบเชิงเส้นโค้งดังรูป ในเบื้องต้นผู้วิเคราะห์สามารถคำนวณ Total SSE ของชุดข้อมูลดิบได้ดังนี้ <span class="math inline">\(Total \ SSE = \sum_{i=1}^{1000}(y_i-\bar{y})^2=692.299\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">runif</span>(<span class="dv">1000</span>,<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="fu">sin</span>(x), <span class="fl">0.5</span>) </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x,y)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y),<span class="at">col=</span><span class="st">"steelblue"</span>, <span class="at">alpha=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Total SSE = 692.299"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ขั้นตอนแรกของอัลกอริทึม decision tree แบบ binary recursive partitioning คือการหา root node ซึ่งทำได้ด้วยการพิจารณาเลือกคะแนนจุดตัดของตัวแปรอิสระที่เหมาะสม จากรูปด้านล่างผู้อ่านจะเห็นว่าการแบ่งส่วนย่อยของ feature space ด้วยจุดตัดที่แตกต่างกันจะทำให้ Total SSE ที่คำนวณจาก <span class="math inline">\(Total \ SSE = \sum_{i \in R_1}(y_i-c_1)^2+\sum_{i \in R_2}(y_i-c_2)^2\)</span> มีค่าแตกต่างกันไป เป้าหมายของอัลกอริทึม decision tree ในขั้นตอนนี้คือการจุดตัดที่ทำให้ค่า Total SSE ดังกล่าวมีค่าต่ำที่สุด ซึ่งจะหมายความว่าการแบ่งส่วนย่อยนั้นสามารถสร้าง decision tree ที่ทำนายค่าของตัวแปรตามได้ใกล้เคียงค่าจริงมากที่สุดเท่าที่จะเป็นไปได้</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ในความเป็นจริงอัลกอริทึม binary recursive partitioning จะพิจารณาค่า Total SSE ที่คำนวณจากจุดตัดทุกค่าที่เป็นไปได้บน feature space จากนั้นจะเลือกจุดตัดที่ทำให้ค่า Total SSE ต่ำที่สุดมาเป็นจุดแบ่งพื้นที่บน x หรือ feature space พื้นที่ที่เกิดขึ้นนี้จะเป็น terminal node สำหรับขั้นตอนนี้ ซึ่งจะมีจำนวน 2 terminal node ได้แก่ terminal node เมื่อ <span class="math inline">\(x &lt; 2.7\)</span> และ <span class="math inline">\(x \geq 2.7\)</span> โดยค่าเฉลี่ยของตัวแปรตาม y ใน terminal node <span class="math inline">\(x &lt; 2.7\)</span> มีค่าเท่ากับ 0.705 หน่วย และใน terminal node <span class="math inline">\(x≥2.7\)</span> พบว่าตัวแปรตาม y มีค่าเฉลี่ยเท่ากับ -0.137 หน่วย ซึ่งทำให้ค่า SSE ของแต่ละ terminal node มีค่าเท่ากับ 106.282 และ 427.451 ตามลำดับ และ Total SSE มีค่าเท่ากับ 533.733</p>
<p>ผู้อ่านจะสังเกตเห็นว่า Total SSE เมื่อมีการสร้าง root node แล้วมีค่าลดต่ำลงเมื่อเปรียบเทียบกับก่อนที่จะสร้าง root node โดย<strong>ความแตกต่างระหว่าง Total SSE ก่อนและภายหลังจากสร้าง root node มีค่าเท่ากับ 692.299 - 533.733 = 158.566 ผลต่างดังกล่าวเรียกว่า information gain</strong> หรือสารสนเทศที่ decision tree สามารถเรียนรู้ได้เพิ่มในแต่ละขั้นตอนของการเรียนรู้</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rpart'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dials':

    prune</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-66-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>เนื่องจากโมเดลข้างต้นยังมีความลำเอียงอยู่ในระดับที่สูงมาก ในมุมมองของอัลกอริทึมจะเห็นว่า information gain ในขั้นตอนก่อนหน้ายังมีค่าสูงอยู่ นั่นหมายความว่ายังมีโอกาสที่อัลกอริทึมจะสามารถเรียนรู้สารสนเทศจากข้อมูลเพิ่มเติมได้อีก อัลกอริทึม decision tree จะทวนซ้ำการดำเนินการข้างต้นอีกครั้งหนึ่ง โดยจะพิจารณาหาจุดตัดที่เหมาะสมภายในแต่ละ terminal nodes ซึ่งใช้เกณฑ์เดียวกันกับการหาจุดตัดในขั้นตอนการสร้าง root node ในข้างต้น รูปด้านล่างแสดงผลลัพธ์ที่ได้จากการทวนซ้ำอัลกอริทึมดังกล่าว ซึ่งจะเห็นว่ามีการแบ่ง terminal node <span class="math inline">\(x \geq 2.7\)</span> เดิมให้กลายเป็น terminal node ใหม่ โดยใช้จุดตัดที่ x = 6.1 ในขั้นตอนนี้ผู้อ่านจะเห็นว่า terminal node <span class="math inline">\(x \geq 2.7\)</span> เดิมจะเปลี่ยนสถานะเป็น internal node ของ decision tree แทน และ terminal node ของโมเดลทำนายจะมีเพิ่มขึ้นจากเดิม 2 nodes กลายเป็น 3 nodes</p>
<p>จากรูปด้านล่างจะเห็นว่าโมเดลทำนายในขั้นตอนนี้มีประสิทธิภาพในการทำนายมากขึ้น เมื่อเปรียบเทียบกับโมเดลที่มีแต่ root node ในขั้นตอนแรก โดยพบว่า terminal nodes ทั้ง 3 nodes ในโมเดลนี้มีค่า SSE เท่ากับ 106.282, 170.316 และ 73.372 ตามลำดับ ซึ่งจะมี Total SSE เท่ากับ 351.97 และเมื่อเปรียบเทียบกับโมเดล root node ก่อนหน้าจะได้ว่า information gain ของโมเดลทำนายนี้มีค่าเท่ากับ 533.733 - 351.97 = 181.763</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-67-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>การดำเนินการตามอัลกอริทึมข้างต้นจะดำเนินการทวนซ้ำไปเรื่อย ๆ จนกระทั่งค่า information gain ที่ได้จะมีค่าน้อยลู่เข้าสู่ 0 ซึ่งหมายความว่าโมเดลไม่สามารถเรียนรู้สารสนเทศใด ๆ จากข้อมูลได้เพิ่มเติมแล้ว รูปด้านล่างแสดงโมเดลทำนายภายหลังจากอัลกอริทึมดังกล่าวหยุดการดำเนินการทวนซ้ำแล้ว จะเห็นว่าการแบ่งส่วนย่อยตามอัลกอริทึม recursive binary partitioning ดังกล่าวทำให้ได้โมเดลทำนายที่สามารถเรียนรู้ความสัมพันธ์เชิงเส้นโค้งที่พบในข้อมูลได้อย่างมีประสิทธิภาพ</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-68-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="partitioning-classification-tree" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-classification-tree">Partitioning: Classification Tree</h3>
<p>สำหรับปัญหา classification การแบ่งส่วนย่อยดังกล่าวจะในทำนองเดียวกับ regression tree อย่างไรก็ตามการพิจารณาความคลาดเคลื่อนภายใน terminal node จะพิจารณาจากตัวบ่งชี้ที่รูปของดัชนีที่เรียกว่า <strong>impurity</strong> โดย decision tree จะเลือกแบ่งพื้นที่ภายใน feature space ที่ทำให้ค่า impurity ดังกล่าวมีค่าต่ำสุด ดัชนี impurity ที่สามารถใช้เป็นเกณฑ์มีหลายตัว เช่น</p>
<ul>
<li>Gini index = <span class="math inline">\(\sum p(1-p) = 1-\sum p^2\)</span></li>
<li>Entropy = <span class="math inline">\(-\sum plog(p)\)</span></li>
<li>Misclassification rate</li>
</ul>
<p>ดัชนี impurity ข้างต้นมีลักษณะเป็นการวัดความแปรปรวนหรือความแตกต่างกันภายใน node ซึ่งสอดคล้องกับความหมายของ SSE ใน regression tree ข้างต้น</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-2146096965.png" class="img-fluid figure-img" style="width:50.0%" alt="การแบ่งส่วนของ feature space"></p>
<p></p><figcaption class="figure-caption">การแบ่งส่วนของ feature space</figcaption><p></p>
</figure>
</div>
<p>จากรูปตัวอย่างด้านบนจะเห็นว่าเป็นปัญหา classification โดยเป็นการสร้างโมเดลจำแนกนักเรียนระหว่างกลุ่มที่สอบผ่านและสอบตก (สีส้ม และสีน้ำเงิน) โดยใช้ตัวแปรอิสระได้แก่ GPA และ SES เป็นตัวแปรทำนาย ดังนั้นในกรณีนี้ feature space หรือปริภูมิของตัวแปรอิสระจะประกอบด้วย GPA และ SES ที่สามารถ plot เป็นระนาบ 2 มิติได้ดังรูป</p>
<p>สมมุติว่าผู้วิเคราะห์ต้องการทำนาย deposit โดยใช้ตัวแปรอิสระจำนวน 3 ตัวได้แก่ default, housing และ loan ขั้นแรกของการพัฒนา decision tree คือการกำหนด root node ที่เหมาะสม คำถามคือ ควรใช้ตัวแปรอิสระตัวใดเป็น root node ดีเพราะเหตุใด?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1262716711.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
<p>การพิจารณาว่า root node ตัวใดเหมาะสมที่สุด สามารถพิจารณาได้จากความเป็นเอกพันธ์กันของค่าตัวแปรตามภายในกลุ่มย่อยที่แบ่งโดยตัวแปรอิสระ หรืออาจพิจารณาในทางกลับกันคือดูจากความไม่เป็นเอกพันธ์กันของค่าตัวแปรตามภายในกลุ่มย่อยดังกล่าว ความไม่เป็นเอกพันธ์นี้สามารถวัดได้โดยใช้สถิติในกลุ่มที่เรียกว่า impurity ดังที่ได้กล่าวไว้ข้างต้น</p>
<p>decision tree จะเลือกตัวแปรและจุดแบ่งที่ทำให้ค่า impurity ดังกล่าวมีค่าต่ำที่สุด เพราะนั่นจะหมายถึงตัวแปรและจุดแบ่งดังกล่าวจะทำให้ decision tree สามารถทำนายค่าของตัวแปรตามได้ดีที่สุด จากรูปด้านล่างแสดงการเปรียบเทียบค่า total impurity จากการแบ่ง 3 แบบคือ การแบ่งด้วย Default, Housing และ Loan ซึ่งจะเห็นว่าการแบ่งด้วย Housing ให้ค่า impurity ต่ำที่สุด ดังนั้นการแบ่ง Housing ดังในรูปจึงถูกเลือกเป็น partition ตัวแรกของอัลกอริทึม และจะเรียก Housing ว่า Root node</p>
<p><img src="images/image-1755337911.png" class="img-fluid" style="width:60.0%"></p>
<p>Laura Elena Raileanu and Kilian Stoffel, “<a href="https://www.unine.ch/files/live/sites/imi/files/shared/documents/papers/Gini_index_fulltext.pdf">Theoretical comparison between the Gini Index and Information Gain criteria</a>” Annals of Mathematics and Artificial Intelligence 41: 77–93, 2004.</p>
<p>จากการคำนวณ impurity ด้วย Gini index ข้างต้นจะเห็นว่า Housing เป็นตัวแปรอิสระที่ทำให้ impurity โดยรวมของการแบ่งส่วนย่อยทั้งสองส่วนมีค่าต่ำที่สุด จากเงื่อนไขในตัวอย่างที่กำหนดข้างต้น Housing จึงจะเป็นตัวแปรอิสระที่ถูกเลือกเป็น root node ก่อน ขั้นตอนถัดมาของอัลกอริทึมคือการพิจารณาหา internal nodes ที่จะแบ่งส่วนข้อมูลภายใต้เงื่อนไขของ root node แบ่งไว้ข้างต้น กล่าวง่าย ๆ คือ หาตัวแปรอิสระตัวอื่นมาแบ่งข้อมูลในแต่ละกิ่งของ root node ต่อ</p>
<p>รูปด้านล่างแสดงการเปรียบเทียบ impurity ของตัวแปรตาม (deposit) ที่เกิดขึ้นจากการแบ่งส่วนข้อมูลภายใต้เงื่อนไขที่ Housing = Yes จากรูปจะเห็นว่าเมื่อใช้ Default เป็นตัวแบ่งจะได้ค่า impurity เท่ากับ 0.9731 แต่ถ้าใช้ Loan เป็นตัวแบ่งจะได้ค่า impurity เป็น 0.1420 ระหว่างตัวแปรอิสระสองตัวนี้ผู้อ่านคิดว่าควรเลือกตัวแปรอิสระใดมาเป็น internal node ในตำแหน่งดังกล่าว</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1494665973.png" class="img-fluid figure-img" style="width:70.0%"></p>
</figure>
</div>
<p>การแบ่งส่วนข้อมูลในแต่ละครั้งจะทำให้ความไม่เป็นเอกพันธ์กันของข้อมูลลดลง เพราะข้อมูลจะถูกจัดระเบียบให้ข้อมูลที่มีคุณลักษณะที่คล้ายคลึงกันจะมาอยู่ภายใต้ node เดียวกัน ส่วนข้อมูลที่แตกต่างกันจะอยู่คนละ node ความไม่เป็นระเบียบหรือความไม่เป็นเอกพันธ์ที่ลดลงนี้แปรผกผันกับสารสนเทศที่โมเดลเรียนรู้ได้เพิ่มขึ้น เราเรียกปริมาณสารสนเทศที่โมเดลเรียนรู้ได้เพิ่มขึ้นว่า <strong>information gain</strong> ซึ่งสามารถคำนวณง่าย ๆ โดยใช้ผลต่างของค่า impurity ก่อน และหลังการแบ่ง ดังนี้</p>
<p><span class="math display">\[information \ gain = Gini(before) = Gini(after)\]</span></p>
<p><strong>จากรูปข้างต้นจะได้ว่า information gain ของตัวแปร Loan มีค่าเท่ากับ 0.1421 - 0.1420 = 0.0001</strong></p>
<p>การแบ่งในอัลกอริทึมข้างต้นจะดำเนินไปจนกระทั่ง information gain มีค่าต่ำที่สุดหรือเข้าใกล้ 0 ซึ่งหมายความว่าไม่มีสารสนเทศอะไรที่โมเดลสามารถเรียนรู้ได้แล้ว จุดเด่นของ decision tree คือสามารถเรียนรู้ความสัมพันธ์ที่ไม่ใช่เชิงเส้นตรงได้ นอกจากนี้ยังมีความแกร่งมากกว่าการวิเคราะห์การถดถอยเชิงเส้น และการวิเคราะห์การถดถอยแบบ logistic นอกจากนี้ decision tree ยังเป็นอัลกอริทึมการเรียนรู้ที่มีความสามารถในการคัดเลือกตัวแปรอิสระในตัวมันเอง <strong>(เพราะอะไร?)</strong></p>
</section>
</section>
<section id="data-preprocessing-สำหรบ-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing-สำหรบ-decision-tree">5.2 Data Preprocessing สำหรับ decision tree</h2>
<p>Decision tree แบบ recursive binary partitioning เป็นอัลกอริทึมที่มีความยืดหยุ่นต่อข้อมูลนำเข้ามาก กล่าวคือเป็นอัลกอริทึมที่ไม่มีข้อกำหนดเกี่ยวกับข้อมูลนำเข้า ผู้วิเคราะห์สามารถนำข้อมูลของตัวแปรอิสระเข้าสู่อัลกอริทึมได้โดยไม่จำเป็นต้องแปลงตัวแปรเชิงปริมาณให้อยู่ในสเกลมาตรฐาน และไม่จำเป็นต้องแปลงตัวแปรจัดประเภทให้เป็นตัวแปรดัมมี นอกจากนี้ decision tree ยังเป็นอัลกอริทึมที่มีความแกร่งต่อปัญหา multicollinerity และปัญหาตัวแปรอิสระไม่ให้สารสนเทศด้วย เนื่องจาก logic ของอัลกอริทึมที่จะคัดเลือกตัวแปรอิสระที่ให้จุดแบ่งพื้นที่ที่ทำให้ค่าความคลาดเคลื่อนรวมต่ำที่สุด decision tree ดังกล่าวจึงมีความสามารถในการคัดเลือกตัวแปรอิสระในตัวมันเอง ถือว่าเป็น feature selection ประเภท embedded method ตัวหนึ่ง</p>
</section>
<section id="hyperparameters-สำหรบ-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameters-สำหรบ-decision-tree">5.3 Hyperparameters สำหรับ decision tree</h2>
<p>decision tree ที่ใช้อัลกรอิทึมการเรียนรู้แบบ recursive binary partitioning สามารถประมวลผลบน tidymodels frameworks โดยใช้ engine rpart ทั้งนี้อัลกอริทึมดังกล่าวจะมี hyperparameters ที่สามารถปรับแต่งได้จำนวน 3 ตัวได้แก่</p>
<ul>
<li><p><code>cost_complexity</code> คือค่าคงที่ <span class="math inline">\(\alpha &gt; 0\)</span> เรียกว่า penalty term เมื่อมีการกำหนดค่านี้ฟังก์ชันวัตถุประสงค์ของ decision tree จะมีการเพิ่ม penalty term ดังกล่าวเข้ามาเป็นดังนี้ <span class="math inline">\(E_{reg}(T) = E(T)+\alpha|T|\)</span> โดยที่ <span class="math inline">\(E(T)\)</span> คือ total error หรือ total impurity ของ terminal nodes จากลักษณะของฟังก์ชันวัตถุประสงค์ดังกล่าวจะเห็นว่า <span class="math inline">\(\alpha\)</span> เป็น hyperparameter ที่จะทำให้ total error ดังกล่าวมีค่าสูงขึ้น ซึ่งทำให้การแบ่ง terminal nodes ทำได้ยากขึ้น ยิ่งกำหนดให้ <span class="math inline">\(\alpha\)</span> มีค่ามากขึ้น ความยากในการแบ่ง terminal nodes ก็จะยากขึ้นเรื่อย ๆ การกำหนด hyperparameter ดังกล่าวจึงเป็นการควบคุมไม่ให้ decision tree แบ่งส่วนพื้นที่ย่อยมากเกินไปจนทำให้เกิดปัญหา overfitting</p></li>
<li><p><code>tree_depth</code> ใช้กำหนดความลึกของต้นไม้ที่สูงที่สุดนับจาก root node ค่าเริ่มต้นคือ 30 การกำหนด hyperparameter ค่านี้จึงช่วยควบคุมความลึกหรือความซับซ้อนของโมเดลทำนายที่สร้างจาก decision tree โดยตรง</p></li>
<li><p><code>min_n</code> จำนวนหน่วยข้อมูลขั้นต่ำที่ต้องมีในแต่ละ terminal node ค่าเริ่มต้นคือ 20 การกำหนด hyperparameter นี้ทำให้อัลกอริทึมจะไม่สามารถแบ่ง terminal nodes จนมีขนาดเล็กเกินไปได้ เป็นการควบคุมความลึกหรือความซับซ้อนของโมเดลทำนายที่ได้จาก decision tree เช่นเดียวกัน</p></li>
</ul>
<p>ลองพิจาณา decision tree ที่มีการกำหนด hyperparameter ที่แตกต่างกันด้านล่าง จะเห็นว่าโมเดลทำนายที่ได้จะมีขนาดและความซับซ้อนที่แตกต่างกันไปขึ้นอยู่กับการกำหนด</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv"</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="dv">10</span>, <span class="at">cost_complexity =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(salary <span class="sc">~</span>., <span class="at">data=</span>dat)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="dv">10</span>, <span class="at">cost_complexity =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(salary <span class="sc">~</span>., <span class="at">data=</span>dat)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="dv">10</span>, <span class="at">cost_complexity =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(salary <span class="sc">~</span>., <span class="at">data=</span>dat)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>fit1<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">rpart.plot</span>(<span class="at">main =</span> <span class="st">"min_n=10, cost_complexity = 10^-5"</span>)</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>fit2<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">rpart.plot</span>(<span class="at">main =</span> <span class="st">"min_n=10, cost_complexity = 10^-3"</span>)</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>fit3<span class="sc">$</span>fit <span class="sc">%&gt;%</span> <span class="fu">rpart.plot</span>(<span class="at">main =</span> <span class="st">"min_n=10, cost_complexity = 10^-2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ปัญหาเกี่ยวกับการกำหนด hyperparameters ข้างต้นคือ ผู้วิเคราะห์ไม่สามารถประมาณค่าพารามิเตอร์ดังกล่าวจากข้อมูลได้โดยตรง การกำหนดค่าที่เหมาะสมให้กับ hyperparameters ดังกล่าวจะใช้ validation dataset ที่สร้างขึ้นจากกระบวนการสุ่มซ้ำ (resampling) มาช่วยในการประมาณค่าความคลาดเคลื่อนของโมเดลทำนาย (เรียกว่า validation error) เมื่อมีการกำหนด hyperparameters เป็นค่าต่าง ๆ จากนั้นทำการวิเคราะห์ผลโดยเลือกชุดของค่า hyperparameters ที่ทำให้ validation error มีค่าต่ำที่สุดไปใช้ในโมเดล เรียกกระบวนการนี้ว่า hyperparameter tuning</p>
</section>
<section id="hyperparameter-tuning-using-tidymodels-workflow" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameter-tuning-using-tidymodels-workflow">5.4 Hyperparameter tuning using tidymodels Workflow</h2>
<p>บทเรียนนี้จะกล่าวถึงหลักและวิธีการปรับแต่ง hyperparameter ของอัลกอริทึมการเรียนรู้ โดยจะใช้อัลกอริทึม decision tree เป็นตัวอย่าง โดยจะสร้างโมเดลทำนายเงินเดือนครู ข้อมูลที่ใช้ได้จาก <code>classification.csv</code> รายละเอียดมีดังนี้</p>
<section id="hyperparameter-tuning" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameter-tuning">Hyperparameter Tuning</h3>
<p>ดังที่ได้กล่าวไปก่อนหน้านี้แล้วว่า hyperparameter เป็นพารามิเตอร์ในอัลกอริทึมการเรียนรู้ที่ไม่สามารถประมาณค่าได้โดยตรง ดังนั้นกระบวนการกำหนดค่า hyperparameter ให้เหมาะสมจึงจะใช้เทคนิคการสุ่มซ้ำ (reampling) เข้ามาช่วย ซึ่งมีขั้นตอนการดำเนินการดังนี้</p>
<ol type="1">
<li>นำชุดข้อมูลฝึกหัดที่จะใช้พัฒนาโมเดลมาแบ่งออกเป็นสองส่วนด้วยวิธีการสุ่มซ้ำ (หรือ random sampling with replacement) ส่วนแรกจะเรียกว่า training data และส่วนที่สองจะเรียกว่า validation data</li>
<li>การสุ่มซ้ำในข้อ 1. สามารถทำได้หลายวิธีการ เช่น การทำ k-folds CV หรือการทำ bootstrapping โดยปกติ bootstrapping เป็นวิธีการที่มีแนวโน้มจะให้ผลการประมาณประสิทธิภาพการทำนายของโมเดลที่แม่นยำกว่า k-folds CV แต่เหมาะสำหรับสถานการณ์ที่ผู้วิเคราะห์มีชุดข้อมูลฝึกหัดที่มีขนาดใหญ่ ในกรณีที่ชุดข้อมูลฝึกหัดมีขนาดเล็กควรเลือกใช้ k-folds CV</li>
<li>กำหนดโมเดลการเรียนรู้ที่ใช้ และกำหนดค่า hyperparameters ที่ต้องการปรับแต่ง</li>
<li>สร้าง grid ของ hyperparameters เพื่อใช้ทดลองกำหนดให้กับโมเดล การสร้าง grid ดังกล่าวอาจทำได้สองวิธีการ วิธีการแรกเรียกว่า regular grid เป็นการสร้าง grid จาก combination ทั้งหมดของค่า hyperparameter ที่เป็นไปได้ ส่วนวิธีการที่สองเรียกว่า random grid ที่การสุ่มตัวอย่างของ grid combination มาทำการศึกษา</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1368790715.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">https://community.alteryx.com/t5/Data-Science/Hyperparameter-Tuning-Black-Magic/ba-p/449289</figcaption><p></p>
</figure>
</div>
<ol start="5" type="1">
<li>นำ hyperparameter แต่ละชุดภายใน grid ที่กำหนดไว้ในข้อ 4. (ในที่นี้สมมุติจะเรียกว่าชุด A) กำหนดให้กับอัลกอริทึมจากนั้นดำเนินการประมวลผลกับชุดข้อมูลฝึกหัดเพื่อสร้างโมเดลทำนาย</li>
<li>เมื่อได้โมเดลทำนายในข้อ 5. จะนำโมเดลไปใช้ทำนายหรือจำแนกข้อมูลใน validation data แล้วคำนวณเป็นค่าประสิทธิภาพการทำนาย</li>
<li>สลับชุดข้อมูล training และ validation จากนั้นทวนซ้ำข้อ 5 และ 6 จนครบ ค่าเฉลี่ยของประสิทธิภาพที่ได้จะเป็นประสิทธิภาพจากการกำหนด hyperparameter ชุด A</li>
<li>เปลี่ยน hyperparamter เป็นชุดต่อไปแล้วทวนซ้ำข้อ 5 - 7</li>
<li>นำค่าประมาณประสิทธิภาพของ hyperparameter แต่ละชุดมาเปรียบเทียบกัน แล้วเลือกชุดของ hyperparameter ที่มีประสิทธิภาพสูงที่สุดเป็นค่า hyperparameter ของโมเดล</li>
</ol>
<p>การดำเนินการข้างต้นสามารถทำได้ใน tidymodels ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/classification.csv"</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>Class)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>dat[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dat, <span class="at">prop =</span> <span class="fl">0.8</span>,<span class="at">strata =</span> Class)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="do">## recipe</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>class_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Class <span class="sc">~</span> . , <span class="at">data=</span>train)<span class="sc">%&gt;%</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_string2factor</span>(Class, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"drop"</span>,<span class="st">"stay"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>train_preproc <span class="ot">&lt;-</span> class_rec <span class="sc">%&gt;%</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>test_preproc <span class="ot">&lt;-</span> class_rec <span class="sc">%&gt;%</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> test)</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>train_preproc_resamples <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_preproc,</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">v=</span><span class="dv">5</span>,</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">repeats=</span><span class="dv">1</span>)</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a><span class="do">## model specification</span></span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="fu">tune</span>())<span class="sc">%&gt;%</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a><span class="do">## create workflow</span></span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a>tree_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(class_rec) <span class="sc">%&gt;%</span></span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_mod)</span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a><span class="do">## create grid</span></span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">parameters</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min_n</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">40</span>)))</span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a>regular_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(p, <span class="at">levels=</span><span class="dv">5</span>)</span>
<span id="cb135-36"><a href="#cb135-36" aria-hidden="true" tabindex="-1"></a>eval_metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(roc_auc,sens, spec)</span>
<span id="cb135-37"><a href="#cb135-37" aria-hidden="true" tabindex="-1"></a>clt <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, </span>
<span id="cb135-38"><a href="#cb135-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb135-39"><a href="#cb135-39" aria-hidden="true" tabindex="-1"></a>                    <span class="at">parallel_over =</span> <span class="st">"everything"</span>)</span>
<span id="cb135-40"><a href="#cb135-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-41"><a href="#cb135-41" aria-hidden="true" tabindex="-1"></a>tune_mod <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb135-42"><a href="#cb135-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> train_preproc_resamples,</span>
<span id="cb135-43"><a href="#cb135-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> regular_grid,</span>
<span id="cb135-44"><a href="#cb135-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> eval_metric,</span>
<span id="cb135-45"><a href="#cb135-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> clt</span>
<span id="cb135-46"><a href="#cb135-46" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb135-47"><a href="#cb135-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-48"><a href="#cb135-48" aria-hidden="true" tabindex="-1"></a>tune_mod <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span>
<span id="cb135-49"><a href="#cb135-49" aria-hidden="true" tabindex="-1"></a>best<span class="ot">&lt;-</span><span class="fu">show_best</span>(tune_mod, <span class="at">n=</span><span class="dv">30</span>, <span class="at">metric=</span><span class="st">"sens"</span>)</span>
<span id="cb135-50"><a href="#cb135-50" aria-hidden="true" tabindex="-1"></a>best</span>
<span id="cb135-51"><a href="#cb135-51" aria-hidden="true" tabindex="-1"></a>final_tree <span class="ot">&lt;-</span> tree_workflow <span class="sc">%&gt;%</span></span>
<span id="cb135-52"><a href="#cb135-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best[<span class="dv">1</span>,]) <span class="sc">%&gt;%</span></span>
<span id="cb135-53"><a href="#cb135-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(split,</span>
<span id="cb135-54"><a href="#cb135-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">metrics =</span> eval_metric)</span>
<span id="cb135-55"><a href="#cb135-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-56"><a href="#cb135-56" aria-hidden="true" tabindex="-1"></a><span class="do">### visualizing tree model</span></span>
<span id="cb135-57"><a href="#cb135-57" aria-hidden="true" tabindex="-1"></a>final_tree<span class="sc">$</span>.workflow[[<span class="dv">1</span>]]<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit <span class="sc">%&gt;%</span> </span>
<span id="cb135-58"><a href="#cb135-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>()</span>
<span id="cb135-59"><a href="#cb135-59" aria-hidden="true" tabindex="-1"></a>final_tree <span class="sc">%&gt;%</span></span>
<span id="cb135-60"><a href="#cb135-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">%&gt;%</span></span>
<span id="cb135-61"><a href="#cb135-61" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rpart.plot</span>(<span class="at">roundint=</span>F)</span>
<span id="cb135-62"><a href="#cb135-62" aria-hidden="true" tabindex="-1"></a><span class="do">### Evaluate performance on test datset</span></span>
<span id="cb135-63"><a href="#cb135-63" aria-hidden="true" tabindex="-1"></a>final_tree <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="บทท-7-regularized-regression" class="level1">
<h1>บทที่ 7 : Regularized Regression</h1>
<p>Linear regression เป็นโมเดลทำนายที่มีจุดเด่นคือเป็นโมเดลอย่างง่ายที่นอกจากจะใช้ทำนายแนวโน้มของตัวแปรอิสระได้แล้ว ยังสามารถใช้ในการอธิบายความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระได้ง่ายและชัดเจนกว่าการใช้โมเดลการเรียนรู้อื่น ๆ อย่างไรก็ตามการใช้งาน linear regression นั้นอยู่ภายใต้ข้อจำกัดหรือข้อตกลงเบื้องต้นที่เคร่งครัดหลายตัว ซึ่งหากข้อตกลงเบื้องต้นดังกล่าวไม่เป็นจริงแล้วการทำนายหรือการอธิบายความสัมพันธ์ด้วย linear regression ก็อาจจะมีปัญหาและขาดความน่าเชื่อถือ</p>
<p>บทเรียนนี้จะ focus ไปที่ปัญหาหนึ่งที่สำคัญและเกิดขึ้นบ่อยในการพัฒนาโมเดลทำนายทั้งใน linear regression และอัลกอริทึมอื่น ๆ คือการที่โมเดลทำนายมีจำนวนตัวแปรอิสระหรือเทอมของตัวแปรอิสระมากเกินไป สถานการณ์ดังกล่าวอาจก่อให้เกิดปัญหาในเชิงเทคนิคหลายประการ ดังนี้</p>
<ol type="1">
<li>overfitting model กล่าวคือการมีตัวแปรอิสระหรือเทอมของตัวแปรอิสระ เช่น เทอมพหุนาม (polynomial) หรือเทอมปฏิสัมพันธ์ (interaction) จำนวนมากเกินไปภายในโมเดล ย่อมทำให้โมเดลเรียนรู้ความสัมพันธ์ในชุดข้อมูลฝึกหัดดีเกินไป และก่อให้เกิดปัญหา overfitting ได้</li>
<li>infinite solution ปัญหานี้เป็นปัญหาเชิงเทคนิค กล่าวคือผู้วิเคราะห์มีจำนวนตัวแปรอิสระหรือเทอมของตัวแปรอิสระ (จำนวนคอลัมน์) ที่ต้องการนำเข้าสู่โมเดลมากกว่าจำนวนหน่วยข้อมูล (จำนวนแถว) สถานการณ์ดังกล่าวทำให้ไม่สามารถหาคำตอบเดียวของค่าประมาณพารามิเตอร์ภายในโมเดลทำนายได้</li>
<li>multicollinearity ปัญหานี้เป็นปัญหาในเชิงเทคนิคที่เกิดขึ้นเมื่อผู้วิเคราะห์มีตัวแปรอิสระจำนวนมากในโมเดล โดยที่ตัวแปรอิสระดังกล่าวมีความซ้ำซ้อนกัน (redundant) กล่าวคือมีความสัมพันธ์ซึ่งกันและกันเองสูงเกินไป สถานการณ์เช่นนี้จะทำให้การประมาณค่าพารามิเตอร์ในโมเดลมีแนวโน้มที่จะไม่เสถียร (unstable solution) ส่งผลให้โมเดลทำนายที่ได้มีความไม่เสถียรตามไปด้วย โมเดลทำนายที่ได้จากสถานการณ์ดังกล่าวจึงจะขาดความน่าเชื่อถือ</li>
</ol>
<p>ในบทที่ 6 เราได้กล่าวถึงการคัดเลือกตัวแปรอิสระเข้าสู่โมเดลด้วยวิธีในกลุ่ม wrapper method ซึ่งผู้อ่านจะเห็นว่าวิธีการดังกล่าวนั้นมีข้อจำกัดสำคัญคือ เป็นวิธีที่ใช้ข้อมูลจากชุดข้อมูลฝึกหัดในการคัดเลือกตัวแปรอิสระแต่เพียงอย่างเดียว ซึ่งอาจทำให้มีความเสี่ยงสูงที่การพัฒนาโมเดลทำนายภายใต้ผลการคัดเลือกตัวแปรอิสระดังกล่าวจะมีปัญหา overfitting ตามมา บทเรียนนี้จะกล่าวถึงเทคนิค regularization ที่สามารถทำมาใช้เพื่อแก้ปัญหาดังกล่าว ปัจจุบันมีการนำเทคนิคนี้ไปใช้ในหลายโมเดลทั้ง linear regression, decision tree ไปจนถึง neural network โดยในบทเรียนนี้จะกล่าวถึงมโนทัศน์สำคัญของการทำ regularization และการนำเทคนิค regularization ไปใช้ในอัลกอริทึม linear regression รายละเอียดมีดังนี้</p>
<section id="มโนทศนสำคญของ-regularized-regression" class="level2">
<h2 class="anchored" data-anchor-id="มโนทศนสำคญของ-regularized-regression">7.1 มโนทัศน์สำคัญของ regularized regression</h2>
<p>concept ของ regularization เป็นเรื่องเกี่ยวกับการปรับสมดุลของโมเดลทำนายเพื่อลดทอนหรือแก้ปัญหา overfitting และ/หรือ ปัญหาตัวอย่างอิสระ สำหรับโมเดล linear regression การปรับสมดุลดังกล่าวจะเป็นการปรับค่าสัมประสิทธิความชันของสมการถดถอยให้น้อยลงเพื่อ<strong>ลดหรือลบ</strong>ผลกระทบของตัวแปรอิสระบางตัวออกจากโมเดลอย่างเหมาะสม</p>
<p>เพื่อให้ผู้อ่านเห็นภาพและเข้าใจมโนทัศน์ของ regularization ได้อย่างชัดเจน อยากให้ผู้อ่านลองพิจารณาตัวอย่างง่าย ๆ ต่อไปนี้</p>
<p>สมมุติว่าผู้วิเคราะห์ต้องการสร้างโมเดลทำนายคะแนนผลสัมฤทธิ์ทางการเรียนของนักเรียน (ACH) โดยใช้จำนวนชั่วโมงการทบทวนบทเรียนต่อสัปดาห์ของนักเรียน (HOUR) เป็นตัวแปรทำนาย แผนภาพการกระจายด้านล่าง (พิจารณาเฉพาะจุด) จะเห็นว่าความสัมพันธ์ระหว่างตัวแปรทั้งสองมีลักษณะเป็นความสัมพันธ์เชิงเส้น (linear relationship) ที่ค่อนข้างชัดเจน ในกรณีนี้ผู้วิเคราะห์จึงเลือกใช้อัลกอริทึม linear regression เป็นอัลกอริทึมการเรียนรู้ เพื่อสร้างโมเดลทำนายที่ต้องการ</p>
<p>การสร้างโมเดลทำนายด้วย linear regression อัลกอริทึมจะพยายามหาสมการเส้นตรงที่ดีที่สุด โดยการคัดเลือกชุดของสัมประสิทธิ์การถดถอย (จุดตัดแกน y และความชัน) ที่ทำให้ฟังก์ชันวัตถุประสงค์ (objective function) มีค่าสูงหรือต่ำที่สุด โดยทั่วไปฟังก์ชันวัตถุประสงค์มักใช้เป็น sum squared error (SSE) การหาค่าประมาณของสัมประสิทธิ์ถดถอยดังกล่าวจึงเป็นการหาค่าที่ทำให้ SSE มีค่าต่ำที่สุด</p>
<p>การหาค่าประมาณพารามิเตอร์ดังกล่าวสามารถทำได้หลายวิธีการ วิธีการแรกที่มักใช้กันในฝั่ง data analysis คือการใช้การ optimization ด้วย first และ second order derivative (ใช้ขั้นตอนวิธีของ calculas) ในโมเดล linear regression ทั่วไปวิธีการนี้สามารถให้สูตรปิดของการหาค่าประมาณสัมประสิทธิ์การถดถอยดังกล่าวได้ อีกวิธีการหนึ่งคือการใช้อัลกอริทึมเชิงตัวเลข (numerical algorithm) เรียกว่า gradient descent หรือ stochastic gradient descent ซึ่งเป็นกระบวนการทวนซ้ำเพื่อหาชุดของสัมประสิทธิ์การถดถอยที่เหมาะสมที่สุดโดยอิงจากค่าของฟังก์ชันวัตถุประสงค์ที่กำหนด</p>
<p>เมื่อกำหนดให้ข้อตกลงเบื้องต้นอื่น ๆ ของ linear regression เป็นจริง และตัวแปรอิสระที่เลือกเข้าสู่โมเดลเป็นตัวแปรอิสระที่มีคุณภาพ กล่าวคือ (1) ให้สารสนเทศในการทำนายตัวแปรตาม และ (2) ไม่ซ้ำซ้อนกันเองกับตัวแปรอิสระอื่น ๆ โมเดลทำนายที่ได้จากอัลกอริทีมจะมีคุณสมบัติที่ดีในทางสถิติกล่าวคือมีความไม่ลำเอียงและมีความแปรปรวนต่ำที่สุด หนังสือสถิติจะเขียนว่าตัวประมาณที่ได้จาก OLS regression เป็นตัวประมาณ BLUE ซึ่งย่อมาจาก Best Linear Unbised Estimator (สามารถพิสูจน์ได้โดยใช้ Gauss-Markov Theorem)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-676691868.png" class="img-fluid figure-img" style="width:70.0%"></p>
<p></p><figcaption class="figure-caption">Least Squared Regression</figcaption><p></p>
</figure>
</div>
<p>โดยปกติ linear regression เป็นโมเดลที่ง่ายที่สุดสำหรับทำนาย กล่าวคือเป็นโมเดลที่มีแนวโน้มจะมีประสิทธิภาพในการทำนายที่ไม่สูงมากนัก แต่จุดเด่นคือมีความยืดหยุ่นในการนำไปใช้ทำนายชุดข้อมูลอื่นนอกเหนือจากชุดข้อมูลฝึกหัดสูง linear regression อย่างไรก็ตามหากหากชุดข้อมูลฝึกหัดไม่ได้เป็นตัวแทนที่ดีของประชากร หรือในขั้นตอนของการพัฒนาโมเดลผู้วิเคราะห์มีการใส่ตัวแปรอิสระหรือเทอมของตัวแปรทำนาย เช่น polynomial หรือ interaction terms ที่ไม่ให้สารสนเทศจำนวนมากเข้าไปในโมเดล สถานการณ์เช่นนี้มักเพิ่มโอกาสที่โมเดลจะเกิดปัญหา overfitting ซึ่งทำให้โมเดลทำนายที่พัฒนาได้นั้นไม่สามารถทำนายชุดข้อมูลทดสอบหรือข้อมูลอื่น ๆ ที่อยู่นอกเหนือชุดข้อมูลฝึกหัดได้อย่างมีประสิทธิภาพ</p>
<p>รูปด้านล่างแสดงสภาพของปัญหา overfitting ที่เกิดขึ้นในโมเดลทำนาย ACH ด้วย HOUR ดังกล่าว จากรูปเมื่อพิจารณาจุดและเส้นโมเดลทำนาย (สีเขียว) จะพบว่าโมเดลเรียนรู้ความสัมพันธ์ระหว่างตัวแปรทั้งสองในชุดข้อมูลฝึกหัดได้ดี แต่เมื่อนำโมเดลดังกล่าวไปใช้ทำนาย ACH ในชุดข้อมูลทดสอบจะพบว่า สมการทำนายเส้นสีเขียวกลายเป็นสมการที่ไม่เหมาะสมในกรณีทั่วไป โดยจะให้ค่าความคลาดเคลื่อนในการทำนาย (SSE) ของชุดข้อมูลทดสอบที่สูงมากกว่า SSE ในชุดข้อมูลฝึกหัดค่อนข้างมาก เส้นสมการทำนายที่เหมาะสมควรเป็นสมการเส้นสีเทาในรูปมากกว่า</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-849757700.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ปัญหา overfitting</figcaption><p></p>
</figure>
</div>
<p>การแก้ปัญหาดังกล่าวผู้วิเคราะห์จะต้องปรับแต่งโมเดลการทำนายใหม่ให้มีความสมดุลในการทำนายชุดข้อมูลที่ไม่รู้จักได้มากขึ้น เทคนิค regularization ถูกพัฒนาขึ้นเพื่อใช้สำหรับการปรับแต่งโมเดลทำนายดังกล่าว คำถามคือการปรับแต่งโมเดลทำนายนั้นควรดำเนินการอย่างไร?</p>
<p>รูปด้านล่างแสดงแนวคิดหลักของ regularization จากรูปจะเห็นว่าโมเดลทำนายเส้นสีเขียวนั้นเกิดปัญหา overfitting ขึ้นกล่าวคือ โมเดลทำนายดังกล่าวเรียนรู้ความสัมพันธ์ในชุดข้อมูลฝึกหัด (จุดสีเขียว) ได้ดีมากเกินไป กล่าวคือโมเดลทำนายนี้มีความแปรปรวนสูงมากเกินไปนั่นเอง จากมโนทัศน์เกี่ยวกับ bias &amp; variance trace-off เราทราบว่าความลำเอียงกับความแปรปรวนของโมเดลทำนายนั้นมีความสัมพันธ์ที่ผกผันกัน โดยโมเดลที่มีความลำเอียงต่ำมีแนวโน้มที่จะมีความแปรปรวนสูง ในทางกลับกันโมเดลที่มีความลำเอียงสูงก็มีแนวโน้มที่จะมีความแปรปรวนต่ำ ดังนั้นจากความสัมพันธ์นี้หากผู้วิเคราะห์มีโมเดลทำนายที่มีความแปรปรวนสูง ผู้วิเคราะห์อาจปรับแต่งโมเดลทำนายดังกล่าวให้มีความแปรปรวนต่ำลงได้ด้วยการเพิ่มความลำเอียงให้กับโมเดลทำนายดังกล่าวอย่างเหมาะสม ดังตัวอย่างในรูป (b) ด้านล่าง</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-343319787.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">main idea ของ regularization</figcaption><p></p>
</figure>
</div>
<p>สำหรับ linear regression สามารถใส่ความลำเอียงให้กับโมเดลทำนายได้ในขั้นตอนของการหาค่าประมาณพารามิเตอร์ของโมเดล โดยปรับสูตรของฟังก์ชันวัตถุประสงค์ใหม่จากเดิม <span class="math inline">\(SSE = \sum_{i=1}^n(y_i-\hat{y}_i)^2\)</span> เป็น</p>
<p><span class="math display">\[
SSE_{reg}=\sum_{i=1}^n(y_i-\hat{y}_i)^2 + P = SSE + P
\]</span></p>
<p>เรียกเทอม <span class="math inline">\(P\)</span> ในสมการข้างต้นว่า penality term หนังสือบางเล่มเลยอาจใช้ชื่อ penalized regression แทน regularized regression ผู้อ่านลองสังเกตการบวกเทอม <span class="math inline">\(P\)</span> ดังกล่าวในฟังก์ชันวัตถุประสงค์ โดยจะเห็นว่าเมื่อ <span class="math inline">\(P&gt;0\)</span> จะทำให้ค่า <span class="math inline">\(SSE_{reg} &gt; SSE\)</span> ซึ่งเป็นการทำให้ค่าประมาณพารามิเตอร์ได้แก่ สัมประสิทธิจุดตัดแกน และความชันในโมเดลทำนายนั้น มีแนวโน้มที่มีความลำเอียงมากกว่าโมเดลทำนายที่ไม่ได้ใส่ penalty term ดังกล่าว ซึ่งหากใส่อย่างเหมาะสมจะช่วยลดความแปรปรวนของโมเดลทำนายได้อย่างที่ได้กล่าวไปแล้ว</p>
<p>ค่า<span class="math inline">\(P\)</span> ดังกล่าวไม่ใช่พารามิเตอร์ที่สามารถประมาณได้โดยตรงจากข้อมูล กล่าวคือเป็น hyperparameter ที่ต้องกำหนดโดยผู้วิเคราะห์ก่อนที่จะดำเนินการประมาณค่าพารามิเตอร์ของโมเดล <strong>คำถามใหญ่ของการทำ regularization จึงเกิดขึ้นว่า</strong> <strong>การกำหนดค่า</strong> <span class="math inline">\(P\)</span> <strong>ดังกล่าวให้เหมาะสมควรดำเนินการอย่างไร?</strong></p>
<p>แนวคิด regularization ดังกล่าวสามารถนำไปประยุกต์ใช้กับอัลกอริทึมการเรียนรู้ได้อีกหลายตัว เช่น ใน regularized logistic regression ฟังก์ชันวัตถุประสงค์จะสามารถเขียนได้เป็น <span class="math inline">\(lnL + P\)</span> เมื่อ <span class="math inline">\(lnL\)</span> คือ log-likelihood function ของโมเดล หรือใน decision tree (มักเรียกว่า pruning tree) ฟังก์ชันวัตถุประสงค์จะเขียนได้เป็น <span class="math inline">\(R_{reg}(T) = R(T) + \alpha|T|\)</span> โดยที่ <span class="math inline">\(R(T)\)</span> คือ training error ของ decision tree ที่มีจำนวน terminal nodes เท่ากับ <span class="math inline">\(T\)</span> และจะเรียก <span class="math inline">\(\alpha\)</span> ว่า cost complexity hyperparameter</p>
</section>
<section id="ประเภทของ-regularization" class="level2">
<h2 class="anchored" data-anchor-id="ประเภทของ-regularization">7.2 ประเภทของ Regularization</h2>
<p>การกำหนดค่า <span class="math inline">\(P\)</span> ให้กับฟังก์ชันวัตถุประสงค์ในข้างต้นอาจดำเนินการโดยจำแนกได้เป็น 3 วิธี ดังนี้</p>
<ol type="1">
<li>Ridge regression</li>
<li>Lasso regression</li>
<li>Elastic-Net regression</li>
</ol>
<section id="ridge-regression" class="level3">
<h3 class="anchored" data-anchor-id="ridge-regression">Ridge Regression</h3>
<p>ฟังก์ชันวัตถุประสงค์ของ regularized regression ประเภท ridge regression สามารถเขียนได้ดังนี้</p>
<p><span class="math display">\[
SSE_{ridge} = SSE+\lambda\sum_{j=1}^kb_j^2
\]</span></p>
<p>จากสมการข้างต้นจะเห็นว่า <span class="math inline">\(P = \lambda\sum_{j=1}^kb_j^2\)</span> คือ penalty term ในกรณีนี้จะเรียกว่า ridge regression penalty หรือหนังสือบางเล่มอาจจะเรียกว่า L2 norm การกำหนด penalty term ดังกล่าวทำให้เกิดผลอย่างไรต่อการพัฒนาโมเดลทำนาย สามารถทำความเข้าใจง่าย ๆ ได้จากการพิสูจน์ด้านล่าง ผู้อ่านจะเห็นว่าตัวประมาณของสัมประสิทธิ์การถดถอยใน ridge regression จะมีเทอม <span class="math inline">\(\lambda\)</span> เพิ่มเข้ามาในเทอมตัวหาร เมื่อเปรียบเทียบกับ linear regression แบบ OLS ธรรมดา ผู้อ่านจะเห็นได้อย่างชัดเจนว่าเมื่อ <span class="math inline">\(\lambda = 0\)</span> ค่าประมาณของสัมประสิทธิ์ความชันจากทั้งสองวิธีการจะเท่ากัน แต่เมื่อกำหนดให้ <span class="math inline">\(\lambda&gt;0\)</span> ค่าประมาณของสัมประสิทธิ์ความชันที่ได้จาก ridge regression จะมีแนวโน้มที่ลดลงต่ำกว่า ols regression อย่างไรก็ตามหากลองพิจารณา <span class="math inline">\(lim_{\lambda \rightarrow \infty}\frac{\sum x_iy_i}{\sum x_i^2+\lambda}\)</span> จะพบว่าค่าสัมประสิทธิ์ความชันของ ridge regression จะมีค่าลู่เข้าใกล้ 0 แต่จะไม่เท่ากับ 0</p>
<p><img src="images/image-75951276.png" class="img-fluid"></p>
<p>จากผลในข้างต้นจะเห็นว่า ridge regression เป็นเทคนิคที่ช่วยปรับขนาดของสัมประสิทธิ์ความชันของตัวแปรอิสระในโมเดลให้มีค่าลดลง แต่จะไม่ได้ทำให้เป็น 0 ดังนั้นตัวแปรอิสระทั้งหมดที่ผู้วิเคราะห์นำเข้าในอัลกอริทึมตอนแรกนั้นจะอยู่ในโมเดลทำนายครบทุกตัว แต่จะถูกปรับลดขนาดของค่าสัมประสิทธิ์ความชันลง ดังนั้น ridge regression จึงไม่ใช่เทคนิคสำหรับคัดเลือกตัวแปรอิสระ แต่เป็นเทคนิคที่เหมาะสำหรับแก้ปัญหา multicollinearity มากกว่า ดังนั้น ridge regression จึงเหมาะที่จะใช้ในสถานการณ์ที่ผู้วิเคราะห์มีตัวแปรอิสระจำนวนมากและตัวแปรดังกล่าวมีความสัมพันธ์กันเองสูงหรือมีความซ้ำซ้อนกัน แต่ผู้วิเคราะห์ไม่ต้องการที่จะตัดตัวแปรอิสระตัวใดออกจากโมเดลทำนาย อัลกอริทึม ridge regression จะช่วยให้ผู้วิเคราะห์สามารถสร้างโมเดลทำนายที่มีตัวแปรอิสระทั้งหมดอยู่ภายในโมเดลโดยหลีกเลี่ยงหรือลดทอนผลกระทบที่เกิดจากปัญหา multicollinearity ได้</p>
<p>ข้อสังเกตหนึ่งคือถึงแม้ว่าในชุดข้อมูลของผู้วิเคราะห์จะมีตัวแปรอิสระที่ไม่ให้สารสนเทศในการทำนายอยู่ด้วย แต่ ridge regression ก็จะไม่ได้ตัดตัวแปรอิสระดังกล่าวออกจากโมเดล ภายใต้สถานการณ์ดังกล่าวการใช้อัลกอริทึม ridge regression ก็จะไม่เหมาะสมควรเปลี่ยนไปใช้ lasso หรือ elastic-net regression มากกว่า</p>
</section>
<section id="lasso-regression" class="level3">
<h3 class="anchored" data-anchor-id="lasso-regression">Lasso Regression</h3>
<p>Lasso regression เป็นอัลกอริทึมที่ถูกพัฒนาขึ้นโดยมีวัตถุประสงค์หลักคือการคัดเลือกตัวแปรอิสระ (feature selection) เข้าสู่โมเดลทำนาย อัลกอริทึมนี้เป็น feature selection ที่จัดอยู่ในกลุ่ม embedded method กล่าวคือเป็นอัลกอริทึมการเรียนรู้ที่มีอัลกอริทึมของการคัดเลือกตัวแปรอิสระรวมอยู่ในขั้นตอนการประมาณค่าพารามิเตอร์ของโมเดล หลักการของ lasso regression เหมือนกับ ridge regression แต่มีการใช้ penalty term ในฟังก์ชันวัตถุประสงค์ที่แตกต่างออกไปดังนี้</p>
<p><span class="math display">\[
SSE_{lasso} = SSE+\lambda\sum_{j=1}^k |b_j|
\]</span></p>
<p>จะเห็นว่ามีการเปลี่ยนแปลงจากการใช้ฟังก์ชันกำลังสองเป็นค่าสมบูรณ์ใน penalty term ผลกระทบที่เกิดขึ้นกับโมเดลทำนายเมื่อใช้ penalty term ดังกล่าวสามารถอธิบายได้โดยใช้การพิสูจน์ง่าย ๆ ด้านล่าง ผู้อ่านจะเห็นว่าตัวประมาณของสัมประสิทธิ์ความชันในโมเดลทำนายมีรูปแบบที่เปลี่ยนแปลงไปจาก ridge regression โดยเทอม <span class="math inline">\(\lambda\)</span> ไม่ได้อยู่ในส่วนของตัวเศษแล้ว แต่ขึ้นมาอยู่ที่ตัวเศษแทน ดังนั้นการกำหนด <span class="math inline">\(\lambda\)</span> ที่เหมาะสมจึงสามารถทำให้ค่าสัมประสิทธิ์ความชันดังกล่าวมีค่าเท่ากับ 0 ได้ ซึ่งหมายถึงการตัดตัวแปรอิสระดังกล่าวออกจากโมเดลทำนาย ด้วยหลักการดังกล่าวอัลกอริทึม lasso regression จึงสามารถคัดเลือกตัวแปรอิสระเข้าสู่โมเดลได้ด้วยการกำหนดค่า <span class="math inline">\(\lambda\)</span> ดังกล่าว</p>
<p><img src="images/image-1836348765.png" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="elastic-net-regression" class="level3">
<h3 class="anchored" data-anchor-id="elastic-net-regression">Elastic-Net Regression</h3>
<p>อัลกอริทึมนี้เป็นการผสมกันระหว่าง ridge และ lasso regression จึงเป็นอัลกอริทึมที่สามารถใช้ทั้งแก้ปัญหา multicollineatiry และคัดเลือกตัวแปรอิสระไปพร้อม ๆ กัน ฟังก์ชันวัตถุประสงค์ของ elastic-net regression เป็นดังนี้</p>
<p><span class="math display">\[
SSE_{elasticnet}=SSE+(1-\alpha)\lambda_1\sum_{j=1}^kb_j^2+\alpha\lambda_2\sum_{j=1}^k|b_j|
\]</span></p>
<p>โดยที่ <span class="math inline">\(\alpha\)</span> เรียกว่า mixing parameter ซึ่งมีค่าที่เป็นไปได้อยู่บนช่วง 0 ถึง 1 ทำหน้าที่สำหรับกำหนดน้ำหนักให้กับ penalty term ทั้งสอง</p>
<p><span class="math inline">\(\lambda\)</span> และ <span class="math inline">\(\alpha\)</span> ที่อยู่ในฟังก์ชันวัตถุประสงค์ของอัลกอริทึมทั้ง 3 ตัวเป็น hyperparameters ของอัลกอริทึม กล่าวคือผู้วิเคราะห์จะต้องกำหนดค่าของพารามิเตอร์ทั้งสองเอง ในทางปฏิบัติผู้วิเคราะห์สามารถปรับแต่งค่า hyperparameters ดังกล่าวได้โดยใช้ตัวอย่างที่ได้จากการสุ่มซ้ำ เช่น cross-validation หรือ bootstraping ในทำนองเดียวกับการปรับแต่ง hyperparameter ของ decision tree ที่กล่าวถึงในบทที่ 5</p>
</section>
</section>
<section id="implement-regularized-regression-using-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="implement-regularized-regression-using-tidymodels">7.3 Implement regularized regression using tidymodels</h2>
<p>การพัฒนาโมเดลทำนายโดยใช้การทำ regularization ใน R สามารถทำได้หลายวิธี เช่น การใช้ฟังก์ชัน <code>cv.glmnet()</code> ของ package glmnet หรือการใช้ <code>tuneGrid()</code> ใน package caret ในหัวข้อนี้จะกล่าวถึงการพัฒนาอัลกอริทึมดังกล่าวภายใต้ tidymodels framework ชุดข้อมูลที่ใช้เป็นตัวอย่างจะมี 2 ชุด ชุดแรกคือ <a href="https://github.com/ssiwacho/2758688_ML/blob/main/week%201/TeacherSalaryData.csv"><code>TeacherSalaryData.csv</code></a> และชุดที่สองคือ <a href="https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week4/gpax.csv"><code>gpax.csv</code></a></p>
<section id="โมเดลทำนายเงนเดอนคร" class="level3">
<h3 class="anchored" data-anchor-id="โมเดลทำนายเงนเดอนคร">โมเดลทำนายเงินเดือนครู</h3>
<p>ตัวอย่างนี้จะพัฒนาโมเดลทำนายเงินเดือนครูโดยจะใช้อัลกอริทึม regularization ก่อนที่จะเริ่มพัฒนาโมเดล ผู้วิเคราะห์ควรเริ่มจากการสำรวจข้อมูลเบื้องต้นก่อน จากวัตถุประสงค์ของงานนี้อาจจำแนกการสำรวจข้อมูลออกเป็นสองส่วน ส่วนแรกคือการสำรวจรูปแบบตารางข้อมูล ขอบเขตข้อมูล และลักษณะการจัดเก็บ/บันทึกข้อมูล และส่วนที่สองคือการสำรวจลักษณะความสัมพันธ์ระหว่างตัวแปรตามคือเงินเดือนครู (salary) และตัวแปรอิสระต่างในโมเดล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">#importing data</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv"</span>)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 397
Columns: 7
$ X             &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ rank          &lt;chr&gt; "Prof", "Prof", "AsstProf", "Prof", "Prof", "AssocProf",…
$ discipline    &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "…
$ yrs.since.phd &lt;int&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 1…
$ yrs.service   &lt;int&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3,…
$ sex           &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male", …
$ salary        &lt;int&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 14…</code></pre>
</div>
</div>
<p>จากผลการสำรวจข้อมูลข้างต้นจะเห็นว่าชุดข้อมูลดังกล่าวเป็นชุดข้อมูลขนาดเล็ก มีรูปแบบตารางเป็นแบบ tidydata แล้ว โดยมีหน่วยข้อมูลทั้งหมดจำนวน 397 หน่วย มีตัวแปรที่สามารถนำมาใช้เป็นตัวแปรอิสระในโมเดลได้ 5 ตัวแปร ได้แก่ <code>rank</code>, <code>discipline</code>, <code>yrs.since.phd</code>, <code>yrs.service</code> และ <code>sex</code> ผู้อ่านจะเห็นว่าตัวแปรอิสระดังกล่าวมีทั้งตัวแปรที่เป็นเชิงปริมาณ และตัวแปรจัดประเภท โดยในกลุ่มของตัวแปรจัดประเภทพบว่าทุกตัวแปรถูกจัดเก็บอยู่ในรูปแบบของตัวอักษร ซึ่งไม่เหมาะสมที่จะนำเข้าสู่โมเดลทำนาย</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exploring data using statistics</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       X           rank            discipline        yrs.since.phd  
 Min.   :  1   Length:397         Length:397         Min.   : 1.00  
 1st Qu.:100   Class :character   Class :character   1st Qu.:12.00  
 Median :199   Mode  :character   Mode  :character   Median :21.00  
 Mean   :199                                         Mean   :22.31  
 3rd Qu.:298                                         3rd Qu.:32.00  
 Max.   :397                                         Max.   :56.00  
  yrs.service        sex                salary      
 Min.   : 0.00   Length:397         Min.   : 57800  
 1st Qu.: 7.00   Class :character   1st Qu.: 91000  
 Median :16.00   Mode  :character   Median :107300  
 Mean   :17.61                      Mean   :113706  
 3rd Qu.:27.00                      3rd Qu.:134185  
 Max.   :60.00                      Max.   :231545  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(salary, yrs.since.phd, yrs.since.phd) <span class="sc">%&gt;%</span> </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 salary yrs.since.phd
salary        1.0000000     0.4192311
yrs.since.phd 0.4192311     1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exploring data using visualization</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">"yrs.since.phd"</span>,<span class="st">"yrs.service"</span>),</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"predictor"</span>,<span class="at">values_to=</span><span class="st">"value"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">y=</span>salary))<span class="sc">+</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> <span class="fu">factor</span>(predictor),</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">"discipline"</span>,<span class="st">"rank"</span>,<span class="st">"sex"</span>),</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"predictor"</span>,<span class="at">values_to=</span><span class="st">"value"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">y=</span>salary, <span class="at">fill=</span>value))<span class="sc">+</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> <span class="fu">factor</span>(predictor),</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_x"</span>)<span class="sc">+</span></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-72-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>นอกจากนี้ผู้วิเคราะห์ยังลองตรวจสอบว่ามีอิทธิพลปฏิสัมพันธ์ระหว่างตัวแปรอิสระที่มีต่อตัวแปรตามหรือไม่ โดยใช้ visualization เป็นเครื่องมือตรวจสอบเช่นเดียวกัน</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ผลการสำรวจความสัมพันธ์ระหว่างตัวแปรข้างต้นเป็นอย่างไร ?</p>
<p>ใน tidymodels framework การเรียกใช้อัลกอริทึม ridge regression, lasso regression หรือ elastic-net regression สามารถทำได้โดยเลือก model type เป็น <code>linear_reg()</code> และกำหนด engine เป็น <code>glmnet</code> เมื่อพิจารณาการกำหนดอาร์กิวเมนท์ของ glmnet ในคู่มือ <a href="https://www.tidymodels.org/find/parsnip/" class="uri">https://www.tidymodels.org/find/parsnip/</a> พบว่า engine ดังกล่าวสามารถใช้ได้กับ model type ทั้ง linear regression, logistic regression และ multinomial regression ซึ่งสอดคล้องกับที่ได้กล่าวในส่วนภาคทฤษฎีว่าหลักของการ regularization สามารถนำไปใช้ได้กับอัลกอริทึมการเรียนรู้ได้มากมาย</p>
<p>จากตารางจะเห็นว่า glmnet มีอาร์กิวเมนท์ 2 ตัวได้แก่ <code>penalty</code> และ <code>mixture</code> ที่เป็น hyperparameters ของอัลกอริทึม โดยที่</p>
<ul>
<li><p><code>penalty</code> คือ regularization hyperparameter</p></li>
<li><p><code>mixture</code> คือสัดส่วนของ lasso penalty (เท่ากับค่า <span class="math inline">\(\alpha\)</span> ใน part ทฤษฎี) หาก <span class="math inline">\(\alpha =1\)</span> หมายถึงกำหนดให้ใช้อัลกอริทึมแบบ lasso แต่หาก <span class="math inline">\(\alpha = 0\)</span> หมายถึงกำหนดให้ใช้อัลกอริทึม ridge regression และหากกำหนดให้ <span class="math inline">\(\alpha \in (0,1)\)</span> หมายถึงกำหนดให้ใช้ elastic-net regression</p></li>
</ul>
<section id="data-preprocessing-note" class="level4">
<h4 class="anchored" data-anchor-id="data-preprocessing-note">Data Preprocessing Note:</h4>
<p>ผู้วิเคราะห์จะต้องแปลงค่าของตัวแปรจัดประเภทให้เป็นตัวแปร dummy หรือตัวแปรแบบ indicator (หรือที่เรียกว่า one-hot encoding) ในกรณีที่ผู้วิเคราะห์เก็บข้อมูลของตัวแปรจัดประเภทเป็นแบบ factor ฟังก์ชัน <code>fit()</code> จะแปลงข้อมูลของตัวแปรแบบ factor ให้เป็น indicator โดยอัตโนมัติ สำหรับตัวแปรเชิงปริมาณจำเป็นที่ต้องทำการแปลงให้เป็นสเกลมาตรฐานก่อน</p>
<p>ตัวอย่างต่อไปนี้จะแสดงการ fit regularized regression ด้วย parsnip โดยยังไม่มีการปรับแต่ง hyperparameter ก่อน ส่วนตัวอย่างที่แสดงการพัฒนาอัลกอริทึมเต็มรูปแบบจะแสดงในส่วนถัดไป คำสั่งในส่วนแรกแสดงการแบ่งชุดข้อมูลเป็น training และ test dataset นอกจากนี้ยังแสดงการทำ feature engineering เพื่อทำให้ข้อมูลของตัวแปรอิสระเป็นไปตามข้อตกลงเบื้องต้นของการวิเคราะห์ regularized regression ผลลัพธ์ที่ได้จากขั้นตอนนี้คือชุดข้อมูล training และ test ที่ผ่านการทำ preprocessing แล้ว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data splitting</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> dat, <span class="at">prop=</span><span class="fl">0.8</span>)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data preprocessing </span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>rec_dat <span class="ot">&lt;-</span> <span class="fu">recipe</span>(salary <span class="sc">~</span>., <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove X</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create dummy variable</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(rank, discipline, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#standarized numeric</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create interaction term</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> yrs.since.phd<span class="sc">:</span><span class="fu">starts_with</span>(<span class="st">"discipline"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">training_data =</span> train)</span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>rec_dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          6

Training data contained 317 data points and no missing data.

Operations:

Variables selected rank, discipline, yrs.since.phd, yrs.servi... [trained]
Dummy variables from rank, discipline, sex [trained]
Centering and scaling for yrs.since.phd, yrs.service, rank_AsstProf, rank... [trained]
Interactions with yrs.since.phd:discipline_B [trained]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create preprocessed train and test dataset</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>train_preproc <span class="ot">&lt;-</span> rec_dat <span class="sc">%&gt;%</span> <span class="fu">bake</span>(<span class="cn">NULL</span>)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>test_preproc <span class="ot">&lt;-</span> rec_dat <span class="sc">%&gt;%</span> <span class="fu">bake</span>(<span class="at">new_data =</span> test)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train_preproc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 317
Columns: 8
$ yrs.since.phd                &lt;dbl&gt; -0.694928928, 1.135122745, -1.533702611, …
$ yrs.service                  &lt;dbl&gt; -0.7146064, 1.4773778, -1.1681203, 1.1750…
$ salary                       &lt;int&gt; 74830, 151650, 88400, 189409, 117256, 802…
$ rank_AsstProf                &lt;dbl&gt; -0.4674818, -0.4674818, 2.1323729, -0.467…
$ rank_Prof                    &lt;dbl&gt; -1.4086471, 0.7076616, -1.4086471, 0.7076…
$ discipline_B                 &lt;dbl&gt; -1.080527, 0.922555, 0.922555, 0.922555, …
$ sex_Male                     &lt;dbl&gt; -2.9796232, 0.3345542, 0.3345542, 0.33455…
$ yrs.since.phd_x_discipline_B &lt;dbl&gt; 0.750889321, 1.047213203, -1.414925065, 0…</code></pre>
</div>
</div>
<p>ตัวอย่างต่อไปนี้แสดงการระบุโมเดลด้วย engine glmnet โดยตัวอย่างแรกนี้จะกำหนดให้อาร์กิวเมนท์ <code>penalty = 0</code> ผลการวิเคราะห์ที่ได้จากการระบุโมเดลนี้จะเท่ากับ ols regression แบบปกติ</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model specification: ols regression</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>regularized_reg <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">mixture =</span> <span class="dv">0</span>, <span class="at">penalty =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>reg_fit <span class="ot">&lt;-</span> regularized_reg <span class="sc">%&gt;%</span> </span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(salary <span class="sc">~</span>., <span class="at">data =</span> train_preproc)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ols regression estimate</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(reg_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  term                         estimate penalty
  &lt;chr&gt;                           &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)                   113837.       0
2 yrs.since.phd                   4747.       0
3 yrs.service                    -2910.       0
4 rank_AsstProf                  -5453.       0
5 rank_Prof                      13321.       0
6 discipline_B                    6641.       0
7 sex_Male                        1466.       0
8 yrs.since.phd_x_discipline_B    1079.       0</code></pre>
</div>
</div>
<p>การใช้ tidymodels framework ช่วยให้ผู้วิเคราะห์สามารถเรียกดูค่าประมาณของสัมประสิทธิ์ความชันของโมเดลในกรณีที่มีการกำหนด penalty hyperparameter ต่าง ๆ ได้ เช่น</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(reg_fit, <span class="at">penalty=</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  term                         estimate penalty
  &lt;chr&gt;                           &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)                  113836.    10000
2 yrs.since.phd                  3326.    10000
3 yrs.service                      48.1   10000
4 rank_AsstProf                 -5416.    10000
5 rank_Prof                      9945.    10000
6 discipline_B                   5135.    10000
7 sex_Male                       1347.    10000
8 yrs.since.phd_x_discipline_B   1077.    10000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># magnitude of b</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>reg_fit<span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>จากตัวอย่างการวิเคราะห์ข้างต้นจะเห็นว่าเมื่อกำหนดให้ penalty term มีค่ามากขึ้นเรื่อย ๆ ค่าของสัมประสิทธิ์ความชันของโมเดลจะมีแนวโน้มลู่เข้าหา 0 ดังที่ได้กล่าวไว้ในในส่วนทฤษฎี</p>
<p>ผลการวิเคราะห์ต่อไปนี้แสดงการเปรียบเทียบประสิทธิภาพของการทำนายที่ได้จากโมเดล ridge regression ที่มีการกำหนด penalty term เท่ากับ 0, 5000 และ 10000 ตามลำดับ</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg_fit, <span class="at">new_data =</span> test_preproc)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg_fit, <span class="at">new_data =</span> test_preproc, <span class="at">penalty =</span> <span class="dv">5000</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg_fit, <span class="at">new_data =</span> test_preproc, <span class="at">penalty =</span> <span class="dv">10000</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>test_preproc <span class="sc">%&gt;%</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(salary) <span class="sc">%&gt;%</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(pred1, pred2, pred3) <span class="sc">%&gt;%</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>( <span class="at">pred_ols =</span> .pred...<span class="dv">2</span> ,</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">pred_ridge5k =</span> .pred...<span class="dv">3</span>,</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">pred_ridge_10k =</span> .pred...<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pred"</span>),</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"model"</span>,</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"pred_value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((salary<span class="sc">-</span>pred_value)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">rsq =</span> <span class="fu">cor</span>(salary, pred_value)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `.pred` -&gt; `.pred...2`
• `.pred` -&gt; `.pred...3`
• `.pred` -&gt; `.pred...4`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  model            rmse   rsq
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
1 pred_ols       22937. 0.418
2 pred_ridge5k   23247. 0.405
3 pred_ridge_10k 23682. 0.389</code></pre>
</div>
</div>
<p>ผลลัพธ์ที่ได้ข้างต้นแสดงให้เห็นว่าการกำหนด penalty term ที่แตกต่างกันมีผลต่อประสิทธิภาพในการทำนายของโมเดล อย่างไรก็ตามวิธีการข้างต้นไม่ใช่วิธีที่มีประสิทธิภาพที่จะให้หาค่าที่ดีที่สุดของ hyperparameters ทั้งสองค่าดังกล่าว ตัวอย่างต่อไปจะแสดงการใช้ k-folds cross-validation เข้ามาช่วยเฟ้นหาค่า hyperparameters ที่เหมาะสม คำสั่งด้านล่างแสดงการใช้ workflow ของ tidymodels เข้ามาช่วยปรับแต่งค่า hyperparameters ดังกล่าว รูปด้านล่างแสดงลักษณะของ workflow ซึ่งจะเห็นว่าเป็นการรวม object สองชนิดเข้าด้วยกันคือ recipe และ parsnip</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1608202707.png" class="img-fluid figure-img" alt="tidymodels workflow (ดัดแปลงจาก Mark Khun)"></p>
<p></p><figcaption class="figure-caption">tidymodels workflow (ดัดแปลงจาก Mark Khun)</figcaption><p></p>
</figure>
</div>
<p>คำสั่งต่อไปนี้แสดงการปรับแต่ง hyperparameter ด้วย workflow ของ tidymodels ดังกล่าว</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create repeated 10-folds CV datasets</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>folds_data <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> train, </span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">v =</span> <span class="dv">10</span>, </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>folds_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation repeated 3 times 
# A tibble: 30 × 3
   splits           id      id2   
   &lt;list&gt;           &lt;chr&gt;   &lt;chr&gt; 
 1 &lt;split [285/32]&gt; Repeat1 Fold01
 2 &lt;split [285/32]&gt; Repeat1 Fold02
 3 &lt;split [285/32]&gt; Repeat1 Fold03
 4 &lt;split [285/32]&gt; Repeat1 Fold04
 5 &lt;split [285/32]&gt; Repeat1 Fold05
 6 &lt;split [285/32]&gt; Repeat1 Fold06
 7 &lt;split [285/32]&gt; Repeat1 Fold07
 8 &lt;split [286/31]&gt; Repeat1 Fold08
 9 &lt;split [286/31]&gt; Repeat1 Fold09
10 &lt;split [286/31]&gt; Repeat1 Fold10
# … with 20 more rows</code></pre>
</div>
</div>
<p>จะเห็นว่า repeated 10-folds CV เป็นการทำ 10-folds CV ซ้ำจำนวน 3 ครั้ง ผลลัพธ์ข้างต้นจึงจะเห็นว่าเป็น tibble ขนาด 30 x 3</p>
</section>
</section>
<section id="ตวอยางการสราง-workflow-เพอทำ-hyperparameter-tuning-ridge-regression" class="level3">
<h3 class="anchored" data-anchor-id="ตวอยางการสราง-workflow-เพอทำ-hyperparameter-tuning-ridge-regression">ตัวอย่างการสร้าง workflow เพื่อทำ hyperparameter tuning : Ridge Regression</h3>
<p>ขั้นตอนต่อไปเป็นการสร้าง workflow สำหรับพัฒนา regularized regression จากรูปจากข้างจะเห็นว่า workflow หนึ่ง ๆ ประกอบด้วยส่วนของการเตรียมข้อมูล และ modelling ที่จัดเก็บอยู่ใน recipe และ parsnip objects รายละเอียดของชุดคำสั่งมีดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data preprocessing specification</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>dat_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(salary <span class="sc">~</span>., <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_select</span>(<span class="sc">-</span>X) <span class="sc">%&gt;%</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(rank, discipline, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> yrs.since.phd<span class="sc">:</span><span class="fu">starts_with</span>(<span class="st">"discipline"</span>))</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co">#model specification</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>regularized_reg <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(),</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co">#ridge regression</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create a workflow object</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>regularized_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(dat_rec) <span class="sc">%&gt;%</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(regularized_reg)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>regularized_workflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_select()
• step_dummy()
• step_normalize()
• step_interact()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = tune()
  mixture = 0

Computational engine: glmnet </code></pre>
</div>
</div>
<p>ผลลัพธ์ข้างต้นจะเห็นว่า workflow ช่วยรวบรวมส่วนของการ preprocessing และ modeling ให้อยู่ภายใต้ object เดียวกัน เมื่อสร้าง workflow เรียบร้อยแล้ว ขั้นตอนถัดไปคือการสร้าง grid ของ hyperparameters เพื่อใช้สำหรับการเฟ้นหาชุดของ hyperparameter ที่มีความเหมาะสมกล่าวคือทำให้ประสิทธิภาพการทำนายของโมเดลมีสูงที่สุด ดังที่ได้กล่าวในบทที่ 5 ว่าการกำหนด grid อาจทำได้สองวิธี วิธีการแรกคือการใช้ regular grid search ที่จะสร้าง grid จาก combination ของค่าที่เป็นไปได้ทั้งหมดของ hyperparameters ที่สนใจ การสร้าง grid ดังกล่าวสามารถทำได้หลายวิธีการ โดยใน tidymodels สามารถทำได้ด้วยฟังก์ชัน <code>grid_regular()</code> ของ package dial ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">parameters</span>(<span class="fu">penalty</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">100</span>)))</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>regular_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(p, <span class="at">levels=</span><span class="dv">50</span>)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>regular_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 1
     penalty
       &lt;dbl&gt;
 1 1   e-100
 2 1.21e- 96
 3 1.46e- 92
 4 1.76e- 88
 5 2.12e- 84
 6 2.56e- 80
 7 3.09e- 76
 8 3.73e- 72
 9 4.50e- 68
10 5.43e- 64
# … with 40 more rows</code></pre>
</div>
</div>
<p>การปรับแต่งค่าพารามิเตอร์ด้วยการดำเนินการข้างต้นมีข้อจำกัดคือเป็นวิธีการที่ใช้ทรัพยากรค่อนข้างมาก อีกวิธีการหนึ่งที่ช่วยลดการใช้ทรัพยากรของเครื่องลงได้คือการใช้ random grid search ซึ่งเป็นการสุ่มชุดของ hyperparameter มาวิเคราะห์ การดำเนินการตามวิธีการนี้สามารถทำได้ด้วยฟังก์ชัน <code>grid_random()</code> ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>random_grid <span class="ot">&lt;-</span> <span class="fu">grid_random</span>(p, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>random_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
    penalty
      &lt;dbl&gt;
 1 9.85e+56
 2 3.04e+80
 3 2.48e+ 5
 4 4.57e-49
 5 3.82e+60
 6 4.28e-71
 7 5.60e+ 0
 8 2.03e+13
 9 2.14e+18
10 2.82e+97</code></pre>
</div>
</div>
<p>ตัวอย่างต่อไปนี้จะเปรียบเทียบผลที่ได้จากการปรับแต่งค่า hyperparameters ด้วยการทำ repeated 10-fold CV บน grid ของ hyperparameter ที่สร้างขึ้นจากสองวิธีการข้างต้น จากตัวอย่างด้านล่างจะเห็นว่าการ fit model ในแต่ละ fold จะใช้ฟังก์ชัน <code>tune_grid()</code> เป็นตัวดำเนินการแทนฟังก์ชัน <code>fit()</code> ทั้งนี้ <code>tune_grid()</code> มีอาร์กิวเมนท์ที่สำคัญได้แก่</p>
<ul>
<li><p><code>resamples</code> ใช้ระบุชุดข้อมูลที่สร้างขึ้นจากกระบวนการสุ่มซ้ำ เช่น k-folds CV หรือ boostraping dataset</p></li>
<li><p><code>grid</code> ใช้สำหรับระบุ grid ของ hyperparameter ของอัลกอริทึมการเรียนรู้ที่เลือกใช้</p></li>
<li><p><code>control</code> ใช้กำหนด option สำหรับควบคุมกระบวนการสุ่มซ้ำ (resample) และปรับแต่งค่า hyperparameter การกำหนดอาร์กิวเมนท์นี้จะต้องกำหนดผ่านฟังก์ชัน <code>control_resamples()</code> หรือ <code>control_grid()</code> อีกทีหนึ่ง รายละเอียดของฟังก์ชันทั้งสองสามารถศึกษาได้จากคู่มือการใช้งาน (พิมพ์ <code>?control_resamples</code> หรือ <code>?control_grid</code>)</p></li>
<li><p><code>metrics</code> ใช้กำหนด evalution metrics ที่ผู้วิเคราะห์จะใช้เพื่อประเมินประสิทธิภาพของโมเดลระหว่างการปรับแต่งค่าพารามิเตอร์ การกำหนดอาร์กิวเมนท์นี้ให้ทำผ่านฟังก์ชัน <code>metric_set()</code> ในกรณีที่ไม่ได้กำหนดโปรแกรมจะกำหนดให้ใช้ค่าเริ่มต้น ซึ่งจะเลือกให้เหมาะสมกับ mode ของโมเดล</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>control_options <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">TRUE</span>, <span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>eval_metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(rsq, rmse, mae)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="co">#regular grid search </span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>tune_regular <span class="ot">&lt;-</span> regularized_workflow <span class="sc">%&gt;%</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds_data,</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> regular_grid,</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> control_options,</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> eval_metric)</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"time usage (regular grid search) = "</span>, <span class="fu">round</span>(end <span class="sc">-</span> start,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "time usage (regular grid search) =  24.3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co">#random grid search </span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>tune_random <span class="ot">&lt;-</span> regularized_workflow <span class="sc">%&gt;%</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds_data,</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> random_grid,</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> control_options,</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> eval_metric)</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"time usage (random grid search) = "</span>, <span class="fu">round</span>(end <span class="sc">-</span> start,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "time usage (random grid search) =  23.6"</code></pre>
</div>
</div>
<p><strong>การประมวลผลข้างต้นการปรับแต่งค่า hyperparameters แต่ละวิธีการใช้เวลาเท่าไหร่ และผลที่ได้จากการปรับแต่งค่า hyperparameters มีความเหมือนหรือแตกต่างกันอย่างไร?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>tune_regular <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>tune_random <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-84-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>จากการทำ workflow ข้างต้นผู้วิเคราะห์สามารถเรียกดูผลการประเมินประสิทธิภาพของโมเดลทำนายที่คำนวณจากการทำ cross-validation โดยใช้ฟังก์ชัน <code>collect_metric()</code> ฟังก์ชันนี้มีอาร์กิวเมนท์ที่ควรรู้จักคือ <code>summarize</code> ค่าเริ่มต้นจะกำหนดให้เป็น <code>TRUE</code> ผลลัพธ์ที่ได้จะเป็นค่าสรุปประสิทธิภาพการทำนายของโมเดลในแต่ละ grid แต่ถ้ากำหนดให้เป็น <code>FALSE</code> ผลลัพธ์ที่ได้จะลงรายละเอียดของประสิทธิภาพเป็นราย validation dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>tune_regular <span class="sc">%&gt;%</span> </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 7
     penalty .metric .estimator      mean     n  std_err .config              
       &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;                
 1 1   e-100 mae     standard   17108.       30 515.     Preprocessor1_Model01
 2 1   e-100 rmse    standard   22461.       30 717.     Preprocessor1_Model01
 3 1   e-100 rsq     standard       0.448    30   0.0220 Preprocessor1_Model01
 4 1.21e- 96 mae     standard   17108.       30 515.     Preprocessor1_Model02
 5 1.21e- 96 rmse    standard   22461.       30 717.     Preprocessor1_Model02
 6 1.21e- 96 rsq     standard       0.448    30   0.0220 Preprocessor1_Model02
 7 1.46e- 92 mae     standard   17108.       30 515.     Preprocessor1_Model03
 8 1.46e- 92 rmse    standard   22461.       30 717.     Preprocessor1_Model03
 9 1.46e- 92 rsq     standard       0.448    30   0.0220 Preprocessor1_Model03
10 1.76e- 88 mae     standard   17108.       30 515.     Preprocessor1_Model04
# … with 140 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>tune_regular <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>penalty, <span class="at">y=</span>mean, <span class="at">col=</span>.metric))<span class="sc">+</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> .metric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 23 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 23 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>tune_random <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 900 × 7
   id      id2     penalty .metric .estimator .estimate .config              
   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                
 1 Repeat1 Fold01 4.28e-71 rsq     standard       0.526 Preprocessor1_Model01
 2 Repeat1 Fold01 4.28e-71 rmse    standard   23052.    Preprocessor1_Model01
 3 Repeat1 Fold01 4.28e-71 mae     standard   15245.    Preprocessor1_Model01
 4 Repeat1 Fold02 4.28e-71 rsq     standard       0.397 Preprocessor1_Model01
 5 Repeat1 Fold02 4.28e-71 rmse    standard   24661.    Preprocessor1_Model01
 6 Repeat1 Fold02 4.28e-71 mae     standard   19846.    Preprocessor1_Model01
 7 Repeat1 Fold03 4.28e-71 rsq     standard       0.548 Preprocessor1_Model01
 8 Repeat1 Fold03 4.28e-71 rmse    standard   19751.    Preprocessor1_Model01
 9 Repeat1 Fold03 4.28e-71 mae     standard   14601.    Preprocessor1_Model01
10 Repeat1 Fold04 4.28e-71 rsq     standard       0.680 Preprocessor1_Model01
# … with 890 more rows</code></pre>
</div>
</div>
<p>นอกจากนี้ยังมีฟังก์ชัน <code>collect_predictions()</code> ที่สามารถใช้เรียกค่าทำนายของตัวแปรตามที่ได้จากแต่ละ resample และชุดของ hyperparameter ภายใน grid การใช้ฟังก์ชันนี้ทำในทำนองเดียวกับ <code>collect_metrics()</code> ดังตัวอย่างต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>tune_regular <span class="sc">%&gt;%</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 47,550 × 7
   id      id2      .pred  .row penalty salary .config              
   &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt;                
 1 Repeat1 Fold01 134570.     7  1e-100 147765 Preprocessor1_Model01
 2 Repeat1 Fold01  85535.    23  1e-100  80139 Preprocessor1_Model01
 3 Repeat1 Fold01 130411.    24  1e-100 144651 Preprocessor1_Model01
 4 Repeat1 Fold01  90509.    32  1e-100 104121 Preprocessor1_Model01
 5 Repeat1 Fold01 104737.    40  1e-100 105350 Preprocessor1_Model01
 6 Repeat1 Fold01 119918.    41  1e-100 104350 Preprocessor1_Model01
 7 Repeat1 Fold01 121175.    48  1e-100 124750 Preprocessor1_Model01
 8 Repeat1 Fold01  85847.    51  1e-100  82379 Preprocessor1_Model01
 9 Repeat1 Fold01 100900.    58  1e-100 100000 Preprocessor1_Model01
10 Repeat1 Fold01 122968.    63  1e-100 194800 Preprocessor1_Model01
# … with 47,540 more rows</code></pre>
</div>
</div>
<p>นอกจากการวิเคราะห์ข้างต้นแล้วยังสามารถใช้ฟังก์ชัน <code>show_best()</code> เพื่อคัดเลือกโมเดลทำนายที่ดีที่สุดจาก grid ที่ผู้วิเคราะห์วิเคราะห์ไว้ในข้างต้น ฟังก์ชันนี้ยังมีอาร์กิวเมนท์ <code>n</code> สำหรับกำหนดว่าต้องการให้เลือกโมเดลที่ดีที่สุดกี่อันดับแรกขึ้นมาให้ผู้วิเคราะห์ และอาร์กิวเมนท์ <code>metric</code> ใชัสำหรับระบุ evaluation metric ที่จะใช้คัดเลือกโมเดลทำนายดังกล่าว ตัวอย่างต่อไปนี้แสดงผลคัดเลือกโมเดลทำนายจากวิธีการสร้าง grid ทั้งสองวิธี จะเห็นว่าผลลัพธ์ที่ได้สอดคล้องกัน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(tune_regular, <span class="at">n=</span><span class="dv">5</span>, <span class="at">metric=</span><span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
    penalty .metric .estimator   mean     n std_err .config              
      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1 1   e-100 rmse    standard   22461.    30    717. Preprocessor1_Model01
2 1.21e- 96 rmse    standard   22461.    30    717. Preprocessor1_Model02
3 1.46e- 92 rmse    standard   22461.    30    717. Preprocessor1_Model03
4 1.76e- 88 rmse    standard   22461.    30    717. Preprocessor1_Model04
5 2.12e- 84 rmse    standard   22461.    30    717. Preprocessor1_Model05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(tune_random, <span class="at">n=</span><span class="dv">5</span>, <span class="at">metric=</span><span class="st">"rmse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
   penalty .metric .estimator   mean     n std_err .config              
     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1 4.28e-71 rmse    standard   22461.    30    717. Preprocessor1_Model01
2 4.57e-49 rmse    standard   22461.    30    717. Preprocessor1_Model02
3 5.60e+ 0 rmse    standard   22461.    30    717. Preprocessor1_Model03
4 2.48e+ 5 rmse    standard   27598.    30    623. Preprocessor1_Model04
5 2.03e+13 rmse    standard   30210.    30    601. Preprocessor1_Model05</code></pre>
</div>
</div>
<section id="กจกรรม-1" class="level4">
<h4 class="anchored" data-anchor-id="กจกรรม-1">กิจกรรม 1 :</h4>
<p>ขอให้นิสิตทดลอง plot R square plot ของโมเดลที่ดีที่สุดข้างต้น ผลลัพธ์ที่ได้เป็นอย่างไร นิสิตที่ข้อเสนอแนะในการพัฒนาโมเดลทำนายดังกล่าวอย่างไร?</p>
<div class="cell">

</div>
</section>
<section id="กจกรรม-2" class="level4">
<h4 class="anchored" data-anchor-id="กจกรรม-2">กิจกรรม 2 :</h4>
<p>ขอให้นิสิตลองใช้อัลกอริทึม regularized regression ตัวอื่นเพื่อพัฒนาโมเดลทำนายเงินเดือนอาจารย์มหาวิทยาลัย โดยใช้ชุดข้อมูล <code>TeacherSalaryData.csv</code> ผลลัพธ์ที่ได้เป็นอย่างไร</p>
</section>
</section>
</section>
<section id="tuning-and-comparing-models" class="level2">
<h2 class="anchored" data-anchor-id="tuning-and-comparing-models">7.4 Tuning and Comparing Models</h2>
<p>โดยทั่วไปในการพัฒนาโมเดลทำนาย ผู้วิเคราะห์จำเป็นต้องทดลองพัฒนาโมเดลทำนายจากอัลกริทึมการเรียนรู้หลายตัว การดำเนินงานดังกล่าวจึงต้องมีทั้งส่วนของการปรับแต่งค่า hyperparameters ของแต่ละอัลกอริทึม และต้องมีส่วนของการเปรียบเทียบประสิทธิภาพการทำนายของโมเดลในชุดข้อมูลทดสอบ จะเห็นว่าการดำเนินการดังกล่าวค่อนข้างมีความซับซ้อน และต้องมีการเขียนชุดคำสั่งเป็นจำนวนมาก</p>
<p>ใน tidymodels มีตัวแปรอีกประเภทที่เรียกว่า workflow set ที่ใช้เก็บ workflow หลาย ๆ ตัวเข้ามารวมไว้ในตัวแปรเดียว ซึ่งทำให้การทำ data preprocessing การปรับแต่งค่า hyperparameters และการเปรียบเทียบประสิทธิภาพระหว่างโมเดลทำนายที่พัฒนาจากอัลกอริทึมที่แตกต่างกันหลาย ๆ ตัวสามารถทำได้ง่ายมากขึ้น</p>
<p>ตัวอย่างต่อไปนี้จะแสดงการพัฒนาโมเดลทำนายโดยใช้อัลกอริทึมได้แก่ regularized logistic regression และ decision tree โดยจะใช้ชุดข้อมูลตัวอย่างจาก package modeldata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#importing data</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(parabolic)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(parabolic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 500
Columns: 3
$ X1    &lt;dbl&gt; 3.291779227, 1.465839693, 1.660986913, 1.602301296, 2.165003287,…
$ X2    &lt;dbl&gt; 1.66108928, 0.41398566, 0.79147013, 0.27639110, 3.16557011, 3.82…
$ class &lt;fct&gt; Class1, Class2, Class2, Class2, Class1, Class1, Class2, Class1, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># splitting data</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> parabolic)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ชุดข้อมูล parabolic ประกอบด้วยตัวแปร 3 ตัว โดยตัวแปรตามเป็นตัวแปรจัดประเภทที่มี 2 categories และตัวแปรอิสระประกอบด้วย X1 และ X2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">col=</span>class))<span class="sc">+</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<section id="model-specification" class="level3">
<h3 class="anchored" data-anchor-id="model-specification">Model Specification</h3>
<p>สร้าง model specification ทั้งหมดที่ต้องการ</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>logistic_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty=</span> <span class="fu">tune</span>(),</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">min_n =</span> <span class="fu">tune</span>())<span class="sc">%&gt;%</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="สราง-workflowset-และวเคราะห-hyperparemeters" class="level3">
<h3 class="anchored" data-anchor-id="สราง-workflowset-และวเคราะห-hyperparemeters">สร้าง workflowset และวิเคราะห์ hyperparemeters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create workflowset</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>mod_specs <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="st">"formula"</span> <span class="ot">=</span> class <span class="sc">~</span> .),</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">list</span>(<span class="at">glmnet =</span> logistic_mod,</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">cart =</span> tree_mod)</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co">#create resamples</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>resamples <span class="ot">&lt;-</span> <span class="fu">bootstraps</span>(<span class="at">data =</span> train)</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co"># tunegrid using workflowmap</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>tune_results<span class="ot">&lt;-</span> mod_specs <span class="sc">%&gt;%</span> </span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(<span class="st">"tune_grid"</span>,</span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">resamples =</span> resamples,</span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">grid =</span> <span class="dv">10</span>,</span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc, sens, spec),</span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">option_add</span>(<span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred=</span>T, <span class="at">parallel_over =</span><span class="st">"resamples"</span>))</span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rankmodels</span></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rank_results</span>(tune_results, <span class="at">rank_metric =</span><span class="st">"roc_auc"</span>)</span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tune_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="บทท-8-polynomial-and-multivariate-adaptive-regression-splines" class="level1">
<h1>บทที่ 8 : Polynomial and Multivariate Adaptive Regression Splines</h1>
</section>
<section id="บทท-9-random-forest-algorithm" class="level1">
<h1>บทที่ 9 : Random Forest Algorithm</h1>
<p>ถึงแม้ว่า Decision tree จะเป็นโมเดลที่สร้างง่าย ใช้งาน และแปลผลง่าย แต่โดยทั่วไปแล้ว ประสิทธิภาพการทำนายของ decision tree มักไม่ค่อยดี และสุ่มเสี่ยงที่จะเกิดปัญหา overfitting ได้ง่ายอีกด้วย</p>
<p><img src="images/image-1695152319.png" class="img-fluid"></p>
<section id="basic-concepts" class="level2">
<h2 class="anchored" data-anchor-id="basic-concepts">9.1 Basic Concepts</h2>
<p>จากข้อจำกัดของ decision tree (รวมทั้ง ML แบบ single learner ตัวอื่น ๆ ) จึงมีการพัฒนาวิธีการสร้างโมเดลทำนายโดยใช้การรวมผลทำนายจากชุดข้อมูล bootstrap เรียกว่า bootstrap aggregation (bagging) รูปด้านล่างแสดงแนวคิดพื้นฐานของ bagging method</p>
<p><img src="images/image-1237506128.png" class="img-fluid"></p>
<p>random forest ในยุคแรกใช้แนวคิดของ bagging ข้างต้นโดยตรง โดยมีขั้นตอนการดำเนินงานดังนี้</p>
<p>กำหนดให้ training dataset ของผู้วิเคราะห์มีขนาด n หน่วย</p>
<ol type="1">
<li><p>สร้าง bootstrap dataset โดยใช้การสุ่มตัวอย่างแบบใส่คืน ขนาด n หน่วย (sampling with replacement) จากชุดข้อมูล trainng data</p></li>
<li><p>นำชุดข้อมูลแต่ละชุดมาสร้าง decision tree</p></li>
<li><p>ทวนซ้ำขั้นตอนที่ 1 และ 2 จนครบ bootstrap dataset ทั้งหมด</p></li>
<li><p>นำผลทำนายจาก bootstrap dataset แต่ละชุดมาหา majority vote</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-275986106.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">ตัวอย่าง bootstrap dataset</figcaption><p></p>
</figure>
</div></li>
</ol>
<p>อย่างไรก็ตาม bagging tree ข้างต้นมีข้อจำกัดกล่าวคือในแต่ละรอบของการทวนซ้ำ อัลกอริทึมมักสร้าง decision tree ที่ซ้ำซ้อนกัน ซึ่งให้ประสิทธิภาพการทำนายไม่ได้ดีขึ้นเท่าที่ควร จากข้อจำกัดนี้จึงมีการพัฒนา random forest algorithm ขึ้น ซึ่งมีรายละเอียดดังนี้</p>
<pre><code>1. สร้าง training dataset
2. กำหนด hyperparameter ของโมเดล
3. สร้าง bootstrap dataset จาก traning dataset
4. สร้าง decision tree จาก bootstrap dataset ดังกล่าวภายใต้เงื่อนไขของ hyperparameter ที่กำหนด 
5. นำ decision tree ใน 4. ไปคำนวณ error ใน OOB แล้วเก็บค่าไว้
6. ทวนซ้ำ 3 - 5 ใหม่ จนได้จำนวน tree model ครบตามกำหนด นำ OOB error ของ model ทั้งหมดมาเฉลี่ยรวมกันจะได้ error ของ random forest 
7. ทวนซ้ำ 2. ถึง 6. ใหม่ด้วย cross-validation จนครบทั้ง hyperparameter grid นำ error ทั้งหมดมาวิเคราะห์เพื่อเลือก hyperparameter ชุดที่ดีที่สุด</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-2033240077.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">สิวะโชติ ศรีสุทธิยากร (2564)</figcaption><p></p>
</figure>
</div>
</section>
<section id="out-of-bag-oob" class="level2">
<h2 class="anchored" data-anchor-id="out-of-bag-oob">9.2 Out-of-Bag (OOB)</h2>
<p>จากตัวอย่าง algorithm ของ random forest ข้างต้นจะเห็นว่ามี hyperparameter ที่จะต้อง fine-tune เนื่องจาก random forest สร้างขึ้นจาก bootstrap dataset การตรวจสอบประสิทธิภาพของโมเดลเพื่อ fine-tune hyperparameters จึงจะใช้การประเมินจาก out-of-bag error โดยที่ out-of-bag error จะคำนวณจากหน่วยข้อมูลที่ไม่ถูกเลือกให้อยู่ภายใต้ bootstrap dataset ในแต่ลละรอบ ซึ่งในทางทฤษฎีจะมีหน่วยข้อมูลแบบ OOB นี้คิดเป็นร้อยละประมาณ 37 ของ original dataset</p>
</section>
<section id="hyperparameters-ของ-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameters-ของ-random-forest">9.3 Hyperparameters ของ Random Forest</h2>
<p>hyperparameter ของ random forest เช่น</p>
<ol type="1">
<li><strong>n_trees</strong> — จำนวนต้นไม้ของแต่ละ random forest จำนวนต้นไม้มีผลโดยตรงต่อประสิทธิภาพในการทำนาย กล่าวคือหากกำหนดให้มีต้นไม้จำนวนมาก การประมาณประสิทธิภาพในการทำนายจะทำได้อย่างคงเส้นคงวา ส่งผลให้การ fine-tune hyperparameter ทำได้อย่างมีประสิทธิภาพตามไปด้วย อย่างไรก็ตามจำนวนต้นไม้ที่มากเกินไปก็จะใช้ทรัพยากรการประมวลผลที่มากตามไปด้วย</li>
<li><strong>mtry</strong> — จำนวนของ feature ที่จะสุ่มมาสร้าง tree model แต่ละ model ภายใต้ random forest</li>
<li><strong>cp</strong> — หรือ cost of complexity hyperparameter อธิบายโดยละเอียดไปแล้วใน decision tree</li>
<li><strong>minspit</strong> — จำนวนหน่วยข้อมูลขั้นต่ำที่ต้องมีภายในแต่ละ node (node size)</li>
<li><strong>minbucket</strong> — จำนวนหน่วยข้อมูลขั้นต่ำของ Terminal node</li>
<li><strong>maxdepth.</strong> — ความลึกสูงที่สุดของต้นไม้แต่ละต้น</li>
<li><strong>splitrule</strong></li>
</ol>
</section>
<section id="ตวอยางการวเคราะห-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="ตวอยางการวเคราะห-random-forest">9.4 ตัวอย่างการวิเคราะห์ random forest</h2>
<p>ใน R มี package หลายตัวที่สามารถใช้วิเคราะห์ random forest ได้ package หนึ่งที่มีประสิทธิภาพคือ ranger ชุดคำสั่งต่อไปนี้เป็นการใช้ฟังก์ชัน <code>ranger</code> โดยตรงเพื่อวิเคราะห​ random forest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co"># importing and preprocessing</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv"</span>)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     rank            discipline        yrs.since.phd    yrs.service   
 Length:397         Length:397         Min.   : 1.00   Min.   : 0.00  
 Class :character   Class :character   1st Qu.:12.00   1st Qu.: 7.00  
 Mode  :character   Mode  :character   Median :21.00   Median :16.00  
                                       Mean   :22.31   Mean   :17.61  
                                       3rd Qu.:32.00   3rd Qu.:27.00  
                                       Max.   :56.00   Max.   :60.00  
     sex                salary      
 Length:397         Min.   : 57800  
 Class :character   1st Qu.: 91000  
 Mode  :character   Median :107300  
                    Mean   :113706  
                    3rd Qu.:134185  
                    Max.   :231545  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>dat1_preproc<span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salary_class =</span> <span class="fu">ifelse</span>(salary<span class="sc">&gt;=</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">salary_class =</span> <span class="fu">factor</span>(salary_class,</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"high"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>salary)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat1_preproc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     rank            discipline        yrs.since.phd    yrs.service   
 Length:397         Length:397         Min.   : 1.00   Min.   : 0.00  
 Class :character   Class :character   1st Qu.:12.00   1st Qu.: 7.00  
 Mode  :character   Mode  :character   Median :21.00   Median :16.00  
                                       Mean   :22.31   Mean   :17.61  
                                       3rd Qu.:32.00   3rd Qu.:27.00  
                                       Max.   :56.00   Max.   :60.00  
     sex            salary_class
 Length:397         low :140    
 Class :character   high:257    
 Mode  :character               
                                
                                
                                </code></pre>
</div>
</div>
<p>ขั้นตอนถัดมาคือแบ่งชุดข้อมูลเป็น training และ test dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dat1_preproc, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> salary_class)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>train<span class="ot">&lt;-</span><span class="fu">training</span>(split)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span><span class="fu">testing</span>(split)</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train<span class="sc">$</span>salary_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 low high 
 112  205 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test<span class="sc">$</span>salary_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 low high 
  28   52 </code></pre>
</div>
</div>
<p>วิเคราะห์ random forest model ด้วยฟังก์ชัน <code>ranger()</code> ในตัวอย่างนี้จะกำหนดให้เป็นค่าเริ่มต้นทั้งหมดก่อน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>fit_rf1 <span class="ot">&lt;-</span> <span class="fu">ranger</span>(salary_class <span class="sc">~</span> . ,</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> train,</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">importance =</span> <span class="st">"impurity"</span>)</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>fit_rf1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger(salary_class ~ ., data = train, importance = "impurity") 

Type:                             Classification 
Number of trees:                  500 
Sample size:                      317 
Number of independent variables:  5 
Mtry:                             2 
Target node size:                 1 
Variable importance mode:         impurity 
Splitrule:                        gini 
OOB prediction error:             15.14 % </code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vip</span>(fit_rf1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>คำนวณค่าทำนายและตรวจสอบความคลาดเคลื่อนของค่าทำนายบนชุดข้อมูล test data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_rf1, test, <span class="at">type=</span><span class="st">"response"</span>)<span class="sc">$</span>predictions</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pred, test<span class="sc">$</span>salary_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fine-tune-hyperparameters" class="level2">
<h2 class="anchored" data-anchor-id="fine-tune-hyperparameters">9.5 fine-tune hyperparameters</h2>
<p>หัวข้อนี้จะแสดงการ fine-tune hyperparameter ของ random forest ตาม algorithm ที่ในข้างต้น โดยใช้ tidymodel framwork รายละเอียดมีดังนี้</p>
<section id="ขนแรก-นำเขาขอมล-และจดการ-label-ของขอมล" class="level3">
<h3 class="anchored" data-anchor-id="ขนแรก-นำเขาขอมล-และจดการ-label-ของขอมล">ขั้นแรก นำเข้าข้อมูล และจัดการ label ของข้อมูล</h3>
<p>ตัวอย่างนี้จะแปลงข้อมูลตัวแปรตาม <code>salary</code> ให้เป็นตัวแปรแบบจัดประเภทที่มี 2 กลุ่ม คือกลุ่มที่เป็นอาจารย์รายได้สูง (&gt;= 100,000 บาท) และกลุ่มอาจารย์รายได้ต่ำ (&lt; 100,000 บาท)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="co"># importing dataset</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv"</span>)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat, <span class="at">width =</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 397
Columns: 7
$ X             &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ rank          &lt;chr&gt; "Prof", "Prof", "AsstProf", "Prof", "Prof", "AssocProf",…
$ discipline    &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "…
$ yrs.since.phd &lt;int&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 1…
$ yrs.service   &lt;int&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3,…
$ sex           &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male", …
$ salary        &lt;int&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 14…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salary_class =</span> <span class="fu">ifelse</span>(salary<span class="sc">&gt;=</span><span class="dv">100000</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">salary_class =</span> <span class="fu">factor</span>(salary_class, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"high"</span>)))</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat, <span class="at">width =</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 397
Columns: 8
$ X             &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ rank          &lt;chr&gt; "Prof", "Prof", "AsstProf", "Prof", "Prof", "AssocProf",…
$ discipline    &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "…
$ yrs.since.phd &lt;int&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 1…
$ yrs.service   &lt;int&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3,…
$ sex           &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male", …
$ salary        &lt;int&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 14…
$ salary_class  &lt;fct&gt; high, high, low, high, high, low, high, high, high, high…</code></pre>
</div>
</div>
</section>
<section id="ขนทสอง-แบงชดขอมล" class="level3">
<h3 class="anchored" data-anchor-id="ขนทสอง-แบงชดขอมล">ขั้นที่สอง แบ่งชุดข้อมูล</h3>
<p>กำหนด seed number เท่ากับ 123 จากนั้นแบ่งชุดข้อมูลโดยใช้ rsample package ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(dat, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>train<span class="ot">&lt;-</span><span class="fu">training</span>(split)</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>test<span class="ot">&lt;-</span><span class="fu">testing</span>(split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ขนทสาม-สราง-recipe-object-สำหรบจดการขอมล" class="level3">
<h3 class="anchored" data-anchor-id="ขนทสาม-สราง-recipe-object-สำหรบจดการขอมล">ขั้นที่สาม สร้าง recipe object สำหรับจัดการข้อมูล</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">recipe</span>(salary_class <span class="sc">~</span> ., <span class="at">data =</span> train) <span class="sc">%&gt;%</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_select</span>(<span class="sc">-</span>X, <span class="sc">-</span>salary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ขนท-4-กำหนดโมเดล-model-specification" class="level3">
<h3 class="anchored" data-anchor-id="ขนท-4-กำหนดโมเดล-model-specification">ขั้นที่ 4 กำหนดโมเดล (model specification)</h3>
<p>ตัวอย่างนี้จะใช้ random forest ใน parsnip สามารถ fit random forest model ได้ด้วย engine หลายตัว ในตัวอย่างนี้จะใช้ <code>ranger</code> ที่มี hyperparameter ให้กำหนดได้ 3 ตัวได้แก่ mtry, trees และ min_n</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>forest_mod <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ขนท-5-สราง-workflow" class="level3">
<h3 class="anchored" data-anchor-id="ขนท-5-สราง-workflow">ขั้นที่ 5 สร้าง workflow</h3>
<p>ผู้วิเคราะห์ไม่จำเป็นต้องสร้าง workflow ก็สามารถใช้ <code>tune_grid()</code> เพื่อ fine-tune hyperparameter ได้ โดยใช้ parsnip object ที่สร้างขึ้นในขั้น 4 เป็น object ใน <code>tune_grid()</code> ได้เลย อย่างไรก็ตามในสถานการณ์ทั่วไปผู้วิเคราะห์จะเป็นต้อง preprocess ข้อมูลก่อนอยู่แล้ว การใช้ workflow จึงน่าจะสะดวกกว่าในกรณีทั่วไป</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(preproc) <span class="sc">%&gt;%</span></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(forest_mod)</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>rf_workflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
1 Recipe Step

• step_select()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (classification)

Main Arguments:
  mtry = tune()
  trees = 500
  min_n = tune()

Computational engine: ranger </code></pre>
</div>
</div>
</section>
<section id="ขนท-6-เตรยมทำ-cross-validation-และกำหนด-hyperparameter-grid" class="level3">
<h3 class="anchored" data-anchor-id="ขนท-6-เตรยมทำ-cross-validation-และกำหนด-hyperparameter-grid">ขั้นที่ 6 เตรียมทำ cross-validation และกำหนด hyperparameter grid</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create folds</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train, <span class="at">repeats =</span><span class="dv">5</span>, <span class="at">strata =</span> <span class="st">"salary_class"</span>)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create random grid</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>my_hyparams <span class="ot">&lt;-</span> <span class="fu">parameters</span>(<span class="fu">mtry</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)),</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">min_n</span>(<span class="fu">range</span>(<span class="dv">10</span>,<span class="dv">40</span>)))</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>my_grid <span class="ot">&lt;-</span> <span class="fu">grid_random</span>(my_hyparams, <span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>my_grid <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(mtry, min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crete evaluation metrics</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>eval_metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(roc_auc, sens, spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ขนท-7-ทำ-cv-เพอนำขอมลมา-tune-hyperparameters" class="level3">
<h3 class="anchored" data-anchor-id="ขนท-7-ทำ-cv-เพอนำขอมลมา-tune-hyperparameters">ขั้นที่ 7 ทำ CV เพื่อนำข้อมูลมา tune hyperparameters</h3>
<p>ฟังก์ชันที่ใช้คือ <code>tune_grid()</code> มีอาร์กิวเมนท์ที่สำคัญได้แก่</p>
<ul>
<li><p><code>resamples</code> ใช้ระบุชุดข้อมูลที่สร้างขึ้นจากกระบวนการสุ่มซ้ำ เช่น k-folds CV หรือ boostraping dataset</p></li>
<li><p><code>grid</code> ใช้สำหรับระบุ grid ของ hyperparameter ของอัลกอริทึมการเรียนรู้ที่เลือกใช้</p></li>
<li><p><code>control</code> ใช้กำหนด option สำหรับควบคุมกระบวนการสุ่มซ้ำ (resample) และปรับแต่งค่า hyperparameter การกำหนดอาร์กิวเมนท์นี้จะต้องกำหนดผ่านฟังก์ชัน <code>control_resamples()</code> หรือ <code>control_grid()</code> อีกทีหนึ่ง รายละเอียดของฟังก์ชันทั้งสองสามารถศึกษาได้จากคู่มือการใช้งาน (พิมพ์ <code>?control_resamples</code> หรือ <code>?control_grid</code>)</p></li>
<li><p><code>metrics</code> ใช้กำหนด evalution metrics ที่ผู้วิเคราะห์จะใช้เพื่อประเมินประสิทธิภาพของโมเดลระหว่างการปรับแต่งค่าพารามิเตอร์ การกำหนดอาร์กิวเมนท์นี้ให้ทำผ่านฟังก์ชัน <code>metric_set()</code> ในกรณีที่ไม่ได้กำหนดโปรแกรมจะกำหนดให้ใช้ค่าเริ่มต้น ซึ่งจะเลือกให้เหมาะสมกับ mode ของโมเดล</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">grid =</span> my_grid,</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">metrics =</span> eval_metric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="วเคราะห-tuning-results" class="level3">
<h3 class="anchored" data-anchor-id="วเคราะห-tuning-results">วิเคราะห์ tuning results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 57 × 8
    mtry min_n .metric .estimator  mean     n std_err .config              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1     5    18 roc_auc binary     0.859    50 0.0113  Preprocessor1_Model01
 2     5    18 sens    binary     0.688    50 0.0205  Preprocessor1_Model01
 3     5    18 spec    binary     0.955    50 0.00658 Preprocessor1_Model01
 4     1    21 roc_auc binary     0.877    50 0.0100  Preprocessor1_Model02
 5     1    21 sens    binary     0.669    50 0.0199  Preprocessor1_Model02
 6     1    21 spec    binary     0.964    50 0.00570 Preprocessor1_Model02
 7     4    14 roc_auc binary     0.856    50 0.0117  Preprocessor1_Model03
 8     4    14 sens    binary     0.708    50 0.0195  Preprocessor1_Model03
 9     4    14 spec    binary     0.950    50 0.00827 Preprocessor1_Model03
10     4    33 roc_auc binary     0.864    50 0.0110  Preprocessor1_Model04
# … with 47 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"sens"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 8
    mtry min_n .metric .estimator  mean     n std_err .config              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1     3    38 sens    binary     0.726    50  0.0189 Preprocessor1_Model14
 2     3    35 sens    binary     0.726    50  0.0189 Preprocessor1_Model19
 3     2    11 sens    binary     0.721    50  0.0195 Preprocessor1_Model18
 4     3    37 sens    binary     0.721    50  0.0187 Preprocessor1_Model07
 5     3    11 sens    binary     0.719    50  0.0191 Preprocessor1_Model08
 6     2    33 sens    binary     0.713    50  0.0205 Preprocessor1_Model16
 7     4    14 sens    binary     0.708    50  0.0195 Preprocessor1_Model03
 8     4    20 sens    binary     0.705    50  0.0195 Preprocessor1_Model12
 9     4    13 sens    binary     0.704    50  0.0196 Preprocessor1_Model06
10     4    36 sens    binary     0.704    50  0.0202 Preprocessor1_Model15
11     4    33 sens    binary     0.692    50  0.0208 Preprocessor1_Model04
12     5    10 sens    binary     0.690    50  0.0197 Preprocessor1_Model09
13     5    18 sens    binary     0.688    50  0.0205 Preprocessor1_Model01
14     5    28 sens    binary     0.672    50  0.0212 Preprocessor1_Model10
15     1    14 sens    binary     0.671    50  0.0198 Preprocessor1_Model17
16     1    21 sens    binary     0.669    50  0.0199 Preprocessor1_Model02
17     1    16 sens    binary     0.669    50  0.0199 Preprocessor1_Model13
18     1    25 sens    binary     0.661    50  0.0192 Preprocessor1_Model11
19     1    39 sens    binary     0.659    50  0.0197 Preprocessor1_Model05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"roc_auc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 8
    mtry min_n .metric .estimator  mean     n std_err .config              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1     1    14 roc_auc binary     0.880    50 0.00963 Preprocessor1_Model17
 2     1    16 roc_auc binary     0.879    50 0.00997 Preprocessor1_Model13
 3     1    21 roc_auc binary     0.877    50 0.0100  Preprocessor1_Model02
 4     1    25 roc_auc binary     0.876    50 0.0101  Preprocessor1_Model11
 5     1    39 roc_auc binary     0.875    50 0.00991 Preprocessor1_Model05
 6     2    33 roc_auc binary     0.868    50 0.0107  Preprocessor1_Model16
 7     2    11 roc_auc binary     0.866    50 0.00979 Preprocessor1_Model18
 8     4    36 roc_auc binary     0.866    50 0.0109  Preprocessor1_Model15
 9     3    35 roc_auc binary     0.865    50 0.0108  Preprocessor1_Model19
10     3    37 roc_auc binary     0.865    50 0.0107  Preprocessor1_Model07
11     4    33 roc_auc binary     0.864    50 0.0110  Preprocessor1_Model04
12     3    38 roc_auc binary     0.864    50 0.0109  Preprocessor1_Model14
13     5    28 roc_auc binary     0.863    50 0.0110  Preprocessor1_Model10
14     4    20 roc_auc binary     0.861    50 0.0111  Preprocessor1_Model12
15     5    18 roc_auc binary     0.859    50 0.0113  Preprocessor1_Model01
16     3    11 roc_auc binary     0.858    50 0.0108  Preprocessor1_Model08
17     4    13 roc_auc binary     0.857    50 0.0115  Preprocessor1_Model06
18     4    14 roc_auc binary     0.856    50 0.0117  Preprocessor1_Model03
19     5    10 roc_auc binary     0.852    50 0.0116  Preprocessor1_Model09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>tuning_results <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>(<span class="at">summarize =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"sens"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> std_err, <span class="at">y=</span> mean))<span class="sc">+</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-104-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>best <span class="ot">&lt;-</span> <span class="fu">show_best</span>(tuning_results, <span class="at">n=</span><span class="dv">6</span>, <span class="at">metric =</span> <span class="st">"sens"</span>)</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>best[<span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
   mtry min_n .metric .estimator  mean     n std_err .config              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
1     3    38 sens    binary     0.726    50  0.0189 Preprocessor1_Model14</code></pre>
</div>
</div>
</section>
<section id="ขนท-8-finalized" class="level3">
<h3 class="anchored" data-anchor-id="ขนท-8-finalized">ขั้นที่ 8 Finalized</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>RF_final <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best[<span class="dv">1</span>,]) <span class="sc">%&gt;%</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(split,</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">metrics =</span>eval_metric)</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>RF_final <span class="sc">%&gt;%</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~3L,      x), num.trees = ~500, min.node.size = min_rows(~38L, x),      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1), probability = TRUE) 

Type:                             Probability estimation 
Number of trees:                  500 
Sample size:                      317 
Number of independent variables:  5 
Mtry:                             3 
Target node size:                 38 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error (Brier s.):  0.1078116 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>RF_final <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 sens    binary         0.706 Preprocessor1_Model1
2 spec    binary         0.891 Preprocessor1_Model1
3 roc_auc binary         0.850 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
</section>
<section id="grid-search-methods" class="level2">
<h2 class="anchored" data-anchor-id="grid-search-methods">9.5 Grid Search methods</h2>
<p>ปัจจัยสำคัญตัวหนึ่งที่มีผลโดยตรงต่อประสิทธิภาพการปรับแต่ง hyperparameter คือการกำหนด grid ของ hyperparameter ใน tidymodel สามารถจำแนกได้เป็น 2 ประเภท ได้แก่</p>
<ul>
<li><p>regular grid</p></li>
<li><p>nonregular grid</p></li>
</ul>
<p>รายละเอียดมีดังนี้</p>
</section>
<section id="regular-grid" class="level2">
<h2 class="anchored" data-anchor-id="regular-grid">Regular grid</h2>
<p>regular grid เป็น grid ของ hyperparameter ที่สร้างขึ้นจากส่วนผสม (combination) ของค่าที่เป็นไปได้ทั้งหมดของ hyperparameter ที่ต้องการวิเคราะห์ การสร้าง regular grid มี 2 ขั้นตอน ขั้นตอนแรกคือการกำหนดค่าที่เป็นไปได้ของ hyperparameter แต่ละตัว และขั้นที่สองคือการสร้าง grid ของค่าที่เป็นไปได้ดังกล่าว ผลลัพธ์ที่ได้คือ hyperparameter space ที่สมบูรณ์</p>
<p>การสร้าง regular grid ใน R สามารถทำได้หลายวิธีการ วิธีการแรกคือการใช้ฟังก์ชัน <code>expand.grid()</code> วิธีการที่สองคือการใช้ฟังก์ชัน <code>crossing()</code> ของ package tidyr และวิธีการที่สามคือการใช้ฟังก์ชัน <code>grid_regular()</code> ของ package dials</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>my_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">5</span>)</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mtry min_n
1    1    10
2    2    10
3    3    10
4    4    10
5    5    10
6    1    15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(my_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mtry min_n
40    5    45
41    1    50
42    2    50
43    3    50
44    4    50
45    5    50</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">5</span>)</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 45 × 2
    mtry min_n
   &lt;int&gt; &lt;dbl&gt;
 1     1    10
 2     1    15
 3     1    20
 4     1    25
 5     1    30
 6     1    35
 7     1    40
 8     1    45
 9     1    50
10     2    10
# … with 35 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>my_params <span class="ot">&lt;-</span> <span class="fu">extract_parameter_set_dials</span>(rf_workflow) <span class="sc">%&gt;%</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(<span class="at">mtry =</span> <span class="fu">mtry</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)),</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">min_n =</span> <span class="fu">min_n</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">60</span>)))</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>my_reggrid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(my_params, <span class="at">levels =</span> <span class="dv">5</span>)</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>my_reggrid <span class="sc">%&gt;%</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ข้อจำกัดของ regular grid คือใช้ทรัพยากรในการประมวลผลมาก โดยเฉพาะกับโมเดลที่มี hyperparameter จำนวนมาก และมีการทวนซ้ำหลายรอบ</p>
</section>
<section id="irregular-grid" class="level2">
<h2 class="anchored" data-anchor-id="irregular-grid">Irregular grid</h2>
<p>มีหลายวิธีที่จะช่วยลดการประมวลผลของ regular grid ลงได้ วิธีการแรกคือ random grid ที่ใช้วิธีการสุ่มตัวอย่าง เพื่อสุ่ม grid มาจากประชากรของ grid ที่เป็นไปได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="ot">&lt;-</span> <span class="fu">grid_random</span>(my_params, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="sc">%&gt;%</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="ot">&lt;-</span> <span class="fu">grid_random</span>(my_params, <span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-109-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="ot">&lt;-</span> <span class="fu">grid_random</span>(my_params, <span class="at">size =</span> <span class="dv">50</span>)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>my_randomgrid <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-110-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ข้อจำกัดของ random grid คือ หาก generate grid ขนาดเล็ก มีโอกาสที่จะได้ grid ที่มีความใกล้เคียงหรือซ้อนทับกันมากเกินไป กล่าวคือ hyperparameter space ที่สร้างขึ้นอาจขาดคุณสมบัติความเป็นตัวแทน ผลการวิเคราะห์ที่ได้จึงอาจทำให้การปรับแต่ง hyperparameter มีความคลาดเคลื่อน</p>
<p>จากข้อจำกัดดังกล่าวการสร้าง grid ของ hyperparameter ที่มีประสิทธิภาพมากกว่า random grid คือการใช้วิธีในกลุ่ม space-filling design ที่มีอัลกอริทึมภายใต้วิธีการในกลุ่มนี้หลายตัว เช่น latin hypercubes, maximum entropy designs, maximum projection designs เป็นต้น</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>my_latingrid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(my_params, <span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>my_latingrid <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>my_maxentrp <span class="ot">&lt;-</span> <span class="fu">grid_max_entropy</span>(my_params, <span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>my_maxentrp  <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mtry, <span class="at">y =</span> min_n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-111-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid" width="864"></p>
</div>
</div>
</section>
</section>
<section id="บทท-10-workflow-set" class="level1">
<h1>บทที่ 10: workflow set</h1>
<p>ในทางปฏิบัติเรามักจะมีโมเดลคู่แข่งขันหลายตัวที่จะนำมาพัฒนาควบคู่กัน ภายใต้ tidymodel framework ผู้วิเคราะห์สามารถสร้าง workflow set เพื่อ fine tune hyperparameter และเปรียบเทียบโมเดลหลาย ๆ ตัวไปพร้อม ๆ กันในการประมวลผลรอบเดียวได้</p>
<p>ผู้วิเคราะห์ต้องการพัฒนาโมเดลจำแนก class โดยมีโมเดลคู่แข่งขันที่เลือกมาใช้งานได้แก่</p>
<ul>
<li><p>logistic regression (with filter selection)</p></li>
<li><p>logistic regression with regulization</p></li>
<li><p>decision tree</p></li>
<li><p>random forest</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">#importing data</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(parabolic)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(parabolic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 500
Columns: 3
$ X1    &lt;dbl&gt; 3.291779227, 1.465839693, 1.660986913, 1.602301296, 2.165003287,…
$ X2    &lt;dbl&gt; 1.66108928, 0.41398566, 0.79147013, 0.27639110, 3.16557011, 3.82…
$ class &lt;fct&gt; Class1, Class2, Class2, Class2, Class1, Class1, Class2, Class1, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># splitting data</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> parabolic)</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="co">#exploring</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">col=</span>class))<span class="sc">+</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co">#preprocessing</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>base_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(class <span class="sc">~</span> . ,<span class="at">data=</span> train)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>filter_recipe <span class="ot">&lt;-</span> base_recipe <span class="sc">%&gt;%</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>embed_recipe <span class="ot">&lt;-</span> base_recipe <span class="sc">%&gt;%</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a><span class="co"># model specification</span></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>regular_logit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty=</span> <span class="fu">tune</span>(),</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(),</span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="fu">tune</span>())<span class="sc">%&gt;%</span></span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb247-27"><a href="#cb247-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-28"><a href="#cb247-28" aria-hidden="true" tabindex="-1"></a><span class="co"># creating workflowset</span></span>
<span id="cb247-29"><a href="#cb247-29" aria-hidden="true" tabindex="-1"></a>my_workflowset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb247-30"><a href="#cb247-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">embed =</span> embed_recipe,</span>
<span id="cb247-31"><a href="#cb247-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">simple =</span> base_recipe),</span>
<span id="cb247-32"><a href="#cb247-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">list</span>(<span class="at">reg_logit =</span> regular_logit,</span>
<span id="cb247-33"><a href="#cb247-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">cart =</span> tree_mod),</span>
<span id="cb247-34"><a href="#cb247-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">cross =</span> <span class="cn">FALSE</span></span>
<span id="cb247-35"><a href="#cb247-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb247-36"><a href="#cb247-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-37"><a href="#cb247-37" aria-hidden="true" tabindex="-1"></a><span class="co"># resampls for CV</span></span>
<span id="cb247-38"><a href="#cb247-38" aria-hidden="true" tabindex="-1"></a>eval_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy,roc_auc, sens, spec)</span>
<span id="cb247-39"><a href="#cb247-39" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(<span class="at">data =</span> train, <span class="at">v =</span> <span class="dv">10</span>, <span class="at">repeats =</span><span class="dv">5</span>)</span>
<span id="cb247-40"><a href="#cb247-40" aria-hidden="true" tabindex="-1"></a>all_tune <span class="ot">&lt;-</span> my_workflowset <span class="sc">%&gt;%</span></span>
<span id="cb247-41"><a href="#cb247-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb247-42"><a href="#cb247-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">grid =</span> <span class="dv">25</span>,</span>
<span id="cb247-43"><a href="#cb247-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb247-44"><a href="#cb247-44" aria-hidden="true" tabindex="-1"></a>               <span class="at">metrics =</span> eval_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>i 1 of 2 tuning:     embed_reg_logit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ 1 of 2 tuning:     embed_reg_logit (6m 24.8s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>i 2 of 2 tuning:     simple_cart</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ 2 of 2 tuning:     simple_cart (6m 26.9s)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rank_results</span>(all_tune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 9
   wflow_id    .config           .metric  mean std_err     n prepr…¹ model  rank
   &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt;
 1 simple_cart Preprocessor1_Mo… accura… 0.903 0.00627    50 recipe  deci…     1
 2 simple_cart Preprocessor1_Mo… roc_auc 0.938 0.00525    50 recipe  deci…     1
 3 simple_cart Preprocessor1_Mo… sens    0.899 0.00991    50 recipe  deci…     1
 4 simple_cart Preprocessor1_Mo… spec    0.906 0.00926    50 recipe  deci…     1
 5 simple_cart Preprocessor1_Mo… accura… 0.902 0.00562    50 recipe  deci…     2
 6 simple_cart Preprocessor1_Mo… roc_auc 0.904 0.00528    50 recipe  deci…     2
 7 simple_cart Preprocessor1_Mo… sens    0.842 0.0101     50 recipe  deci…     2
 8 simple_cart Preprocessor1_Mo… spec    0.960 0.00507    50 recipe  deci…     2
 9 simple_cart Preprocessor1_Mo… accura… 0.901 0.00625    50 recipe  deci…     3
10 simple_cart Preprocessor1_Mo… roc_auc 0.938 0.00525    50 recipe  deci…     3
# … with 190 more rows, and abbreviated variable name ¹​preprocessor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>all_tune <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(<span class="at">metric =</span> <span class="st">"roc_auc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-113-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>จากผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่า decision tree มีประสิทธิภาพสูงกว่า regularized logistic regression เราสามารถดึงข้อมูลของ regularized logistic regression ขึ้นมาได้โดยใช้คำสั่งต่อไปนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>all_tune <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(<span class="at">metric =</span> <span class="st">"sens"</span>, <span class="at">id =</span> <span class="st">"simple_cart"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="หนังสือ_ML_pdf_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>simple_cart_results<span class="ot">&lt;-</span> all_tune <span class="sc">%&gt;%</span> </span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow_set_result</span>(<span class="at">id =</span> <span class="st">"simple_cart"</span>)</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>simple_cart_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Tuning results
# 10-fold cross-validation repeated 5 times 
# A tibble: 50 × 5
   splits           id      id2    .metrics           .notes          
   &lt;list&gt;           &lt;chr&gt;   &lt;chr&gt;  &lt;list&gt;             &lt;list&gt;          
 1 &lt;split [337/38]&gt; Repeat1 Fold01 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 2 &lt;split [337/38]&gt; Repeat1 Fold02 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 3 &lt;split [337/38]&gt; Repeat1 Fold03 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 4 &lt;split [337/38]&gt; Repeat1 Fold04 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 5 &lt;split [337/38]&gt; Repeat1 Fold05 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 6 &lt;split [338/37]&gt; Repeat1 Fold06 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 7 &lt;split [338/37]&gt; Repeat1 Fold07 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 8 &lt;split [338/37]&gt; Repeat1 Fold08 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
 9 &lt;split [338/37]&gt; Repeat1 Fold09 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
10 &lt;split [338/37]&gt; Repeat1 Fold10 &lt;tibble [100 × 6]&gt; &lt;tibble [0 × 3]&gt;
# … with 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(simple_cart_results, <span class="at">n=</span><span class="dv">5</span>, <span class="at">metric =</span> <span class="st">"sens"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  cost_complexity min_n .metric .estimator  mean     n std_err .config          
            &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;            
1        1.10e- 8    38 sens    binary     0.919    50 0.0105  Preprocessor1_Mo…
2        2.95e- 9    39 sens    binary     0.916    50 0.0107  Preprocessor1_Mo…
3        3.08e- 7    35 sens    binary     0.915    50 0.0107  Preprocessor1_Mo…
4        1.05e- 4    34 sens    binary     0.913    50 0.0108  Preprocessor1_Mo…
5        1.80e-10    21 sens    binary     0.901    50 0.00996 Preprocessor1_Mo…</code></pre>
</div>
</div>
<p>ขั้นตอนสุดท้ายคือการ finalized model …</p>
</section>
<section id="บทท-11-k-nn-algorithm" class="level1">
<h1>บทที่ 11: K-NN algorithm</h1>
<p>บทเรียนนี้จะกล่าวถึงการพัฒนา classification model ด้วยอัลกอริทึม K-Nearest Neighbors (K-NN) อัลกอริทึมนี้เป็นอัลกอริทึมพื้นฐานที่ใช้สำหรับทำนายกลุ่มหรือจำแนกประเภทของหน่วยข้อมูล ซึ่งบ่อยครั้งสามารถทำได้อย่างมีประสิทธิภาพ แนวคิดพื้นฐานของอัลกอริทึม K-NN คือการบันทึกข้อมูล feature และ labels ของหน่วยข้อมูลใน training data เอาไว้ และใช้ข้อมูลที่บันทึกนี้สำหรับการทำนายหน่วยข้อมูลใหม่ โดยจะนำ feature ของหน่วยข้อมูลใหม่มาเปรียบเทียบกับ training data ที่บันทึกเอาไว้ จากนั้นหาหน่วยข้อมูลใน training data ที่มีลักษณะของ feature ใกล้เคียงกับหน่วยข้อมูลใหม่มากที่สุดขึ้นมาจำนวน K ค่า จากนั้นนำ labels ของหน่วยข้อมูลทั้ง K ค่า มาหาฉันทามติซึ่งจะใช้เป็นค่าทำนาย label ของหน่วยข้อมูลใหม่</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image-1247111281.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">สิวะโชติ ศรีสุทธิยากร (2563)</figcaption><p></p>
</figure>
</div>
<p>อัลกอริทึม K-NN (พื้นฐาน) มี hyperparameter จำนวน 1 ตัว ได้แก่ K หรือจำนวนหน่วยข้อมูลที่มีคุณลักษณะใกล้เคียงกับหน่วยข้อมูลที่ต้องการทำนายมากที่สุด ในทางทฤษฎีค่า K เป็นพารามิเตอร์ที่ใช้กำหนดความซับซ้อนของโมเดล กล่าวคือยิ่ง K มีค่าน้อยโมเดลจะยิ่งมีความยืดหยุ่นหรือมีความไวต่อการเปลี่ยนแปลงในความสัมพันธ์ของข้อมูลมาก ในทางกลับกันหาก K มีค่ามาก อัลกอริทึมจะมีความไวต่อการเปลี่ยนแปลงหรือความสัมพันธ์ของข้อมูลลดลง ทำให้โมเดลมีความซับซ้อนลดลงไปด้วย</p>
<p>การกำหนดค่า K ที่น้อยเกินไปอาจส่งผลให้โมเดลทำนายมีแนวโน้มเป็น overfitting model ในทางกลับกันการกำหนด K ที่มากเกินไปก็อาจส่งผลให้โมเดลทำนายมีแนวโน้มเป็น underfitting model อย่างไรก็ตามการกำหนดค่า K ดังกล่าวไม่สามารถประมาณได้โดยตรงจากข้อมูล ในทางปฏิบัติจะใช้เทคนิคการสุ่มซ้ำ (resampling technique) เช่น cross-validation หรือ bootstrap เพื่อค้นหาและระบุค่า K ที่เหมาะสมมากที่สุด</p>
<section id="distance-matrices" class="level2">
<h2 class="anchored" data-anchor-id="distance-matrices"><img src="images/image-587457222.png" class="img-fluid"> 11.1 Distance matrices</h2>
<p>อัลกอริทึม K-NN จะเปรียบเทียบความต่างหรือความเหมือนของหน่วยข้อมูลใหม่ที่ต้องการทำนาย กับหน่วยข้อมูลในชุดข้อมูลฝึกหัดโดยใช้การวัดระยะทางระหว่างหน่วยข้อมูลบนระนาบของ features ที่ใช้เป็นตัวแทนทำนาย หน่วยข้อมูลที่มีคุณลักษณะหรือค่าของ feature ใกล้เคียงกันจะมีระยะทางบนระนาบดังกล่าวที่ใกล้เคียงกัน ในทางกลับกันหน่วยข้อมูลที่มีคุณลักษณะแตกต่างกันจะมีระยะทางบนระนาบที่ห่างกัน ดังตัวอย่างในรูปด้านล่าง</p>
<p><img src="images/image-76231899.png" class="img-fluid"><br>
ระยะทางที่ใช้ในอัลกริทึม K-NN มีหลายตัว สมมุติให้ <span class="math inline">\(x = (x_1, x_2, x_3, …, x_p)\)</span> และ <span class="math inline">\(y=(y_1,y_2,y_3,...,y_p)\)</span> เป็นเวกเตอร์ของ feature ของหน่วยข้อมูลสองหน่วย ได้แก่ หน่วยข้อมูล X และ หน่วยข้อมูล Y</p>
<p>หัวข้อนี้จะกล่าวถึงวิธีการคำนวณระยะทางระหว่างจุดทั้งสองที่สามารถเลือกใช้ได้ทั้งใน python และ R จำนวน 4 วิธีการได้แก่ ระยะทางแบบ Euclidean, Manhattan, Minkowski และ Hamming รายละเอียดมีดังนี้</p>
<section id="euclidean-distance" class="level3">
<h3 class="anchored" data-anchor-id="euclidean-distance">Euclidean Distance</h3>
<p>ระยะแบบ euclidean เป็นระยะที่วัดจากเส้นตรงที่สั้นที่สุดที่สามารถลากเชื่อมต่อระหว่างจุดสองจุดบนระนาบที่กำหนด จากกำหนดจุด X และ Y บนระนาบขนาด p มิติในข้างต้น จะได้ว่าระยะทางแบบ euclidean สามารถคำนวณได้โดยใช้สูตรดังนี้</p>
<p><span class="math display">\[
d(x)
\]</span></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>