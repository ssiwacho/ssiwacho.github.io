<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ML: สัปดาห์ที่ 3:  Linear Regression (2)</title>
    <meta charset="utf-8" />
    <meta name="author" content="อ.ดร.สิวะโชติ ศรีสุทธิยากร" />
    <script src="week3_files/header-attrs/header-attrs.js"></script>
    <script src="week3_files/htmlwidgets/htmlwidgets.js"></script>
    <script src="week3_files/jquery/jquery.min.js"></script>
    <link href="week3_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="week3_files/datatables-binding/datatables.js"></script>
    <link href="week3_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="week3_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="week3_files/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="week3_files/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="week3_files/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer1.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# ML: สัปดาห์ที่ 3: </br> Linear Regression (2)
### อ.ดร.สิวะโชติ ศรีสุทธิยากร

---


class: center, middle






# housing.csv


---
class: middle

.left-column[

### housing.csv

- **Importing Data**

- Data Preprocessing

- Modelling

- Models Evaluating


]

.right-column[

### Importing Data


```r
#setwd() # &lt;--- setting working directory
#getwd() # &lt;--- checking working directory
#dir() # &lt;--- List the Files in a Directory/Folder
dat&lt;-read.csv("housing.csv")
head(dat)
```


```
##   longitude latitude housing_median_age total_rooms total_bedrooms population
## 1   -122.23    37.88                 41         880            129        322
## 2   -122.22    37.86                 21        7099           1106       2401
## 3   -122.24    37.85                 52        1467            190        496
## 4   -122.25    37.85                 52        1274            235        558
## 5   -122.25    37.85                 52        1627            280        565
## 6   -122.25    37.85                 52         919            213        413
##   households median_income median_house_value ocean_proximity
## 1        126        8.3252             452600        NEAR BAY
## 2       1138        8.3014             358500        NEAR BAY
## 3        177        7.2574             352100        NEAR BAY
## 4        219        5.6431             341300        NEAR BAY
## 5        259        3.8462             342200        NEAR BAY
## 6        193        4.0368             269700        NEAR BAY
```



]


---
class: middle, center

# Any Problem?


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]


.right-column[


### Data Preprocessing

Data preprocessing techniques generally refer to addition, deletion, or transformation of data.

- Exploring data

- Handling missing data

- Outlier detection

- Transforming data

- Feature Extraction

- Features Scaling

The need for data preprocessing is depended on data in hand and the type of model being used.


- Learning algorithm of linear regression is relied on `\((X^TX)^{-1}\)` matrix, hence it is sensitive to characteristics of predictor data.

- Tree-based model are insensitive to characteristics of the variables.


]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[


```r
str(dat)
```

```
## 'data.frame':	20640 obs. of  10 variables:
##  $ longitude         : num  -122 -122 -122 -122 -122 ...
##  $ latitude          : num  37.9 37.9 37.9 37.9 37.9 ...
##  $ housing_median_age: num  41 21 52 52 52 52 52 52 42 52 ...
##  $ total_rooms       : num  880 7099 1467 1274 1627 ...
##  $ total_bedrooms    : num  129 1106 190 235 280 ...
##  $ population        : num  322 2401 496 558 565 ...
##  $ households        : num  126 1138 177 219 259 ...
##  $ median_income     : num  8.33 8.3 7.26 5.64 3.85 ...
##  $ median_house_value: num  452600 358500 352100 341300 342200 ...
##  $ ocean_proximity   : chr  "NEAR BAY" "NEAR BAY" "NEAR BAY" "NEAR BAY" ...
```
]




---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]


.right-column[


```r
summary(dat)
```

```
##    longitude         latitude     housing_median_age  total_rooms   
##  Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
##  1st Qu.:-121.8   1st Qu.:33.93   1st Qu.:18.00      1st Qu.: 1448  
##  Median :-118.5   Median :34.26   Median :29.00      Median : 2127  
##  Mean   :-119.6   Mean   :35.63   Mean   :28.64      Mean   : 2636  
##  3rd Qu.:-118.0   3rd Qu.:37.71   3rd Qu.:37.00      3rd Qu.: 3148  
##  Max.   :-114.3   Max.   :41.95   Max.   :52.00      Max.   :39320  
##                                                                     
##  total_bedrooms     population      households     median_income    
##  Min.   :   1.0   Min.   :    3   Min.   :   1.0   Min.   : 0.4999  
##  1st Qu.: 296.0   1st Qu.:  787   1st Qu.: 280.0   1st Qu.: 2.5634  
##  Median : 435.0   Median : 1166   Median : 409.0   Median : 3.5348  
##  Mean   : 537.9   Mean   : 1425   Mean   : 499.5   Mean   : 3.8707  
##  3rd Qu.: 647.0   3rd Qu.: 1725   3rd Qu.: 605.0   3rd Qu.: 4.7432  
##  Max.   :6445.0   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
##  NA's   :207                                                        
##  median_house_value ocean_proximity   
##  Min.   : 14999     Length:20640      
##  1st Qu.:119600     Class :character  
##  Median :179700     Mode  :character  
##  Mean   :206856                       
##  3rd Qu.:264725                       
##  Max.   :500001                       
## 
```

]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]


.right-column[


### Exploring data: Frequency Distribution


```r
#convert character data into factor
dat$ocean_proximity&lt;-factor(dat$ocean_proximity) 
#generate frequency distribution of ocean_proximity
table(dat$ocean_proximity) 
```

```
## 
##  &lt;1H OCEAN     INLAND     ISLAND   NEAR BAY NEAR OCEAN 
##       9136       6551          5       2290       2658
```

```r
par(mar=c(3,3,1,1))
barplot(table(dat$ocean_proximity))
```

&lt;img src="week3_files/figure-html/unnamed-chunk-5-1.png" width="504" /&gt;


]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[

### Exploring data: Frequency Distribution



```r
library(tidyr) # tidying datatable tools
library(dplyr) # manipulating data tools
par(mfrow=c(2,4),mar=c(5,4,0.5,0.5))
for(i in 1:7)
{
  hist(dat[,i+2],main="",xlab=names(dat)[i+2])
}
```

&lt;img src="week3_files/figure-html/unnamed-chunk-6-1.png" width="864" /&gt;

]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[

### Frequency Distribution (`nclass=30`)

&lt;img src="week3_files/figure-html/unnamed-chunk-7-1.png" width="864" /&gt;


]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;

&lt;small&gt;
**Note:** [California Map](https://www.google.com/maps/place/%E0%B9%81%E0%B8%84%E0%B8%A5%E0%B8%B4%E0%B8%9F%E0%B8%AD%E0%B8%A3%E0%B9%8C%E0%B9%80%E0%B8%99%E0%B8%B5%E0%B8%A2+%E0%B8%AA%E0%B8%AB%E0%B8%A3%E0%B8%B1%E0%B8%90%E0%B8%AD%E0%B9%80%E0%B8%A1%E0%B8%A3%E0%B8%B4%E0%B8%81%E0%B8%B2/data=!4m2!3m1!1s0x808fb9fe5f285e3d:0x8b5109a227086f55?sa=X&amp;ved=2ahUKEwjT98DtnrvrAhUjyzgGHbdiAnUQ8gEwHHoECBkQBg)
&lt;/small&gt;

]

.right-column[

### Visualizing geographical data: ocean_proximity

.pull-left[

```r
library(ggplot2)

ggplot()+geom_point(data=dat,
              aes(x=longitude,
                  y=latitude,
                  col=ocean_proximity),
              alpha=0.7)+
        theme_minimal()+
        coord_fixed(1.3)
```

]

.pull-right[
&lt;img src="week3_files/figure-html/unnamed-chunk-9-1.png" width="504" /&gt;


]
]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[

### Visualizing geographical data: median_house_value

.pull-left[

```r
library(ggplot2)
library(viridis)

ggplot()+geom_point(data=dat,
              aes(x=longitude,
                  y=latitude,
                  col=median_house_value),
                  alpha=0.7)+
        theme_minimal()+
        coord_fixed(1.3)
```

]

.pull-right[

&lt;img src="week3_files/figure-html/unnamed-chunk-11-1.png" width="504" /&gt;

]
]
---
.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[

### Manipulating Data


```r
# manipulating data
dat&lt;-dat%&gt;%mutate(room.per.household=total_rooms/households,
                  bedroom.per.room=total_bedrooms/total_rooms,
                  household.size=population/households)

summary(dat[,11:13])
```

```
##  room.per.household bedroom.per.room household.size     
##  Min.   :  0.8461   Min.   :0.1000   Min.   :   0.6923  
##  1st Qu.:  4.4407   1st Qu.:0.1754   1st Qu.:   2.4297  
##  Median :  5.2291   Median :0.2032   Median :   2.8181  
##  Mean   :  5.4290   Mean   :0.2130   Mean   :   3.0707  
##  3rd Qu.:  6.0524   3rd Qu.:0.2398   3rd Qu.:   3.2823  
##  Max.   :141.9091   Max.   :1.0000   Max.   :1243.3333  
##                     NA's   :207
```

]

---
.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


]

.right-column[

### Outlier Detecting


```r
dat%&gt;%filter(household.size&gt;1000)%&gt;%select(longitude,latitude,room.per.household,household.size,population,households)
```

```
##   longitude latitude room.per.household household.size population households
## 1   -121.98    38.32           3.166667       1243.333       7460          6
```

```r
dat%&gt;%filter(room.per.household&gt;100)
```

```
##   longitude latitude housing_median_age total_rooms total_bedrooms population
## 1   -120.10    38.91                 33        1561            282         30
## 2   -120.08    38.80                 34        1988            511         36
##   households median_income median_house_value ocean_proximity
## 1         11         1.875             500001          INLAND
## 2         15         4.625             162500          INLAND
##   room.per.household bedroom.per.room household.size
## 1           141.9091        0.1806534       2.727273
## 2           132.5333        0.2570423       2.400000
```



]

---
.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;

&lt;small&gt;

**Note:** [reference](https://www.google.co.th/maps/place/38°19'12.0%22N+121°58'48.0%22W/@38.320686,-121.9783531,919m/data=!3m1!1e3!4m5!3m4!1s0x0:0x0!8m2!3d38.32!4d-121.98)

&lt;/small&gt;

]

.right-column[


.pull-left[



```r
ggplot()+geom_point(data=dat,
              aes(x=longitude,
                  y=latitude),
                  col="grey",
                  alpha=0.5)+
         geom_point(aes(x=-121.98,
                        y=38.32),
                     col="red",
                     size=5)+
         geom_point(aes(x=-120.10,
                        y=38.91),
                     col="red",
                     size=5)        +

         geom_point(aes(x=-120.08,
                        y=38.80),
                     col="red",
                     size=5)  +
        theme_minimal()+
        scale_color_viridis()+
        coord_fixed(1.3)
```

]

.pull-right[
&lt;img src="week3_files/figure-html/unnamed-chunk-15-1.png" width="504" /&gt;
]

]

---
class: middle




```r
library(DT)
dat%&gt;%filter(room.per.household&gt;10)%&gt;%
      select(longitude,latitude,room.per.household,household.size,population,households)%&gt;%
      datatable(rownames=F, 
                options = list(pageLength=5,
                lengthMenu=c(5,10)))%&gt;%
      formatRound(columns=c('room.per.household', 'household.size'), digits=2)
```

<div id="htmlwidget-2d521249a8e6fee4e924" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2d521249a8e6fee4e924">{"x":{"filter":"none","data":[[-119.93,-120,-120.25,-121.54,-120.34,-120.33,-120.34,-120.37,-120.27,-120.27,-120.19,-121.92,-121.96,-119.95,-119.93,-119.94,-119.98,-120,-119.99,-119.92,-120.02,-120.04,-120.13,-120.16,-120.16,-120.06,-120.1,-120.3,-120.32,-120.08,-119.21,-119.34,-119.28,-119.32,-118.91,-119.55,-119.54,-115.88,-119.15,-118.59,-122.89,-122.7,-122.7,-122.75,-120.35,-120.77,-118.45,-118.43,-118.12,-118.4,-119.53,-122.71,-122.96,-119.64,-120.89,-119.3,-119.07,-119.08,-118.96,-119.02,-118.99,-118.97,-118.97,-118.99,-121.95,-121.94,-122.26,-120.09,-120.26,-120.35,-120.27,-120.25,-120.24,-120.23,-120.22,-120.21,-120.19,-117.65,-117.53,-117.65,-118.02,-120.1,-120.06,-120.06,-120.2,-120.18,-120.16,-120.18,-120.15,-120.15,-120.12,-120.1,-120.1,-120.11,-120.11,-120.08,-120.07,-120.06,-120.04,-120.04,-120.01,-120.58,-120.33,-120.18,-120.22,-120.66,-120.74,-121,-121.14,-121.25,-121.19,-121.08,-121.06,-121.14,-121.15,-117.53,-117.13,-117.32,-116.75,-116.71,-116.68,-116.36,-116.52,-116.5,-116.48,-116.49,-116.54,-116.53,-116.48,-116.46,-116.42,-116.42,-116.4,-116.36,-116.33,-116.39,-116.43,-116.44,-116.37,-116.33,-116.29,-116.26,-114.98,-114.49,-117.78,-117.76,-117.61,-117.51,-117.61,-114.47,-114.31,-117.28,-117.32,-117.28,-117.27,-117.26,-117.27,-117.16,-117.18,-117.17,-117.19,-117.21,-117.2,-117.22,-117.2,-117.17,-117.21,-117.07,-117.13,-117.09,-117.06,-117.13,-116.94,-116.91,-116.9,-116.88,-116.88,-116.87,-116.86,-116.86,-116.99,-116.89,-116.86,-116.85,-116.85,-116.83,-116.82,-116.76,-116.76,-116.98,-116.88,-116.76,-116.88,-117.17,-117.26,-121.45,-120.93,-119.5,-121.75,-121.93,-122.03,-121.96,-122.04,-121.82,-120.48,-120.51,-121.76,-122.08,-123.49,-121.03,-120.93,-121.78,-122.81,-123.32,-123.17,-123.22,-118.54,-118.37,-118.7,-120.25,-120.19,-120.12,-120.03,-120.2,-119.93,-119.57],[38.72,38.52,38.55,40.06,38.23,38.26,38.25,38.23,38.29,38.31,38.42,37.74,37.74,38.95,38.94,38.92,38.94,38.93,38.88,38.91,38.76,38.86,39.06,39.04,39.01,39.01,38.91,38.9,38.71,38.8,37.25,37.12,37.11,37.06,36.79,36.51,36.51,32.93,34.83,35.72,39.42,39,38.99,39.01,40.63,40.65,34.08,33.97,34.12,34.09,37.34,37.88,38.26,37.61,37.21,38.26,37.8,37.78,37.64,37.64,37.65,37.64,37.64,37.63,36.61,36.57,38.36,39.4,39.32,39.34,39.35,39.34,39.35,39.36,39.35,39.35,39.35,33.58,33.69,33.53,33.8,39.17,39.09,39.15,39.12,39.14,39.14,39.17,39.15,39.2,39.18,39.19,39.19,39.21,39.24,39.23,39.24,39.25,39.24,39.27,39.26,39.27,39.3,39.28,39.2,39.72,39.82,39.75,39.86,40.27,40.23,40.19,40.23,40.29,40.25,33.92,33.89,33.51,33.83,33.75,33.71,33.88,33.84,33.82,33.8,33.8,33.79,33.78,33.84,33.79,33.79,33.76,33.78,33.78,33.75,33.69,33.75,33.74,33.69,33.72,33.67,33.65,33.82,33.97,33.97,33.98,34.01,34.16,34.34,34.4,34.19,34.26,34.24,34.24,34.24,34.24,34.23,34.26,34.3,34.28,34.27,34.28,34.26,34.26,34.24,34.25,34.22,34.24,34.24,34.22,34.17,34.17,34.24,34.24,34.25,34.24,34.25,34.24,34.24,34.23,34.3,34.27,34.31,34.26,34.25,34.25,34.24,34.29,34.23,34.13,34.08,34.14,34.19,32.68,33.09,37.72,35.76,34.35,37.35,37.4,37.18,37.13,37,36.86,39.66,39.52,41.5,38.3,38.7,37.65,37.65,40.12,40.93,40.43,40.31,40.16,36.12,36.19,35.82,38.03,38.03,38.12,38.19,37.84,37.85,37.94],[10.515306122449,29.8529411764706,10.1685912240185,31.7777777777778,16.847533632287,28.7572815533981,13.4730392156863,11.490861618799,28.1129032258065,33.9896907216495,47.5151515151515,10.5116279069767,22.2222222222222,23.8888888888889,38.8409090909091,13.1041666666667,10.6394557823129,20.9007832898172,11.1832669322709,11.6798780487805,11.0245614035088,10.3754789272031,16.8835616438356,15.8139534883721,56.2692307692308,61.8125,141.909090909091,37,34.84375,132.533333333333,26.4521739130435,50.8378378378378,26.041095890411,29.0747663551402,20.2,11,24.5,10.4,11.8654891304348,31.0625,21.6315789473684,13.4406779661017,11.2095238095238,10.0531400966184,10.9090909090909,19.9621212121212,10.3448275862069,17.5,10.4193548387097,10.3706563706564,20.3366834170854,11.38,15.0151515151515,21.162962962963,10.7875816993464,11.6258741258741,14.1138211382114,12.7421875,11.4028985507246,52.8482142857143,17.5460992907801,16.6715328467153,18.8469387755102,34.5714285714286,10.2117647058824,11.6346863468635,10.1731843575419,16.8125,16.7932960893855,19.86,15.2727272727273,24.9,36.4782608695652,22.2282608695652,26.3661971830986,26.8823529411765,16.4213836477987,11.110599078341,10.5581395348837,10.0058737151248,10.5,20.0978260869565,24.0241935483871,52.6904761904762,28.2368421052632,18.7155172413793,17.25,10.4478527607362,21.3974358974359,20.9393939393939,15.021164021164,36.0754716981132,18.5,13.858024691358,20.0333333333333,16.7884615384615,24.5328947368421,10.5536480686695,11.1220657276995,23.5473684210526,13.9855072463768,15.5112781954887,41.3333333333333,39.755905511811,23.3966005665722,10.8132183908046,16.0245901639344,28.6153846153846,10.3852459016393,59.875,15.1153846153846,21.3720930232558,13.2588235294118,11.3023255813953,18.3487544483986,10.0438596491228,19.1785714285714,10.5,19.1195652173913,12.5176056338028,13.5686274509804,10.1923701298701,10.0337078651685,24.5,14.3047619047619,12.7747093023256,10.2002176278564,11.9018691588785,11.2989690721649,10.5295007564297,12.4473684210526,13.4080824088748,14.7067307692308,10.860423232778,13.8859011627907,10.7654662973223,10.9535864978903,12.6268656716418,19.65625,10.8226514486392,12.9104859335038,24.6258278145695,12.3846153846154,62.4222222222222,10.2962962962963,11.2873831775701,10.3529411764706,14.36,11.2284482758621,16.5226781857451,11.8898305084746,10.3866666666667,11.4159292035398,11.0285714285714,10.0463215258856,11.0981308411215,13.6030042918455,22.6463414634146,14.7777777777778,19.468,28.4321428571429,17.3229166666667,20.520697167756,14.8518518518519,19.1631205673759,16.6117647058824,10.8214285714286,36.7153846153846,10.3211678832117,14.8021978021978,16.6887417218543,10.359649122807,21.8056537102473,11.2306338028169,12.3688524590164,18.9770642201835,12.1,16.5505617977528,29.2486486486486,36.0606060606061,26.4659685863874,16.0570175438597,10.9205298013245,14.7404371584699,26.5114155251142,17.408560311284,22.1335877862595,10.5292553191489,11.6329787234043,14.6713286713287,12.9018867924528,14,17.2692307692308,11.2931034482759,14.189349112426,10.2237442922374,11.9007936507937,14.6666666666667,10.5815217391304,11.3846153846154,10.0952380952381,12.5,10.1051051051051,28.6,11.5725190839695,10.5833333333333,12.8085106382979,10.2721712538226,16.5412844036697,10.1351351351351,20.125,22.8235294117647,10.5128205128205,11.5964912280702,12.25,12.32,23.9941520467836,21.0952380952381,18.7935222672065,10.8458149779736,11.4280052840159,24.6691176470588,37.0634920634921,11.4585079631182,11.5365853658537,17.3],[2.9234693877551,1.98039215686275,2.5473441108545,1.74074074074074,2.44843049327354,2.44660194174757,2.44362745098039,2.41253263707572,2.40322580645161,2.75257731958763,2.48484848484848,3.25581395348837,2.77777777777778,2,2.20454545454545,2.44791666666667,2.30612244897959,2.60835509138381,2.68924302788845,3,2.54385964912281,2.727969348659,2.60958904109589,2.71317829457364,2.07692307692308,2.33333333333333,2.72727272727273,2.13207547169811,2.6875,2.4,2.91304347826087,1.72972972972973,2.34246575342466,2.57943925233645,2.3375,5.2,14,2.55,2.72554347826087,2.04166666666667,1.36842105263158,3.15254237288136,1.72380952380952,2.14734299516908,2.86363636363636,2.12121212121212,2.64827586206897,4.25,3.42652329749104,3.30888030888031,2.86934673366834,2.396,2.33333333333333,2.15555555555556,3.2483660130719,2.62237762237762,2.68292682926829,2.2265625,2.61159420289855,2.36607142857143,2.39716312056738,2.4963503649635,2.42857142857143,2.15625,2.92352941176471,2.09963099630996,1.94972067039106,2.671875,2.17877094972067,3.37,2.40606060606061,2.67272727272727,2.5304347826087,2.66304347826087,2.85915492957746,2.5,3.0314465408805,3.23963133640553,4.95348837209302,3.19383259911894,4,2.3695652173913,2.54838709677419,2.33333333333333,2.59210526315789,2.13793103448276,2.14583333333333,2.17177914110429,2.08974358974359,2.13636363636364,2.06349206349206,2.27358490566038,2.525,2.59876543209877,2.56666666666667,2.41346153846154,2.40131578947368,2.50643776824034,2.3943661971831,2.77894736842105,2.22463768115942,2.71804511278195,2.0952380952381,2.75984251968504,2.39376770538244,2.06034482758621,2.40983606557377,0.692307692307692,2.61475409836066,1.75,2.375,1.6046511627907,2.52941176470588,2.23255813953488,2.19217081850534,3.19298245614035,3.27380952380952,3.3804347826087,2.3804347826087,2.19953051643192,2.58039215686275,1.99107142857143,1.91685393258427,2.07142857142857,2.08095238095238,1.85174418604651,1.82589771490751,1.92056074766355,2.16494845360825,1.70953101361573,2.06842105263158,2,2.94230769230769,1.88023412877082,2.09302325581395,2.01846722068329,1.9957805907173,1.74626865671642,1.91517857142857,2.15100965759438,2.25831202046036,1.90066225165563,2.63461538461538,1.84444444444444,3.31481481481481,2.91705607476635,2.91176470588235,2.38,2.80387931034483,2.43844492440605,2.15042372881356,2.896,2.85840707964602,2.70793650793651,2.56403269754768,2.85046728971963,2.52575107296137,2.76829268292683,2.62962962962963,3.12,3.13928571428571,2.74479166666667,3.01089324618736,3.23888888888889,2.51063829787234,2.75686274509804,2.79365079365079,2.59230769230769,2.45620437956204,2.97802197802198,2.75496688741722,2.17543859649123,2.29681978798587,2.37676056338028,2.27868852459016,2.62844036697248,2.55555555555556,2.32958801498127,2.38378378378378,2.34090909090909,2.14659685863874,2.48684210526316,2.52980132450331,2.68032786885246,2.59817351598174,2.56031128404669,2.72137404580153,2.82978723404255,2.71276595744681,2.39160839160839,2.67924528301887,3,2.03846153846154,1.67241379310345,2.06508875739645,3.49771689497717,2.41402116402116,2.80952380952381,3.28804347826087,10.1538461538462,3.71428571428571,4.25,2.39039039039039,2.58181818181818,2.3206106870229,2.30555555555556,2.38297872340426,3.07645259938838,1.81651376146789,3.24324324324324,3.58928571428571,2.05882352941176,3.01538461538462,2.29824561403509,2.25,2.64,2.08187134502924,2.28571428571429,2.66396761133603,2.58810572687225,2.73579920739762,2.48529411764706,2.2010582010582,2.35624476110645,2.14634146341463,2.55],[573,202,1103,47,546,252,997,924,298,267,82,140,25,36,97,235,339,999,675,984,725,712,381,350,54,112,30,113,86,36,335,64,171,276,187,26,28,51,2006,98,26,186,181,889,63,280,384,17,956,857,571,599,308,291,994,750,330,285,901,265,338,342,238,483,497,569,349,171,780,337,397,294,291,245,203,85,482,703,213,2175,32,218,316,98,197,248,309,354,163,141,390,241,202,421,385,251,365,584,510,264,307,723,44,701,845,717,294,27,638,28,247,69,215,384,616,728,275,311,657,1874,658,2453,853,29,437,1274,1678,411,1050,1130,1179,2524,612,4176,2880,2186,473,117,858,2450,883,574,137,83,179,2497,99,119,1301,1129,1015,1086,323,853,941,1220,1177,1135,71,780,879,527,1382,1749,1062,703,1408,337,673,271,416,248,1300,1350,556,573,230,622,441,309,410,567,382,981,569,1316,713,1064,1020,342,710,9,106,873,349,766,1825,59,605,132,78,17,796,142,304,498,112,2012,594,120,402,35,588,131,18,396,356,48,658,1175,2071,338,416,2811,88,51],[196,102,433,27,223,103,408,383,124,97,33,43,9,18,44,96,147,383,251,328,285,261,146,129,26,48,11,53,32,15,115,37,73,107,80,5,2,20,736,48,19,59,105,414,22,132,145,4,279,259,199,250,132,135,306,286,123,128,345,112,141,137,98,224,170,271,179,64,358,100,165,110,115,92,71,34,159,217,43,681,8,92,124,42,76,116,144,163,78,66,189,106,80,162,150,104,152,233,213,95,138,266,21,254,353,348,122,39,244,16,104,43,85,172,281,228,84,92,276,852,255,1232,445,14,210,688,919,214,485,661,570,1262,208,2221,1376,1083,237,67,448,1139,391,302,52,45,54,856,34,50,464,463,472,375,113,315,367,428,466,410,27,250,280,192,459,540,423,255,504,130,274,91,151,114,566,568,244,218,90,267,185,132,191,228,151,366,219,514,262,376,376,143,265,3,52,522,169,219,756,21,184,13,21,4,333,55,131,216,47,654,327,37,112,17,195,57,8,150,171,21,247,454,757,136,189,1193,41,20]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>longitude<\/th>\n      <th>latitude<\/th>\n      <th>room.per.household<\/th>\n      <th>household.size<\/th>\n      <th>population<\/th>\n      <th>households<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"lengthMenu":[5,10],"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"targets":3,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"className":"dt-right","targets":[0,1,2,3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[


.pull-left[

### Outliers ???


```r
ggplot()+
  geom_point(data=dat,
          aes(x=longitude,
              y=latitude),
              col="grey",
              alpha=0.5)+
  geom_point(data=dat%&gt;%
             filter(room.per.household&gt;10),
             aes(x=longitude,
             y=latitude),
             col="red",
             size=5)+
  theme_minimal()+
  scale_color_viridis()+
  coord_fixed(1.3)
```

]

.pull-right[

&lt;img src="week3_files/figure-html/unnamed-chunk-18-1.png" width="504" /&gt;


]
]



---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Outliers???


```r
dat%&gt;%filter(room.per.household&gt;10)%&gt;%
          mutate(bedroom.per.household=total_bedrooms/households, bedroom.per.pop=total_bedrooms/population)%&gt;%
            summarise(mean.bed=mean(bedroom.per.pop,na.rm=T),
                      min.bed=min(bedroom.per.pop,na.rm=T),
                      max.bed=max(bedroom.per.pop,na.rm=T),
                      mean.room=mean(room.per.household),
                      min.room=min(room.per.household),
                      max.room=max(room.per.household))
```

```
##   mean.bed   min.bed  max.bed mean.room min.room max.room
## 1 1.652165 0.2121212 14.19444  19.32924 10.00587 141.9091
```



]
---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Outliers??? (K-means clustering)


```r
dat$id&lt;-1:dim(dat)[1]
temp&lt;-dat%&gt;%filter(room.per.household&gt;10, is.na(total_bedrooms)==F)%&gt;%
          mutate(bedroom.per.household=total_bedrooms/households, 
                 bedroom.per.pop=total_bedrooms/population)
#Kmeans clustering
km&lt;-kmeans(temp%&gt;%select(bedroom.per.household,
                         bedroom.per.pop,
                         room.per.household),
           center=3) 
#print the output
km
```

```
## K-means clustering with 3 clusters of sizes 186, 37, 2
## 
## Cluster means:
##   bedroom.per.household bedroom.per.pop room.per.household
## 1              2.867231        1.178802           14.60263
## 2              7.451991        3.483395           36.95917
## 3             29.851515       11.797222          137.22121
## 
## Clustering vector:
##   [1] 1 2 1 2 1 2 1 1 2 2 2 1 1 1 2 1 1 1 1 1 1 1 1 1 2 2 3 2 2 3 2 2 2 2 1 1 1
##  [38] 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 1 1 1 1 1 1 2 1
##  [75] 2 2 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 1 1 1 2 1 2 1
## [112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1
## [149] 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 2 2 1 1 1 2 1
## [186] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2
## [223] 1 1 1
## 
## Within cluster sum of squares by cluster:
## [1] 3802.61203 4738.74610   90.98077
##  (between_SS / total_SS =  84.2 %)
## 
## Available components:
## 
## [1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
## [6] "betweenss"    "size"         "iter"         "ifault"
```

```r
temp$cluster&lt;-km$cluster
```




]
---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Remove the outliers


```r
# specify outliers
dat$cluster&lt;-0
dat$cluster[temp$id]&lt;-temp$cluster
dat$cluster&lt;-ifelse(dat$cluster==x,0,ifelse(dat$cluster==0,0,1))
dat&lt;-dat%&gt;%filter(cluster==0)
table(dat$cluster)
```

```
## 
##     0 
## 20601
```

]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;


&lt;small&gt;
* [naniar package](https://cran.r-project.org/web/packages/naniar/index.html)
* [mice package](https://cran.r-project.org/web/packages/mice/index.html)
* [flexible imputation of missing data](https://stefvanbuuren.name/fimd/)
&lt;/small&gt;

]

.right-column[

### Missing value analysis (1)


```r
# install.packages("naniar")
library(naniar)
library(gridExtra)
#any_na(dat)
p1&lt;-gg_miss_var(dat)
p2&lt;-vis_miss(dat, sort_miss=T)
grid.arrange(p1,p2, nrow=1)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-23-1.png" width="720" /&gt;
]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating



]

.right-column[


### Type of Missing value

**Missing completely at random (MCAR): ** `\(p_{ij}=\pi\)`

**Missing at random (MAR): ** `\(p_{ij}=p(Missing|Y_{obs})\)`

**Missing not at rondom (MNAR): ** `\(p_{ij}=p(Missing|Y_{obs},Y_{miss})\)`
]

&lt;center&gt;&lt;img src="typemiss.png" width=60%&gt;&lt;/center&gt;


---

.pull-left[

### Missing value analysis (2)


```r
ggplot()+geom_point(data=dat,
              aes(x=longitude,
                  y=latitude,
                  col=total_bedrooms),
                  alpha=0.5)+
         geom_point(data=dat%&gt;%
                    filter(is.na(total_bedrooms)==T),
                    aes(x=longitude,
                        y=latitude),
                     col="red",
                     alpha=0.2,
                     size=3)+
        theme_minimal()+
        scale_color_viridis()+
        coord_fixed(1.3)
```



]

.pull-right[
&lt;img src="week3_files/figure-html/unnamed-chunk-25-1.png" width="504" /&gt;
]


---
class: middle

### Missing value analysis (3)



```r
p3&lt;-ggplot(dat,aes(x=bedroom.per.room,y=median_house_value))+geom_miss_point()
p4&lt;-ggplot(dat,aes(x=bedroom.per.room,y=median_house_value))+geom_miss_point()+facet_wrap(~ocean_proximity)
grid.arrange(p3,p4, nrow=1)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-26-1.png" width="1152" /&gt;



---

class: middle


### Missing value analysis (4)


```r
p5&lt;-ggplot(dat,aes(x=bedroom.per.room,y=room.per.household))+geom_miss_point()
p6&lt;-ggplot(dat,aes(x=bedroom.per.room,y=room.per.household))+geom_miss_point()+facet_wrap(~ocean_proximity)
grid.arrange(p5,p6,nrow=1)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-27-1.png" width="1152" /&gt;


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;

[**Kokla et al.(2019)**](https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-019-3110-0)

]

.right-column[

### Imputation

&lt;img src="missing.png"&gt;



]



---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Imputation using K-NN algorithm

- CARET package offers `preProcess` function that can predict missing values. 

- To impute missing values, we need to set argument `method=knnImpute` for K-Nearest Neighbors imputation and set the argument `method=bagImpute` for bagged tree imputation.


&lt;img src="knn.png" width=80%&gt;
]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[


```r
library(caret)
#install.packages("RANN")
library(RANN)
dat$id.missing&lt;-ifelse(is.na(dat$total_bedrooms)==T,1,0)
impute.knn&lt;-preProcess(dat%&gt;%select(-id.missing),method="knnImpute",k=5,knnSummary = mean)
impute.dat.knn&lt;-predict(impute.knn,dat)
summary(impute.dat.knn)
```

```
##    longitude          latitude       housing_median_age  total_rooms     
##  Min.   :-2.3849   Min.   :-1.4467   Min.   :-2.19807   Min.   :-1.2068  
##  1st Qu.:-1.1126   1st Qu.:-0.7955   1st Qu.:-0.84710   1st Qu.:-0.5444  
##  Median : 0.5388   Median :-0.6455   Median : 0.02706   Median :-0.2332  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.0000  
##  3rd Qu.: 0.7783   3rd Qu.: 0.9755   3rd Qu.: 0.66281   3rd Qu.: 0.2344  
##  Max.   : 2.6243   Max.   : 2.9620   Max.   : 1.85485   Max.   :16.8174  
##  total_bedrooms        population        households      median_income    
##  Min.   :-1.273521   Min.   :-1.2583   Min.   :-1.3062   Min.   :-1.7738  
##  1st Qu.:-0.573534   1st Qu.:-0.5641   1st Qu.:-0.5737   1st Qu.:-0.6887  
##  Median :-0.243710   Median :-0.2303   Median :-0.2362   Median :-0.1769  
##  Mean   :-0.000149   Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000  
##  3rd Qu.: 0.259331   3rd Qu.: 0.2634   3rd Qu.: 0.2765   3rd Qu.: 0.4590  
##  Max.   :14.017036   Max.   :30.2519   Max.   :14.6014   Max.   : 5.8546  
##  median_house_value   ocean_proximity room.per.household bedroom.per.room   
##  Min.   :-1.6628    &lt;1H OCEAN :9136   Min.   :-2.88760   Min.   :-1.948803  
##  1st Qu.:-0.7557    INLAND    :6513   1st Qu.:-0.58895   1st Qu.:-0.648252  
##  Median :-0.2349    ISLAND    :   5   Median :-0.08519   Median :-0.169513  
##  Mean   : 0.0000    NEAR BAY  :2290   Mean   : 0.00000   Mean   : 0.000401  
##  3rd Qu.: 0.5033    NEAR OCEAN:2657   3rd Qu.: 0.43996   3rd Qu.: 0.461633  
##  Max.   : 2.5394                      Max.   :12.50158   Max.   :13.564168  
##  household.size            id                cluster    id.missing     
##  Min.   : -0.22337   Min.   :-1.7329694   Min.   :0   Min.   :0.00000  
##  1st Qu.: -0.06166   1st Qu.:-0.8655160   1st Qu.:0   1st Qu.:0.00000  
##  Median : -0.02429   Median :-0.0002447   Median :0   Median :0.00000  
##  Mean   :  0.00000   Mean   : 0.0000000   Mean   :0   Mean   :0.01005  
##  3rd Qu.:  0.02027   3rd Qu.: 0.8665373   3rd Qu.:0   3rd Qu.:0.00000  
##  Max.   :119.30396   Max.   : 1.7313051   Max.   :0   Max.   :1.00000
```

]
---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating


&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;/br&gt;

* [missRanger](https://cran.r-project.org/web/packages/missRanger/index.html)

]

.right-column[

### Imputation using Random forest


&lt;img src="randomforest.png" width=50%&gt;



```r
#install.packages("missRanger")
library(missRanger)
impute.dat.rf&lt;-missRanger(dat,.~.-id.missing,seed=1234,num.trees=500)
```

```
## 
## Missing value imputation by random forests
## 
##   Variables to impute:		total_bedrooms, bedroom.per.room
##   Variables used to impute:	longitude, latitude, housing_median_age, total_rooms, total_bedrooms, population, households, median_income, median_house_value, ocean_proximity, room.per.household, bedroom.per.room, household.size, id, cluster
## iter 1:	..
## iter 2:	..
## iter 3:	..
```


]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[


```r
summary(impute.dat.rf)
```

```
##    longitude         latitude     housing_median_age  total_rooms   
##  Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
##  1st Qu.:-121.8   1st Qu.:33.93   1st Qu.:18.00      1st Qu.: 1447  
##  Median :-118.5   Median :34.25   Median :29.00      Median : 2126  
##  Mean   :-119.6   Mean   :35.63   Mean   :28.66      Mean   : 2635  
##  3rd Qu.:-118.0   3rd Qu.:37.71   3rd Qu.:37.00      3rd Qu.: 3146  
##  Max.   :-114.3   Max.   :41.95   Max.   :52.00      Max.   :39320  
##  total_bedrooms     population      households     median_income    
##  Min.   :   1.0   Min.   :    3   Min.   :   1.0   Min.   : 0.4999  
##  1st Qu.: 296.0   1st Qu.:  789   1st Qu.: 281.0   1st Qu.: 2.5625  
##  Median : 435.0   Median : 1167   Median : 410.0   Median : 3.5352  
##  Mean   : 537.7   Mean   : 1428   Mean   : 500.3   Mean   : 3.8715  
##  3rd Qu.: 647.0   3rd Qu.: 1726   3rd Qu.: 606.0   3rd Qu.: 4.7440  
##  Max.   :6445.0   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
##  median_house_value   ocean_proximity room.per.household bedroom.per.room
##  Min.   : 14999     &lt;1H OCEAN :9136   Min.   : 0.8462    Min.   :0.1000  
##  1st Qu.:119700     INLAND    :6513   1st Qu.: 4.4390    1st Qu.:0.1755  
##  Median :179800     ISLAND    :   5   Median : 5.2264    Median :0.2032  
##  Mean   :206916     NEAR BAY  :2290   Mean   : 5.3596    Mean   :0.2131  
##  3rd Qu.:265000     NEAR OCEAN:2657   3rd Qu.: 6.0472    3rd Qu.:0.2399  
##  Max.   :500001                       Max.   :24.9000    Max.   :1.0000  
##  household.size           id           cluster    id.missing     
##  Min.   :   0.750   Min.   :    1   Min.   :0   Min.   :0.00000  
##  1st Qu.:   2.431   1st Qu.: 5169   1st Qu.:0   1st Qu.:0.00000  
##  Median :   2.820   Median :10324   Median :0   Median :0.00000  
##  Mean   :   3.072   Mean   :10325   Mean   :0   Mean   :0.01005  
##  3rd Qu.:   3.283   3rd Qu.:15488   3rd Qu.:0   3rd Qu.:0.00000  
##  Max.   :1243.333   Max.   :20640   Max.   :0   Max.   :1.00000
```


]
---

class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Splitting data





- using `sample()` function from base package.


```r
set.seed(1234)
train.id&lt;-sample(rownames(impute.dat.rf),0.6*dim(impute.dat.rf)[1])
train.dat&lt;-impute.dat.rf[train.id,]
test.dat&lt;-impute.dat.rf[-as.numeric(train.id),]
```

- using `createDataPartition()` function from caret package.


```r
#install.packages("caret")
library(caret)
set.seed(1234)
train.id.caret&lt;-createDataPartition(impute.dat.rf$median_house_value,
                                    p=0.6,
                                    list=F)
train.dat.caret&lt;-impute.dat.rf[train.id.caret,]
test.dat.caret&lt;-impute.dat.rf[-train.id.caret,]
```


]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[





```r
grid.arrange(p1,p2,nrow=1)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-34-1.png" width="864" /&gt;

]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Exploring correlations in training data


```r
train.dat.caret&lt;-train.dat.caret%&gt;%
                    select(-total_rooms,-total_bedrooms,-cluster)%&gt;%
                        select(7,1:6,8:12)
# correlation between numeric variables.
round(cor(train.dat.caret%&gt;%select(-ocean_proximity)),2)[1,]
```

```
## median_house_value          longitude           latitude housing_median_age 
##               1.00              -0.06              -0.14               0.10 
##         population         households      median_income room.per.household 
##              -0.02               0.06               0.70               0.24 
##   bedroom.per.room     household.size                 id 
##              -0.26              -0.02               0.07
```

```r
#correlation between continuous outcome and categorical predictor.
lm&lt;-lm(median_house_value~ocean_proximity,data=train.dat.caret)
summary(lm)$r.squared%&gt;%sqrt() 
```

```
## [1] 0.4925983
```
]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Scatter plot matrix


```r
library(GGally)
ggpairs(train.dat.caret,switch="y")
```

&lt;img src="week3_files/figure-html/unnamed-chunk-36-1.png" width="1008" /&gt;

]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[


```r
ggplot(data=dat,aes(x=median_income,y=median_house_value))+
  geom_point(alpha=0.5,col="darkblue")+
  theme_minimal()
```

&lt;img src="week3_files/figure-html/unnamed-chunk-37-1.png" width="576" /&gt;

]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]

.right-column[

### Exploring correlation in training data


```r
ggplot(train.dat.caret,
       aes(x=ocean_proximity,y=median_house_value))+
  geom_boxplot()
```

&lt;img src="week3_files/figure-html/fit-1.png" width="504" /&gt;

]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]


.right-column[

### Near-Zero Variance Predictors


```r
#install.packages("caret")
library(caret)
nearZeroVar(train.dat.caret)
```

```
## integer(0)
```

### filtering data


```r
train&lt;-train.dat.caret%&gt;%filter(median_house_value&lt;500000)
```


]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]


.right-column[

### Feature Scaling

- Normalization: `\(x^* = \frac{x-min(x)}{max(x)-min(x)} \in [0,1]\)`

- Standardization: `\(x^*=\frac{x-\overline{x}}{SD} \in [-\inf,\inf]\)`



```r
###----  standardized using scale function
# scale(train[,c(1,2,4,5)],center=T,scale=T)

###----- using caret package
# preProcess(train,method=c("range")) #normalized
preprocess&lt;-preProcess(train,method=c("center","scale")) #standardized
preprocess
```

```
## Created from 11792 samples and 12 variables
## 
## Pre-processing:
##   - centered (11)
##   - ignored (1)
##   - scaled (11)
```


]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- **Data Preprocessing**

- Modelling

- Models Evaluating

]


.right-column[

### Feature Scaling


```r
train.scale&lt;-predict(preprocess,train)
summary(train.scale)
```

```
##  median_house_value   longitude          latitude       housing_median_age
##  Min.   :-1.8200    Min.   :-2.3658   Min.   :-1.4525   Min.   :-2.18682  
##  1st Qu.:-0.7804    1st Qu.:-1.1000   1st Qu.:-0.8072   1st Qu.:-0.83233  
##  Median :-0.1936    Median : 0.5232   Median :-0.6448   Median : 0.04411  
##  Mean   : 0.0000    Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.00000  
##  3rd Qu.: 0.5758    3rd Qu.: 0.7912   3rd Qu.: 0.9568   3rd Qu.: 0.68152  
##  Max.   : 3.1338    Max.   : 2.6179   Max.   : 2.9019   Max.   : 1.87666  
##    population        households      median_income       ocean_proximity
##  Min.   :-1.2216   Min.   :-1.2861   Min.   :-2.0111   &lt;1H OCEAN :5122  
##  1st Qu.:-0.5470   1st Qu.:-0.5660   1st Qu.:-0.7328   INLAND    :3893  
##  Median :-0.2257   Median :-0.2342   Median :-0.1405   ISLAND    :   4  
##  Mean   : 0.0000   Mean   : 0.0000   Mean   : 0.0000   NEAR BAY  :1283  
##  3rd Qu.: 0.2523   3rd Qu.: 0.2621   3rd Qu.: 0.5695   NEAR OCEAN:1490  
##  Max.   :29.0172   Max.   :14.3500   Max.   : 7.1736                    
##  room.per.household bedroom.per.room  household.size           id           
##  Min.   :-2.86548   Min.   :-1.9920   Min.   :-0.17710   Min.   :-1.723244  
##  1st Qu.:-0.57411   1st Qu.:-0.6503   1st Qu.:-0.05309   1st Qu.:-0.877361  
##  Median :-0.08018   Median :-0.1778   Median :-0.02427   Median : 0.009358  
##  Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.00000   Mean   : 0.000000  
##  3rd Qu.: 0.42872   3rd Qu.: 0.4529   3rd Qu.: 0.00959   3rd Qu.: 0.853655  
##  Max.   :12.61307   Max.   :13.5488   Max.   :90.69566   Max.   : 1.723923
```

]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[

### All-in (Full model)


```r
fit.train.full&lt;-lm(median_house_value~.,data=train.scale%&gt;%select(-id))
summary(fit.train.full)$adj.r.squared
```

```
## [1] 0.6361949
```

```r
summary(fit.train.full)$sigma # training RMSE
```

```
## [1] 0.6031626
```


### Filter (Reduce model)


```r
fit.train.reduce&lt;-lm(median_house_value~median_income+ocean_proximity,data=train.scale)
summary(fit.train.reduce)$adj.r.squared
```

```
## [1] 0.5685418
```

```r
summary(fit.train.reduce)$sigma # training RMSE
```

```
## [1] 0.6568548
```

]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[



```r
par(mfrow=c(2,2))
plot(fit.train.full)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-44-1.png" width="576" /&gt;




]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[


```r
par(mfrow=c(2,2))
plot(fit.train.reduce)
```

&lt;img src="week3_files/figure-html/unnamed-chunk-45-1.png" width="576" /&gt;

]

---
class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[

### Comparing Models: Partial F-test

.pull-left[

&lt;small&gt;

**Hypotheses**


`\(H_0:\)` Reduced model = Full model


`\(H_1:\)` Reduced model worse than Full model

&lt;/small&gt;


&lt;small&gt;

**test statistics**



`$$F=\frac{\frac{SSE_{reduce}-SSE_{full}}{p^*}}{\frac{SSE_{full}}{n-p_{full}-1}} \sim F_{p^*,n-p_{full}-1}$$`
&lt;/small&gt;


&lt;small&gt;

`\(p\)` คือจำนวนตัวแปรอิสระภายในโมเดลทำนาย

`\(p^*=p_{full}-p_{reduce}\)`

`\(n\)` คือจำนวนหน่วยข้อมูล

&lt;/small&gt;

]


.pull-right[


```r
# fit.all &lt;--full model (All-in)
# fil.filter &lt;-- reduced model
anova(fit.train.reduce,fit.train.full)
```


]

]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[

### Comparing Models: Likelihood ratio test


.pull-left[

&lt;small&gt;

**Hypotheses**

`\(H_0:\)` Reduced model = Full model


`\(H_1:\)` Reduced model worse than Full model

&lt;/small&gt;

&lt;small&gt;

**test statistics**

`$$deviance=-2LL_{reduce}-(-2LL_{full})\sim \chi^2_{p^*}$$`

&lt;/small&gt;

&lt;small&gt;

`\(p\)` คือจำนวนตัวแปรอิสระภายในโมเดลทำนาย

`\(p^*=p_{full}-p_{reduce}\)`

`\(n\)` คือจำนวนหน่วยข้อมูล

**Note:** normality assumption must be assumed.
&lt;/small&gt;

]


.pull-right[


```r
# install.packages("lmtest")
library(lmtest)
lrtest(fit.train.reduce,fit.train.full)
```


]

]

---

class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[

### Feature Selection (Wrapper methods)

&lt;small&gt;

- Backward elemination (`backward`)

- Forward selection (`forward`)

- Bidirectional (`seqrep`)

- All possible (`exhaustive`)

&lt;/small&gt;

&lt;small&gt;

`regsubsets()` [leaps package], which has the tuning parameter nvmax specifying the maximal number of predictors to incorporate in the model. It returns multiple models with different size up to nvmax. You need to compare the performance of the different models for choosing the best one. regsubsets() has the option method, which can take the values “backward”, “forward” and “seqrep” (seqrep = sequential replacement, combination of forward and backward selections).

&lt;/small&gt;


```r
#install.packages("leaps")
library(leaps)
regsubsets&lt;-regsubsets(median_house_value~., data = train.scale%&gt;%select(-id), nvmax = 11,
                     method = "backward")
summary(regsubsets)
```

]


---
class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[


```
## Subset selection object
## Call: regsubsets.formula(median_house_value ~ ., data = train.scale %&gt;% 
##     select(-id), nvmax = 11, method = "backward")
## 13 Variables  (and intercept)
##                           Forced in Forced out
## longitude                     FALSE      FALSE
## latitude                      FALSE      FALSE
## housing_median_age            FALSE      FALSE
## population                    FALSE      FALSE
## households                    FALSE      FALSE
## median_income                 FALSE      FALSE
## ocean_proximityINLAND         FALSE      FALSE
## ocean_proximityISLAND         FALSE      FALSE
## ocean_proximityNEAR BAY       FALSE      FALSE
## ocean_proximityNEAR OCEAN     FALSE      FALSE
## room.per.household            FALSE      FALSE
## bedroom.per.room              FALSE      FALSE
## household.size                FALSE      FALSE
## 1 subsets of each size up to 11
## Selection Algorithm: backward
##           longitude latitude housing_median_age population households
## 1  ( 1 )  " "       " "      " "                " "        " "       
## 2  ( 1 )  " "       "*"      " "                " "        " "       
## 3  ( 1 )  "*"       "*"      " "                " "        " "       
## 4  ( 1 )  "*"       "*"      " "                " "        "*"       
## 5  ( 1 )  "*"       "*"      " "                "*"        "*"       
## 6  ( 1 )  "*"       "*"      "*"                "*"        "*"       
## 7  ( 1 )  "*"       "*"      "*"                "*"        "*"       
## 8  ( 1 )  "*"       "*"      "*"                "*"        "*"       
## 9  ( 1 )  "*"       "*"      "*"                "*"        "*"       
## 10  ( 1 ) "*"       "*"      "*"                "*"        "*"       
## 11  ( 1 ) "*"       "*"      "*"                "*"        "*"       
##           median_income ocean_proximityINLAND ocean_proximityISLAND
## 1  ( 1 )  "*"           " "                   " "                  
## 2  ( 1 )  "*"           " "                   " "                  
## 3  ( 1 )  "*"           " "                   " "                  
## 4  ( 1 )  "*"           " "                   " "                  
## 5  ( 1 )  "*"           " "                   " "                  
## 6  ( 1 )  "*"           " "                   " "                  
## 7  ( 1 )  "*"           " "                   " "                  
## 8  ( 1 )  "*"           "*"                   " "                  
## 9  ( 1 )  "*"           "*"                   " "                  
## 10  ( 1 ) "*"           "*"                   "*"                  
## 11  ( 1 ) "*"           "*"                   "*"                  
##           ocean_proximityNEAR BAY ocean_proximityNEAR OCEAN room.per.household
## 1  ( 1 )  " "                     " "                       " "               
## 2  ( 1 )  " "                     " "                       " "               
## 3  ( 1 )  " "                     " "                       " "               
## 4  ( 1 )  " "                     " "                       " "               
## 5  ( 1 )  " "                     " "                       " "               
## 6  ( 1 )  " "                     " "                       " "               
## 7  ( 1 )  " "                     " "                       " "               
## 8  ( 1 )  " "                     " "                       " "               
## 9  ( 1 )  " "                     " "                       "*"               
## 10  ( 1 ) " "                     " "                       "*"               
## 11  ( 1 ) " "                     "*"                       "*"               
##           bedroom.per.room household.size
## 1  ( 1 )  " "              " "           
## 2  ( 1 )  " "              " "           
## 3  ( 1 )  " "              " "           
## 4  ( 1 )  " "              " "           
## 5  ( 1 )  " "              " "           
## 6  ( 1 )  " "              " "           
## 7  ( 1 )  "*"              " "           
## 8  ( 1 )  "*"              " "           
## 9  ( 1 )  "*"              " "           
## 10  ( 1 ) "*"              " "           
## 11  ( 1 ) "*"              " "
```

]


---

class: middle

.left-column[

### housing.csv

- Importing Data

- Data Preprocessing

- **Modelling**

- Models Evaluating

]

.right-column[


```r
temp&lt;-summary(regsubsets)
objects(temp)
```

```
## [1] "adjr2"  "bic"    "cp"     "obj"    "outmat" "rsq"    "rss"    "which"
```

&lt;img src="week3_files/figure-html/unnamed-chunk-51-1.png" width="720" /&gt;

]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
