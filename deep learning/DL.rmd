---
title: "การเรียนรู้เชิงลึก"
output:
  rmdformats::robobook:
    self_contained: FALSE
---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="150")
opts_chunk$set(echo=TRUE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=100)
```



<p style="line-height:1.3; font-size:16px; color: #353b48; text-align:right;">
สิวะโชติ ศรีสุทธิยากร
</br>
</br>
ภาควิชาวิจัยและจิตวิทยาการศึกษา คณะครุศาสตร์
</br>
จุฬาลงกรณ์มหาวิทยาลัย
</br>
</font> 13 May 2021 </font>
</p>


# Introduction

- Most machine learning algorithms as they exist now focus on function optimization, and the solutions yielded don’t always explain the underlying trends within the data nor give
the inferential power that artificial intelligence was trying to get close to.

- As such, using machine learning algorithms often becomes a repetitive trial and error process, in which the choice of algorithm across problems yields different performance results.

- This is fine in some contexts, but in the case of language modeling and computer vision, it becomes problematic.


In response to some of the shortcomings of machine learning, and the significant advance in the theoretical and technological capabilities at our disposal today, deep learning has emerged and is rapidly expanding as one of the most exciting fields of science. It is being used in technologies such as self-driving cars, image recognition on social media platforms, and translation of text from one language to others. 


Deep learning is the subfield of machine learning that is devoted to building algorithms that explain
and learn a high and low level of abstractions of data that traditional machine learning algorithms often cannot.


## **Deep learning model**

โมเดล deep learning พื้นฐานที่สุดจะประกอบด้วยส่วนประกอบหลักที่เรียกว่าชั้น (layer) จำนวน 3 ส่วนได้แก่ input layer, hidden layer และ output layer ดังตัวอย่างในรูปด้านล่าง

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 09.15.17.png){width=50%}</left>

เมื่อพิจารณาโมเดลในรูปจะเห็นว่า ใน input layer ประกอบด้วยส่วนย่อยที่เรียกว่า นิวรอน (neurons) จำนวน 2 ตัว ซึ่งใช้แทนตัวแปรอิสระ $X = [{x_1}, {x_2}]$ ผู้อ่านจะเห็นว่า output layer ของโมเดลเกิดขึ้นจากการนำข้อมูลใน input layer มาผ่านการประมวลผลใน hidden layer ผลลัพธ์ที่ได้จะเป็นค่าทำนายของตัวแปรตามที่ต้องการ

Note: โดยทั่วไปการประมวลผลใน hidden layer จะ เป็นการค่าผลรวมเชิงเส้นแบบถ่วงน้ำหนักของข้อมูลนำเข้ามา จากนั้นนำผลรวมดังกล่าวผ่านการแปลงด้วย activation function เพื่อให้พิสัยของผลลัพธ์มีพิสัยหรือหน่วยที่เหมาะสำหรับการส่งต่อไปยัง neuron ใน layer ถัดไป


<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 09.35.57.png){width=70%}</left>




##  **ประเภทของ deep learning model**

Deep learning model จำแนกได้หลายประเภท 

1. **Single Layer Percentron Model (SLP)** โมเดลนี้เป็นโมเดลพื้นฐานของ DL model ทั่วไป สามารถใช้ได้กับทั้งปัญหา classfication และ regression โมเดลนี้จะนำข้อมูลนำเข้าจาก input layer มารวมกันด้วยผลรวมเชิงเส้นแบบถ่วงน้ำหนัก ผลรวมเชิงเส้นนี้จะถูกใช้ผลลัพธ์ใน output layer รูปต่อไปนี้แสดงตัวอย่างของ SLP model

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 10.58.12.png){width=60%}</left>


2. **Multilayer Perceptron Model (MLP)** โมเดลนี้ขยายจาก SLP model โดยขยายให้มีชั้นของ hidden layer มากขึ้น ดังรูป

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 08.28.17.png){width=60%}</left>


3. **Convolutional Neural Network (CNNs)** โมเดลนี้เป็นโมเดลที่ใช้บ่อยสำหรับการประมวลผลข้อมูลแบบรูปภาพ โมเดลถูกออกแบบให้เลียนแบบการมองเห็นของมนุษย์ทั่วไป โดยโมเดล CNN ประกอบด้วยนิวรอนทีี่จัดเก็บข้อมูลโดยจำแนกเป็น 3 มิติได้แก่ กว้าง ยาว และลึก 


4. **Recurrent Neural Network (RNNs)**


5. **Restricted Boltzmann Machines (RBMs)**


6. **Deep Belief Networks (DBNs)**


...


# **SLP and MLP models**

อย่างที่กล่าวในข้างต้น SLP และ MLP ประกอบด้วย input, hidden และ output layers โดยที่การประมวลผลใน hidden layer เป็นการหาผลรวมเชิงเส้นแบบถ่วงน้ำหนักของข้อมูลนำเข้าเพื่อส่งต่อไปใน output layer

รูปด้านล่างแสดงให้เห็นกระบวนการหาผลรวมเชิงเส้นแบบถ่วงน้ำหนักดังกล่าว จะเห็นว่าตัวถ่วงน้ำหนัก (weight) อาจจำแนกได้เป็น 2 ประเภท ประเภทแรกคือน้ำหนักของตัวแปรอิสระแต่ละตัว เขียนแทนด้วย $w$ ซึ่งเป็นตัวคูณปรับน้ำหนักของตัวแปรอิสระก่อนนำไปหาผลรวมเชิงเส้น และประเภทที่สองเรียกว่า ความลำเอียง (bias: $b$) เป็นน้ำหนักที่ไม่ได้คูณกับตัวแปรใดใน input layer แต่ใช้บวกโดยตรงเข้าไปกับผลรวมเชิงเส้น รูปแบบทั่วไปของการหาผลรวมเชิงเส้นแบบถ่วงน้ำหนักของแต่ละนิวรอนจึงเขียนเป็นสมการทางคณิตศาสตร์ได้ดังนี้

$y = w_0x_0+w_1x_1+w_2x_2+...+w_px_p+b$

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 11.22.25.png){width=40%}</left>


## Keras

Keras package เป็น package สำเร็จรูปซึ่งมีทั้งใน R และ Python ใช้สำหรับสร้างโมเดล DL ซึ่งได้รับความนิยมอย่างมากในปัจจุบัน เนื่องจากเป็น package ที่เขียนคำสั่งสั้นแต่มีประสิทธิภาพสูง  

การสร้างโมเดล DL ใน Keras สามารถทำได้สองวิธีการ วิธีการแรกคือการใช้ functional API และวิธีการที่สองคือการใช้ sequential API วิธีการที่สองเป็นวิธีการที่ง่ายในการสร้างโมเดล DL ดังกล่าว ซึ่งจะเป็นวิธีการที่กล่าวถึงก่อนในบทเรียนนี้

การทำงานใน sequantial API จะเริ่มจากการกำหนดรายละเอียดใน input layer ก่อนจากนั้นจึงกำหนด hidden layer และ output layer เป็นลำดับไป การกำหนด layer ดังกล่าวสามารถทำได้ผ่าน dense layer module 

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/59cru8.gif){width=25%}</left>



## Creating model in Keras (Python)

```{r echo=F}
library(reticulate)
```

<left>![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 13.44.05.png){width=40%}</left>

การสร้างโมเดล DL ข้างต้นด้วย Sequential API ของ Keras package สามารถทำได้โดยเขียนคำสั่งดังนี้

```{python}
from keras.models import Sequential
from keras.layers import Dense

#1. Create a Sequential model
model = Sequential()

#2. Add an input layer and a hidden layer with 2 neurons.
model.add(Dense(units = 2, input_shape=[3],
                activation="relu"))

#3. Add 1-neuron output layer
model.add(Dense(units = 1))
```


### Activation function

ชุดคำสั่งข้างต้นจะเห็นว่ามีการกำหนดอาร์กิวเมนท์ `activation` เพื่อระบุ activation function ที่ต้องการใช้แปลงค่าผลรวมเชิงเส้นให้อยู่ภายในพิสัยที่เหมาะสำหรับส่งผ่านไปยัง neuron ใน layer ที่อยู่ถัดไป

activation function ที่สามารถกำหนดได้ในการสร้างโมเดล DL มีหลายตัว (รายละเอียดจะกล่าวถึงภายหลัง) ในตัวอย่างข้างต้นกำหนดให้ `activation = "relu"` ซึ่งหมายถึง Retified Linear Unit function ดังนี้

<center>$R(z) = max(0, z)$</center>

```{r echo=F, fig.width=5, fig.height=4}
z<-seq(-10,10,0.1)
relu<-function(z)
{
 y<-ifelse(z>0, z, 0)
 return(y)   
}
par(mar=c(5,5,1,1))
plot(z,relu(z), type="l")
grid(5,5,col="grey")
```

การกำหนด activation function แบบ relu จึงจะให้โมเดลที่มีลักษณะดังรูป

![](/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/github/ssiwacho/2758501/ssiwacho.github.io/deep learning/Screen Shot 2564-05-13 at 14.47.32.png){width=50%}


### summarise the model

ผู้วิเคราะห์สามารถใช้ฟังก์ชัน `summary()` เพื่อพิจารณารายละเอียดของโมเดลที่สร้างขึ้นในข้างต้นได้ ผลลัพธ์ที่ได้เป็นดังนี้ 

```{python}
model.summary()
```


## Creating model in Keras (R)

Keras API สามารถเรียกได้จาก R เหมือนกับ python ก่อนการใช้ Keras ใน R ผู้วิเคราะห์จำเป็นต้องติดตั้ง package ก่อนโดยเขียนคำสั่งดังนี้

```{r eval=F}
install.packages("keras")
install_keras()
library(keras)
library(dplyr)
```

```{r echo=F}
library(keras)
```

```{r}
#1. Create a Sequential model
model.r <- keras_model_sequential()

#2. Add input, hidden and output layer
model.r %>% layer_dense(units = 10, input_shape=c(6), activation="relu") %>%
  layer_dense(units = 1)

#3. summary the model
model.r
```

## Compile the model

### Compile the model in Python

```{python}
model.compile(optimizer = "adam", loss = "mse")
```

### Compile the model in R

```{r}
model.r %>% compile(optimizer = "adam", loss = "mse")
```

## Training and Predicting

```{r}
dat<-read.csv("/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/Machine Learning/เอกสาร/ep2_regression/_02_multiple regression/SalaryData.csv")
head(dat)
```

```{r}
library(caret)
set.seed(123)
train.id<-createDataPartition(dat$salary, p=0.7, list=F)
train.dat<-dat[train.id,]
test.dat<-dat[-train.id,]

# Split data into feature matrix and outcome vector
training<-train.dat[,2:6]
training_outcome<-as.numeric(train.dat[,7])
test<-test.dat[,2:6]
test_outcome<-as.numeric(test.dat[,7])

# create design matrix
training <- model.matrix(~ rank+discipline+yrs.since.phd+yrs.service+sex,data=training)
test<-model.matrix(~ rank+discipline+yrs.since.phd+yrs.service+sex,data=test)
dimnames(training)<-NULL
```

### Training model in Python

```{r}
history <- model.r %>% keras::fit(training[,-1], training_outcome, epoch = 30)
plot(history)

```


```{python eval=F}
model.fit(X_train, y_train, epochs=5)

preds = model.predict(X_test)
print(preds)

# Evaluating the model
model.evaluate(X_test, y_test)
```




