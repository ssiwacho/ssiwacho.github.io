[
  {
    "path": "posts/2022-02-23-student-dataset/",
    "title": "Student Dataset",
    "description": "การจัดกระทำชุดข้อมูล onet",
    "author": [
      {
        "name": "Siwachoat Srisuttiyakorn",
        "url": {}
      }
    ],
    "date": "2022-02-23",
    "categories": [],
    "contents": "\n\nContents\nStudent background dataset\nVariables\nรายได้พ่อ แม่ และผู้ปกครอง (ต่อปี)\nLIVING_ID\nLIVING_PARENT_ID\nLIVING_TYPE_ID\n\n\n\nการวิเคราะห์ส่วนนี้จะดำเนินการจัดกระทำข้อมูลส่วนที่เป็นข้อมูลพื้นฐานของนักเรียนจากฐานข้อมูล onet\nStudent background dataset\nชุดข้อมูลพื้นฐานนักเรียนได้จากฐานข้อมูลนักเรียนรายบุคคลที่เข้าสอบ onet ปีการศึกษา 2561 ซึ่งมีจำนวนทั้งสิ้น 1,048,575 คน ข้อมูลชุดนี้มีตัวแปรที่สำคัญและอาจนำไปใช้ต่อได้ ได้แก่ เพศของนักเรียน (GENDER) ระดับชั้นของนักเรียน (XM_GRADE_CODE) รายได้พ่อ แม่ และ ผู้ปกครอง (DAD_INCOME, MOM_INCOME และ PARENT_INCOME) และสถานภาพทางครอบครัวของนักเรียน ได้แก่ สถานะครอบครัว (LIVING_ID) สถานะภาพพ่อแม่ (LIVING_PARENT_ID) และสภาพที่พักอาศัยของนักเรียน (LIVING_TYPE_ID)\n\n\nlibrary(dplyr)\nlibrary(readxl)\nstudent_bg<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-23-student-dataset/dbo_VW_SON_STUDENT_DATA.xlsx\")\nglimpse(student_bg)\n\n\nRows: 1,048,575\nColumns: 20\n$ STUDENT_SEQ      <chr> \"65\", \"66\", \"67\", \"68\", \"69\", \"70\", \"71\", \"…\n$ GRADE_CODE       <chr> \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"…\n$ SCHOOL_CODE      <chr> \"7043010809\", \"7043010809\", \"7043010809\", \"…\n$ STUDENT_ID       <chr> \"70580602\", \"70590650\", \"70580604\", \"705806…\n$ GENDER           <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\"…\n$ DOB              <chr> \"25460512\", \"25420801\", \"25450912\", \"254510…\n$ SEAT_NO          <chr> \"43100432\", \"43100421\", \"43100506\", \"431005…\n$ STUDENT_STATUS   <chr> \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\"…\n$ SPC_CODE         <chr> NA, \"009\", NA, NA, NA, NA, NA, NA, \"009\", N…\n$ XM_GRADE_CODE    <chr> \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"…\n$ DAD_INCOME       <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ MOM_INCOME       <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ PARENT_INCOME    <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ DAD_CAREER       <dbl> 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ MOM_CAREER       <dbl> 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ PARENT_CAREER    <dbl> 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ LIVING_ID        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ NUM_OF_SIBLINGS  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ LIVING_PARENT_ID <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ LIVING_TYPE_ID   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n\nVariables\nตัวแปรที่สนใจจะนำมาวิเคราะห์ได้แก่ ตัวแปรรายได้ สถานภาพครอบครัว (LIVING_ID) บุคคลที่นักเรียนพักอาศัยด้วย (LIVING_PARENT_ID) และลักษณะที่พักอาศัยของนักเรียน (LIVING_TYPE_ID)\nรายได้พ่อ แม่ และผู้ปกครอง (ต่อปี)\n0 = ไม่ให้ข้อมูล\n1 = < 50,000\n2 = 50,001 - 100,000\n3 = 100,001 - 200,000\n4 = 200,001 - 300,000\n5 = >300,000\nตัวแปรรายได้สามารถนำมาจัดกระทำได้หลายลักษณะ\nLIVING_ID\nสถานภาพครอบครัวของนักเรียน –> พ่อแม่อยู่ด้วยกันหรือไม่?\n0 = ไม่ให้ข้อมูล\n1 = อยู่ด้วยกัน\n2 = แยกกันอยู่\n3 = บิดาหรือมารดาเสียชีวิต\n4 = บิดาและมารดา เสียชีวิต\n\n\ntable(student_bg$LIVING_ID)\n\n\n\n     0      1      2      3      4 \n 36241 727644 214945  31972   2341 \n\nLIVING_PARENT_ID\nสถานภาพครอบครัวของนักเรียน –> นักเรียนพักอาศัยอยู่กับใคร?\n0 = ไม่ให้ข้อมูล\n1 = อยู่ด้วยกันกับบิดาและมารดา\n2 = บิดา\n3 = มารดา\n4 = ญาติ\n\n\ntable(student_bg$LIVING_PARENT_ID)\n\n\n\n     0      1      2      3      4 \n 35051 663446  48563 100598 139976 \n\nLIVING_TYPE_ID\nสถานที่พักอาศัยของนักเรียน\n0 = ไม่ให้ข้อมูล\n1 = บ้านของตนเอง\n2 = บ้านเช่า\n3 = หอพัก\n\n\ntable(student_bg$LIVING_TYPE_ID)\n\n\n\n     0      1      2      3 \n 36169 857557  74422  23552 \n\n\n\n\n",
    "preview": {},
    "last_modified": "2022-02-24T21:17:49+07:00",
    "input_file": {}
  },
  {
    "path": "posts/2022-02-22-onetdataset/",
    "title": "Onet Dataset",
    "description": "การดำเนินการข้างต้นทำให้ได้ชุดข้อมูล 3 ชุดได้แก่ ชุดข้อมูลคะแนนสอบ onet ระดับโรงเรียนของนักเรียนในระดับชั้น ป.6 ม.3 และ ม.6 ผู้วิเคราะห์ได้ปรับเปลี่ยนโครงสร้างของข้อมูลให้อยู่ในรูปแบบ tidy data แล้ว และมีการลดทอนข้อมูลคะแนนสอบ onet โดยนำค่าเฉลี่ยคะแนนสอบในระดับโรงเรียนของแต่ละรายวิชามาวิเคราะห์องค์ประกอบหลัก ซึ่งทำให้สามารถลดทอนตัวแปรคะแนนสอบ onet ได้เหลือตัวแปรเดียว เรียกว่า คะแนนผลสัมฤทธิ์โดยรวมของนักเรียนในโรงเรียน ไฟล์ข้อมูลที่จัดการเรียบร้อยแล้วจะถูกเก็บไว้เป็น .csv ชื่อ `onet_p6.csv`, `onet_m3.csv` และ `onet_m6.csv`",
    "author": [
      {
        "name": "Siwachoat Srisuttiyakorn",
        "url": {}
      }
    ],
    "date": "2022-02-22",
    "categories": [],
    "contents": "\n\nContents\nImporting data\nTidying data\nExploring data\nPrincipal Component Analysis (PCA)\nPCA on p6 dataset\nPCA on m3 dataset\nPCA on m6 dataset\n\nMerge three dataset together\nสรุป\n\nฐานข้อมูลสถิติพื้นฐาน onet ระดับโรงเรียน ปีการศึกษา 2561 โดยมีชุดข้อมูล 3 ชุด ได้แก่ ชุดข้อมูลของ ป.6 ม.3 และ ม.6 ข้อมูลทั้งหมดอยู่ในไฟล์ข้อมูล O-NET_2561.xlsx\nImporting data\n\n\nlibrary(dplyr)\nlibrary(readxl)\n# check the excel sheet\nexcel_sheets(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-22-onetdataset/O-NET_2561.xlsx\")\n\n\n[1] \"ONET_P6_2561\" \"ONET_M3_2561\" \"ONET_M6_2561\"\n\nผลการสำรวจข้างต้นจะเห็นว่าไฟล์ข้อมูลมี 3 sheets ซึ่งบันทึกข้อมูลคะแนน onet ในระดับชั้น ป.6 ม.3 และ ม.6 ตามลำดับ\n\n\n# onetscore (from onet database)\nonet_p6<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-22-onetdataset/O-NET_2561.xlsx\", sheet=\"ONET_P6_2561\")\nonet_m3<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-22-onetdataset/O-NET_2561.xlsx\", sheet=\"ONET_M3_2561\")\nonet_m6<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-22-onetdataset/O-NET_2561.xlsx\", sheet=\"ONET_M6_2561\")\n\n\n\nเมื่อพิจารณาชุดข้อมูลทั้งสามชุด จะพบว่า ทั้งสามชุดมีตัวแปรเหมือนกันกัน แต่เป็นชุดข้อมูลที่อยู่ในรูปแบบ long format ซึ่งยังไม่พร้อมที่จะนำไปวิเคราะห์ ต้องดำเนินการจัดกระทำข้อมูลให้อยู่ในรูปแบบ tidy data ก่อน ตัวแปรที่สำคัญในชุดข้อมูลทั้ง 3 ได้แก่ ชื่อโรงเรียน (SCHOOL_NAME) สังกัดโรงเรียน (AREA_NAME_XX) อำเภอ (AMPH_NAME) จังหวัด (PROV_NAME) ขนาดโรงเรียน (SCHOOL_SIZE) รายวิชา (SBJ_NAME) และค่าสถิติของคะแนนสอบ onet ในแต่ละโรงเรียน ได้แก่ ค่าต่ำสุด ค่าสูงสุด ค่าเฉลี่ย มัธยฐาน และ ส่วนเบี่ยงเบนมาตรฐาน\nTidying data\nขั้นแรกดำเนินการแปลงชุดข้อมูล onet ทั้ง 3 ชุด จากเดิมที่อยู่ในรูปแบบ long format ให้อยู่ในรูป wide format dataset โดยใช้ฟังก์ชัน select() เพื่อเลือกตัวแปรที่คาดว่าจะได้ใช้ในการวิเคราะห์ และใช้ฟังก์ชัน pivot_wider() เพื่อแปลงข้อมูลให้เป็น wide format โดยใช้ชุดคำสั่งด้านล่าง\n\n\nlibrary(tidyr)\n## ชุดข้อมูลระดับชั้น ป.6\nonet_p6<-onet_p6%>%\n  dplyr::select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_P6,AREA_NAME_P6,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    #spread(key=\"SBJ_NAME\", value=c(\"AVG_SCORE\"))\n   pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n\n## ชุดข้อมูลระดับชั้น ม.3\nonet_m3<-onet_m3%>%\n  dplyr::select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_M3,AREA_NAME_M3,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n  \n## ชุดข้อมูลระดับชั้น ม.6\nonet_m6<-onet_m6%>%\n  dplyr::select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_M6,AREA_NAME_M6,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n\n#เปลี่ยนชื่อคอลัมน์คะแนนในแต่ละรายวิชาให้เป็นภาษาอังกฤษจะได้เรียกง่าย ๆ \nnames(onet_p6)[14:29]<-c(paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_avg\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_sd\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_min\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_max\"))\n                         \n\nnames(onet_m3)[14:29]<-c(paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_avg\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_sd\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_min\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_max\"))\n                         \n\nnames(onet_m6)[14:33]<-c(paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_avg\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_sd\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_min\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_max\"))\n\n\n\nตรวจสอบข้อมูลซ้ำซ้อนกับค่าสูญหายในชุดข้อมูลท้ังสาม ผลการวิเคราะห์ด้านล่างจะเห็นว่าชุดข้อมูลทั้งสามไม่ได้มีค่าซ้ำซ้อน และพบว่าค่าสูญหายที่เกิดขึ้นส่วนใหญ่เกิดในตัวแปรเขตพื้นที่ทางการศึกษา ซึ่งไม่ใช่สิ่งผิดปกติ ทั้งนี้เป็นเพราะโรงเรียนในชุดข้อมูลมีหลายโรงเรียนที่ไม่ได้สังกัดเขตพื้นที่ของสพฐ. ส่วนค่าของตัวแปรที่มีการสูญหายพบว่าในแต่ละชุดข้อมูลมีเพียง 1 โรงเรียนเท่านั้น การแก้ไขค่าสูญหายในดังกล่าวจึงใช้การตัดทิ้ง\n\n\n# identify duplicate data\nschooid_p6<-onet_p6$SCHOOL_CODE\nschooid_m3<-onet_m3$SCHOOL_CODE\nschooid_m6<-onet_m6$SCHOOL_CODE\n\nduplicated(schooid_p6)%>%table()\n\n\n.\nFALSE \n30692 \n\nduplicated(schooid_m3)%>%table()\n\n\n.\nFALSE \n11919 \n\nduplicated(schooid_m6)%>%table()\n\n\n.\nFALSE \n 3898 \n\n# identify missing data\nlibrary(naniar)\nmiss_var_summary(onet_p6)\n\n\n# A tibble: 29 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_P6   2429  7.91   \n 2 AREA_NAME_P6   2429  7.91   \n 3 math_avg          1  0.00326\n 4 math_sd           1  0.00326\n 5 math_min          1  0.00326\n 6 math_max          1  0.00326\n 7 SCHOOL_CODE       0  0      \n 8 SCHOOL_NAME       0  0      \n 9 AMPH_ID           0  0      \n10 AMPH_NAME         0  0      \n# … with 19 more rows\n\nmiss_var_summary(onet_m3)\n\n\n# A tibble: 29 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_M3   1091     9.15\n 2 AREA_NAME_M3   1091     9.15\n 3 SCHOOL_CODE       0     0   \n 4 SCHOOL_NAME       0     0   \n 5 AMPH_ID           0     0   \n 6 AMPH_NAME         0     0   \n 7 PROV_ID           0     0   \n 8 PROV_NAME         0     0   \n 9 REGION_NAME       0     0   \n10 URBAN_ZONE        0     0   \n# … with 19 more rows\n\nmiss_var_summary(onet_m6)\n\n\n# A tibble: 33 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_M6    502  12.9   \n 2 AREA_NAME_M6    502  12.9   \n 3 eng_avg           1   0.0257\n 4 sci_avg           1   0.0257\n 5 eng_sd            1   0.0257\n 6 sci_sd            1   0.0257\n 7 eng_min           1   0.0257\n 8 sci_min           1   0.0257\n 9 eng_max           1   0.0257\n10 sci_max           1   0.0257\n# … with 23 more rows\n\nตัดโรงเรียนที่มีค่าสูญหายออกจากชุดข้อมูลที่จะนำไปวิเคราะห์\n\n\nonet_p6_nomiss<-onet_p6%>%filter(!is.na(math_avg))\nonet_m3_nomiss<-onet_m3\nonet_m6_nomiss<-onet_m6%>%filter(!is.na(eng_avg))\n\n\n\nExploring data\nผลการวิเคราะห์ข้อมูลเบื้องต้นพบว่า ในชุดข้อมูล onet มีข้อมูลคะแนนสอบจากโรงเรียนต่าง ๆ โดยมีโรงเรียนในระดับชั้นป.6 เป็นส่วนใหญ่จำนวน 30692 โรงเรียน รองลงมาคือระดับชั้นม.3 จำนวน 11919 โรงเรียน และระดับม.6 จำนวน 3898 โรงเรียน\n\n\nlibrary(ggplot2)\n\n# จำนวนโรงเรียนจำแนกตามระดับชั้น\ntemp<-onet_p6%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\nnames(temp)[2]<-\"p6\"\nm3<-onet_m3%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\nm6<-onet_m6%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\ntemp$m3<-m3$n\ntemp$m6<-m6$n\ncolSums(temp[,2:4])\n\n\n   p6    m3    m6 \n30692 11919  3898 \n\nbarplot(colSums(temp[,2:4]))\n\n\n\n\nจำนวนโรงเรียนจำแนกตามสังกัด พบว่าโรงเรียนส่วนใหญ่เป็นโรงเรียนสังกัด สพฐ. รองลงมาคือ สช. อทป. และกรุงเทพมหานคร\n\n\n#ระดับชั้น ป.6\ntable(onet_p6$BUREA_NAME)\n\n\n\n            กรมส่งเสริมการปกครองท้องถิ่น \n                                860 \n        กองบัญชาการตำรวจตระเวนชายแดน \n                                206 \n                        สถาบันพลศึกษา \n                                  1 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                431 \n                สำนักการศึกษาเมืองพัทยา \n                                 10 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                              26815 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 40 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                               2274 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                  1 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n                             โฮมสคูล \n                                  4 \n\n#ระดับชั้น ม.3\ntable(onet_m3$BUREA_NAME)\n\n\n\n            กรมส่งเสริมการปกครองท้องถิ่น \n                                631 \n        กองบัญชาการตำรวจตระเวนชายแดน \n                                  3 \n              สถาบันบัณฑิตพัฒนศิลป์ (ม.6) \n                                 12 \n                        สถาบันพลศึกษา \n                                 11 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                109 \n                สำนักการศึกษาเมืองพัทยา \n                                 11 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                               9336 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 35 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                               1319 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                402 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n\n#ระดับชั้น ม.6\ntable(onet_m6$BUREA_NAME)\n\n\n\n  กรมยุทธศึกษาทหาร กองบัญชาการทหารสูงสุด \n                                  1 \n            กรมส่งเสริมการปกครองท้องถิ่น \n                                345 \n              ในกำกับกระทรวงศึกษาธิการ \n                                  1 \n              สถาบันบัณฑิตพัฒนศิลป์ (ม.6) \n                                 11 \n                        สถาบันพลศึกษา \n                                 11 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                  9 \n                สำนักการศึกษาเมืองพัทยา \n                                  1 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                               2452 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 31 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                                711 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                274 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n          สำนักพัฒนาสังคม กรุงเทพมหานคร \n                                  1 \n\nเมื่อพิจารณาจำแนกตามจังหวัด พบว่า จังหวัดนครราชสีมาเป็นจังหวัดที่มีโรงเรียนมากที่สุด รองลงมาคือจังหวัดกรุงเทพฯ อุบลราชธานี และขอนแก่น ส่วนจังหวัดที่มีโรงเรียนน้อยที่สุดคือจังหวัดระนอง\n\n\n# generate barplot\ntemp%>%pivot_longer(cols=c(\"p6\",\"m3\",\"m6\"), \n                    names_to=\"level\", \n                    values_to=\"freq\")%>%\n       mutate(level=factor(level, levels=c(\"p6\",\"m3\",\"m6\")))%>%\n  ggplot()+\n  geom_bar(aes(x=reorder(PROV_NAME, freq), \n               y=freq, fill=level), \n                stat=\"identity\")+xlab(\"จังหวัด \\n\")+ylab(\"จำนวนโรงเรียน\")+\n                coord_flip()+theme_minimal()+\n                theme(text=element_text(family=\"ChulaCharasNew\"))\n\n\n\n\nผลการวิเคราะห์ต่อไปนี้แสดงการแจกแจงของคะแนนสอบ onet ในระดับโรงเรียน ในแต่ละรายวิชาโดยจำแนกตามระดับชั้นของนักเรียน\nคะแนน onet ของนักเรียนระดับชั้น ป.6 จำแนกตามรายวิชา\n\n\nlibrary(gridExtra)\n\n# ระดับชั้น ป.6\nsummary(onet_p6_nomiss[,15:18])\n\n\n    math_avg        sci_avg         eng_avg         thai_sd      \n Min.   : 0.00   Min.   : 6.00   Min.   : 7.50   Min.   : 0.000  \n 1st Qu.:27.73   1st Qu.:34.25   1st Qu.:28.75   1st Qu.: 9.677  \n Median :33.12   Median :38.00   Median :32.50   Median :12.139  \n Mean   :34.68   Mean   :38.28   Mean   :34.46   Mean   :11.602  \n 3rd Qu.:40.00   3rd Qu.:41.97   3rd Qu.:37.97   3rd Qu.:14.055  \n Max.   :95.00   Max.   :74.50   Max.   :97.50   Max.   :31.125  \n\np1<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\ngrid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)\n\n\n\n\nคะแนน onet ของนักเรียนระดับชั้น ม.3 จำแนกตามรายวิชา\n\n\n# ระดับชั้น ม.3\nsummary(onet_m3_nomiss[,15:18])\n\n\n    eng_avg         math_avg        sci_avg         thai_sd     \n Min.   :15.00   Min.   : 8.00   Min.   :16.00   Min.   : 0.00  \n 1st Qu.:25.09   1st Qu.:23.19   1st Qu.:31.37   1st Qu.:11.06  \n Median :26.22   Median :25.27   Median :33.50   Median :12.79  \n Mean   :26.93   Mean   :26.25   Mean   :33.96   Mean   :12.42  \n 3rd Qu.:27.50   3rd Qu.:27.73   3rd Qu.:35.99   3rd Qu.:14.18  \n Max.   :84.19   Max.   :93.28   Max.   :72.65   Max.   :23.16  \n\np1<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\ngrid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)\n\n\n\n\nคะแนน onet ของนักเรียนระดับชั้น ม.6 จำแนกตามรายวิชา\n\n\n# ระดับชั้น ม.6\nsummary(onet_m6_nomiss[,15:19])\n\n\n    soc_avg         eng_avg         math_avg        sci_avg     \n Min.   :17.00   Min.   :12.50   Min.   : 7.50   Min.   : 9.60  \n 1st Qu.:30.74   1st Qu.:22.09   1st Qu.:18.86   1st Qu.:25.13  \n Median :32.34   Median :23.75   Median :21.20   Median :26.80  \n Mean   :32.64   Mean   :26.14   Mean   :23.76   Mean   :27.44  \n 3rd Qu.:34.02   3rd Qu.:26.41   3rd Qu.:25.07   3rd Qu.:28.68  \n Max.   :57.36   Max.   :86.12   Max.   :97.31   Max.   :76.32  \n    thai_sd     \n Min.   : 0.00  \n 1st Qu.:10.83  \n Median :12.38  \n Mean   :11.99  \n 3rd Qu.:13.58  \n Max.   :21.99  \n\np1<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\np5<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=soc_avg))+xlim(0,100)\n\ngrid.arrange(p1,p2,p3,p4,p5, nrow=3, ncol=2)\n\n\n\n\nPrincipal Component Analysis (PCA)\nนอกจากค่าเฉลี่ยคะแนน onet ของแต่ละโรงเรียนแล้ว ยังมีค่าสถิติของคะแนนอื่น ๆ ได้แก่ sd, min และ max ซึ่งให้สารสนเทศในมิติต่าง ๆ เกี่ยวกับการแจกแจงของคะแนน onet ในแต่ละโรงเรียนด้วย อย่างไรก็ตามข้อมูลมีปริมาณค่อนข้างมาก และหลายระดับชั้น หากนำตัวแปรทั้งหมดมาวิเคราะห์จะทำให้มีความซับซ้อนเกินไป วิธีการหนึ่งที่สามารถลดทอนข้อมูลดังกล่าวได้คือการใช้เทคนิค PCA ซึ่งเป็นการยุบรวมตัวแปรหลาย ๆ ตัวเข้าด้วยกันเพื่อสร้างสเกลของตัวแปรใหม่โดยใช้ความสัมพันธ์ระหว่างตัวแปร\nก่อนการวิเคราะห์ PCA ผู้วิเคราะห์ดำเนินการตรวจสอบความสัมพันธ์ระหว่างค่าสถิติดังกล่าวโดยใช้แผนภาพการกระจายและสัมประสิทธิ์สหสัมพันธ์ก่อน โดยจำแนกตามระดับชั้นของนักเรียน ได้ผลการวิเคราะห์ดังนี้\n\n\nlibrary(GGally)\ncor_p6<-onet_p6_nomiss%>%select(ends_with(c(\"avg\")))%>%cor()\ncor_m3<-onet_m3_nomiss%>%select(ends_with(c(\"avg\")))%>%cor(use=\"complete.obs\")\ncor_m6<-onet_m6_nomiss%>%select(ends_with(c(\"avg\")))%>%cor(use=\"complete.obs\")\n\n#correlation p6\ncor_p6\n\n\n          thai_avg  math_avg   sci_avg   eng_avg\nthai_avg 1.0000000 0.7249939 0.7471793 0.6088336\nmath_avg 0.7249939 1.0000000 0.7084016 0.6460727\nsci_avg  0.7471793 0.7084016 1.0000000 0.6017332\neng_avg  0.6088336 0.6460727 0.6017332 1.0000000\n\n#correlation m3\ncor_m3\n\n\n          thai_avg   eng_avg  math_avg   sci_avg\nthai_avg 1.0000000 0.4754923 0.6683351 0.7822189\neng_avg  0.4754923 1.0000000 0.6603974 0.5139788\nmath_avg 0.6683351 0.6603974 1.0000000 0.7151848\nsci_avg  0.7822189 0.5139788 0.7151848 1.0000000\n\n#correlation m6\ncor_m6\n\n\n          thai_avg   soc_avg   eng_avg  math_avg   sci_avg\nthai_avg 1.0000000 0.8982477 0.7483392 0.8335856 0.8269468\nsoc_avg  0.8982477 1.0000000 0.7389249 0.8298790 0.8280027\neng_avg  0.7483392 0.7389249 1.0000000 0.8714466 0.8029595\nmath_avg 0.8335856 0.8298790 0.8714466 1.0000000 0.9007536\nsci_avg  0.8269468 0.8280027 0.8029595 0.9007536 1.0000000\n\nPCA on p6 dataset\nvar$coord: coordinates of variables to create a scatter plot\nvar$cos2: represents the quality of representation for variables on the factor map. It’s calculated as the squared coordinates: - - - var.cos2 = var.coord * var.coord.\nvar$contrib: contains the contributions (in percentage) of the variables to the principal components. The contribution of a variable (var) to a given principal component is (in percentage) : (var.cos2 * 100) / (total cos2 of the component)\n\n\nlibrary(factoextra)\npca_p6_fit<-princomp(onet_p6_nomiss%>%dplyr::select(ends_with(c(\"avg\")))%>%data.frame(), scores=TRUE, cor=TRUE)\nfviz_screeplot(pca_p6_fit)\n\n\n\nget_eig(pca_p6_fit)\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1  3.0220158        75.550395                    75.55039\nDim.2  0.4406782        11.016955                    86.56735\nDim.3  0.2869393         7.173482                    93.74083\nDim.4  0.2503668         6.259169                   100.00000\n\nvar <- get_pca_var(pca_p6_fit)\nvar$coord #factor loadings\n\n\n             Dim.1       Dim.2       Dim.3       Dim.4\nthai_avg 0.8896884  0.23051132  0.07507016  0.38688952\nmath_avg 0.8882723  0.04449422 -0.44394055 -0.10913034\nsci_avg  0.8822783  0.24809599  0.26758744 -0.29737235\neng_avg  0.8142651 -0.56921996  0.11232759  0.01853388\n\n#var$cos2 # squared loadings\n#var$contrib #prop. squared loadings\n\n\n\n\n\nfviz_pca_var(pca_p6_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet จาก 4 รายวิชา ให้เหลือเพียงตัวแปรเดียวเรียกว่า คะแนนผลสัมฤทธิ์ onet โดยรวม โดยตัวแปรดังกล่าวสามารถอธิบายความแปรปรวนของตัวแปรเดิมทั้ง 4 ได้คิดเป็นร้อยละ 75.55\nแผนภาพต่อไปนี้แสดงการแจกแจงของคะแนนผลสัมฤทธิ์ onet โดยรวมระดับโรงเรียน ของนักเรียนระดับชั้นประถมศึกษาปีที่ 6 โดยการแจกแจงในภาพรวมแสดงด้วยแผนภาพ histogram และใช้ boxplot แสดงการแจกแจงของคะแนนจำแนกตามสังกัดของโรงเรียน\n\n\nonet_p6_nomiss$com1<-pca_p6_fit$scores[,1]\np1<-ggplot(onet_p6_nomiss)+geom_histogram(aes(x=com1))+xlab(\"P6 Ach component\")\np1\n\n\n\nsummary(onet_p6_nomiss$com1)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-5.7595 -1.1640 -0.1689  0.0000  0.9826 10.7712 \n\n\n\np1<-ggplot(data=onet_p6_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"P6 Ach component\")\np1\n\n\n\n\nPCA on m3 dataset\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1  2.9176275        72.940687                    72.94069\nDim.2  0.6031477        15.078693                    88.01938\nDim.3  0.2685367         6.713417                    94.73280\nDim.4  0.2106881         5.267203                   100.00000\n             Dim.1      Dim.2        Dim.3       Dim.4\nthai_avg 0.8635889  0.3649334  0.223128029  0.26693036\neng_avg  0.7608661 -0.6095065  0.220469519 -0.03126968\nmath_avg 0.8949234 -0.1216248 -0.412371593  0.11945371\nsci_avg  0.8899644  0.2892760  0.009665917 -0.35240508\n\n\n\nonet_m3_nomiss$com1<-pca_m3_fit$scores[,1]\np1<-ggplot(onet_m3_nomiss)+geom_histogram(aes(x=com1))+xlab(\"M3 Ach component\")+xlim(-6,6)\np1\n\n\n\n\n\n\nfviz_pca_var(pca_m3_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet ในระดับมัธยมศึกษาปีที่ 3 ได้เหลือ 1 องค์ประกอบ เรียกองค์ประกอบนี้ว่าผลสัมฤทธิ์ onet โดยรวม เช่นเดียวกับที่วิเคราะห์ในระดับชั้น ป.6 โดยองค์ประกอบดังกล่าวสามารถอธิบายความแปรปรวนของตัวแปรเดิมได้คิดเป็นร้อยละ 72.94\n\n\np1<-ggplot(data=onet_m3_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"M3 Ach component\")\np1\n\n\n\n\nPCA on m6 dataset\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1 4.31357346        86.271469                    86.27147\nDim.2 0.33038711         6.607742                    92.87921\nDim.3 0.17199471         3.439894                    96.31911\nDim.4 0.10146913         2.029383                    98.34849\nDim.5 0.08257558         1.651512                   100.00000\n             Dim.1      Dim.2       Dim.3        Dim.4        Dim.5\nthai_avg 0.9277860  0.2765852  0.11073757  0.224218975  0.013300204\nsoc_avg  0.9251801  0.2943146  0.08104849 -0.225466624  0.004082051\neng_avg  0.8948587 -0.3765740  0.22177892 -0.015571887  0.089395775\nmath_avg 0.9558159 -0.1514528 -0.08895745  0.007435426 -0.235604288\nsci_avg  0.9394001 -0.0502069 -0.30994149  0.007874978  0.137408289\n\n\n\nonet_m6_nomiss$com1<-pca_m6_fit$scores[,1]\np1<-ggplot(onet_m6_nomiss)+geom_histogram(aes(x=com1))+xlab(\"M6 Ach Component\")\np1\n\n\n\n\n\n\nfviz_pca_var(pca_m6_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet ในระดับมัธยมศึกษาปีที่ 6 ได้เหลือ 1 องค์ประกอบ เรียกองค์ประกอบนี้ว่า ผลสัมฤทธิ์ onet โดยรวม โดยองค์ประกอบนี้สามารถอธิบายความแปรปรวนของตัวแปรเดิมได้คิดเป็นร้อยละ 86.27\n\n\np1<-ggplot(data=onet_m6_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"M6 Ach Component\")\n\np1\n\n\n\n\nMerge three dataset together\nขั้นตอนสุดท้ายคือการรวมชุดข้อมูลทั้งสามเข้าด้วยกันเป็นชุดข้อมูลเดียว ทั้งนี้ชุดข้อมูลที่รวมเสร็จแล้วจำเป็นต้องอยู่ในรูปแบบ tidy data ด้วย\n\n\np6<-onet_p6_nomiss\np6$class<-\"p6\"\nnames(p6)[14:29]<-paste(names(p6)[14:29],\"p6\",sep=\"_\")\nnames(p6)[30]<-\"ach_p6\"\nnames(p6)[9:10]<-c(\"AREA_CODE\",\"AREA_NAME\")\nm3<-onet_m3_nomiss\nm3$class<-\"m3\"\nnames(m3)[14:29]<-paste(names(m3)[14:29],\"m3\",sep=\"_\")\nnames(m3)[30]<-\"ach_m3\"\nnames(m3)[9:10]<-c(\"AREA_CODE\",\"AREA_NAME\")\nm6<-onet_m6_nomiss\nm6$class<-\"m6\"\nnames(m6)[14:33]<-paste(names(m6)[14:33],\"m6\",sep=\"_\")\nnames(m6)[34]<-\"ach_m6\"\nnames(m6)[9:10]<-c(\"AREA_CODE\",\"AREA_NAME\")\n\nonet<-full_join(p6,m3, by=names(p6)[c(1:13,31)])\nonet<-full_join(onet,m6, by=names(onet)[c(1:13,31)])\n\nglimpse(onet)\n\n\nRows: 46,507\nColumns: 69\n$ SCHOOL_CODE <chr> \"3023200101\", \"3024100101\", \"3035200102\", \"30403…\n$ SCHOOL_NAME <chr> \"เทศบาลชุมชนวิมลวิทยา\", \"วัดสัมปทวน (บางแก้วพุทธิยาคาร)\"…\n$ AMPH_ID     <chr> \"2301\", \"2401\", \"3501\", \"4006\", \"5301\", \"5709\", …\n$ AMPH_NAME   <chr> \"เมืองตราด\", \"เมืองฉะเชิงเทรา\", \"เมืองยโสธร\", \"สีชมพู\"…\n$ PROV_ID     <chr> \"23\", \"24\", \"35\", \"40\", \"53\", \"57\", \"64\", \"15\", …\n$ PROV_NAME   <chr> \"ตราด\", \"ฉะเชิงเทรา\", \"ยโสธร\", \"ขอนแก่น\", \"อุตรดิตถ์\"…\n$ REGION_NAME <chr> \"ตะวันออก\", \"ตะวันออก\", \"ตะวันออกเฉียงเหนือ\", \"ตะวันออ…\n$ URBAN_ZONE  <chr> \"URBAN\", \"URBAN\", \"URBAN\", \"SUBURB\", \"URBAN\", \"S…\n$ AREA_CODE   <chr> \"3023\", \"3024\", \"3035\", \"3040\", \"3053\", \"3057\", …\n$ AREA_NAME   <chr> \"ท้องถิ่นจังหวัดตราด\", \"ท้องถิ่นจังหวัดฉะเชิงเทรา\", \"ท้องถิ่นจั…\n$ BUREA_CODE  <chr> \"30\", \"30\", \"30\", \"30\", \"30\", \"30\", \"30\", \"30\", …\n$ BUREA_NAME  <chr> \"กรมส่งเสริมการปกครองท้องถิ่น\", \"กรมส่งเสริมการปกครองท้อ…\n$ SCHOOL_SIZE <chr> \"L\", \"M\", \"L\", \"S\", \"XL\", \"M\", \"S\", \"S\", \"L\", \"S…\n$ thai_avg_p6 <dbl> 56.96341, 54.30921, 57.08975, 37.80000, 59.77416…\n$ math_avg_p6 <dbl> 32.25610, 29.07895, 41.98020, 19.00000, 42.15613…\n$ sci_avg_p6  <dbl> 34.02439, 34.06579, 39.73153, 34.00000, 43.65741…\n$ eng_avg_p6  <dbl> 33.41463, 34.60526, 40.32020, 23.00000, 39.19444…\n$ thai_sd_p6  <dbl> 11.380286, 11.599746, 16.025261, 10.482008, 14.8…\n$ math_sd_p6  <dbl> 14.695121, 11.801832, 22.548947, 10.677078, 21.9…\n$ sci_sd_p6   <dbl> 9.993871, 10.845914, 12.311258, 7.211102, 12.070…\n$ eng_sd_p6   <dbl> 12.275497, 14.807163, 17.203388, 5.454356, 15.81…\n$ thai_min_p6 <dbl> 25.25, 22.00, 15.00, 19.75, 25.00, 24.00, 25.00,…\n$ math_min_p6 <dbl> 5, 15, 5, 5, 0, 10, 15, 15, 5, 5, 5, 10, 10, 10,…\n$ sci_min_p6  <dbl> 2.5, 11.0, 14.0, 23.5, 19.5, 17.0, 11.5, 23.5, 1…\n$ eng_min_p6  <dbl> 7.5, 10.0, 7.5, 17.5, 10.0, 17.5, 17.5, 17.5, 7.…\n$ thai_max_p6 <dbl> 85.75, 71.50, 86.75, 52.50, 89.50, 83.75, 72.00,…\n$ math_max_p6 <dbl> 80, 60, 100, 40, 100, 80, 45, 55, 95, 80, 85, 75…\n$ sci_max_p6  <dbl> 58.5, 58.5, 76.0, 46.5, 76.5, 73.5, 46.5, 53.0, …\n$ eng_max_p6  <dbl> 97.5, 85.0, 92.5, 35.0, 95.0, 65.0, 40.0, 52.5, …\n$ ach_p6      <dbl> -0.3571698, -0.6103090, 0.9877122, -2.7404489, 1…\n$ class       <chr> \"p6\", \"p6\", \"p6\", \"p6\", \"p6\", \"p6\", \"p6\", \"p6\", …\n$ thai_avg_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_avg_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_avg_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_avg_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_sd_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_sd_m3   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_sd_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_sd_m3   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_min_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_min_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_min_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_min_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_max_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_max_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_max_m3 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_max_m3  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ ach_m3      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_avg_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ soc_avg_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_avg_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_avg_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_avg_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_sd_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ soc_sd_m6   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_sd_m6   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_sd_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_sd_m6   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_min_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ soc_min_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_min_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_min_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_min_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ thai_max_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ soc_max_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ eng_max_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ math_max_m6 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ sci_max_m6  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ ach_m6      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n\nสรุป\nการดำเนินการข้างต้นทำให้ได้ชุดข้อมูล onet ที่มีตัวแปรสำคัญคือคะแนนผลสัมฤทธิ์ onet ระดับโรงเรียนของนักเรียนในระดับชั้น ป.6 ม.3 และ ม.6 โดยที่คะแนนผลสัมฤทธิ์ onet ดังกล่าวสร้างจากเทคนิคการวิเคราะห์องค์ประกอบหลัก (PCA) และสามารถอธิบายความแปรปรวนในตัวแปรเดิมคือ คะแนนสอบ onet ทุกรายวิชา ได้ตั้งแต่ประมาณร้อยละ 72 ถึง 86 ซึ่งอยู่ในระดับที่สูงมาก ผู้วิเคราะห์จึงจะใช้คะแนนผลสัมฤทธิ์ onet ดังกล่าวเป็นตัวแทนผลสัมฤทธิ์ onet จากทุกรายวิชาของนักเรียน\nไฟล์ข้อมูลที่จัดการเรียบร้อยแล้วจะถูกเก็บไว้เป็น .csv ชื่อ onet.csv\n\n\nwrite.csv(onet, file=\"onet.csv\")\n\n\n\n\nhtml {\n  scroll-behavior: smooth;\n}\nd-article {\n    contain: none;\n  }\n#TOC {\n  position: fixed;\n  z-index: 50;\n  background: \"white\";     /* or   background: white; */\n  padding: -5px;           /* optional */\n  border-radius: 5px;      /* optional */\n  }\n\n/* Hide the ToC when resized to mobile or tablet:  480px, 768px, 900px */\n@media screen and (max-width: 900px) {\n#TOC {\n    position: relative;\n  }\n}\n\n\n\n",
    "preview": "posts/2022-02-22-onetdataset/onetdataset_files/figure-html5/unnamed-chunk-6-1.png",
    "last_modified": "2022-02-25T00:16:40+07:00",
    "input_file": {}
  },
  {
    "path": "posts/2022-02-20-inequality/",
    "title": "Edu Inequality Project I",
    "description": "ส่วนจัดกระทำข้อมูล",
    "author": [
      {
        "name": "Siwachoat Srisuttiyakorn",
        "url": {}
      }
    ],
    "date": "2022-02-20",
    "categories": [
      "inequality"
    ],
    "contents": "\n\nContents\nOnet datasets\nImporting data\nTidying data\nExploring data\nPrincipal Component Analysis (PCA)\nPCA on p6 dataset\nPCA on m3 dataset\nPCA on m6 dataset\n\nStudent background dataset\nSchool background dataset\nONESQA dataset\n\nData Exploring and Manipulating\nTidying and Manipulating Onet datasets\n\n\nOnet datasets\nฐานข้อมูลสถิติพื้นฐาน onet ระดับโรงเรียน ปีการศึกษา 2561 โดยมีชุดข้อมูล 3 ชุด ได้แก่ ชุดข้อมูลของ ป.6 ม.3 และ ม.6 ข้อมูลทั้งหมดอยู่ในไฟล์ข้อมูล O-NET_2561.xlsx\nImporting data\n\n\nlibrary(dplyr)\nlibrary(readxl)\n\n# onetscore (from onet database)\nonet_p6<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/O-NET_2561.xlsx\", sheet=\"ONET_P6_2561\")\nonet_m3<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/O-NET_2561.xlsx\", sheet=\"ONET_M3_2561\")\nonet_m6<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/O-NET_2561.xlsx\", sheet=\"ONET_M6_2561\")\n\n\n\nเมื่อพิจารณาชุดข้อมูลทั้งสามชุด จะพบว่า ทั้งสามชุดมีตัวแปรเหมือนกันกัน แต่เป็นชุดข้อมูลที่อยู่ในรูปแบบ long format ซึ่งยังไม่พร้อมที่จะนำไปวิเคราะห์ ต้องดำเนินการจัดกระทำข้อมูลให้อยู่ในรูปแบบ tidy data ก่อน ตัวแปรที่สำคัญในชุดข้อมูลทั้ง 3 ได้แก่ ชื่อโรงเรียน (SCHOOL_NAME) สังกัดโรงเรียน (AREA_NAME_XX) อำเภอ (AMPH_NAME) จังหวัด (PROV_NAME) ขนาดโรงเรียน (SCHOOL_SIZE) รายวิชา (SBJ_NAME) และค่าสถิติของคะแนนสอบ onet ในแต่ละโรงเรียน ได้แก่ ค่าต่ำสุด ค่าสูงสุด ค่าเฉลี่ย มัธยฐาน และ ส่วนเบี่ยงเบนมาตรฐาน\nTidying data\nขั้นแรกดำเนินการแปลงชุดข้อมูล onet ทั้ง 3 ชุด จากเดิมที่อยู่ในรูปแบบ long format ให้อยู่ในรูป wide format dataset โดยใช้ฟังก์ชัน select() เพื่อเลือกตัวแปรที่คาดว่าจะได้ใช้ในการวิเคราะห์ และใช้ฟังก์ชัน pivot_wider() เพื่อแปลงข้อมูลให้เป็น wide format โดยใช้ชุดคำสั่งด้านล่าง\n\n\nlibrary(tidyr)\n## ชุดข้อมูลระดับชั้น ป.6\nonet_p6<-onet_p6%>%\n  select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_P6,AREA_NAME_P6,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    #spread(key=\"SBJ_NAME\", value=c(\"AVG_SCORE\"))\n   pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n\n## ชุดข้อมูลระดับชั้น ม.3\nonet_m3<-onet_m3%>%\n  select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_M3,AREA_NAME_M3,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n  \n## ชุดข้อมูลระดับชั้น ม.6\nonet_m6<-onet_m6%>%\n  select(SCHOOL_CODE,SCHOOL_NAME,AMPH_ID,AMPH_NAME,PROV_ID,PROV_NAME,REGION_NAME,URBAN_ZONE,\n         AREA_CODE_M6,AREA_NAME_M6,BUREA_CODE,BUREA_NAME,SCHOOL_SIZE,\n         SBJ_NAME,AVG_SCORE,SD_SCORE,MIN_SCORE, MAX_SCORE)%>%\n    pivot_wider(names_from=SBJ_NAME, values_from=c(\"AVG_SCORE\",\"SD_SCORE\",\"MIN_SCORE\",\"MAX_SCORE\"))\n\n#เปลี่ยนชื่อคอลัมน์คะแนนในแต่ละรายวิชาให้เป็นภาษาอังกฤษจะได้เรียกง่าย ๆ \nnames(onet_p6)[14:29]<-c(paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_avg\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_sd\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_min\"),\n                         paste0(c(\"thai\",\"math\",\"sci\",\"eng\"), \"_max\"))\n                         \n\nnames(onet_m3)[14:29]<-c(paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_avg\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_sd\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_min\"),\n                         paste0(c(\"thai\",\"eng\",\"math\",\"sci\"), \"_max\"))\n                         \n\nnames(onet_m6)[14:33]<-c(paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_avg\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_sd\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_min\"),\n                         paste0(c(\"thai\",\"soc\",\"eng\",\"math\",\"sci\"), \"_max\"))\n\n\n\nตรวจสอบข้อมูลซ้ำซ้อนกับค่าสูญหายในชุดข้อมูลท้ังสาม ผลการวิเคราะห์ด้านล่างจะเห็นว่าชุดข้อมูลทั้งสามไม่ได้มีค่าซ้ำซ้อน และพบว่าค่าสูญหายที่เกิดขึ้นส่วนใหญ่เกิดในตัวแปรเขตพื้นที่ทางการศึกษา ซึ่งไม่ใช่สิ่งผิดปกติ ทั้งนี้เป็นเพราะโรงเรียนในชุดข้อมูลมีหลายโรงเรียนที่ไม่ได้สังกัดเขตพื้นที่ของสพฐ. ส่วนค่าของตัวแปรที่มีการสูญหายพบว่าในแต่ละชุดข้อมูลมีเพียง 1 โรงเรียนเท่านั้น การแก้ไขค่าสูญหายในดังกล่าวจึงใช้การตัดทิ้ง\n\n\n# identify duplicate data\nschooid_p6<-onet_p6$SCHOOL_CODE\nschooid_m3<-onet_m3$SCHOOL_CODE\nschooid_m6<-onet_m6$SCHOOL_CODE\n\nduplicated(schooid_p6)%>%table()\n\n\n.\nFALSE \n30692 \n\nduplicated(schooid_m3)%>%table()\n\n\n.\nFALSE \n11919 \n\nduplicated(schooid_m6)%>%table()\n\n\n.\nFALSE \n 3898 \n\n# identify missing data\nlibrary(naniar)\nmiss_var_summary(onet_p6)\n\n\n# A tibble: 29 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_P6   2429  7.91   \n 2 AREA_NAME_P6   2429  7.91   \n 3 math_avg          1  0.00326\n 4 math_sd           1  0.00326\n 5 math_min          1  0.00326\n 6 math_max          1  0.00326\n 7 SCHOOL_CODE       0  0      \n 8 SCHOOL_NAME       0  0      \n 9 AMPH_ID           0  0      \n10 AMPH_NAME         0  0      \n# … with 19 more rows\n\nmiss_var_summary(onet_m3)\n\n\n# A tibble: 29 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_M3   1091     9.15\n 2 AREA_NAME_M3   1091     9.15\n 3 SCHOOL_CODE       0     0   \n 4 SCHOOL_NAME       0     0   \n 5 AMPH_ID           0     0   \n 6 AMPH_NAME         0     0   \n 7 PROV_ID           0     0   \n 8 PROV_NAME         0     0   \n 9 REGION_NAME       0     0   \n10 URBAN_ZONE        0     0   \n# … with 19 more rows\n\nmiss_var_summary(onet_m6)\n\n\n# A tibble: 33 × 3\n   variable     n_miss pct_miss\n   <chr>         <int>    <dbl>\n 1 AREA_CODE_M6    502  12.9   \n 2 AREA_NAME_M6    502  12.9   \n 3 eng_avg           1   0.0257\n 4 sci_avg           1   0.0257\n 5 eng_sd            1   0.0257\n 6 sci_sd            1   0.0257\n 7 eng_min           1   0.0257\n 8 sci_min           1   0.0257\n 9 eng_max           1   0.0257\n10 sci_max           1   0.0257\n# … with 23 more rows\n\nตัดโรงเรียนที่มีค่าสูญหายออกจากชุดข้อมูลที่จะนำไปวิเคราะห์\n\n\nonet_p6_nomiss<-onet_p6%>%filter(!is.na(math_avg))\nonet_m3_nomiss<-onet_m3\nonet_m6_nomiss<-onet_m6%>%filter(!is.na(eng_avg))\n\n\n\nExploring data\nผลการวิเคราะห์ข้อมูลเบื้องต้นพบว่า ในชุดข้อมูล onet มีข้อมูลคะแนนสอบจากโรงเรียนต่าง ๆ โดยมีโรงเรียนในระดับชั้นป.6 เป็นส่วนใหญ่จำนวน 30692 โรงเรียน รองลงมาคือระดับชั้นม.3 จำนวน 11919 โรงเรียน และระดับม.6 จำนวน 3898 โรงเรียน\n\n\nlibrary(ggplot2)\n\n# จำนวนโรงเรียนจำแนกตามระดับชั้น\ntemp<-onet_p6%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\nnames(temp)[2]<-\"p6\"\nm3<-onet_m3%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\nm6<-onet_m6%>%group_by(PROV_NAME)%>%count()%>%arrange(PROV_NAME)\ntemp$m3<-m3$n\ntemp$m6<-m6$n\ncolSums(temp[,2:4])\n\n\n   p6    m3    m6 \n30692 11919  3898 \n\nbarplot(colSums(temp[,2:4]))\n\n\n\n\nจำนวนโรงเรียนจำแนกตามสังกัด พบว่าโรงเรียนส่วนใหญ่เป็นโรงเรียนสังกัด สพฐ. รองลงมาคือ สช. อทป. และกรุงเทพมหานคร\n\n\n#ระดับชั้น ป.6\ntable(onet_p6$BUREA_NAME)\n\n\n\n            กรมส่งเสริมการปกครองท้องถิ่น \n                                860 \n        กองบัญชาการตำรวจตระเวนชายแดน \n                                206 \n                        สถาบันพลศึกษา \n                                  1 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                431 \n                สำนักการศึกษาเมืองพัทยา \n                                 10 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                              26815 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 40 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                               2274 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                  1 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n                             โฮมสคูล \n                                  4 \n\n#ระดับชั้น ม.3\ntable(onet_m3$BUREA_NAME)\n\n\n\n            กรมส่งเสริมการปกครองท้องถิ่น \n                                631 \n        กองบัญชาการตำรวจตระเวนชายแดน \n                                  3 \n              สถาบันบัณฑิตพัฒนศิลป์ (ม.6) \n                                 12 \n                        สถาบันพลศึกษา \n                                 11 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                109 \n                สำนักการศึกษาเมืองพัทยา \n                                 11 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                               9336 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 35 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                               1319 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                402 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n\n#ระดับชั้น ม.6\ntable(onet_m6$BUREA_NAME)\n\n\n\n  กรมยุทธศึกษาทหาร กองบัญชาการทหารสูงสุด \n                                  1 \n            กรมส่งเสริมการปกครองท้องถิ่น \n                                345 \n              ในกำกับกระทรวงศึกษาธิการ \n                                  1 \n              สถาบันบัณฑิตพัฒนศิลป์ (ม.6) \n                                 11 \n                        สถาบันพลศึกษา \n                                 11 \n           สำนักการศึกษา กรุงเทพมหานคร \n                                  9 \n                สำนักการศึกษาเมืองพัทยา \n                                  1 \n    สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน \n                               2452 \n        สำนักงานคณะกรรมการการอุดมศึกษา \n                                 31 \nสำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน \n                                711 \n           สำนักงานพระพุทธศาสนาแห่งชาติ \n                                274 \n            สำนักบริหารงานการศึกษาพิเศษ \n                                 50 \n          สำนักพัฒนาสังคม กรุงเทพมหานคร \n                                  1 \n\nเมื่อพิจารณาจำแนกตามจังหวัด พบว่า จังหวัดนครราชสีมาเป็นจังหวัดที่มีโรงเรียนมากที่สุด รองลงมาคือจังหวัดกรุงเทพฯ อุบลราชธานี และขอนแก่น ส่วนจังหวัดที่มีโรงเรียนน้อยที่สุดคือจังหวัดระนอง\n\n\n# generate barplot\ntemp%>%pivot_longer(cols=c(\"p6\",\"m3\",\"m6\"), \n                    names_to=\"level\", \n                    values_to=\"freq\")%>%\n       mutate(level=factor(level, levels=c(\"p6\",\"m3\",\"m6\")))%>%\n  ggplot()+\n  geom_bar(aes(x=reorder(PROV_NAME, freq), \n               y=freq, fill=level), \n                stat=\"identity\")+xlab(\"จังหวัด \\n\")+ylab(\"จำนวนโรงเรียน\")+\n                coord_flip()+theme_minimal()+\n                theme(text=element_text(family=\"ChulaCharasNew\"))\n\n\n\n\nผลการวิเคราะห์ต่อไปนี้แสดงการแจกแจงของคะแนนสอบ onet ในระดับโรงเรียน ในแต่ละรายวิชาโดยจำแนกตามระดับชั้นของนักเรียน\nคะแนน onet ของนักเรียนระดับชั้น ป.6 จำแนกตามรายวิชา\n\n\nlibrary(gridExtra)\n\n# ระดับชั้น ป.6\nsummary(onet_p6_nomiss[,15:18])\n\n\n    math_avg        sci_avg         eng_avg         thai_sd      \n Min.   : 0.00   Min.   : 6.00   Min.   : 7.50   Min.   : 0.000  \n 1st Qu.:27.73   1st Qu.:34.25   1st Qu.:28.75   1st Qu.: 9.677  \n Median :33.12   Median :38.00   Median :32.50   Median :12.139  \n Mean   :34.68   Mean   :38.28   Mean   :34.46   Mean   :11.602  \n 3rd Qu.:40.00   3rd Qu.:41.97   3rd Qu.:37.97   3rd Qu.:14.055  \n Max.   :95.00   Max.   :74.50   Max.   :97.50   Max.   :31.125  \n\np1<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_p6_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\ngrid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)\n\n\n\n\nคะแนน onet ของนักเรียนระดับชั้น ม.3 จำแนกตามรายวิชา\n\n\n# ระดับชั้น ม.3\nsummary(onet_m3_nomiss[,15:18])\n\n\n    eng_avg         math_avg        sci_avg         thai_sd     \n Min.   :15.00   Min.   : 8.00   Min.   :16.00   Min.   : 0.00  \n 1st Qu.:25.09   1st Qu.:23.19   1st Qu.:31.37   1st Qu.:11.06  \n Median :26.22   Median :25.27   Median :33.50   Median :12.79  \n Mean   :26.93   Mean   :26.25   Mean   :33.96   Mean   :12.42  \n 3rd Qu.:27.50   3rd Qu.:27.73   3rd Qu.:35.99   3rd Qu.:14.18  \n Max.   :84.19   Max.   :93.28   Max.   :72.65   Max.   :23.16  \n\np1<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_m3_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\ngrid.arrange(p1,p2,p3,p4, nrow=2, ncol=2)\n\n\n\n\nคะแนน onet ของนักเรียนระดับชั้น ม.6 จำแนกตามรายวิชา\n\n\n# ระดับชั้น ม.6\nsummary(onet_m6_nomiss[,15:19])\n\n\n    soc_avg         eng_avg         math_avg        sci_avg     \n Min.   :17.00   Min.   :12.50   Min.   : 7.50   Min.   : 9.60  \n 1st Qu.:30.74   1st Qu.:22.09   1st Qu.:18.86   1st Qu.:25.13  \n Median :32.34   Median :23.75   Median :21.20   Median :26.80  \n Mean   :32.64   Mean   :26.14   Mean   :23.76   Mean   :27.44  \n 3rd Qu.:34.02   3rd Qu.:26.41   3rd Qu.:25.07   3rd Qu.:28.68  \n Max.   :57.36   Max.   :86.12   Max.   :97.31   Max.   :76.32  \n    thai_sd     \n Min.   : 0.00  \n 1st Qu.:10.83  \n Median :12.38  \n Mean   :11.99  \n 3rd Qu.:13.58  \n Max.   :21.99  \n\np1<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=thai_avg))+xlim(0,100)\np2<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=math_avg))+xlim(0,100)\np3<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=sci_avg))+xlim(0,100)\np4<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=eng_avg))+xlim(0,100)\np5<-ggplot(data=onet_m6_nomiss)+geom_histogram(aes(x=soc_avg))+xlim(0,100)\n\ngrid.arrange(p1,p2,p3,p4,p5, nrow=3, ncol=2)\n\n\n\n\nPrincipal Component Analysis (PCA)\nนอกจากค่าเฉลี่ยคะแนน onet ของแต่ละโรงเรียนแล้ว ยังมีค่าสถิติของคะแนนอื่น ๆ ได้แก่ sd, min และ max ซึ่งให้สารสนเทศในมิติต่าง ๆ เกี่ยวกับการแจกแจงของคะแนน onet ในแต่ละโรงเรียนด้วย อย่างไรก็ตามข้อมูลมีปริมาณค่อนข้างมาก และหลายระดับชั้น หากนำตัวแปรทั้งหมดมาวิเคราะห์จะทำให้มีความซับซ้อนเกินไป วิธีการหนึ่งที่สามารถลดทอนข้อมูลดังกล่าวได้คือการใช้เทคนิค PCA ซึ่งเป็นการยุบรวมตัวแปรหลาย ๆ ตัวเข้าด้วยกันเพื่อสร้างสเกลของตัวแปรใหม่โดยใช้ความสัมพันธ์ระหว่างตัวแปร\nก่อนการวิเคราะห์ PCA ผู้วิเคราะห์ดำเนินการตรวจสอบความสัมพันธ์ระหว่างค่าสถิติดังกล่าวโดยใช้แผนภาพการกระจายและสัมประสิทธิ์สหสัมพันธ์ก่อน โดยจำแนกตามระดับชั้นของนักเรียน ได้ผลการวิเคราะห์ดังนี้\n\n\nlibrary(GGally)\ncor_p6<-onet_p6_nomiss%>%select(ends_with(c(\"avg\")))%>%cor()\ncor_m3<-onet_m3_nomiss%>%select(ends_with(c(\"avg\")))%>%cor(use=\"complete.obs\")\ncor_m6<-onet_m6_nomiss%>%select(ends_with(c(\"avg\")))%>%cor(use=\"complete.obs\")\n\n#correlation p6\ncor_p6\n\n\n          thai_avg  math_avg   sci_avg   eng_avg\nthai_avg 1.0000000 0.7249939 0.7471793 0.6088336\nmath_avg 0.7249939 1.0000000 0.7084016 0.6460727\nsci_avg  0.7471793 0.7084016 1.0000000 0.6017332\neng_avg  0.6088336 0.6460727 0.6017332 1.0000000\n\n#correlation m3\ncor_m3\n\n\n          thai_avg   eng_avg  math_avg   sci_avg\nthai_avg 1.0000000 0.4754923 0.6683351 0.7822189\neng_avg  0.4754923 1.0000000 0.6603974 0.5139788\nmath_avg 0.6683351 0.6603974 1.0000000 0.7151848\nsci_avg  0.7822189 0.5139788 0.7151848 1.0000000\n\n#correlation m6\ncor_m6\n\n\n          thai_avg   soc_avg   eng_avg  math_avg   sci_avg\nthai_avg 1.0000000 0.8982477 0.7483392 0.8335856 0.8269468\nsoc_avg  0.8982477 1.0000000 0.7389249 0.8298790 0.8280027\neng_avg  0.7483392 0.7389249 1.0000000 0.8714466 0.8029595\nmath_avg 0.8335856 0.8298790 0.8714466 1.0000000 0.9007536\nsci_avg  0.8269468 0.8280027 0.8029595 0.9007536 1.0000000\n\nPCA on p6 dataset\nvar$coord: coordinates of variables to create a scatter plot\nvar$cos2: represents the quality of representation for variables on the factor map. It’s calculated as the squared coordinates: - - - var.cos2 = var.coord * var.coord.\nvar$contrib: contains the contributions (in percentage) of the variables to the principal components. The contribution of a variable (var) to a given principal component is (in percentage) : (var.cos2 * 100) / (total cos2 of the component)\n\n\nlibrary(factoextra)\npca_p6_fit<-princomp(onet_p6_nomiss%>%select(ends_with(c(\"avg\")))%>%data.frame(), scores=TRUE, cor=TRUE)\nfviz_screeplot(pca_p6_fit)\n\n\n\nget_eig(pca_p6_fit)\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1  3.0220158        75.550395                    75.55039\nDim.2  0.4406782        11.016955                    86.56735\nDim.3  0.2869393         7.173482                    93.74083\nDim.4  0.2503668         6.259169                   100.00000\n\nvar <- get_pca_var(pca_p6_fit)\nvar$coord #factor loadings\n\n\n             Dim.1       Dim.2       Dim.3       Dim.4\nthai_avg 0.8896884  0.23051132  0.07507016  0.38688952\nmath_avg 0.8882723  0.04449422 -0.44394055 -0.10913034\nsci_avg  0.8822783  0.24809599  0.26758744 -0.29737235\neng_avg  0.8142651 -0.56921996  0.11232759  0.01853388\n\n#var$cos2 # squared loadings\n#var$contrib #prop. squared loadings\n\n\n\n\n\nfviz_pca_var(pca_p6_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet จาก 4 รายวิชา ให้เหลือเพียงตัวแปรเดียวเรียกว่า คะแนนผลสัมฤทธิ์ onet โดยรวม โดยตัวแปรดังกล่าวสามารถอธิบายความแปรปรวนของตัวแปรเดิมทั้ง 4 ได้คิดเป็นร้อยละ 75.55\nแผนภาพต่อไปนี้แสดงการแจกแจงของคะแนนผลสัมฤทธิ์ onet โดยรวมระดับโรงเรียน ของนักเรียนระดับชั้นประถมศึกษาปีที่ 6 โดยการแจกแจงในภาพรวมแสดงด้วยแผนภาพ histogram และใช้ boxplot แสดงการแจกแจงของคะแนนจำแนกตามสังกัดของโรงเรียน\n\n\nonet_p6_nomiss$com1<-pca_p6_fit$scores[,1]\np1<-ggplot(onet_p6_nomiss)+geom_histogram(aes(x=com1))+xlab(\"P6 Ach component\")\np1\n\n\n\nsummary(onet_p6_nomiss$com1)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-5.7595 -1.1640 -0.1689  0.0000  0.9826 10.7712 \n\n\n\np1<-ggplot(data=onet_p6_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"Thai-Sci-Math Component\")\np1\n\n\n\n\nPCA on m3 dataset\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1  2.9176275        72.940687                    72.94069\nDim.2  0.6031477        15.078693                    88.01938\nDim.3  0.2685367         6.713417                    94.73280\nDim.4  0.2106881         5.267203                   100.00000\n             Dim.1      Dim.2        Dim.3       Dim.4\nthai_avg 0.8635889  0.3649334  0.223128029  0.26693036\neng_avg  0.7608661 -0.6095065  0.220469519 -0.03126968\nmath_avg 0.8949234 -0.1216248 -0.412371593  0.11945371\nsci_avg  0.8899644  0.2892760  0.009665917 -0.35240508\n\n\n\nonet_m3_nomiss$com1<-pca_m3_fit$scores[,1]\np1<-ggplot(onet_m3_nomiss)+geom_histogram(aes(x=com1))+xlab(\"M3 Ach component\")+xlim(-6,6)\np1\n\n\n\n\n\n\nfviz_pca_var(pca_m3_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet ในระดับมัธยมศึกษาปีที่ 3 ได้เหลือ 1 องค์ประกอบ เรียกองค์ประกอบนี้ว่าผลสัมฤทธิ์ onet โดยรวม เช่นเดียวกับที่วิเคราะห์ในระดับชั้น ป.6 โดยองค์ประกอบดังกล่าวสามารถอธิบายความแปรปรวนของตัวแปรเดิมได้คิดเป็นร้อยละ 72.94\n\n\np1<-ggplot(data=onet_m3_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"Thai-Eng-Math Component\")\np1\n\n\n\n\nPCA on m6 dataset\n\n\n      eigenvalue variance.percent cumulative.variance.percent\nDim.1 4.31357346        86.271469                    86.27147\nDim.2 0.33038711         6.607742                    92.87921\nDim.3 0.17199471         3.439894                    96.31911\nDim.4 0.10146913         2.029383                    98.34849\nDim.5 0.08257558         1.651512                   100.00000\n             Dim.1      Dim.2       Dim.3        Dim.4        Dim.5\nthai_avg 0.9277860  0.2765852  0.11073757  0.224218975  0.013300204\nsoc_avg  0.9251801  0.2943146  0.08104849 -0.225466624  0.004082051\neng_avg  0.8948587 -0.3765740  0.22177892 -0.015571887  0.089395775\nmath_avg 0.9558159 -0.1514528 -0.08895745  0.007435426 -0.235604288\nsci_avg  0.9394001 -0.0502069 -0.30994149  0.007874978  0.137408289\n\n\n\nonet_m6_nomiss$com1<-pca_m6_fit$scores[,1]\np1<-ggplot(onet_m6_nomiss)+geom_histogram(aes(x=com1))+xlab(\"Thai-Soc-Eng-Math component\")\np1\n\n\n\n\n\n\nfviz_pca_var(pca_m6_fit, repel=TRUE)\n\n\n\n\nผลการวิเคราะห์ข้างต้นแสดงให้เห็นว่าการใช้ PCA สามารถลดทอนตัวแปรเดิมที่เป็นคะแนน onet ในระดับมัธยมศึกษาปีที่ 6 ได้เหลือ 1 องค์ประกอบ เรียกองค์ประกอบนี้ว่า ผลสัมฤทธิ์ onet โดยรวม โดยองค์ประกอบนี้สามารถอธิบายความแปรปรวนของตัวแปรเดิมได้คิดเป็นร้อยละ 86.27\n\n\np1<-ggplot(data=onet_m6_nomiss)+\n  geom_boxplot(aes(x=com1, y=BUREA_NAME, fill=BUREA_NAME))+\n  theme_minimal()+\n  theme(legend.position = \"none\",\n        text=element_text(family=\"ChulaCharasNew\"))+\n  xlab(\"Thai-Soc-Eng-Math Component\")\n\np1\n\n\n\n\nStudent background dataset\nชุดข้อมูลพื้นฐานนักเรียนได้จากฐานข้อมูลนักเรียนรายบุคคลที่เข้าสอบ onet ปีการศึกษา 2561 ข้อมูลชุดนี้มีตัวแปรที่สำคัญและอาจนำไปใช้ต่อได้ ได้แก่ เพศของนักเรียน (GENDER) ระดับชั้นของนักเรียน (XM_GRADE_CODE) รายได้พ่อ แม่ และ ผู้ปกครอง (DAD_INCOME, MOM_INCOME และ PARENT_INCOME) และสถานภาพทางครอบครัวของนักเรียน ได้แก่ สถานะครอบครัว (LIVING_ID) สถานะภาพพ่อแม่ (LIVING_PARENT_ID) และสภาพที่พักอาศัยของนักเรียน (LIVING_TYPE_ID)\n\n\nstudent_bg<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/dbo_VW_SON_STUDENT_DATA.xlsx\")\nglimpse(student_bg)\n\n\nRows: 1,048,575\nColumns: 20\n$ STUDENT_SEQ      <chr> \"65\", \"66\", \"67\", \"68\", \"69\", \"70\", \"71\", \"…\n$ GRADE_CODE       <chr> \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"…\n$ SCHOOL_CODE      <chr> \"7043010809\", \"7043010809\", \"7043010809\", \"…\n$ STUDENT_ID       <chr> \"70580602\", \"70590650\", \"70580604\", \"705806…\n$ GENDER           <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\"…\n$ DOB              <chr> \"25460512\", \"25420801\", \"25450912\", \"254510…\n$ SEAT_NO          <chr> \"43100432\", \"43100421\", \"43100506\", \"431005…\n$ STUDENT_STATUS   <chr> \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\"…\n$ SPC_CODE         <chr> NA, \"009\", NA, NA, NA, NA, NA, NA, \"009\", N…\n$ XM_GRADE_CODE    <chr> \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"M3\", \"…\n$ DAD_INCOME       <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ MOM_INCOME       <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ PARENT_INCOME    <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ DAD_CAREER       <dbl> 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ MOM_CAREER       <dbl> 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ PARENT_CAREER    <dbl> 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ LIVING_ID        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ NUM_OF_SIBLINGS  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ LIVING_PARENT_ID <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ LIVING_TYPE_ID   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n\nSchool background dataset\nชุดข้อมูลพื้นฐานโรงเรียนได้จาก ระบบสารสนเทศเพื่อบริหารการศึกษา (EMIS) กลุ่มสารสนเทศ สนผ. สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน ฐานข้อมูลนี้เก็บรวบรวมข้อมูลระดับโรงเรียนในสังกัด สพฐ. จากทั่วประเทศ จำนวน 30,112 โรงเรียน โดยมีข้อมูลที่ถูกบันทึกเอาไว้ 97 รายการ อย่างไรก็ตามมีหลายรายการที่ไม่ใช่ข้อมูลที่เกี่ยวข้องกับการวิเคราะห์\n\n\nschool_bg<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/dat61.xlsx\")\ndim(school_bg)\n\n\n[1] 30112    97\n\nONESQA dataset\nชุดข้อมูลผลประเมินคุณภาพภายนอกรอบที่ 3 ของโรงเรียน ได้จาก สมศ. ตัวบ่งชี้ที่ใช้สำหรับประเมินคุณภาพภายนอกของโรงเรียนจำแนกเป็นสองกลุ่ม กลุ่มแรกเป็นตัวบ่งชี้สำหรับการศึกษาระดับปฐมวัย และส่วนที่สองเป็นตัวบ่งชี้สำหรับการศึกษาขั้นพื้นฐานระดับอื่น ๆ\n\n\n\n\nonesqa<-read_excel(\"/Users/siwachoat/Documents/distill website/myresearch/_posts/2022-02-20-inequality/onesqa3.xlsx\", skip=6)\n\n\n\nData Exploring and Manipulating\nผลการวิเคราะห์พบว่า โรงเรียนส่วนใหญ่อยู่ในสังกัด สพฐ. รองลงมาคือ สช. อปท. กทม. ตชด. การศึกษาพิเศษ สกอ. เมืองพัทยา โฮมสคูล และสถาบันพลศึกษา\n\n\n# จำแนกตามสังกัดของโรงเรียนและระดับชั้น\ntemp<-onet_p6%>%group_by(BUREA_NAME)%>%count()%>%arrange(BUREA_NAME)\nnames(temp)[2]<-\"p6\"\nm3<-onet_m3%>%group_by(BUREA_NAME)%>%count()%>%arrange(BUREA_NAME)\nm6<-onet_m6%>%group_by(BUREA_NAME)%>%count()%>%arrange(BUREA_NAME)\ntemp<-merge(temp,m3, by.x=\"BUREA_NAME\", by.y=\"BUREA_NAME\", all=TRUE)\ntemp<-merge(temp,m6, by.x=\"BUREA_NAME\", by.y=\"BUREA_NAME\", all=TRUE)\nnames(temp)[2:4]<-c(\"p6\",\"m3\",\"m6\")\ntemp%>%arrange(desc(p6))\n\n\n                            BUREA_NAME    p6   m3   m6\n1      สำนักงานคณะกรรมการการศึกษาขั้นพื้นฐาน 26815 9336 2452\n2  สำนักงานคณะกรรมการส่งเสริมการศึกษาเอกชน  2274 1319  711\n3              กรมส่งเสริมการปกครองท้องถิ่น   860  631  345\n4             สำนักการศึกษา กรุงเทพมหานคร   431  109    9\n5          กองบัญชาการตำรวจตระเวนชายแดน   206    3   NA\n6              สำนักบริหารงานการศึกษาพิเศษ    50   50   50\n7          สำนักงานคณะกรรมการการอุดมศึกษา    40   35   31\n8                  สำนักการศึกษาเมืองพัทยา    10   11    1\n9                               โฮมสคูล     4   NA   NA\n10                         สถาบันพลศึกษา     1   11   11\n11            สำนักงานพระพุทธศาสนาแห่งชาติ     1  402  274\n12   กรมยุทธศึกษาทหาร กองบัญชาการทหารสูงสุด    NA   NA    1\n13               ในกำกับกระทรวงศึกษาธิการ    NA   NA    1\n14               สถาบันบัณฑิตพัฒนศิลป์ (ม.6)    NA   12   11\n15           สำนักพัฒนาสังคม กรุงเทพมหานคร    NA   NA    1\n\nTidying and Manipulating Onet datasets\nDistill is a publication format for scientific and technical writing, native to the web.\nLearn more about using Distill at https://rstudio.github.io/distill.\n\n\n\n",
    "preview": "posts/2022-02-20-inequality/inequality_files/figure-html5/unnamed-chunk-5-1.png",
    "last_modified": "2022-02-23T22:16:37+07:00",
    "input_file": {}
  }
]
